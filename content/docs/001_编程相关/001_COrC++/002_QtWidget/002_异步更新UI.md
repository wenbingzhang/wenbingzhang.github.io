---
slug: 6DHpyx7jyybZRnVW7qREMY
title: ğŸ“ å¼‚æ­¥æ›´æ–°UI
date: 2025-05-13 20:19:27+08:00
bookComments: false
bookHidden: false
bookCollapseSection: false
weight: 2
---

## å¼‚æ­¥å®šæ—¶æ›´æ–°UI
å°½é‡çš„å‡å°‘å¡UIé—®é¢˜
```c++
//
// Created by å¼ æ–‡å…µ on 2025/5/13.
//

#ifndef TASKRUNNER_H
#define TASKRUNNER_H
#include <QFuture>
#include <QElapsedTimer>
#include <QtConcurrent>
#include <atomic>
#include <functional>
#include <QThread>

class TaskRunner {
public:
    TaskRunner() = default;

    ~TaskRunner() { stop(); }

    void start(const int intervalMs, const std::function<void()> &task) {
        if (m_future.isRunning()) {
            return;
        }

        m_exit = false;
        m_future = QtConcurrent::run([=]() {
            QElapsedTimer timer;
            task(); // ç«‹å³æ‰§è¡Œä¸€æ¬¡
            timer.start();
            while (!m_exit) {
                if (timer.elapsed() >= intervalMs) {
                    task(); // å‘¨æœŸæ‰§è¡Œ
                    timer.restart();
                }
                if (!m_exit) {
                    QThread::msleep(100); // å¯è°ƒç²¾åº¦
                }
            }
        });
    }

    void stop() {
        m_exit = true;
        if (m_future.isRunning()) {
            m_future.waitForFinished();
        }
    }

private:
    std::atomic<bool> m_exit = false;
    QFuture<void> m_future;
};
#endif //TASKRUNNER_H

```

## ä½¿ç”¨æ–¹å¼
```c++
// è¿è¡Œä»»åŠ¡
m_taskRunner->start(5000, [this]() {
    onUpdateTaskInfo();
});

// åœæ­¢ä»»åŠ¡
m_taskRunner->stop();
```