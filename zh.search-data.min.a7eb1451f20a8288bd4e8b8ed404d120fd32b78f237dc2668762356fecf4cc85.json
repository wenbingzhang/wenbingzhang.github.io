[{"id":0,"href":"/notes/2025/02/10/7auahqg8nnxm5ydhxzqrnr/","title":"ğŸ“ è°ƒç”¨Pythonä»£ç ","section":"ğŸ”– Python","content":"#include \u0026lt;cstdio\u0026gt; #include \u0026lt;iostream\u0026gt; #include \u0026lt;Python.h\u0026gt; // åŒ…å« Python å¤´æ–‡ä»¶ int main() { // åˆå§‹åŒ– Python è§£é‡Šå™¨ Py_Initialize(); // åˆ›å»ºä¸€ä¸ª Python å­—å…¸æ¥ä¼ é€’å‚æ•° PyObject* pName = PyUnicode_FromString(\u0026#34;__main__\u0026#34;); PyObject* pModule = PyImport_Import(pName); Py_XDECREF(pName); if (pModule != nullptr) { // åˆ›å»ºä¸€ä¸ªå…¨å±€å­—å…¸æ¥å­˜å‚¨å‚æ•° PyObject* pGlobals = PyModule_GetDict(pModule); // å°†å‚æ•°ä½œä¸º Python å¯¹è±¡æ·»åŠ åˆ°å…¨å±€å­—å…¸ä¸­ PyDict_SetItemString(pGlobals, \u0026#34;param1\u0026#34;, PyLong_FromLong(42)); // ç¤ºä¾‹å‚æ•°1 PyDict_SetItemString(pGlobals, \u0026#34;param2\u0026#34;, PyUnicode_FromString(\u0026#34;Hello from C++\u0026#34;)); // ç¤ºä¾‹å‚æ•°2 // å®šä¹‰å¹¶æ‰§è¡Œ Python ä»£ç  const char* script = R\u0026#34;( import platform import sys import os system_info = { \u0026#39;param1\u0026#39;: param1, \u0026#39;param2\u0026#39;: param2, \u0026#39;OS\u0026#39;: platform.system(), \u0026#39;OS Version\u0026#39;: platform.version(), \u0026#39;Release\u0026#39;: platform.release(), \u0026#39;Machine\u0026#39;: platform.machine(), \u0026#39;Processor\u0026#39;: platform.processor(), \u0026#39;Python Version\u0026#39;: sys.version, } print(system_info) )\u0026#34;; // æ‰§è¡Œ Python ä»£ç  const auto result = PyRun_SimpleString(script); std::cout \u0026lt;\u0026lt; \u0026#34;Result from Python: \u0026#34; \u0026lt;\u0026lt; result \u0026lt;\u0026lt; std::endl; Py_XDECREF(pModule); } else { PyErr_Print(); std::cerr \u0026lt;\u0026lt; \u0026#34;Failed to load the Python script\u0026#34; \u0026lt;\u0026lt; std::endl; } // å…³é—­ Python è§£é‡Šå™¨ Py_Finalize(); return 0; } "},{"id":1,"href":"/notes/2024/08/01/rnc4n7cfifidx8ca2rhjme/","title":"ğŸ“ QMLé¼ æ ‡äº‹ä»¶","section":"ğŸ”– Qt","content":" ç¤ºä¾‹ä»£ç  # import QtQuick 2.15 import QtQuick.Controls 2.15 ApplicationWindow { visible: true width: 640 height: 480 Rectangle { id: container width: 200 height: 200 color: \u0026#34;lightblue\u0026#34; MouseArea { anchors.fill: parent onEntered: { console.log(\u0026#34;Mouse entered\u0026#34;) container.color = \u0026#34;lightgreen\u0026#34; } onExited: { console.log(\u0026#34;Mouse exited\u0026#34;) container.color = \u0026#34;lightblue\u0026#34; } } } } é—®é¢˜æè¿° # é¼ æ ‡è¿›å…¥çŸ©å½¢åŒºåŸŸæ—¶ï¼Œä¸ä¼šæ”¹å˜çŸ©å½¢çš„é¢œè‰²ã€‚\nè§£å†³æ–¹æ³• # éœ€è¦åœ¨MouseAreaä¸­è®¾ç½®hoverEnabled: trueå±æ€§ï¼Œè¿™æ ·é¼ æ ‡è¿›å…¥çŸ©å½¢åŒºåŸŸæ—¶ï¼Œä¼šè§¦å‘onEnteredäº‹ä»¶ï¼Œæ”¹å˜çŸ©å½¢çš„é¢œè‰²ã€‚\n"},{"id":2,"href":"/notes/2024/06/06/sf4ff6x8cuyhvzougj9dwg/","title":"ğŸ“ MacOSç­¾å","section":"ğŸ”– MacOSç›¸å…³","content":" ä¸‹è½½æ ¹è¯ä¹¦ # https://www.apple.com/certificateauthority/DeveloperIDG2CA.cer\nå¯¼å…¥æ ¹è¯ä¹¦ # sudo security import ~/Downloads/DeveloperIDG2CA.cer \\ -k /Library/Keychains/System.keychain \\ -T /usr/bin/codesign \\ -T /usr/bin/security \\ -T /usr/bin/productbuild æŸ¥çœ‹å’Œæ¸…ç†ç‰¹æ®Šå±æ€§ # xattr -lr xxx.app xattr -cr xxx.app ç­¾å‘APP # codesign --deep --force --verbose --sign \u0026#34;xxxx\u0026#34; xxx.app éªŒè¯ç­¾å # spctl --assess --type execute --verbose=4 xxx.app å‚è€ƒæ–‡æ¡£ # https://testerhome.com/topics/33338\nhttps://www.apple.com/certificateauthority/\nhttps://www.jianshu.com/p/f420649fba42\n"},{"id":3,"href":"/notes/2024/03/11/j3c62fv8dglvf2kg975zlv/","title":"ğŸ“ æ ‡ç­¾æ“ä½œ","section":"ğŸ“” Git","content":" åˆ›å»ºæ ‡ç­¾ # git tag \u0026lt;tagname\u0026gt; æ¨é€æ ‡ç­¾åˆ°è¿œç¨‹ä»“åº“ # git push origin \u0026lt;tagname\u0026gt; æ¨é€æ‰€æœ‰æ ‡ç­¾åˆ°è¿œç¨‹ä»“åº“ # git push origin --tags æŸ¥çœ‹æœ¬åœ°æ‰€æœ‰æ ‡ç­¾ # git tag æŸ¥çœ‹è¿œç¨‹æ‰€æœ‰æ ‡ç­¾ # git ls-remote --tags origin åˆ é™¤æœ¬åœ°æˆ–è¿œç¨‹æ ‡ç­¾ # git tag -d \u0026lt;tagname\u0026gt; # åˆ é™¤è¿œç¨‹æ ‡ç­¾ git push origin :refs/tags/\u0026lt;tagname\u0026gt; "},{"id":4,"href":"/notes/2024/03/06/e3ksq3zkmps14gcxuirwzx/","title":"ğŸ“ æ‰€æœ‰æƒ","section":"ğŸ”– å­¦ä¹ ç¬”è®°","content":" æ‰€æœ‰æƒ # æ‰€æœ‰æƒè§„åˆ™ # Rust ä¸­çš„æ¯ä¸€ä¸ªå€¼éƒ½æœ‰ä¸€ä¸ª æ‰€æœ‰è€…ï¼ˆownerï¼‰ã€‚ å€¼åœ¨ä»»ä¸€æ—¶åˆ»æœ‰ä¸”åªæœ‰ä¸€ä¸ªæ‰€æœ‰è€…ã€‚ å½“æ‰€æœ‰è€…ï¼ˆå˜ï¥¾ï¼‰ç¦»å¼€ä½œç”¨åŸŸï¼Œè¿™ä¸ªå€¼å°†è¢«ä¸¢å¼ƒã€‚ å¯Copyçš„ç±»å‹ # æ‰€æœ‰æ•´æ•°ç±»å‹ï¼Œæ¯”å¦‚ u32 ã€‚ å¸ƒå°”ç±»å‹ï¼Œbool ï¼Œå®ƒçš„å€¼æ˜¯ true å’Œ false ã€‚ æ‰€æœ‰æµ®ç‚¹æ•°ç±»å‹ï¼Œæ¯”å¦‚ f64 ã€‚ å­—ç¬¦ç±»å‹ï¼Œchar ã€‚ å…ƒç»„ï¼Œå½“ä¸”ä»…å½“å…¶åŒ…å«çš„ç±»å‹ä¹Ÿéƒ½å®ç° Copy çš„æ—¶å€™ã€‚æ¯”å¦‚ï¼Œ(i32, i32) å®ç°äº† Copy ï¼Œä½†(i32, String) å°±æ²¡æœ‰ã€‚ "},{"id":5,"href":"/notes/2025/02/10/gqci9riugfetribe6j6fou/","title":"ğŸ“ è°ƒç”¨Pythonæ–¹æ³•","section":"ğŸ”– Python","content":"#include \u0026lt;Python.h\u0026gt; #include \u0026lt;iostream\u0026gt; int main() { // åˆå§‹åŒ– Python è§£é‡Šå™¨ Py_Initialize(); // åˆ›å»º Python å­—å…¸å¹¶å°†å‚æ•°ä¼ é€’ç»™ Python PyObject* pName = PyUnicode_FromString(\u0026#34;__main__\u0026#34;); PyObject* pModule = PyImport_Import(pName); Py_XDECREF(pName); if (pModule != nullptr) { // åˆ›å»ºä¸€ä¸ªå…¨å±€å­—å…¸æ¥å­˜å‚¨å‚æ•° PyObject* pGlobals = PyModule_GetDict(pModule); // åˆ›å»º Python å‡½æ•° const char* func_code = R\u0026#34;( def my_function(param1, param2): return f\u0026#34;Received param1: {param1}, param2: {param2}\u0026#34; )\u0026#34;; // æ‰§è¡Œå®šä¹‰å‡½æ•°çš„ä»£ç  PyRun_SimpleString(func_code); // è·å– Python å‡½æ•°å¯¹è±¡ PyObject* pFunc = PyDict_GetItemString(pGlobals, \u0026#34;my_function\u0026#34;); if (PyCallable_Check(pFunc)) { // å‡†å¤‡å‚æ•° PyObject* pArgs = PyTuple_Pack(2, PyLong_FromLong(42), PyUnicode_FromString(\u0026#34;Hello from C++\u0026#34;)); // è°ƒç”¨å‡½æ•° PyObject* pValue = PyObject_CallObject(pFunc, pArgs); if (pValue != nullptr) { // æ‰“å°å‡½æ•°è¿”å›å€¼ std::cout \u0026lt;\u0026lt; \u0026#34;Function returned: \u0026#34; \u0026lt;\u0026lt; PyUnicode_AsUTF8(pValue) \u0026lt;\u0026lt; std::endl; Py_XDECREF(pValue); } else { PyErr_Print(); } Py_XDECREF(pArgs); } else { PyErr_Print(); } } else { PyErr_Print(); std::cerr \u0026lt;\u0026lt; \u0026#34;Failed to load the Python module\u0026#34; \u0026lt;\u0026lt; std::endl; } // å…³é—­ Python è§£é‡Šå™¨ Py_Finalize(); return 0; } "},{"id":6,"href":"/notes/2024/08/06/ny773erqjgbzmzgfikfvds/","title":"ğŸ“ QMLè™šæ‹Ÿåˆ—è¡¨","section":"ğŸ”– Qt","content":"import QtQuick 2.15 import QtQuick.Controls 2.15 ApplicationWindow { visible: true width: 640 height: 28 Flickable { id: flickable width: parent.width height: parent.height contentWidth: 51200 // æ ¹æ®éœ€è¦è°ƒæ•´åˆ»åº¦å°ºé•¿åº¦ï¼ˆ1000ä¸ªåˆ»åº¦ï¼Œæ¯ä¸ªåˆ»åº¦é—´éš”51.2ï¼‰ clip: true Component.onCompleted: updateVisibleRange() onContentXChanged: updateVisibleRange() onWidthChanged: updateVisibleRange() function updateVisibleRange() { var itemWidth = 51.2; var firstIndex = Math.floor(flickable.contentX / itemWidth); var visibleCount = Math.ceil(flickable.width / itemWidth) + 1; firstVisibleIndex = firstIndex; lastVisibleIndex = firstIndex + visibleCount; createVisibleItems(); } property int firstVisibleIndex: 0 property int lastVisibleIndex: 0 function createVisibleItems() { itemContainer.children.forEach(function(item) { item.destroy(); }); for (var i = firstVisibleIndex; i \u0026lt;= lastVisibleIndex; i++) { var item = itemComponent.createObject(itemContainer, { index: i, width: 1, height: flickable.height, x: i * 51.2 }); } } Item { id: itemContainer anchors.fill: parent } Component { id: itemComponent Item { property int index Rectangle { property int itemIndex: index anchors.bottom: parent.bottom width: 1 height: index % 10 === 0 ? 18 : index % 5 === 0 ? 9 : 4 color: \u0026#34;black\u0026#34; Repeater { model: index % 10 === 0 ? 1 : 0 Label { anchors.left: parent.right anchors.leftMargin: 2 anchors.bottom: parent.bottom anchors.bottomMargin: 4 // color: activePalette.windowText text: parent.itemIndex } } } } } } } "},{"id":7,"href":"/notes/2024/05/28/3txbbb7iruppjsg4p7rwnb/","title":"ğŸ“ MacOSå †æ ˆå¤§å°","section":"ğŸ”– MacOSç›¸å…³","content":" é—®é¢˜ä»£ç  # char buffer[8*1024*1024]; é—®é¢˜åˆ†æ # macosç³»ç»Ÿé»˜è®¤çš„å †æ ˆå¤§å°ä¸º8MBï¼Œå¯ä»¥é€šè¿‡ulimitå‘½ä»¤æŸ¥çœ‹å’Œä¿®æ”¹ã€‚ ä½†æ˜¯ï¼Œå¦‚æœä»£ç ä¸­ä½¿ç”¨äº†å¤§é‡çš„å †æ ˆå˜é‡ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ ˆæº¢å‡ºï¼Œå¯¼è‡´ç¨‹åºå´©æºƒã€‚ # æŸ¥çœ‹ç³»ç»Ÿé»˜è®¤çš„å †æ ˆå¤§å° ulimit -a # æˆ–è€… ulimit -s è§£å†³æ–¹æ¡ˆ # char *buffer = new char[8*1024*1024]; // è®°å¾—é‡Šæ”¾ delete[] buffer; "},{"id":8,"href":"/notes/2024/03/14/5kqlzqjqawbxf2t6vusxar/","title":"ğŸ“ åˆ é™¤Commit","section":"ğŸ“” Git","content":"# è·å–commitä¿¡æ¯ git log # commit-id è¦åˆ é™¤commitçš„ä¸‹ä¸€ä¸ªcommit-id git rebase -i (commit-id) # ç¼–è¾‘æ–‡ä»¶ï¼Œå°†è¦åˆ é™¤çš„commitä¹‹å‰çš„pickæ”¹ä¸ºdrop # ä¿å­˜æ–‡ä»¶é€€å‡º # å†æ¬¡æŸ¥çœ‹commitä¿¡æ¯ï¼Œç¡®è®¤åˆ é™¤æˆåŠŸ git log "},{"id":9,"href":"/notes/2024/03/06/o4arkqgfnqygr5ckif2gkk/","title":"ğŸ“ å€Ÿç”¨ä¸å¼•ç”¨","section":"ğŸ”– å­¦ä¹ ç¬”è®°","content":" å€Ÿç”¨ä¸å¼•ç”¨ # åˆ›å»ºä¸€ä¸ªå¼•ç”¨çš„ï¨ˆä¸ºç§°ä¸º å€Ÿç”¨ å…è®¸ä½¿ç”¨å€¼ä½†ï¥§è·å–å…¶æ‰€æœ‰æƒ å¼•ç”¨è§„åˆ™ # åœ¨ä»»æ„ç»™å®šæ—¶é—´ï¼Œè¦ä¹ˆ åªèƒ½æœ‰ä¸€ä¸ªå¯å˜å¼•ç”¨ï¼Œè¦ä¹ˆ åªèƒ½æœ‰å¤šä¸ªï¥§å¯å˜å¼•ç”¨ã€‚ å¼•ç”¨å¿…é¡»æ€»æ˜¯æœ‰æ•ˆçš„ã€‚ å¯å˜å¼•ç”¨ # å…è®¸ä¿®æ”¹ä¸€ä¸ªå€Ÿç”¨çš„å€¼ï¼Œè¿™å°±æ˜¯å¯å˜å¼•ç”¨ï¼ˆ\u0026amp;mutï¼‰ã€‚\nfn main() { let mut s = String::from(\u0026#34;hello\u0026#34;); change(\u0026amp;mut s); } fn change(some_string: \u0026amp;mut String) { some_string.push_str(\u0026#34;, world\u0026#34;); } æ‚¬å‚å¼•ç”¨ï¼ˆDangling Referencesï¼‰ # fn main() { let reference_to_nothing = dangle(); } fn dangle() -\u0026gt; \u0026amp;String { // dangle è¿”å›ä¸€ä¸ªå­—ç¬¦ï¤…çš„å¼•ç”¨ let s = String::from(\u0026#34;hello\u0026#34;); // s æ˜¯ä¸€ä¸ªæ–°å­—ç¬¦ï¤… \u0026amp;s // è¿”å›å­—ç¬¦ï¤… s çš„å¼•ç”¨ } // è¿™ï§© s ç¦»å¼€ä½œç”¨åŸŸå¹¶è¢«ä¸¢å¼ƒã€‚å…¶å†…å­˜è¢«é‡Šæ”¾ã€‚ // å±é™©ï¼ "},{"id":10,"href":"/notes/2025/02/10/pkdrvn9md3ggfmbxahx4ef/","title":"ğŸ“ æ³¨å†ŒPythonæ¨¡å—","section":"ğŸ”– Python","content":"#include \u0026lt;Python.h\u0026gt; #include \u0026lt;iostream\u0026gt; // ç¤ºä¾‹ç»“æ„ä½“ï¼ˆC++å¯¹è±¡ï¼‰ struct MyStruct { int value; }; // C++ ä» Python è·å– `void*` å¹¶ä½¿ç”¨ static PyObject* use_object(PyObject* self, PyObject* args) { PyObject* capsule; if (!PyArg_ParseTuple(args, \u0026#34;O\u0026#34;, \u0026amp;capsule)) { return nullptr; } // å–å› `void*` å¹¶è½¬æ¢å› C++ æŒ‡é’ˆ auto* obj = static_cast\u0026lt;MyStruct*\u0026gt;(PyCapsule_GetPointer(capsule, \u0026#34;this\u0026#34;)); if (!obj) { PyErr_SetString(PyExc_RuntimeError, \u0026#34;Invalid capsule!\u0026#34;); return nullptr; } std::cout \u0026lt;\u0026lt; \u0026#34;Received C++ object with value: \u0026#34; \u0026lt;\u0026lt; obj-\u0026gt;value \u0026lt;\u0026lt; std::endl; return PyLong_FromLong(obj-\u0026gt;value); } // Python æ–¹æ³•è¡¨ static PyMethodDef CppMethods[] = { {\u0026#34;use_object\u0026#34;, use_object, METH_VARARGS, \u0026#34;Use a C++ object from PyCapsule\u0026#34;}, {nullptr, nullptr, 0, nullptr} }; // Python æ¨¡å—å®šä¹‰ static struct PyModuleDef cppModule = { PyModuleDef_HEAD_INIT, \u0026#34;cppModule\u0026#34;, nullptr, -1, CppMethods }; // åˆå§‹åŒ– Python æ¨¡å— PyMODINIT_FUNC PyInit_cppModule(void) { return PyModule_Create(\u0026amp;cppModule); } int main() { // åˆå§‹åŒ– Python è§£é‡Šå™¨ Py_Initialize(); PyObject* pModule = PyImport_AddModule(\u0026#34;__main__\u0026#34;); PyObject* pGlobals = PyModule_GetDict(pModule); // æ³¨å†Œ C++ æ–¹æ³•åˆ° Python PyObject* pCppModule = PyModule_Create(\u0026amp;cppModule); PyDict_SetItemString(pGlobals, \u0026#34;cppModule\u0026#34;, pCppModule); // æ‰§è¡Œ Python ä»£ç  const auto python_code = R\u0026#34;( def my_function(capsule): result = cppModule.use_object(capsule) # ä¼ å› C++ å¤„ç† print(f\u0026#34;Python received: {result}\u0026#34;) return result )\u0026#34;; PyRun_SimpleString(python_code); // è·å– Python å‡½æ•°å¯¹è±¡ if (PyObject* pFunc = PyDict_GetItemString(pGlobals, \u0026#34;my_function\u0026#34;); PyCallable_Check(pFunc)) { auto* obj = new MyStruct{42}; // åˆ›å»º C++ å¯¹è±¡ const auto capsule = PyCapsule_New(obj, \u0026#34;this\u0026#34;, nullptr); // è¿”å›å°è£…çš„æŒ‡é’ˆ // å‡†å¤‡å‚æ•° PyObject* pArgs = PyTuple_Pack(1, capsule); // è°ƒç”¨å‡½æ•° if (PyObject* pValue = PyObject_CallObject(pFunc, pArgs); pValue != nullptr) { // æ‰“å°å‡½æ•°è¿”å›å€¼ std::cout \u0026lt;\u0026lt; \u0026#34;Function returned: \u0026#34; \u0026lt;\u0026lt; PyLong_AsLong(pValue) \u0026lt;\u0026lt; std::endl; Py_XDECREF(pValue); } else { PyErr_Print(); } Py_XDECREF(pArgs); } else { PyErr_Print(); } // å…³é—­ Python è§£é‡Šå™¨ Py_Finalize(); return 0; } "},{"id":11,"href":"/blog/git/WNYzxj6GR/","title":"ğŸ“ gitä¹‹åˆ é™¤è¿œç¨‹åˆ†æ”¯","section":"ğŸ“” Git","content":" gitåˆ é™¤è¿œç¨‹åˆ†æ”¯å°±è¿™ä¹ˆç®€å•\ngit push origin --delete [branch_name] "},{"id":12,"href":"/blog/git/-fZeBsu3T/","title":"ğŸ“ gitæ›´æ–°.gitignore","section":"ğŸ“” Git","content":" ä¸€èˆ¬ç›´æ¥ä¿®æ”¹.gitignoreæ˜¯ä¸ç”Ÿæ•ˆçš„ï¼Œéœ€è¦å…ˆæ¸…ç†ç¼“å­˜ï¼Œå†ä¿®æ”¹.gitignoreã€‚\ngit rm -r --cached . git add . git commit -m \u0026#39;update .gitignore\u0026#39; "},{"id":13,"href":"/blog/git/H1Krv6b-4/","title":"ğŸ“ gitä¿®æ”¹å†å²cimmitä¿¡æ¯","section":"ğŸ“” Git","content":" git ä½¿ç”¨rebaseä¿®æ”¹å†å²æäº¤çš„cimmitä¿¡æ¯\n1ã€ä¿®æ”¹æŒ‡å®šcommit # git rebase -i 36224db æˆ–:\ngit rebase -i HEAD~3 2ã€æŠŠpickæ”¹ä¸ºedit # pickï¼šä¿ç•™è¯¥commitï¼ˆç¼©å†™:pï¼‰\nrewordï¼šä¿ç•™è¯¥commitï¼Œä½†æˆ‘éœ€è¦ä¿®æ”¹è¯¥commitçš„æ³¨é‡Šï¼ˆç¼©å†™:rï¼‰\neditï¼šä¿ç•™è¯¥commit, ä½†æˆ‘è¦åœä¸‹æ¥ä¿®æ”¹è¯¥æäº¤(ä¸ä»…ä»…ä¿®æ”¹æ³¨é‡Š)ï¼ˆç¼©å†™:eï¼‰\nsquashï¼šå°†è¯¥commitå’Œå‰ä¸€ä¸ªcommitåˆå¹¶ï¼ˆç¼©å†™:sï¼‰\nfixupï¼šå°†è¯¥commitå’Œå‰ä¸€ä¸ªcommitåˆå¹¶ï¼Œä½†æˆ‘ä¸è¦ä¿ç•™è¯¥æäº¤çš„æ³¨é‡Šä¿¡æ¯ï¼ˆç¼©å†™:fï¼‰\nexecï¼šæ‰§è¡Œshellå‘½ä»¤ï¼ˆç¼©å†™:xï¼‰\ndropï¼šæˆ‘è¦ä¸¢å¼ƒè¯¥commitï¼ˆç¼©å†™:dï¼‰\n3ã€ä¿®æ”¹commitä¿¡æ¯ # git commit --amend git rebase --continue 4ã€æ¨é€åˆ°è¿œç¨‹ä»“åº“ # git push -f origin master "},{"id":14,"href":"/blog/git/By9OI51xN/","title":"ğŸ“ gitåŸºç¡€ç¬”è®°","section":"ğŸ“” Git","content":" gitæ˜¯ä¸€ä¸ªå¼€æºçš„åˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼Œå¯ä»¥æœ‰æ•ˆã€é«˜é€Ÿçš„å¤„ç†ä»å¾ˆå°åˆ°éå¸¸å¤§çš„é¡¹ç›®ç‰ˆæœ¬ç®¡ç†ã€‚\nå…‹éš†é¡¹ç›® # git clone https://github.com/golang/go.git æŸ¥çœ‹è¿œç¨‹ä»“åº“ # git remote -v æ·»åŠ è¿œç¨‹ä»“åº“ # è¦æ·»åŠ ä¸€ä¸ªæ–°çš„è¿œç¨‹ä»“åº“ï¼Œå¯ä»¥æŒ‡å®šä¸€ä¸ªç®€å•çš„åå­—ï¼Œä»¥ä¾¿å°†æ¥å¼•ç”¨ï¼Œè¿è¡Œ git remote add [shortname] [url]ï¼š\ngit remote add pb https://github.com/golang/go.git ç°åœ¨å¯ä»¥ç”¨å­—ç¬¦ä¸² pb æŒ‡ä»£å¯¹åº”çš„ä»“åº“åœ°å€äº†ã€‚æ¯”å¦‚è¯´ï¼Œè¦æŠ“å–æ‰€æœ‰ Paul æœ‰çš„ï¼Œä½†æœ¬åœ°ä»“åº“æ²¡æœ‰çš„ä¿¡æ¯ï¼Œå¯ä»¥è¿è¡Œ git fetch pb\nä»è¿œç¨‹ä»“åº“æŠ“å–æ•°æ® # git fetch [remote-name] æ¨é€æ•°æ®åˆ°è¿œç¨‹ä»“åº“ # git push [remote-name] [branch-name]\ngit push origin master æŸ¥çœ‹è¿œç¨‹ä»“åº“ä¿¡æ¯ # git remote show [remote-name]\ngit remote show origin é‡å‘½åè¿œç¨‹ä»“åº“ # git remote rename old_remote-name new_remote-name\ngit remote rename pb test åˆ é™¤è¿œç¨‹ä»“åº“ # git remote rm remote-name\ngit remote rm test "},{"id":15,"href":"/blog/git/Hk6GGp6cQ/","title":"ğŸ“ Gitå›æ»šåˆ°æŸä¸ªcommit","section":"ğŸ“” Git","content":" gitæ˜¯ä¸€ä¸ªå¼€æºçš„åˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼Œå¯ä»¥æœ‰æ•ˆã€é«˜é€Ÿçš„å¤„ç†ä»å¾ˆå°åˆ°éå¸¸å¤§çš„é¡¹ç›®ç‰ˆæœ¬ç®¡ç†ã€‚\nå›æ»šå‘½ä»¤ # git reset --hard HEAD^ #å›æ»šåˆ°ä¸Šä¸ªç‰ˆæœ¬ git reset --hard HEAD~3 #å›æ»šåˆ°å‰3æ¬¡æäº¤ä¹‹å‰ï¼Œä»¥æ­¤ç±»æ¨ï¼Œå›é€€åˆ°næ¬¡æäº¤ä¹‹å‰ git reset --hard commit_id #å›æ»šåˆ°æŒ‡å®šcommitçš„shaç‰ˆæœ¬ æ¨é€å‘½ä»¤ # git push origin HEAD --force #å¼ºåˆ¶æ¨é€åˆ°è¿œç¨‹ æ¸©é¦¨æç¤º # å›æ»šæœ‰é£é™©ï¼Œè¯·æå‰åšå¥½å¤‡ä»½ã€‚\n"},{"id":16,"href":"/links/","title":"ğŸ¤ å‹æƒ…é“¾æ¥","section":"Docs","content":" "},{"id":17,"href":"/articles/2024/12/23/wvkjyjt7qhumo4jpucheca/","title":"Linuxç¡¬ç›˜æ•…éšœç›¸å…³çš„æŸ¥è¯¢å‘½ä»¤","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" æŸ¥çœ‹ç¡¬ç›˜åŠå¯¹åº”çš„UUIDä¿¡æ¯ # # æŸ¥çœ‹ç¡¬ç›˜åŠå¯¹åº”çš„UUIDä¿¡æ¯ æˆ–è€…æ˜¯æ‰€æœ‰ç¡¬ç›˜çš„UUIDä¿¡æ¯ blkid [/dev/sda1] # lsblk -o NAME,UUID -p æŸ¥çœ‹UUIDå¯¹åº”çš„ç¡¬ç›˜è·¯å¾„ # blkid -U 383bc776-fc1a-4040-ad8f-45f4f5d96fcf æŸ¥çœ‹ç¡¬ç›˜ä¿¡æ¯ # lshw -class disk æ£€æµ‹ç£ç›˜æ˜¯å¦æŸå # badblocks -b 4096 -v /dev/sda # ä¹Ÿæœ‰åå¿«çš„å±è”½æ–¹å¼è¿™ä¸ªé‡Œå°±ä¸åˆ—ä¸¾äº† ç‚¹äº®ç¡¬ç›˜LED # dd if=/dev/sda of=/dev/null bs=1M count=100 # ç‚¹äº®ç¡¬ç›˜LED æŸ¥çœ‹æœåŠ¡å™¨åºåˆ—å· # dmidecode -t 1 # æŸ¥çœ‹å¯¹åº”çš„\u0026#39;Serial Number\u0026#39;å­—æ®µ "},{"id":18,"href":"/articles/2024/11/15/mcagbs9lfdrnxxu9k29t9j/","title":"ä½¿ç”¨FFmpegç”Ÿæˆæµ‹è¯•è§†é¢‘","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" ç”Ÿæˆ23.976fpsçš„æµ‹è¯•è§†é¢‘ # ffmpeg -f lavfi -i testsrc=size=1280x720:rate=30 -vf \u0026#34;drawtext=text=\u0026#39;%{pts\\:hms} %{n}\u0026#39;:x=(w-text_w)/2:y=100:fontsize=48:fontcolor=white:boxcolor=black@0.5:borderw=2\u0026#34; -r 23.976 -t 10 -y output.mp4 "},{"id":19,"href":"/articles/2024/03/27/e4c2nybngzu5eddbnmdjgq/","title":"Mambaæ›¿ä»£Conda","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":"mambaæ˜¯ä¸€ä¸ªcondaçš„æ›¿ä»£å“ï¼Œå¯ä»¥åŠ é€Ÿcondaçš„åŒ…ç®¡ç†ï¼Œæå‡åŒ…ç®¡ç†çš„æ•ˆç‡ã€‚\nå®‰è£… # brew install micromamba é…ç½® # # æ ¹æ®å‘½ä»¤æç¤ºï¼Œä¿®æ”¹~/.zshrcæ–‡ä»¶ micromamba shell init -s zsh -p ~/.micromamba # æ·»åŠ é…ç½®æ–‡ä»¶ $ cat ~/.mambarc channels: - conda-forge always_yes: false ä½¿ç”¨ # micromamba create -n python310 python=3.10 # æ¿€æ´»ç¯å¢ƒ micromamba activate python310 # ç„¶åå¯ä»¥ç”¨ micromamba æˆ–è€… pip è£…ä¸œè¥¿ micromamba install package_1 package_2=version ## å…·ä½“è¯·å‚è€ƒ https://mamba.readthedocs.io/en/latest/ micromamba --help "},{"id":20,"href":"/articles/2024/03/06/9mzhfnl58azjmeibfblvjy/","title":"Hugoç½‘ç«™å»ºè®¾","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" å®‰è£… Hugo # ä¸‹è½½åœ°å€ï¼šhttps://github.com/gohugoio/hugo/releases\nåˆ›å»ºç½‘ç«™ # hugo new site book cd book git init git submodule add https://github.com/alex-shpak/hugo-book themes/hugo-book æœ¬åœ°è°ƒè¯• # hugo server --disableFastRender --minify --ignoreCache github actions # mkdir -p .github/workflows touch .github/workflows/build.yml name: Build on: push: branches: - main # Set a branch to deploy pull_request: jobs: deploy: runs-on: ubuntu-20.04 concurrency: group: ${{ github.workflow }}-${{ github.ref }} steps: - uses: actions/checkout@v3 with: submodules: true # Fetch Hugo themes (true OR recursive) fetch-depth: 0 # Fetch all history for .GitInfo and .Lastmod - name: Setup Hugo uses: peaceiris/actions-hugo@v2 with: hugo-version: \u0026#39;0.123.7\u0026#39; # æ˜¯å¦å¯ç”¨ hugo extend extended: true - name: Build run: hugo --minify - name: Deploy uses: peaceiris/actions-gh-pages@v3 if: ${{ github.ref == \u0026#39;refs/heads/main\u0026#39; }} with: github_token: ${{ secrets.GH_PAGE_ACTION_TOKEN }} publish_dir: ./public github pages # å¯ä»¥åœ¨é¡¹ç›®çš„ Settings ä¸­å¼€å¯ Pages æœåŠ¡ï¼Œç„¶åé€‰æ‹© Branch ä¸ºgh-pageså³å¯ã€‚\nå¦‚æœæƒ³è¦å®šåˆ¶åŸŸåï¼Œå¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ About custom domains and GitHub Pages\n"},{"id":21,"href":"/articles/2024/02/06/kkcc5t2y88hybafpourudv/","title":"FFmpegæ£€æµ‹é€æ˜é€šé“","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" æ£€æµ‹é€æ˜é€šé“ # FFmpegå‘½ä»¤ # $ ffmpeg -v error -i 123.mp4 -vf \u0026#34;select=\u0026#39;eq(n,0)\u0026#39;, alphaextract\u0026#34; -f null /dev/null [Parsed_alphaextract_1 @ 0x7fe8f5208100] Requested planes not available. [Parsed_alphaextract_1 @ 0x7fe8f5208100] Failed to configure input pad on Parsed_alphaextract_1 [vf#0:0 @ 0x7fe8f5005f40] Error reinitializing filters! Failed to inject frame into filter network: Invalid argument Error while filtering: Invalid argument [out#0/null @ 0x7fe8f5004900] Nothing was written into output file, because at least one of its streams received no packets. åˆ¤æ–­æ¡ä»¶ # å¦‚æœå‡ºç°ä»¥ä¸ŠæŠ¥é”™ä¿¡æ¯ï¼Œåˆ™è¯´æ˜è§†é¢‘ä¸­æ²¡æœ‰é€æ˜é€šé“ã€‚\n"},{"id":22,"href":"/blog/linux/fSHb366Mg/","title":"sshå®¢æˆ·ç«¯äºæœåŠ¡ç«¯ä¿æŒè¿æ¥","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" linux ssh é»˜è®¤æ²¡æœ‰å¼€å¯å¿ƒè·³ï¼Œæ‰€ä»¥å¾ˆå®¹æ˜“å¯¼è‡´è¿æ¥æ–­å¼€ã€‚\næœåŠ¡ç«¯è®¾ç½® # sudo vim /etc/ssh/sshd_config TCPKeepAlive yes ClientAliveInterval 60 ClientAliveCountMax 3 å®¢æˆ·ç«¯è®¾ç½® # ä¸€èˆ¬è¿˜æ˜¯å»ºè®®åœ¨å®¢æˆ·ç«¯è®¾ç½®ã€‚\nsudo vim /etc/ssh/ssh_config TCPKeepAlive yes ServerAliveInterval 60 ServerAliveCountMax 3 "},{"id":23,"href":"/blog/linux/G0DCCusMR/","title":"Centos7ç³»ç»Ÿå‡çº§å†…æ ¸ç‰ˆæœ¬","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" ä½¿ç”¨ELRepoä»“åº“å‡çº§ç³»ç»Ÿå†…æ ¸\næŸ¥çœ‹å†…æ ¸ç‰ˆæœ¬ # uname -r uname -a cat /etc/redhat-release å®‰è£…ELRepo yumæº # rpm --import https://www.elrepo.org/RPM-GPG-KEY-elrepo.org rpm -Uvh http://www.elrepo.org/elrepo-release-7.0-3.el7.elrepo.noarch.rpm æŸ¥çœ‹å¯ç”¨çš„å†…æ ¸ç‰ˆæœ¬ # yum --disablerepo=\u0026#34;*\u0026#34; --enablerepo=\u0026#34;elrepo-kernel\u0026#34; list available ... kernel-lt.x86_64 4.4.155-1.el7.elrepo kernel-lt-devel.x86_64 4.4.155-1.el7.elrepo ... å®‰è£…ç¨³å®šç‰ˆæœ¬å†…æ ¸ # yum --enablerepo=elrepo-kernel install kernel-lt è®¾ç½®å¼•å¯¼ï¼ˆgrub2ï¼‰ # æŸ¥çœ‹æ‰€æœ‰å†…æ ¸ç‰ˆæœ¬ # sudo awk -F\\\u0026#39; \u0026#39;$1==\u0026#34;menuentry \u0026#34; {print i++ \u0026#34; : \u0026#34; $2}\u0026#39; /etc/grub2.cfg 0 : CentOS Linux (4.4.241-1.el7.elrepo.x86_64) 7 (Core) 1 : CentOS Linux (3.10.0-957.el7.x86_64) 7 (Core) 2 : CentOS Linux (0-rescue-651e1b90bb3149809cdeb8cc80e72c43) 7 (Core) è®¾ç½®æ–°çš„é»˜è®¤å¼•å¯¼çš„å†…æ ¸ç‰ˆæœ¬ # æ–¹æ³•1\ngrub2-set-default 0 #å…¶ä¸­ 0 æ˜¯ä¸Šé¢æŸ¥è¯¢å‡ºæ¥çš„å¯ç”¨å†…æ ¸ æ–¹æ³•2\nvim /etc/default/grub GRUB_DEFAULT=0 #å…¶ä¸­ 0 æ˜¯ä¸Šé¢æŸ¥è¯¢å‡ºæ¥çš„å¯ç”¨å†…æ ¸ grub2-mkconfig -o /boot/grub2/grub.cfg #ç”Ÿæˆ grub é…ç½®æ–‡ä»¶ reboot # é‡å¯æœºå™¨ éªŒè¯åŠåˆ é™¤æ—§å†…æ ¸ï¼ˆå¯é€‰ï¼‰ # uname -r # æŸ¥çœ‹å†…æ ¸ç‰ˆæœ¬ 4.4.241-1.el7.elrepo.x86_64 yum install yum-utils package-cleanup --oldkernels # åˆ é™¤æ—§çš„å†…æ ¸ç‰ˆæœ¬ # ä¹Ÿå¯ä»¥ä½¿ç”¨ rpm -qa | grep kernel å…ˆæŠŠæ‰€æœ‰çš„å†…æ ¸ç‰ˆæœ¬æŸ¥è¯¢å‡ºæ¥ï¼Œç„¶åä½¿ç”¨ yum remove åˆ é™¤æ‰æ—§çš„å†…æ ¸ç‰ˆæœ¬ å‡çº§å¤±è´¥çš„å¤„ç†æ–¹æ³• # å¦‚æœå‘ç°å‡çº§å†…æ ¸ç‰ˆæœ¬å¹¶é‡å¯ï¼Œå‘ç°æœºå™¨æ— æ³•å¯åŠ¨ï¼Œéœ€è¦åœ¨å¼€æœºè¿›å…¥å¼•å¯¼å†…æ ¸é€‰æ‹©ç•Œé¢æ‰‹åŠ¨é€‰æ‹©è€çš„å†…æ ¸å¯åŠ¨ï¼Œç„¶åå†è®²é»˜è®¤å¼•å¯¼çš„å†…æ ¸ç‰ˆæœ¬æ”¹å›æ¥çš„å†…æ ¸ç‰ˆæœ¬è¿›è¡Œå›æ»šã€‚\n"},{"id":24,"href":"/blog/linux/xd2UELYGR/","title":"dnsmasqå®‰è£…ä¸é…ç½®","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" dnsmasqæ˜¯ä¸€ä¸ªå°å·§ä¸”æ–¹ä¾¿åœ°ç”¨äºé…ç½®DNSå’ŒDHCPçš„å·¥å…·ï¼Œé€‚ç”¨äºå°å‹ç½‘ç»œï¼Œå®ƒæä¾›äº†DNSåŠŸèƒ½å’Œå¯é€‰æ‹©çš„DHCPåŠŸèƒ½ã€‚\nå®‰è£…æœåŠ¡ # sudo yum install dnsmasq å¸¸ç”¨é…ç½® # cat /etc/dnsmasq.conf #######è¿™é‡Œè¡¨ç¤º ä¸¥æ ¼æŒ‰ç…§ resolv-file æ–‡ä»¶ä¸­çš„é¡ºåºä»ä¸Šåˆ°ä¸‹è¿›è¡Œ DNS è§£æ, ç›´åˆ°ç¬¬ä¸€ä¸ªæˆåŠŸè§£ææˆåŠŸä¸ºæ­¢ #strict-order ###åŒæ—¶å‘é€æ‰€æœ‰çš„æŸ¥è¯¢åˆ°æ‰€æœ‰çš„dnsæœåŠ¡å™¨ï¼Œè°å¿«å°±ç”¨è° all-servers listen-address=127.0.0.1 ###ä¸è®©dnsmasqå»è¯»/etc/hostsæ–‡ä»¶ no-hosts ## è®¾ç½®ç¼“å­˜æ¡ç›® cache-size=10240 #å…è®¸å®¢æˆ·ç«¯ç¼“å­˜çš„æ—¶é—´å•ä½ä¸ºç§’ local-ttl=10 max-cache-ttl=15 ###å¼€å¯æ—¥å¿— #log-queries ##é…ç½®æ—¥å¿—æ–‡ä»¶ #log-facility=/data/logs/dnsmasq.log cat /etc/resolv.dnsmasq.conf nameserver 223.5.5.5 nameserver 114.114.114.114 nameserver 222.246.129.80 å¯åŠ¨æœåŠ¡ # systemctl start dnsmasq éªŒè¯æ–¹æ³• # dig www.zhangwenbing.com å…¶ä»–é…ç½® # å›½å†…æŒ‡å®šDNS # server=/cn/114.114.114.114 server=/taobao.com/114.114.114.114 server=/taobaocdn.com/114.114.114.114 å›½å¤–æŒ‡å®šDNS # server=/google.com/8.8.8.8 å±è”½ç½‘é¡µå¹¿å‘Š # address=/ad.youku.com/127.0.0.1 address=/ad.iqiyi.com/127.0.0.1 å…¶ä»–åŠŸèƒ½ # é™¤äº†DNSï¼Œè¿˜æ”¯æŒDHCPå’ŒTFTPï¼Œç”±äºæš‚æ—¶ç”¨ä¸åˆ°ï¼Œè¿™é‡Œå°±ä¸ä¸€ä¸€ä¾‹ä¸¾äº†ã€‚\n"},{"id":25,"href":"/blog/linux/SNyWJwbGR/","title":"ä½¿ç”¨sshé…ç½®è·³æ¿æœº","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" ç®€å•çš„ä¿®æ”¹/etc/ssh/ssh_configæ–‡ä»¶å³å¯é€šè¿‡è·³æ¿æœºï¼Œç›´è¾¾ç›®æ ‡æœåŠ¡å™¨ã€‚\né…ç½®æ–¹æ³• # cat /etc/ssh/ssh_config Host jump-server User xxxx Hostname yyy.yyy.yyy.yyy Port 22 Host 10.* ProxyCommand ssh -q -W %h:%p jump-server Host æ”¯æŒé€šé…ç¬¦ * å’Œ ?\nxxxx è·³æ¿æœºç”¨æˆ·å\nyyy.yyy.yyy.yyy è·³æ¿æœºIPåœ°å€\néœ€è¦æ³¨æ„çš„é—®é¢˜ # è·³æ¿æœºæœ€å¥½æ˜¯å…ç§˜é’¥ç™»å½•ï¼Œä¸ç„¶çš„è¯ä¼šéœ€è¦è¾“å…¥å¯†ç ã€‚\n"},{"id":26,"href":"/blog/linux/tqj7MybMg/","title":"centos6é•œåƒç«™åœæ­¢ç»´æŠ¤çš„è§£å†³åŠæ³•","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" 2020å¹´11æœˆ30æ—¥ centos6å„å¤§å¼€æºé•œåƒç«™å·²ç»åœæ­¢ç»´æŠ¤äº†ï¼Œä½†æ˜¯é˜¿é‡Œäº‘è¿˜æœ‰å…¶ä»–æºå¯ä»¥ä½¿ç”¨ã€‚\né”™è¯¯æç¤º # http://mirrors.aliyun.com/epel/6/x86_64/repodata/repomd.xml: [Errno 14] PYCURL ERROR 22 - \u0026#34;The requested URL returned error: 404 Not Found\u0026#34; è§£å†³åŠæ³• # cat /etc/yum.repos.d/CentOS-Base.repo # CentOS-Base.repo # # The mirror system uses the connecting IP address of the client and the # update status of each mirror to pick mirrors that are updated to and # geographically close to the client. You should use this for CentOS updates # unless you are manually picking other mirrors. # # If the mirrorlist= does not work for you, as a fall back you can try the # remarked out baseurl= line instead. # # [base] name=CentOS-6.10 - Base - mirrors.aliyun.com failovermethod=priority baseurl=http://mirrors.aliyun.com/centos-vault/6.10/os/$basearch/ gpgcheck=1 gpgkey=http://mirrors.aliyun.com/centos-vault/RPM-GPG-KEY-CentOS-6 #released updates [updates] name=CentOS-6.10 - Updates - mirrors.aliyun.com failovermethod=priority baseurl=http://mirrors.aliyun.com/centos-vault/6.10/updates/$basearch/ gpgcheck=1 gpgkey=http://mirrors.aliyun.com/centos-vault/RPM-GPG-KEY-CentOS-6 #additional packages that may be useful [extras] name=CentOS-6.10 - Extras - mirrors.aliyun.com failovermethod=priority baseurl=http://mirrors.aliyun.com/centos-vault/6.10/extras/$basearch/ gpgcheck=1 gpgkey=http://mirrors.aliyun.com/centos-vault/RPM-GPG-KEY-CentOS-6 #additional packages that extend functionality of existing packages [centosplus] name=CentOS-6.10 - Plus - mirrors.aliyun.com failovermethod=priority baseurl=http://mirrors.aliyun.com/centos-vault/6.10/centosplus/$basearch/ gpgcheck=1 enabled=0 gpgkey=http://mirrors.aliyun.com/centos-vault/RPM-GPG-KEY-CentOS-6 #contrib - packages by Centos Users [contrib] name=CentOS-6.10 - Contrib - mirrors.aliyun.com failovermethod=priority baseurl=http://mirrors.aliyun.com/centos-vault/6.10/contrib/$basearch/ gpgcheck=1 enabled=0 gpgkey=http://mirrors.aliyun.com/centos-vault/RPM-GPG-KEY-CentOS-6 yum clean all yum makecache "},{"id":27,"href":"/blog/ffmpeg/ROS_KIbGg/","title":"ffmpegè§„èŒƒéŸ³é¢‘çš„å“åº¦","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" é€šè¿‡FFmpegå†…ç½®æ»¤é•œã€æ‰‹åŠ¨è°ƒæ•´éŸ³é‡ã€æˆ–è€…ffmpeg-normalizeå®ç°å¯¹å“åº¦çš„æ§åˆ¶ã€‚\nå†…ç½®å½’ä¸€åŒ–æ»¤æ³¢å™¨ # loudnormï¼šé€šè¿‡EBU R.128è¿›è¡Œå“åº¦æ ‡å‡†åŒ–ã€‚æ‚¨å¯ä»¥è®¾ç½®ç§¯åˆ†çš„ä½“ç§¯ç›®æ ‡ï¼Œä½“ç§¯èŒƒå›´ç›®æ ‡æˆ–æœ€å¤§çœŸå®å³°ã€‚å»ºè®®ç”¨äºå‘å¸ƒéŸ³é¢‘å’Œè§†é¢‘ï¼Œå¹¶è¢«ä¸–ç•Œå„åœ°çš„å¹¿æ’­å…¬å¸ä½¿ç”¨ã€‚\ndynaudnormï¼šâ€œæ™ºèƒ½â€å“åº¦å½’ä¸€åŒ–ï¼Œä¸è¿›è¡Œè£å‰ªã€‚åŠ¨æ€åœ°å°†è§„èŒƒåŒ–åº”ç”¨äºæ–‡ä»¶çš„çª—å£éƒ¨åˆ†ã€‚åº”è°¨æ…ä½¿ç”¨ï¼Œå› ä¸ºè¿™å¯èƒ½ä¼šæ”¹å˜å£°éŸ³çš„ç‰¹æ€§ã€‚\n#fdk_aacç¼–ç å™¨ ffmpeg200421 -i \u0026#34;source_audio.ts\u0026#34; -c:a libfdk_aac -strict -2 -ac 2 -ar 48000 -ab 196k -af \u0026#34;[0:a]pan=stereo| FL \u0026lt; FL + 0.5*FC + 0.6*BL + 0.6*SL | FR \u0026lt; FR + 0.5*FC + 0.6*BR + 0.6*SR,loudnorm=I=-23:LRA=6:tp=-1\u0026#34; -y -cutoff 20000 \u0026#34;ac_5m.ts\u0026#34; #aacç¼–ç å™¨ ffmpeg -i \u0026#34;source_audio.ts\u0026#34; -c:a aac -strict -2 -ac 2 -ar 48000 -ab 196k -af \u0026#34;loudnorm=I=-23:LRA=6:tp=-1\u0026#34; -y -cutoff 20000 \u0026#34;1_aac_dynaudnorm_ac_5m.ts\u0026#34; å¸¸ç”¨æ–¹å¼ # ffmpeg -i input.mp4 -vn -acodec libfdk_aac -ac 2 -ar 44100 -af loudnorm=I=-16:TP=-1:LRA=7:print_format=json -f null /dev/null æ‰‹åŠ¨è§„èŒƒéŸ³é¢‘çš„å“åº¦ # é¦–å…ˆï¼Œæ‚¨éœ€è¦åˆ†æéŸ³é¢‘æµä»¥è·å–æœ€å¤§éŸ³é‡ï¼Œä»¥æŸ¥çœ‹è§„èŒƒåŒ–æ˜¯å¦èµ·ä½œç”¨ã€‚\nffmpeg -i video.avi -af \u0026#34;volumedetect\u0026#34; -vn -sn -dn -f null /dev/null [Parsed_volumedetect_0 @ 0x7f8ba1c121a0] mean_volume: -16.0 dB [Parsed_volumedetect_0 @ 0x7f8ba1c121a0] max_volume: -5.0 dB [Parsed_volumedetect_0 @ 0x7f8ba1c121a0] histogram_0db: 87861 ä½¿ç”¨éŸ³é‡è¿‡æ»¤å™¨ï¼ˆvolumeï¼‰\nffmpeg -i video.mp4 -af \u0026#34;volume=5dB\u0026#34; -c:v copy -c:a aac -cutoff 20000 output.mp4 volume=5dB è¡¨ç¤ºå¢åŠ 5åˆ†è´çš„éŸ³é‡\nvolume=-5dB è¡¨ç¤ºå‡å°‘5åˆ†è´çš„éŸ³é‡\nvolume=1.5 è¡¨ç¤ºæ”¾å¤§1.5å€çš„éŸ³é‡\nffmpeg-normalize # ffmpeg-normalize æ˜¯ä¸€ä¸ªPythonåº“ï¼Œå¯ä»¥ä½¿ç”¨pipå®‰è£…ï¼Œè¯¦ç»†çš„ä½¿ç”¨æ–¹å¼åœ¨githubä¸Šæœ‰æ–‡æ¡£ï¼Œè¿™é‡Œå°±ä¸åšè¿‡å¤šçš„ä»‹ç»äº†ã€‚\n"},{"id":28,"href":"/blog/linux/-vpymjJGg/","title":"tcpdumpä¹‹UDPæŠ“åŒ…","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" ä½¿ç”¨tcpdumpæŠ“UDPåŒ…ï¼Œè¿‡æ»¤è¿‡æ»¤IPå’Œportï¼Œå¹¶ä¸”è‡ªåŠ¨æ‹†åˆ†ç‰‡æ®µã€‚\nå®‰è£…tcpdump # yum install -y tcpdump ä½¿ç”¨æ–¹æ³• # tcpdump -i bond0 udp port xxxx and host xxx.x.xx.xxx -s0 -G 600 -w %Y_%m%d_%H%M_%S.pcap å‚æ•°è¯´æ˜ # -i æŒ‡å®šç›‘å¬çš„ç½‘å¡\nudp ç›‘å¬UDPåè®®\nport æŒ‡å®šè¿‡æ»¤çš„ç«¯å£\nhost æŒ‡å®šè¿‡æ»¤çš„ip\n-s è¡¨ç¤ºä»ä¸€ä¸ªåŒ…ä¸­æˆªå–çš„å­—èŠ‚æ•°ï¼Œ0è¡¨ç¤ºåŒ…ä¸æˆªæ–­\n-G æŒ‰ç…§å›ºå®šçš„æ—¶é—´é—´éš”åˆ‡å‰²è¾“å‡ºçš„æ–‡ä»¶ï¼ˆå•ä½ï¼šç§’ï¼‰\n-w ç›´æ¥å°†åŒ…å†™å…¥æ–‡ä»¶ä¸­ï¼Œå¹¶ä¸åˆ†æå’Œæ‰“å°å‡ºæ¥ï¼›\nå–éè¿ç®—æ˜¯ â€˜not â€™ â€˜! â€˜ï¼Œä¸è¿ç®—æ˜¯â€™andâ€™ï¼Œâ€™\u0026amp;\u0026amp;;æˆ–è¿ç®— æ˜¯â€™orâ€™ ,â€˜||â€™\nå®šæ—¶æŠ“åŒ…(python) # #!/usr/bin/env python # -*- coding: UTF-8 -*- # # @author å¼ æ–‡å…µ # @blog https://zhangwenbing.com/ # @datetime 2020-12-18 14:56:01 # @description # import os import time from apscheduler.schedulers.blocking import BlockingScheduler def system(cmd): t = time.strftime(\u0026#39;%Y-%m-%d %H:%M:%S\u0026#39;, time.localtime(time.time())) print(\u0026#39;{} æ‰§è¡Œ {}\u0026#39;.format(t, cmd)) stat = os.system(cmd) if stat != 0: print(\u0026#39;{} æ‰§è¡Œ {} å¤±è´¥\u0026#39;.format(t, cmd)) scheduler = BlockingScheduler() # æ˜ŸæœŸ1-5çš„17ç‚¹40åˆ†æ‰§è¡ŒæŠ“åŒ…ä»»åŠ¡ scheduler.add_job(system, \u0026#39;cron\u0026#39;, day_of_week=\u0026#34;mon,tue,wed,thu,fri,sat\u0026#34;, hour=17, minute=30, args=[\u0026#39;/sbin/tcpdump -i bond0 udp port xxxx and host xxx.x.xx.xxx -s0 -G 3600 -w /your_path/%Y_%m%d_%H%M_%S.pcap \u0026amp;\u0026gt;/dev/null\u0026#39;]) # æ˜ŸæœŸ1-5çš„20ç‚¹01åˆ†æ‰§è¡Œkill scheduler.add_job(system, \u0026#39;cron\u0026#39;, day_of_week=\u0026#34;mon,tue,wed,thu,fri,sat\u0026#34;, hour=20, minute=1, args=[\u0026#39;pkill -9 tcpdump \u0026amp;\u0026gt;/dev/null\u0026#39;]) scheduler.start() # æ˜ŸæœŸ1-5çš„23ç‚¹59åˆ†æ‰§è¡Œè‡ªåŠ¨æ¸…ç†7å¤©ä¹‹å‰çš„æŠ“åŒ…æ–‡ä»¶ scheduler.add_job(system, \u0026#39;cron\u0026#39;, day_of_week=\u0026#34;mon,tue,wed,thu,fri,sat\u0026#34;, hour=23, minute=59, args=[\u0026#39;/usr/bin/find /your_path/ -type f -ctime +7 -exec rm -f {} \\; \u0026amp;\u0026gt;/dev/null\u0026#39;]) scheduler.start() åˆ‡åˆ†æŠ“åŒ…æ–‡ä»¶ # tcpdump -r old_file -w new_files -C 10 -r æŒ‡å®šéœ€è¦åˆ‡åˆ†çš„æ–‡ä»¶\n-w æŒ‡å®šæ–°çš„æ–‡ä»¶åå‰ç¼€\n-C æŒ‡å®šåˆ‡åˆ†çš„æ–‡ä»¶å¤§å°ï¼ˆå•ä½ï¼šMï¼‰\n"},{"id":29,"href":"/blog/linux/h5sGcU1MR/","title":"Linuxæ”¶å½•UDPè§†é¢‘èŠ±å±æ€»ç»“","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" æœ€è¿‘åœ¨Linuxä¸‹ä½¿ç”¨ffmpegæ”¶å½•UDPæµèŠ±å±é—®é¢˜ï¼Œå‘ç°æœºå™¨æœ‰åŒç½‘å¡ï¼Œæ·»åŠ è·¯ç”±æŒ‡å®šç½‘å¡æ”¶å½•å¯¼è‡´æ— æ³•æ”¶å½•äº†ã€‚å¦é™„ä¸€äº›è§£å†³èŠ±å±çš„ä¼˜åŒ–æ–¹æ³•ã€‚\nä¼˜åŒ–å†…æ ¸å‚æ•° # cat /etc/sysctl.conf net.ipv4.conf.default.rp_filter = 0 net.ipv4.conf.all.rp_filter = 0 # ä¿®æ”¹é»˜è®¤ç½‘ç»œçš„ç¼“å­˜å¤§å° è¿™ä¸ªå¾ˆé‡è¦ä¸ç„¶ net.core.rmem_max = 50000000 net.core.rmem_default = 50000000 sysctl -p # æ·»åŠ ä»¥ä¸Šé…ç½®åéœ€è¦é‡å¯ç³»ç»Ÿ reboot # ä¸é‡å¯çš„è¯ä¸€å®šè¦æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ for i in /proc/sys/net/ipv4/conf/*/rp_filter ; do echo 0 \u0026gt; \u0026#34;$i\u0026#34;; done åæ§½ # ç”±äºåšä¸»åªä¿®æ”¹äº†ä¸Šé¢çš„ sysctl.conf å¹¶ä¸”åªæ‰§è¡Œäº† sysctl -p æ‰€ä»¥æ‚²å‰§äº†ï¼Œæ·»åŠ è·¯ç”±ä¹‹åä¸€ç›´æ— æ³•æ”¶å½•ã€‚\n20201218æ›´æ–° # åˆšå¼€å§‹ä»¥ä¸ºæ˜¯å­˜å‚¨å’Œæ”¶å½•èµ°åŒä¸€ç½‘å£å¯¼è‡´èŠ±å±ï¼Œæ²¡æƒ³åˆ°ç»è¿‡ä¸€ç•ªæŠ“åŒ…åˆ†æä¹‹åï¼Œæœ€åç¡®å®šæ˜¯äº¤æ¢æœºæœ‰ç“¶é¢ˆï¼ˆäº¤æ¢æœºè€æ—§ï¼‰ï¼Œæ˜¯äº¤æ¢æœºçš„æ•°æ®å¤„ç†ä¸è¿‡æ¥å¯¼è‡´çš„ä¸¢åŒ…ã€‚\ncifs(samba) # å¦‚æœæ”¶å½•æ–‡ä»¶æ˜¯å­˜å‚¨åˆ°cifsçš„è¯ï¼Œä¸€å®šè¦åœ¨æŒ‚è½½çš„æ—¶å€™æŒ‡å®š cache=none ç¦ç”¨ç¼“å­˜ï¼Œä¸ç„¶æ”¶å½•é•¿è§†é¢‘æ—¶ä¼šå¯¼è‡´æ”¶å½•ä¸­æ–­ã€‚\n"},{"id":30,"href":"/blog/linux/loBZJ41MR/","title":"CentOSæ·»åŠ é™æ€è·¯ç”±ä¹‹route","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" routeå‘½ä»¤å‚æ•°è¯¦ç»†è¯´æ˜åŠå¸¸ç”¨å‘½ä»¤\nåŸæ–‡åœ°å€ docs.lvrui.io\n\u0026gt; route Kernel IP routing table Destination Gateway Genmask Flags Metric Ref Use Iface default localhost 0.0.0.0 UG 100 0 0 eno16780032 172.17.0.0 0.0.0.0 255.255.0.0 U 0 0 0 docker0 192.168.10.0 0.0.0.0 255.255.255.0 U 100 0 0 eno16780032 macOS ä¸­ä½¿ç”¨ netstat -nr å‘½ä»¤æ¥æŸ¥çœ‹å½“å‰è·¯ç”±è¡¨\nDestination ç›®æ ‡ç½‘è·¯\nGateway ç½‘å…³\nGenmask æ©ç \nFlags æ ‡è¯†\nU è·¯ç”±å·²ç»å¯åŠ¨\nH è·¯ç”±ç›®æ ‡ä¸ºä¸»æœº\nG ä½¿ç”¨ç½‘å…³\nR ä¸ºåŠ¨æ€è·¯ç”±å¤åŸè·¯ç”±è¡¨\nD ç”±å®ˆæŠ¤è¿›ç¨‹æˆ–é—´æ¥åŠ¨æ€å®‰è£…\nM è¢«è·¯ç”±å®ˆæŠ¤è¿›ç¨‹æˆ–é—´æ¥ä¿®æ”¹\nA é€šè¿‡ addrconf ä¿®æ”¹\nC ç¼“å­˜æ¡ç›®\n! æ‹’ç»è·¯ç”±\nMetric è·¯ç”±å¼€é”€, åˆ°ç›®æ ‡çš„â€˜è·ç¦»â€™ï¼ˆé€šå¸¸åŸºäºè·³æ•°ç»Ÿè®¡ï¼‰\nRef å‚è€ƒæ­¤è·¯ç”±çš„æ•°é‡\nUse è·¯ç”±æŸ¥æ‰¾è®¡æ•°ã€‚ä¾èµ–ä¸ä½¿ç”¨ - F è¿˜æ˜¯ - C é€‰é¡¹ï¼Œè¿™ä¸ªå€¼è¦ä¹ˆæ˜¯è·¯ç”±ç¼“å­˜æœªå‘½ä¸­æ•°è¦ä¹ˆæ˜¯å‘½ä¸­æ•°\nIface æ­¤è·¯ç”±æ•°æ®åŒ…å‘é€åˆ°çš„ç½‘ç»œæ¥å£\næ·»åŠ åˆ°ä¸»æœºçš„è·¯ç”± # route add â€“host 192.168.59.2 dev eth1 route add â€“host 192.168.59.2 gw 192.168.10.85 æ·»åŠ åˆ°ç½‘ç»œçš„è·¯ç”± # route add -net 192.168.248.0/24 gw 192.168.10.85 route add â€“net 192.168.248.0 netmask 255.255.255.0 gw 192.168.10.85 route add â€“net 192.168.248.0 netmask 255.255.255.0 dev eth1 æ·»åŠ é»˜è®¤ç½‘å…³ # route add default gw 192.168.10.85 route add -net 0.0.0.0 gw 192.168.10.85 ä½¿ç”¨ route å‘½ä»¤æ·»åŠ çš„è·¯ç”±ï¼Œæœºå™¨é‡å¯æˆ–è€…ç½‘å¡é‡å¯åè·¯ç”±å°±å¤±æ•ˆäº†\nroute del â€“host 192.168.10.85 dev eth1 æ€ä¹ˆ add çš„å°±æ€ä¹ˆ del æ‰. ä½†æ˜¯ del çš„æ—¶å€™å¯ä»¥ä¸å†™ç½‘å…³\nåœ¨ /etc/rc.local é‡Œæ·»åŠ è·¯ç”±ä¿¡æ¯\nroute add -net 192.168.247.0/24 dev eth1 route add -net 192.168.110.0/24 gw 192.168.10.85 åœ¨ /etc/sysconfig/network é‡Œæ·»åŠ åˆ°æœ«å°¾ GATEWAY=gw-ip æˆ–è€… GATEWAY=gw-dev\nåœ¨ /etc/sysconfig/static-router æ·»åŠ  any net x.x.x.x/24 gw y.y.y.y\næ·»åŠ æ°¸ä¹…è·¯ç”± # CentOS7 ä¸‹æ¨èä½¿ç”¨ä¸Šé¢ç¬¬ä¸‰ç§æ–¹æ³•æ·»åŠ æ°¸ä¹…é™æ€è·¯ç”±\n[root@centos7 ~] 10.15.150.0/24 via 192.168.150.253 dev enp0s3 10.25.250.0/24 via 192.168.150.253 dev enp0s3 å°†æ°¸ä¹…é™æ€è·¯ç”±éœ€è¦å†™åˆ° /etc/sysconfig/network-scripts/route-interface æ–‡ä»¶ä¸­\næ³¨æ„:\nifcfg-enp0s3 æ–‡ä»¶æ”¹åä¸º ifcfg-eth0 åï¼Œroute-enp0s3 æ–‡ä»¶ä¹Ÿè¦æ”¹åä¸º route-eth0\nå‚è€ƒæ–‡æ¡£:\nhttps://www.cnblogs.com/panblack/p/Centos7_Static_Routes.html "},{"id":31,"href":"/blog/macos/aaELFz1Mg/","title":"macos Lauchpad(å¯åŠ¨å°) é‡ç½®","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" é‡ç½®macosçš„Lauchpad(å¯åŠ¨å°)ï¼ŒåŠè®¾ç½®Lauchpad(å¯åŠ¨å°)çš„è¡Œæ•°å’Œåˆ—æ•°ã€‚\næ‰“å¼€ç»ˆç«¯ç¨‹åºï¼ŒæŒ‰éœ€æ±‚æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å³å¯ã€‚\né‡ç½® Lauchpad # defaults write com.apple.dock ResetLaunchPad -bool TRUE; é‡å¯ Dock # killall Dock è®¾ç½® Lauchpad å›¾æ ‡çš„åˆ—æ•° # defaults write com.apple.dock springboard-columns -int 7 è®¾ç½® Lauchpad å›¾æ ‡çš„è¡Œæ•° # defaults write com.apple.dock springboard-rows -int 7 "},{"id":32,"href":"/blog/linux/bdpp4QAMg/","title":"nginxåŠphp-fpmä¼˜åŒ–","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" ç®€å•çš„è®²è®²nginx+phpçš„ä¸€äº›å¸¸ç”¨ä¼˜åŒ–ï¼Œä»¥åŠç›¸å…³çš„å†…æ ¸å‚æ•°ä¼˜åŒ–ã€‚\nNginx ä¼˜åŒ– # 1. TCP ä¸ UNIX å¥—æ¥å­— # UNIX åŸŸå¥—æ¥å­—æä¾›çš„æ€§èƒ½ç•¥é«˜äº TCP å¥—æ¥å­—åœ¨å›é€æ¥å£ä¸Šçš„æ€§èƒ½ï¼ˆè¾ƒå°‘çš„æ•°æ®å¤åˆ¶ï¼Œè¾ƒå°‘çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼‰ã€‚å¦‚æœæ¯ä¸ªæœåŠ¡å™¨éœ€è¦æ”¯æŒè¶…è¿‡ 1000 ä¸ªè¿æ¥ï¼Œè¯·ä½¿ç”¨ TCP å¥—æ¥å­— - å®ƒä»¬å¯ä»¥æ›´å¥½åœ°æ‰©å±•ã€‚\nupstream backend { server unix:/var/run/fastcgi.sock; } 2. è°ƒæ•´ worker_processes å‚æ•° # ç°ä»£ç¡¬ä»¶æ˜¯å¤šå¤„ç†å™¨ï¼ŒNGINX å¯ä»¥åˆ©ç”¨å¤šä¸ªç‰©ç†æˆ–è™šæ‹Ÿå¤„ç†å™¨ã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæ‚¨çš„ Web æœåŠ¡å™¨è®¡ç®—æœºä¸ä¼šé…ç½®ä¸ºå¤„ç†å¤šä¸ªå·¥ä½œè´Ÿè½½ï¼ˆä¾‹å¦‚åŒæ—¶æä¾› Web æœåŠ¡å™¨å’Œæ‰“å°æœåŠ¡å™¨çš„æœåŠ¡ï¼‰ï¼Œå› æ­¤æ‚¨éœ€è¦é…ç½® NGINX ä»¥ä½¿ç”¨æ‰€æœ‰å¯ç”¨çš„å¤„ç†å™¨ï¼Œå› ä¸º NGINX å·¥ä½œè¿›ç¨‹æ˜¯ä¸æ˜¯å¤šçº¿ç¨‹çš„ã€‚\nå°† nginx.conf æ–‡ä»¶ä¸­çš„ worker_processes è®¾ç½®ä¸ºè®¡ç®—æœºæ‰€å…·æœ‰çš„æ ¸å¿ƒæ•°ã€‚\nå½“ä½ åœ¨å®ƒçš„æ—¶å€™ï¼Œå¢åŠ  worker_connections çš„æ•°é‡ï¼ˆæ¯ä¸ªæ ¸å¿ƒåº”è¯¥å¤„ç†å¤šå°‘ä¸ªè¿æ¥ï¼‰å¹¶å°† multi_accept è®¾ç½®ä¸º ONï¼Œå¦‚æœä½ åœ¨ Linux ä¸Šåˆ™è®¾ç½®ä¸º epollï¼š\nworker_processes 4; events { worker_connections 1024; multi_accept on; } 3. ç¦ç”¨è®¿é—®æ—¥å¿— # access_log off; log_not_found off; error_log /var/log/nginx-error.log warn; å¦‚æœæœ‰éœ€è¦ä¸å¯ä»¥å…³é—­ï¼Œè‡³å°‘æ˜¯ç¼“å­˜ä»–ä»¬\naccess_log /var/log/nginx/access.log main buffer=16k; 4. å¼€å¯ gzip å‹ç¼© # gzip on; gzip_disable \u0026#34;msie6\u0026#34;; gzip_vary on; gzip_proxied any; gzip_comp_level 6; gzip_min_length 1100; gzip_buffers 16 8k; gzip_http_version 1.1; gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript; 5. ç¼“å­˜è®¿é—®é¢‘æ¬¡è¾ƒé«˜çš„æ–‡ä»¶ # open_file_cache max=2000 inactive=20s; open_file_cache_valid 60s; open_file_cache_min_uses 5; open_file_cache_errors off; 6. è°ƒæ•´å®¢æˆ·ç«¯è¶…æ—¶ # client_max_body_size 50M; client_body_buffer_size 1m; client_body_timeout 15; client_header_timeout 15; keepalive_timeout 2 2; send_timeout 15; sendfile on; tcp_nopush on; tcp_nodelay on; 7. è°ƒæ•´è¾“å‡ºç¼“å­˜ # fastcgi_buffers 256 16k; fastcgi_buffer_size 128k; fastcgi_connect_timeout 3s; fastcgi_send_timeout 120s; fastcgi_read_timeout 120s; fastcgi_busy_buffers_size 256k; fastcgi_temp_file_write_size 256k; reset_timedout_connection on; server_names_hash_bucket_size 100; 8. è´Ÿè½½å‡è¡¡ç­–ç•¥ # Nginx æä¾›è½®è¯¢ï¼ˆround robinï¼‰ã€ç”¨æˆ· IP å“ˆå¸Œï¼ˆclient IPï¼‰å’ŒæŒ‡å®šæƒé‡ 3 ç§æ–¹å¼ã€‚\né»˜è®¤æƒ…å†µä¸‹ï¼ŒNginx ä¼šä¸ºä½ æä¾›è½®è¯¢ä½œä¸ºè´Ÿè½½å‡è¡¡ç­–ç•¥ã€‚ä½†æ˜¯è¿™å¹¶ä¸ä¸€å®šèƒ½å¤Ÿè®©ä½ æ»¡æ„ã€‚æ¯”å¦‚ï¼ŒæŸä¸€æ—¶æ®µå†…çš„ä¸€è¿ä¸²è®¿é—®éƒ½æ˜¯ç”±åŒä¸€ä¸ªç”¨æˆ· Michael å‘èµ·çš„ï¼Œé‚£ä¹ˆç¬¬ä¸€æ¬¡ Michael çš„è¯·æ±‚å¯èƒ½æ˜¯ backend2ï¼Œè€Œä¸‹ä¸€æ¬¡æ˜¯ backend3ï¼Œç„¶åæ˜¯ backend1ã€backend2ã€backend3â€¦â€¦ åœ¨å¤§å¤šæ•°åº”ç”¨åœºæ™¯ä¸­ï¼Œè¿™æ ·å¹¶ä¸é«˜æ•ˆã€‚å½“ç„¶ï¼Œä¹Ÿæ­£å› å¦‚æ­¤ï¼ŒNginx ä¸ºä½ æä¾›äº†ä¸€ä¸ªæŒ‰ç…§ Michaelã€Jasonã€David ç­‰ç­‰è¿™äº›ä¹±ä¸ƒå…«ç³Ÿçš„ç”¨æˆ·çš„ IP æ¥ hash çš„æ–¹å¼ï¼Œè¿™æ ·æ¯ä¸ª client çš„è®¿é—®è¯·æ±‚éƒ½ä¼šè¢«ç”©ç»™åŒä¸€ä¸ªåç«¯æœåŠ¡å™¨ã€‚\nupstream backend { ip_hash; server unix:/var/run/php7.2-fpm.sock1 weight=100 max_fails=5 fail_timeout=5; server unix:/var/run/php7.2-fpm.sock2 weight=100 max_fails=5 fail_timeout=5; } 9. æŒç»­ç›‘æ§æ—¥å¿— # å°¤å…¶æ˜¯åœ¨è°ƒä¼˜æœ€åˆæœŸï¼Œåœ¨ä¸€ä¸ªçª—å£\ntail -f /var/log/nginx/error.log åœ¨å¦å¤–ä¸¤ä¸ªçª—å£åˆ†åˆ«ï¼š\ntail -f /var/log/php-fpm/error.log tail -f /var/log/php-fpm/www-error.log PHP-fpm ä¼˜åŒ– # 1. ä¿®æ”¹è¿›ç¨‹ç®¡ç†æ¨¡å¼ # static ç®¡ç†æ¨¡å¼é€‚åˆæ¯”è¾ƒå¤§å†…å­˜çš„æœåŠ¡å™¨ï¼Œè€Œ dynamic åˆ™é€‚åˆå°å†…å­˜çš„æœåŠ¡å™¨ï¼Œä½ å¯ä»¥è®¾ç½®ä¸€ä¸ª pm.min_spare_servers å’Œ pm.max_spare_servers åˆç†èŒƒå›´ï¼Œè¿™æ ·è¿›ç¨‹æ•°ä¼šä¸æ–­å˜åŠ¨ã€‚ondemand æ¨¡å¼åˆ™æ›´åŠ é€‚åˆå¾®å°å†…å­˜ï¼Œä¾‹å¦‚ 512MB æˆ–è€… 256MB å†…å­˜ï¼Œä»¥åŠå¯¹å¯ç”¨æ€§è¦æ±‚ä¸é«˜çš„ç¯å¢ƒã€‚\npm = dynamic #æŒ‡å®šè¿›ç¨‹ç®¡ç†æ–¹å¼ï¼Œæœ‰3ç§å¯ä¾›é€‰æ‹©ï¼šstaticã€dynamicå’Œondemandã€‚ pm.max_children = 16 #staticæ¨¡å¼ä¸‹åˆ›å»ºçš„å­è¿›ç¨‹æ•°æˆ–dynamicæ¨¡å¼ä¸‹åŒä¸€æ—¶åˆ»å…è®¸æœ€å¤§çš„php-fpmå­è¿›ç¨‹æ•°é‡ã€‚ pm.start_servers = 10 #åŠ¨æ€æ–¹å¼ä¸‹çš„èµ·å§‹php-fpmè¿›ç¨‹æ•°é‡ã€‚ pm.min_spare_servers = 8 #åŠ¨æ€æ–¹å¼ä¸‹æœåŠ¡å™¨ç©ºé—²æ—¶æœ€å°php-fpmè¿›ç¨‹æ•°é‡ã€‚ pm.max_spare_servers = 16 #åŠ¨æ€æ–¹å¼ä¸‹æœåŠ¡å™¨ç©ºé—²æ—¶æœ€å¤§php-fpmè¿›ç¨‹æ•°é‡ã€‚ pm.max_requests = 2000 #php-fpmå­è¿›ç¨‹èƒ½å¤„ç†çš„æœ€å¤§è¯·æ±‚æ•°ã€‚ pm.process_idle_timeout = 10s request_terminate_timeout = 120 pm = staticï¼Œå§‹ç»ˆä¿æŒä¸€ä¸ªå›ºå®šæ•°é‡çš„å­è¿›ç¨‹ï¼Œè¿™ä¸ªæ•°ç”± pm.max_children å®šä¹‰ï¼Œè¿™ç§æ–¹å¼å¾ˆä¸çµæ´»ï¼Œä¹Ÿé€šå¸¸ä¸æ˜¯é»˜è®¤çš„ã€‚\npm = dynamicï¼Œå¯åŠ¨æ—¶ä¼šäº§ç”Ÿå›ºå®šæ•°é‡çš„å­è¿›ç¨‹ï¼ˆç”± pm.start_servers æ§åˆ¶ï¼‰å¯ä»¥ç†è§£æˆæœ€å°å­è¿›ç¨‹æ•°ï¼Œè€Œæœ€å¤§å­è¿›ç¨‹æ•°åˆ™ç”± pm.max_children å»æ§åˆ¶ï¼Œå­è¿›ç¨‹æ•°ä¼šåœ¨æœ€å¤§å’Œæœ€å°æ•°èŒƒå›´ä¸­å˜åŒ–ã€‚é—²ç½®çš„å­è¿›ç¨‹æ•°è¿˜å¯ä»¥ç”±å¦ 2 ä¸ªé…ç½®æ§åˆ¶ï¼Œåˆ†åˆ«æ˜¯ pm.min_spare_servers å’Œ pm.max_spare_serversã€‚å¦‚æœé—²ç½®çš„å­è¿›ç¨‹è¶…å‡ºäº† pm.max_spare_serversï¼Œåˆ™ä¼šè¢«æ€æ‰ã€‚å°äº pm.min_spare_servers åˆ™ä¼šå¯åŠ¨è¿›ç¨‹ï¼ˆæ³¨æ„ï¼Œpm.max_spare_servers åº”å°äº pm.max_childrenï¼‰ã€‚\npm = ondemandï¼Œè¿™ç§æ¨¡å¼å’Œ pm = dynamic ç›¸åï¼ŒæŠŠå†…å­˜æ”¾åœ¨ç¬¬ä¸€ä½ï¼Œæ¯ä¸ªé—²ç½®è¿›ç¨‹åœ¨æŒç»­é—²ç½®äº† pm.process_idle_timeout ç§’åå°±ä¼šè¢«æ€æ‰ï¼Œå¦‚æœæœåŠ¡å™¨é•¿æ—¶é—´æ²¡æœ‰è¯·æ±‚ï¼Œå°±åªä¼šæœ‰ä¸€ä¸ª php-fpm ä¸»è¿›ç¨‹ã€‚å¼Šç«¯æ˜¯é‡åˆ°é«˜å³°æœŸæˆ–è€…å¦‚æœ pm.process_idle_timeout çš„å€¼å¤ªçŸ­çš„è¯ï¼Œå®¹æ˜“å‡ºç° 504 Gateway Time-out é”™è¯¯ï¼Œå› æ­¤ pm = dynamic å’Œ pm = ondemand è°æ›´é€‚åˆè§†å®é™…æƒ…å†µè€Œå®šã€‚\n2. é‡Šæ”¾å†…å­˜çš„é…ç½® # pm.max_requests = 1000 è®¾ç½®æ¯ä¸ªå­è¿›ç¨‹é‡ç”Ÿä¹‹å‰æœåŠ¡çš„è¯·æ±‚æ•°. å¯¹äºå¯èƒ½å­˜åœ¨å†…å­˜æ³„æ¼çš„ç¬¬ä¸‰æ–¹æ¨¡å—æ¥è¯´æ˜¯éå¸¸æœ‰ç”¨çš„. å¦‚æœè®¾ç½®ä¸º â€˜0â€™ åˆ™ä¸€ç›´æ¥å—è¯·æ±‚. ç­‰åŒäº PHP_FCGI_MAX_REQUESTS ç¯å¢ƒå˜é‡. é»˜è®¤å€¼: 0.\nä¹Ÿå°±æ˜¯å½“ä¸€ä¸ª PHP-CGI è¿›ç¨‹å¤„ç†çš„è¯·æ±‚æ•°ç´¯ç§¯åˆ° 1000 ä¸ªåï¼Œè‡ªåŠ¨é‡å¯è¯¥è¿›ç¨‹ï¼Œé˜²æ­¢ç¬¬ä¸‰æ–¹åº“é€ æˆçš„å†…å­˜æ³„æ¼ã€‚ é‡å¯æ—¶å¯èƒ½ä¼šå¯¼è‡´ 502 é”™è¯¯ï¼Œåœ¨é«˜å¹¶å‘ç«™ç‚¹æ—¶æœ‰å‡ºç°ã€‚\n3. php-fpm æ…¢æ—¥å¿— # request_terminate_timeout = 30s #å°†æ‰§è¡Œæ—¶é—´å¤ªé•¿çš„è¿›ç¨‹ç›´æ¥ç»ˆæ­¢ request_slowlog_timeout = 2s #2ç§’ slowlog = log/$pool.log.slow #æ—¥å¿—æ–‡ä»¶ å†…æ ¸ä¼˜åŒ– # 1. TIME_WAITäº§ç”ŸåŸå› ï¼š # 1ã€nginxç°æœ‰çš„è´Ÿè½½å‡è¡¡æ¨¡å—å®ç°php fastcgiè´Ÿè½½å‡è¡¡ï¼Œnginxä½¿ç”¨äº†çŸ­è¿æ¥æ–¹å¼ï¼Œæ‰€ä»¥ä¼šé€ æˆå¤§é‡å¤„äºTIME_WAITçŠ¶æ€çš„è¿æ¥ã€‚\n2ã€TCP/IPè®¾è®¡è€…æœ¬æ¥æ˜¯è¿™ä¹ˆè®¾è®¡çš„\nä¸»è¦æœ‰ä¸¤ä¸ªåŸå› \n(1) é˜²æ­¢ä¸Šä¸€æ¬¡è¿æ¥ä¸­çš„åŒ…ï¼Œè¿·è·¯åé‡æ–°å‡ºç°ï¼Œå½±å“æ–°è¿æ¥ï¼ˆç»è¿‡2MSLï¼Œä¸Šä¸€æ¬¡è¿æ¥ä¸­æ‰€æœ‰çš„é‡å¤åŒ…éƒ½ä¼šæ¶ˆå¤±ï¼‰\n(2) å¯é çš„å…³é—­TCPè¿æ¥\nåœ¨ä¸»åŠ¨å…³é—­æ–¹å‘é€çš„æœ€åä¸€ä¸ª ack(fin) ï¼Œæœ‰å¯èƒ½ä¸¢å¤±ï¼Œè¿™æ—¶è¢«åŠ¨æ–¹ä¼šé‡æ–°å‘fin, å¦‚æœè¿™æ—¶ä¸»åŠ¨æ–¹å¤„äº CLOSED çŠ¶æ€ ï¼Œå°±ä¼šå“åº” rst è€Œä¸æ˜¯ ackã€‚æ‰€ä»¥ä¸»åŠ¨æ–¹è¦å¤„äº TIME_WAIT çŠ¶æ€ï¼Œè€Œä¸èƒ½æ˜¯ CLOSED ã€‚\n2. è¿‡å¤šTIME_WAITå±å®³ # TIME_WAIT å¹¶ä¸ä¼šå ç”¨å¾ˆå¤§èµ„æºçš„ï¼Œé™¤éå—åˆ°æ”»å‡»ã€‚åªè¦æŠŠTIME_WAITæ‰€å ç”¨å†…å­˜æ§åˆ¶åœ¨ä¸€å®šèŒƒå›´ã€‚ä¸€èˆ¬é»˜è®¤æœ€å¤§æ˜¯35600æ¡TIME_WAITã€‚\n3. è§£å†³æ–¹æ³• # net.ipv4.tcp_syncookies = 1 è¡¨ç¤ºå¼€å¯SYN Cookiesã€‚å½“å‡ºç°SYNç­‰å¾…é˜Ÿåˆ—æº¢å‡ºæ—¶ï¼Œå¯ç”¨cookiesæ¥å¤„ç†ï¼Œå¯é˜²èŒƒå°‘é‡SYNæ”»å‡»ï¼Œé»˜è®¤ä¸º0ï¼Œè¡¨ç¤ºå…³é—­ã€‚\nnet.ipv4.tcp_tw_reuse = 1 è¡¨ç¤ºå¼€å¯é‡ç”¨ã€‚å…è®¸å°†TIME-WAIT socketsé‡æ–°ç”¨äºæ–°çš„TCPè¿æ¥ï¼Œé»˜è®¤ä¸º0ï¼Œè¡¨ç¤ºå…³é—­ã€‚\nnet.ipv4.tcp_tw_recycle = 1 è¡¨ç¤ºå¼€å¯TCPè¿æ¥ä¸­TIME-WAIT socketsçš„å¿«é€Ÿå›æ”¶ï¼Œé»˜è®¤ä¸º0ï¼Œè¡¨ç¤ºå…³é—­ã€‚\nnet.ipv4.tcp_fin_timeout = 30 è¡¨ç¤ºå¦‚æœå¥—æ¥å­—ç”±æœ¬ç«¯è¦æ±‚å…³é—­ï¼Œè¿™ä¸ªå‚æ•°å†³å®šäº†å®ƒä¿æŒåœ¨FIN-WAIT-2çŠ¶æ€çš„æ—¶é—´ã€‚\nnet.ipv4.tcp_keepalive_time = 1200 è¡¨ç¤ºå½“keepaliveèµ·ç”¨çš„æ—¶å€™ï¼ŒTCPå‘é€keepaliveæ¶ˆæ¯çš„é¢‘åº¦ã€‚ç¼ºçœæ˜¯2å°æ—¶ï¼Œæ”¹ä¸º20åˆ†é’Ÿã€‚\nnet.ipv4.ip_local_port_range = 1024 65000 è¡¨ç¤ºç”¨äºå‘å¤–è¿æ¥çš„ç«¯å£èŒƒå›´ã€‚ç¼ºçœæƒ…å†µä¸‹å¾ˆå°ï¼š32768åˆ°61000ï¼Œæ”¹ä¸º1024åˆ°65000ã€‚\nnet.ipv4.tcp_max_syn_backlog = 8192 è¡¨ç¤ºSYNé˜Ÿåˆ—çš„é•¿åº¦ï¼Œé»˜è®¤ä¸º1024ï¼ŒåŠ å¤§é˜Ÿåˆ—é•¿åº¦ä¸º8192ï¼Œå¯ä»¥å®¹çº³æ›´å¤šç­‰å¾…è¿æ¥çš„ç½‘ç»œè¿æ¥æ•°ã€‚\nnet.ipv4.tcp_max_tw_buckets = 5000 è¡¨ç¤ºç³»ç»ŸåŒæ—¶ä¿æŒTIME_WAITå¥—æ¥å­—çš„æœ€å¤§æ•°é‡ï¼Œå¦‚æœè¶…è¿‡è¿™ä¸ªæ•°å­—ï¼ŒTIME_WAITå¥—æ¥å­—å°†ç«‹åˆ»è¢«æ¸…é™¤å¹¶æ‰“å°è­¦å‘Šä¿¡æ¯ã€‚é»˜ è®¤ä¸º180000ï¼Œæ”¹ä¸º5000ã€‚å¯¹äºApacheã€Nginxç­‰æœåŠ¡å™¨ï¼Œä¸Šå‡ è¡Œçš„å‚æ•°å¯ä»¥å¾ˆå¥½åœ°å‡å°‘TIME_WAITå¥—æ¥å­—æ•°é‡ï¼Œä½†æ˜¯å¯¹äºSquidï¼Œæ•ˆæœå´ä¸å¤§ã€‚æ­¤é¡¹å‚æ•°å¯ä»¥æ§åˆ¶TIME_WAITå¥—æ¥å­—çš„æœ€å¤§æ•°é‡ï¼Œé¿å…SquidæœåŠ¡å™¨è¢«å¤§é‡çš„TIME_WAITå¥—æ¥å­—æ‹–æ­»ã€‚\næ³¨:\nnet.ipv4.tcp_tw_reuse = 1 net.ipv4.tcp_tw_recycle = 1 è®¾ç½®è¿™ä¸¤ä¸ªå‚æ•°ï¼š reuseæ˜¯è¡¨ç¤ºæ˜¯å¦å…è®¸é‡æ–°åº”ç”¨å¤„äºTIME-WAITçŠ¶æ€çš„socketç”¨äºæ–°çš„TCPè¿æ¥ï¼› recyseæ˜¯åŠ é€ŸTIME-WAIT socketså›æ”¶\n"},{"id":33,"href":"/blog/ffmpeg/Mv3bzfgqM/","title":"ffmpegåœ¨ç‰¹å®šçš„æ—¶é—´æ··åˆä¸€ä¸ªæˆ–å¤šä¸ªéŸ³é¢‘","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" ä½¿ç”¨FFmpegä¸­çš„adelayå’Œamixæ»¤é•œç»™éŸ³é¢‘åšæ··éŸ³\nåœ¨30ç§’åæ··åˆ1ä¸ªéŸ³é¢‘\nffmpeg -i 1-1.mp3 -i 2.mp3 -filter_complex \u0026#34;[1]adelay=delays=30s:all=1[aud1];[0][aud1]amix=inputs=2\u0026#34; -vsync 2 -y 3.mp3 åœ¨30ç§’åæ··åˆ2ä¸ªéŸ³é¢‘\nffmpeg -i 1-1.mp3 -i 2.mp3 -i 3.mp3 -filter_complex \u0026#34;[1]adelay=delays=30s:all=1[aud1];[2]adelay=delays=30s:all=1[aud2];[0][aud1][aud2]amix=inputs=3\u0026#34; -vsync 2 -y 4.mp3 æ··åˆå¤šä¸ªå‚ç…§æ··åˆ2ä¸ªçš„å‘½ä»¤ä¿®æ”¹ä¸‹å³å¯\n"},{"id":34,"href":"/blog/linux/HTLMANZea/","title":"[supervisord]å¡«å‘ä¹‹æœ€å¤§è¿æ¥æ•°","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" ä¿®æ”¹supervisordé…ç½®çªç ´1024æœ€å¤§è¿æ¥æ•°\né—®é¢˜æè¿° # æœ€è¿‘åœ¨ä½¿ç”¨supervisordæœåŠ¡æ—¶å‘ç°ï¼Œæ— è®ºå¦‚ä½•ä¿®æ”¹ç³»ç»Ÿçš„æœ€å¤§è¿æ¥æ•°ï¼Œç”±supervisordç®¡ç†çš„ç¨‹åºéƒ½æ— æ³•çªç ´1024çš„é™åˆ¶ã€‚\nè§£å†³åŠæ³• # cat /etc/supervisord.conf [supervisord] minfds=81920 minprocs=81920 cat /etc/supervisord.d/xxx.ini [program:xxx] minfds=81920 minprocs=81920 systemctl restart supervisord.service "},{"id":35,"href":"/blog/ffmpeg/UtHueryud/","title":"FFmpeg æ°´å°","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" å›¾ç‰‡æ°´å°ã€æ–‡å­—æ°´å°ã€ç”»ä¸­ç”»\nå›¾ç‰‡æ°´å° # ffmpeg -i input.mp4 -vf \u0026#34;movie=wenzi.png[watermark];[in][watermark] overlay=main_w-overlay_w-10:main_h-overlay_h-10[out] \u0026#34; output.mp4 -i :ä¸€èˆ¬è¡¨ç¤ºè¾“å…¥\ninput.mp4:è¿™é‡Œè¡¨ç¤ºè¦å¤„ç†çš„è§†é¢‘æº\n-vf:æ»¤é•œç›¸å…³ï¼Œè§†é¢‘è£å‰ªï¼Œæ°´å°ç­‰ç­‰æ“ä½œéƒ½éœ€è¦å®ƒå®Œæˆ\nwenzi.png: è¦æ·»åŠ çš„æ°´å°å›¾ç‰‡åœ°å€\noverlay:æ°´å°å‚æ•°\nmain_w-overlay_w-10 : æ°´å°åœ¨xè½´çš„ä½ç½®ï¼Œä¹Ÿå¯ä»¥å†™æˆx=main_w-overlay_w-10\nmain_h-overlay_h-10ï¼šæ°´å°åœ¨yè½´çš„ä½ç½®\nffmpeg -i input.mp4 -i logo.png -filter_complex \u0026#39;overlay=x=10:y=main_h-overlay_h-10\u0026#39; output.mp4 -filter_complex: ç›¸æ¯”-vf,\nfilter_complexé€‚åˆå¼€å‘å¤æ‚çš„æ»¤é•œåŠŸèƒ½ï¼Œå¦‚åŒæ—¶å¯¹è§†é¢‘è¿›è¡Œè£å‰ªå¹¶æ—‹è½¬ã€‚å‚æ•°ä¹‹é—´ä½¿ç”¨é€—å·ï¼ˆï¼Œï¼‰éš”å¼€å³å¯\nmain_w:è§†é¢‘å®½åº¦\noverlay_w: è¦æ·»åŠ çš„å›¾ç‰‡æ°´å°å®½åº¦\nmain_h : è§†é¢‘é«˜åº¦\noverlay_h:è¦æ·»åŠ çš„å›¾ç‰‡æ°´å°å®½åº¦\næ–‡å­—æ°´å° # ffmpeg -i input.mp4 -vf \u0026#34;drawtext=fontfile=simhei.ttf: text=â€˜æŠ€æœ¯æ˜¯ç¬¬ä¸€ç”Ÿäº§åŠ›â€™:x=10:y=10:fontsize=24:fontcolor=white:shadowy=2\u0026#34; output.mp4 fontfile:å­—ä½“ç±»å‹\ntext:è¦æ·»åŠ çš„æ–‡å­—å†…å®¹\nfontsize:å­—ä½“å¤§å°\nfontcolorï¼šå­—ä½“é¢œè‰²\nç”»ä¸­ç”» # åªæ˜¾ç¤º1éï¼Œåè¾¹é‡å¤æ˜¾ç¤ºæœ€åä¸€å¸§ã€‚\nffmpeg -i bunny.mp4 -vf \u0026#34;movie=test.mov[logo];[0:v][logo]overlay=x=100:y=100\u0026#34; -y out.mp4 movä¸€ç›´å¾ªç¯æ˜¾ç¤ºã€‚ æ·»åŠ  loop=0,setpts=N/FRAME_RATE/TB å³å¯ã€‚\nffmpeg -i bunny.mp4 -vf \u0026#34;movie=test.mov:loop=0,setpts=N/FRAME_RATE/TB[logo];[0:v][logo]overlay=x=100:y=100\u0026#34; -y out.mp4 åªæ˜¾ç¤ºä¸€é æ·»åŠ eof_actionå³å¯ã€‚\nffmpeg -i bunny.mp4 -vf \u0026#34;movie=test.mov[logo];[0:v][logo]overlay=x=100:y=100:eof_action=pass\u0026#34; -vframes 1000 -y out.mp4 "},{"id":36,"href":"/blog/linux/QNIBzjz3k/","title":"supervisor å¸¸è§å‘åŠè§£å†³åŠæ³•","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" Too many open filesã€è·å–ä¸åˆ°$HOMEç­‰\nToo many open files # vim /etc/supervisord.conf [supervisord] minfds=81920 minprocs=81920 # systemctl restart supervisord è·å–ä¸åˆ°$HOME # [program:apache2] command=/home/chrism/bin/httpd -c \u0026#34;ErrorLog /dev/stdout\u0026#34; -DFOREGROUND user=chrism environment=HOME=\u0026#34;/home/chrism\u0026#34;,USER=\u0026#34;chrism\u0026#34; supervisorctl update "},{"id":37,"href":"/blog/linux/N2EsU3hZT/","title":"linux nvidia è·å–æ˜¾å¡ä¿¡æ¯","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" ä½¿ç”¨deviceQueryè·å–æ˜¾å¡ä¿¡æ¯\nç¯å¢ƒ # Linuxã€nvidiaã€cuda\nå‘½ä»¤ # /usr/local/cuda/extras/demo_suite/deviceQuery CUDA Device Query (Runtime API) version (CUDART static linking) Detected 2 CUDA Capable device(s) Device 0: \u0026#34;GeForce RTX 2080 Ti\u0026#34; CUDA Driver Version / Runtime Version 10.1 / 10.1 CUDA Capability Major/Minor version number: 7.5 Total amount of global memory: 11019 MBytes (11554717696 bytes) (68) Multiprocessors, ( 64) CUDA Cores/MP: 4352 CUDA Cores GPU Max Clock rate: 1545 MHz (1.54 GHz) Memory Clock rate: 7000 Mhz Memory Bus Width: 352-bit L2 Cache Size: 5767168 bytes Maximum Texture Dimension Size (x,y,z) 1D=(131072), 2D=(131072, 65536), 3D=(16384, 16384, 16384) Maximum Layered 1D Texture Size, (num) layers 1D=(32768), 2048 layers Maximum Layered 2D Texture Size, (num) layers 2D=(32768, 32768), 2048 layers Total amount of constant memory: 65536 bytes Total amount of shared memory per block: 49152 bytes Total number of registers available per block: 65536 Warp size: 32 Maximum number of threads per multiprocessor: 1024 Maximum number of threads per block: 1024 Max dimension size of a thread block (x,y,z): (1024, 1024, 64) Max dimension size of a grid size (x,y,z): (2147483647, 65535, 65535) Maximum memory pitch: 2147483647 bytes Texture alignment: 512 bytes Concurrent copy and kernel execution: Yes with 3 copy engine(s) Run time limit on kernels: No Integrated GPU sharing Host Memory: No Support host page-locked memory mapping: Yes Alignment requirement for Surfaces: Yes Device has ECC support: Disabled Device supports Unified Addressing (UVA): Yes Device supports Compute Preemption: Yes Supports Cooperative Kernel Launch: Yes Supports MultiDevice Co-op Kernel Launch: Yes Device PCI Domain ID / Bus ID / location ID: 0 / 1 / 0 Compute Mode: \u0026lt; Default (multiple host threads can use ::cudaSetDevice() with device simultaneously) \u0026gt; Device 1: \u0026#34;GeForce RTX 2080 Ti\u0026#34; CUDA Driver Version / Runtime Version 10.1 / 10.1 CUDA Capability Major/Minor version number: 7.5 Total amount of global memory: 11019 MBytes (11554717696 bytes) (68) Multiprocessors, ( 64) CUDA Cores/MP: 4352 CUDA Cores GPU Max Clock rate: 1545 MHz (1.54 GHz) Memory Clock rate: 7000 Mhz Memory Bus Width: 352-bit L2 Cache Size: 5767168 bytes Maximum Texture Dimension Size (x,y,z) 1D=(131072), 2D=(131072, 65536), 3D=(16384, 16384, 16384) Maximum Layered 1D Texture Size, (num) layers 1D=(32768), 2048 layers Maximum Layered 2D Texture Size, (num) layers 2D=(32768, 32768), 2048 layers Total amount of constant memory: 65536 bytes Total amount of shared memory per block: 49152 bytes Total number of registers available per block: 65536 Warp size: 32 Maximum number of threads per multiprocessor: 1024 Maximum number of threads per block: 1024 Max dimension size of a thread block (x,y,z): (1024, 1024, 64) Max dimension size of a grid size (x,y,z): (2147483647, 65535, 65535) Maximum memory pitch: 2147483647 bytes Texture alignment: 512 bytes Concurrent copy and kernel execution: Yes with 3 copy engine(s) Run time limit on kernels: No Integrated GPU sharing Host Memory: No Support host page-locked memory mapping: Yes Alignment requirement for Surfaces: Yes Device has ECC support: Disabled Device supports Unified Addressing (UVA): Yes Device supports Compute Preemption: Yes Supports Cooperative Kernel Launch: Yes Supports MultiDevice Co-op Kernel Launch: Yes Device PCI Domain ID / Bus ID / location ID: 0 / 2 / 0 Compute Mode: \u0026lt; Default (multiple host threads can use ::cudaSetDevice() with device simultaneously) \u0026gt; \u0026gt; Peer access from GeForce RTX 2080 Ti (GPU0) -\u0026gt; GeForce RTX 2080 Ti (GPU1) : Yes \u0026gt; Peer access from GeForce RTX 2080 Ti (GPU1) -\u0026gt; GeForce RTX 2080 Ti (GPU0) : Yes deviceQuery, CUDA Driver = CUDART, CUDA Driver Version = 10.1, CUDA Runtime Version = 10.1, NumDevs = 2 æºç  # https://github.com/NVIDIA/cuda-samples/tree/master/Samples/deviceQuery\nç¼–è¯‘ # /usr/local/cuda/bin/nvcc deviceQuery.cpp -I /usr/local/cuda/samples/common/inc/ -o deviceQuery "},{"id":38,"href":"/blog/ffmpeg/rdgQnFI6j/","title":"ffprobeè¯¦è§£","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" ffprobeæ˜¯ffmpegæä¾›çš„ä¸‰å¤§å·¥å…·ä¹‹ä¸€ï¼Œç”¨æ¥æŸ¥çœ‹éŸ³è§†é¢‘æ–‡ä»¶çš„å„ç§ä¿¡æ¯ï¼Œæ¯”å¦‚ï¼šå°è£…æ ¼å¼ã€éŸ³é¢‘/è§†é¢‘æµä¿¡æ¯ã€æ•°æ®åŒ…ä¿¡æ¯ç­‰ã€‚\nffprobeçš„æºç æ˜¯ffprobe.cï¼Œå¼€å‘è¿‡ç¨‹ä¸­å¦‚æœæƒ³è·å–ffprobeæŸ¥çœ‹çš„ä¿¡æ¯ï¼Œå¯ä»¥é€šè¿‡åˆ†ææºç ï¼Œè·å¾—å¯¹åº”å­—æ®µã€‚\næœ¬æ–‡ä¸»è¦ä»‹ç»formatã€streamã€Packetå’ŒFrameä¿¡æ¯ï¼ŒåŒ…å«æ¯ä¸ªå­—æ®µçš„è¯´æ˜ä»¥åŠå¯¹åº”çš„ffmpegå­—æ®µã€‚\næŸ¥çœ‹éŸ³è§†é¢‘æ–‡ä»¶çš„å°è£…æ ¼å¼ # ffprobe -show_format inputFile è¾“å‡ºä¿¡æ¯ï¼š\n[FORMAT] // æ–‡ä»¶å filename=VID_20190811_113717.mp4 // å®¹å™¨ä¸­æµçš„ä¸ªæ•°ï¼Œå³AVFormatContext-\u0026gt;nb_streams nb_streams=2 // å³AVFormatContext-\u0026gt;nb_programs nb_programs=0 // å°è£…æ ¼å¼ï¼Œå³AVFormatContext-\u0026gt;iformat-\u0026gt;name format_name=mov,mp4,m4a,3gp,3g2,mj2 // å³AVFormatContext-\u0026gt;iformat-\u0026gt;long_name format_long_name=QuickTime / MOV // å³AVFormatContext-\u0026gt;start_timeï¼ŒåŸºäºAV_TIME_BASE_Qï¼Œæ¢ç®—ä¸ºç§’ start_time=0.000000 // å³AVFormatContext-\u0026gt;durationï¼ŒåŸºäºAV_TIME_BASE_Qï¼Œæ¢ç®—ä¸ºç§’ duration=10.508000 // å•ä½å­—èŠ‚ï¼Œå³avio_size(AVFormatContext-\u0026gt;pb) size=27263322 // ç ç‡ï¼Œå³AVFormatContext-\u0026gt;bit_rate bit_rate=20756240 // å³AVFormatContext-\u0026gt;probe_score probe_score=100 [/FORMAT] æŸ¥çœ‹éŸ³è§†é¢‘æ–‡ä»¶çš„æµä¿¡æ¯ # ffprobe -show_streams inputFile è¾“å‡ºä¿¡æ¯ï¼š\n[STREAM] // å½“å‰æµçš„ç´¢å¼•ä¿¡æ¯,å¯¹åº”äºAVStream-\u0026gt;index index=0 // AVCodecDescriptor * cd = avcodec_descriptor_get(AVStream-\u0026gt;codecpar-\u0026gt;codec_id) // ç¼–ç åç§°ï¼Œå³cd-\u0026gt;name codec_name=h264 // ç¼–ç å…¨ç§°ï¼Œå³cd-\u0026gt;long_name codec_long_name=H.264 / AVC / MPEG-4 AVC / MPEG-4 part 10 // ä¸€ä¸ªç¼–ç å‚æ•°ï¼Œå¯ä»¥ä¸ºBaselineã€Mainã€Highç­‰ï¼ŒBaselineæ— Bå¸§ï¼ŒMainåŠä»¥åå¯ä»¥åŒ…å«Bå¸§ // é€šè¿‡avcodec_profile_name(AVStream-\u0026gt;codecpar-\u0026gt;codec_id, AVStream-\u0026gt;codecpar-\u0026gt;profile)è·å¾— profile=High // æµç±»å‹ï¼Œå³av_get_media_type_string(AVStream-\u0026gt;codecpar-\u0026gt;codec_type) codec_type=video // å³AVStream-\u0026gt;codec-\u0026gt;time_base codec_time_base=14777/877500 // é€šè¿‡å®av_fourcc2str(AVStream-\u0026gt;codecpar-\u0026gt;codec_tag)è·å¾— codec_tag_string=avc1 // å¯¹åº”AVStream-\u0026gt;codecpar-\u0026gt;codec_tag codec_tag=0x31637661 // æœ‰æ•ˆåŒºåŸŸçš„å®½åº¦ï¼Œå³AVStream-\u0026gt;codecpar-\u0026gt;width width=1920 // æœ‰æ•ˆåŒºåŸŸçš„é«˜åº¦ï¼Œå³AVStream-\u0026gt;codecpar-\u0026gt;height height=1080 // è§†é¢‘å¸§å®½åº¦ï¼Œå¯èƒ½ä¸ä¸Šé¢çš„å®½åº¦ä¸åŒï¼Œå³AVStream-\u0026gt;codec-\u0026gt;coded_widthï¼Œä¾‹å¦‚ï¼šå½“è§£ç å¸§åœ¨è¾“å‡ºå‰è£å‰ªæˆ–å¯ç”¨ä½åˆ†è¾¨ç‡æ—¶ coded_width=1920 // è§†é¢‘å¸§é«˜åº¦ï¼Œå¯èƒ½ä¸ä¸Šé¢çš„é«˜åº¦ä¸åŒï¼Œå³AVStream-\u0026gt;codec-\u0026gt;coded_heightï¼Œä¾‹å¦‚ï¼šå½“è§£ç å¸§åœ¨è¾“å‡ºå‰è£å‰ªæˆ–å¯ç”¨ä½åˆ†è¾¨ç‡æ—¶ coded_height=1088 // è§†é¢‘çš„å»¶è¿Ÿå¸§æ•°ï¼Œå³AVStream-\u0026gt;codecpar-\u0026gt;video_delay has_b_frames=0 // sarï¼Œå›¾åƒé‡‡é›†æ—¶ï¼Œæ¨ªå‘é‡‡é›†ç‚¹æ•°ä¸çºµå‘é‡‡é›†ç‚¹æ•°çš„æ¯”ä¾‹ // FFmpegæä¾›äº†å¤šä¸ªsarï¼šAVStream-\u0026gt;sample_aspect_ratioã€AVStream-\u0026gt;codecpar-\u0026gt;sample_aspect_ratioã€AVFrame-\u0026gt;sample_aspect_ratio // é€šè¿‡av_guess_sample_aspect_ratioè·å–æœ€ç»ˆçš„sar sample_aspect_ratio=1:1 // darï¼ŒçœŸæ­£å±•ç¤ºçš„å›¾åƒå®½é«˜æ¯”ï¼Œåœ¨æ¸²æŸ“è§†é¢‘æ—¶ï¼Œå¿…é¡»æ ¹æ®è¿™ä¸ªæ¯”ä¾‹è¿›è¡Œç¼©æ”¾ // é€šè¿‡av_reduceè®¡ç®—å¾—åˆ°ï¼Œpar * sar = dar display_aspect_ratio=16:9 // åƒç´ æ ¼å¼ï¼Œå³av_get_pix_fmt_name(AVStream-\u0026gt;codecpar-\u0026gt;format) pix_fmt=yuvj420p // ç¼–ç å‚æ•°ï¼Œå³AVStream-\u0026gt;codecpar-\u0026gt;level level=40 // é¢å¤–çš„è‰²å½©ç©ºé—´ç‰¹å¾ï¼Œå³av_color_range_name(AVStream-\u0026gt;codecpar-\u0026gt;color_range)ï¼ŒAVCOL_RANGE_MPEGå¯¹åº”tvï¼ŒAVCOL_RANGE_JPEGå¯¹åº”pc color_range=pc // YUVå½©è‰²ç©ºé—´ç±»å‹ï¼Œå³av_color_space_name(AVStream-\u0026gt;codecpar-\u0026gt;color_space) color_space=bt470bg // é¢œè‰²ä¼ è¾“ç‰¹æ€§ï¼Œå³av_color_transfer_name(AVStream-\u0026gt;codecpar-\u0026gt;color_trc) color_transfer=smpte170m // å³av_color_primaries_name(AVStream-\u0026gt;codecpar-\u0026gt;color_primaries) color_primaries=bt470bg // è‰²åº¦æ ·å“çš„ä½ç½®ï¼Œå³av_chroma_location_name(AVStream-\u0026gt;codecpar-\u0026gt;chroma_location) chroma_location=left // äº¤é”™è§†é¢‘ä¸­å­—æ®µçš„é¡ºåºï¼Œå³AVStream-\u0026gt;codecpar-\u0026gt;field_order field_order=unknown // av_timecode_make_mpeg_tc_stringå¤„ç†AVStream-\u0026gt;codec-\u0026gt;timecode_frame_startè·å¾— timecode=N/A // å‚è€ƒå¸§æ•°é‡ï¼Œå³AVStream-\u0026gt;codec-\u0026gt;refs refs=1 is_avc=true // è¡¨ç¤ºç”¨å‡ ä¸ªå­—èŠ‚è¡¨ç¤ºNALUçš„é•¿åº¦ nal_length_size=4 id=N/A // å½“å‰æµçš„åŸºæœ¬å¸§ç‡ï¼Œè¿™ä¸ªå€¼ä»…æ˜¯ä¸€ä¸ªçŒœæµ‹ï¼Œå¯¹åº”äºAVStream-\u0026gt;r_frame_rate r_frame_rate=30/1 // å¹³å‡å¸§ç‡ï¼Œå¯¹åº”äºAVStream-\u0026gt;avg_frame_rate avg_frame_rate=438750/14777 // AVStreamçš„æ—¶é—´åŸºå‡†ï¼Œå³AVStream-\u0026gt;time_base time_base=1/90000 // æµå¼€å§‹æ—¶é—´ï¼ŒåŸºäºtime_baseï¼Œå³AVStream-\u0026gt;start_time start_pts=0 // è½¬æ¢ï¼ˆstart_pts * time_baseï¼‰ä¹‹åçš„å¼€å§‹æ—¶é—´ï¼Œå•ä½ç§’ start_time=0.000000 // æµæ—¶é•¿ï¼ŒåŸºäºtime_baseï¼Œå³AVStream-\u0026gt;duration duration_ts=945728 // è½¬æ¢ï¼ˆduration_ts * time_baseï¼‰ä¹‹åçš„æ—¶é•¿ï¼Œå•ä½ç§’ duration=10.508089 // ç ç‡ï¼Œå³AVStream-\u0026gt;codecpar-\u0026gt;bit_rate bit_rate=19983544 // æœ€å¤§ç ç‡ï¼Œå³AVStream-\u0026gt;codec-\u0026gt;rc_max_rate max_bit_rate=N/A // Bits per sample/pixelï¼Œå³AVStream-\u0026gt;codec-\u0026gt;bits_per_raw_sample bits_per_raw_sample=8 // è§†é¢‘æµä¸­çš„å¸§æ•°ï¼Œå³AVStream-\u0026gt;nb_frames nb_frames=312 nb_read_frames=N/A nb_read_packets=N/A // ä¸‹é¢TAGä¸ºAVStream-\u0026gt;metadataä¸­çš„ä¿¡æ¯ // é€†æ—¶é’ˆçš„æ—‹è½¬è§’åº¦ï¼ˆç›¸å½“äºæ­£å¸¸è§†é¢‘çš„é€†æ—¶é’ˆæ—‹è½¬è§’åº¦ï¼‰ TAG:rotate=90 // åˆ›å»ºæ—¶é—´ TAG:creation_time=2019-08-11T03:37:28.000000Z // è¯­è¨€ TAG:language=eng TAG:handler_name=VideoHandle // SIDE_DATAä¸ºAVStream-\u0026gt;side_dataæ•°æ® [SIDE_DATA] // side_dataæ•°æ®ç±»å‹ï¼ŒDisplay Matrixè¡¨ç¤ºä¸€ä¸ª3*3çš„çŸ©é˜µï¼Œè¿™ä¸ªçŸ©é˜µéœ€è¦åº”ç”¨åˆ°è§£ç åçš„è§†é¢‘å¸§ä¸Šï¼Œæ‰èƒ½æ­£ç¡®å±•ç¤º side_data_type=Display Matrix displaymatrix= 00000000: 0 65536 0 00000001: -65536 0 0 00000002: 0 0 1073741824 // é¡ºæ—¶é’ˆæ—‹è½¬90åº¦è¿˜åŸè§†é¢‘ rotation=-90 [/SIDE_DATA] [/STREAM] [STREAM] // å½“å‰æµçš„ç´¢å¼•ä¿¡æ¯,å¯¹åº”äºAVStream-\u0026gt;index index=1 // AVCodecDescriptor * cd = avcodec_descriptor_get(AVStream-\u0026gt;codecpar-\u0026gt;codec_id) // ç¼–ç åç§°ï¼Œå³cd-\u0026gt;name codec_name=aac // ç¼–ç å…¨ç§°ï¼Œå³cd-\u0026gt;long_name codec_long_name=AAC (Advanced Audio Coding) // é€šè¿‡avcodec_profile_name(AVStream-\u0026gt;codecpar-\u0026gt;codec_id, AVStream-\u0026gt;codecpar-\u0026gt;profile)è·å¾— profile=LC // æµç±»å‹ï¼Œå³av_get_media_type_string(AVStream-\u0026gt;codecpar-\u0026gt;codec_type) codec_type=audio // å³AVStream-\u0026gt;codec-\u0026gt;time_base codec_time_base=1/48000 // é€šè¿‡å®av_fourcc2str(AVStream-\u0026gt;codecpar-\u0026gt;codec_tag)è·å¾— codec_tag_string=mp4a // å¯¹åº”AVStream-\u0026gt;codecpar-\u0026gt;codec_tag codec_tag=0x6134706d // é‡‡æ ·ç‚¹æ ¼å¼ï¼Œé€šè¿‡av_get_sample_fmt_name(AVStream-\u0026gt;codecpar-\u0026gt;format)è·å– sample_fmt=fltp // é‡‡æ ·ç‡ï¼Œå³AVStream-\u0026gt;codecpar-\u0026gt;sample_rate sample_rate=48000 // é€šé“æ•°ï¼Œå³AVStream-\u0026gt;codecpar-\u0026gt;channels channels=2 // é€šé“å¸ƒå±€ï¼Œä¸channelsæ˜¯ç›¸å¯¹åº”ï¼Œé€šè¿‡av_bprint_channel_layoutè·å–ï¼Œstereoè¡¨ç¤ºç«‹ä½“å£° channel_layout=stereo // æ¯ä¸ªé‡‡æ ·ç‚¹å ç”¨å¤šå°‘bitï¼Œå³av_get_bits_per_sample(par-\u0026gt;codec_id) bits_per_sample=0 id=N/A r_frame_rate=0/0 avg_frame_rate=0/0 // AVStreamçš„æ—¶é—´åŸºå‡†ï¼Œå³AVStream-\u0026gt;time_base time_base=1/48000 // æµå¼€å§‹æ—¶é—´ï¼ŒåŸºäºtime_baseï¼Œå³AVStream-\u0026gt;start_time start_pts=0 // è½¬æ¢ï¼ˆstart_pts * time_baseï¼‰ä¹‹åçš„å¼€å§‹æ—¶é—´ï¼Œå•ä½ç§’ start_time=0.000000 // æµæ—¶é•¿ï¼ŒåŸºäºtime_baseï¼Œå³AVStream-\u0026gt;duration duration_ts=502776 // è½¬æ¢ï¼ˆduration_ts * time_baseï¼‰ä¹‹åçš„æ—¶é•¿ï¼Œå•ä½ç§’ duration=10.474500 // ç ç‡ï¼Œå³AVStream-\u0026gt;codecpar-\u0026gt;bit_rate bit_rate=156002 // æœ€å¤§ç ç‡ï¼Œå³AVStream-\u0026gt;codec-\u0026gt;rc_max_rate max_bit_rate=156000 // Bits per sample/pixelï¼Œå³AVStream-\u0026gt;codec-\u0026gt;bits_per_raw_sample bits_per_raw_sample=N/A // éŸ³é¢‘æµä¸­çš„å¸§æ•°ï¼Œå³AVStream-\u0026gt;nb_frames nb_frames=491 nb_read_frames=N/A nb_read_packets=N/A TAG:creation_time=2019-08-11T03:37:28.000000Z TAG:language=eng TAG:handler_name=SoundHandle [/STREAM] SAR(Sample Aspect Ratio): é‡‡æ ·æ•°å®½é«˜æ¯”ï¼Œå›¾åƒçš„æ¨ªå‘é‡‡é›†ç‚¹æ•°ä¸çºµå‘é‡‡é›†ç‚¹æ•°çš„æ¯”å€¼ï¼Œå³åƒç´ ä¸ªæ•°çš„æ¯”å€¼ã€‚\nPAR(Pixel Aspect Ratio): åƒç´ å®½é«˜æ¯”ï¼Œå³æ¯ä¸ªåƒç´ çš„å®½åº¦ä¸é«˜åº¦çš„æ¯”å€¼ï¼Œæ‰€ä»¥å¯ä»¥è®¤ä¸ºåƒç´ ä¸æ˜¯æ­£æ–¹å½¢çš„ã€‚\nDAR(Display Aspect Ratio): æ˜¾ç¤ºå®½é«˜æ¯”ï¼Œå›¾åƒæœ€ç»ˆå±•ç¤ºçš„å®½é«˜æ¯”ï¼Œæ’­æ”¾å™¨åœ¨æ¸²æŸ“è§†é¢‘å¸§æ—¶ï¼Œéœ€è¦ä¿æŒDARçš„æ¯”ä¾‹ã€‚\nå®ƒä»¬ä¹‹é—´çš„å…³ç³»ï¼šPAR * SAR = DAR\nå¦‚ä¸Šå›¾æ‰€ç¤ºï¼šæ¯ä¸ªæ–¹æ ¼ä»£è¡¨ä¸€ä¸ªåƒç´ ï¼Œå®½åº¦ä¸º5åƒç´ ï¼Œé«˜åº¦ä¸º4åƒç´ ï¼Œå³SAR=5 : 4\nå‡è®¾å›¾åƒçš„æ˜¾ç¤ºå®½åº¦ä¸º160ï¼Œé«˜åº¦ä¸º120ï¼Œå³DAR=4 : 3\né‚£ä¹ˆå¯ä»¥è®¡ç®—å‡ºPAR = DAR / SAR = 16 : 15ï¼Œè¡¨ç¤ºåƒç´ æ–¹æ ¼æ˜¯ä¸€ä¸ªé•¿æ–¹å½¢ã€‚\nFFmpegæä¾›äº†å¤šä¸ªSARï¼š\nAVStream-\u0026gt;sample_aspect_ratio\nAVStream-\u0026gt;codecpar-\u0026gt;sample_aspect_ratio\nAVFrame-\u0026gt;sample_aspect_ratio\næœ€ç»ˆçš„SARæ˜¯é€šè¿‡av_guess_sample_aspect_ratioè·å–çš„ã€‚\nå¯¹äºDARï¼ŒAVStream-\u0026gt;display_aspect_ratioçš„å€¼å§‹ç»ˆä¸º0:0ï¼Œå‚è€ƒffprobeä»£ç ï¼Œå¯çŸ¥DARæ˜¯é€šè¿‡av_reduceè®¡ç®—å¾—åˆ°çš„ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\nAVRational sar, dar; // par AVCodecParameters *par = AVStream-\u0026gt;codecpar; // è®¡ç®—å‡ºsar sar = av_guess_sample_aspect_ratio(AVFormatContext, AVStream, NULL); // æ ¹æ®parå’Œsarè®¡ç®—å‡ºdar av_reduce(\u0026amp;dar.num, \u0026amp;dar.den, par-\u0026gt;width * sar.num, par-\u0026gt;height * sar.den, 1024*1024); æŸ¥çœ‹éŸ³è§†é¢‘æ–‡ä»¶çš„æ•°æ®åŒ…ä¿¡æ¯ # // -select_streamsè¡¨ç¤ºé€‰æ‹©éŸ³é¢‘æˆ–è€…è§†é¢‘ ffprobe -show_format [-select_streams audio | video] inputFile é¦–å…ˆçœ‹ä¸‹è§†é¢‘æµçš„ç¬¬ä¸€ä¸ªPacketå’Œç¬¬äºŒä¸ªPacketï¼š\n[PACKET] //Packetç±»å‹ï¼Œå³av_get_media_type_string(AVStream-\u0026gt;codecpar-\u0026gt;codec_type) codec_type=video // å½“å‰å¸§æ‰€å±æµçš„ç´¢å¼•ä¿¡æ¯,å¯¹åº”äºAVStream-\u0026gt;index stream_index=0 // å¸§å±•ç¤ºæ—¶é—´ï¼Œå³AVPacket-\u0026gt;ptsï¼ŒåŸºäºAVStream-\u0026gt;time_baseæ—¶é—´åŸºå‡† pts=0 // æ¢ç®—ä¸ºç§’ pts_time=0.000000 // å¸§è§£ç æ—¶é—´ï¼Œå³AVPacket-\u0026gt;dtsï¼ŒåŸºäºAVStream-\u0026gt;time_baseæ—¶é—´åŸºå‡† dts=0 // æ¢ç®—ä¸ºç§’ dts_time=0.000000 // å½“å‰å¸§çš„æ—¶é•¿ï¼Œç­‰äºä¸‹ä¸€å¸§çš„pts - å½“å‰å¸§ptsï¼Œå³AVPacket-\u0026gt;durationï¼ŒåŸºäºAVStream-\u0026gt;time_baseæ—¶é—´åŸºå‡† duration=12972 // æ¢ç®—ä¸ºç§’ duration_time=0.144133 // AVPacket-\u0026gt;convergence_durationï¼Œä¹Ÿæ˜¯åŸºäºAVStream-\u0026gt;time_baseæ—¶é—´åŸºå‡† convergence_duration=N/A // æ¢ç®—ä¸ºç§’ convergence_duration_time=N/A // å½“å‰å¸§çš„Sizeï¼Œå­—èŠ‚ï¼Œå³AVPacket-\u0026gt;size size=187872 // å½“å‰å¸§åœ°å€åç§»é‡ï¼Œå³AVPacket-\u0026gt;pos pos=830842 flags=K_ [/PACKET] [PACKET] codec_type=video stream_index=0 pts=12972 // å³ 12972 / 90000 pts_time=0.144133 dts=12972 dts_time=0.144133 duration=2999 duration_time=0.033322 convergence_duration=N/A convergence_duration_time=N/A size=31200 // ä¸Šä¸€å¸§çš„pos + size pos=1018714 flags=__ [/PACKET] ç„¶åçœ‹ä¸‹éŸ³é¢‘æµçš„ç¬¬ä¸€ä¸ªPacketå’Œç¬¬äºŒä¸ªPacketï¼š\n[PACKET] // éŸ³é¢‘å¸§ codec_type=audio // å½“å‰å¸§æ‰€å±æµçš„ç´¢å¼•ä¿¡æ¯,å¯¹åº”äºAVStream-\u0026gt;index stream_index=1 // å¸§å±•ç¤ºæ—¶é—´ï¼Œå³AVPacket-\u0026gt;ptsï¼ŒåŸºäºAVStream-\u0026gt;time_baseæ—¶é—´åŸºå‡† pts=0 pts_time=0.000000 // å¸§è§£ç æ—¶é—´ï¼Œå³AVPacket-\u0026gt;dtsï¼ŒåŸºäºAVStream-\u0026gt;time_baseæ—¶é—´åŸºå‡† dts=0 dts_time=0.000000 // å½“å‰å¸§çš„æ—¶é•¿ï¼Œç­‰äºä¸‹ä¸€å¸§çš„pts - å½“å‰å¸§ptsï¼Œå³AVPacket-\u0026gt;durationï¼ŒåŸºäºAVStream-\u0026gt;time_baseæ—¶é—´åŸºå‡† duration=1024 // 1024 / 48000 duration_time=0.021333 convergence_duration=N/A convergence_duration_time=N/A size=416 pos=810458 flags=K_ [/PACKET] [PACKET] // éŸ³é¢‘å¸§ codec_type=audio stream_index=1 pts=1024 // 1024 / 48000 pts_time=0.021333 dts=1024 dts_time=0.021333 duration=1024 duration_time=0.021333 convergence_duration=N/A convergence_duration_time=N/A size=416 // ä¸Šä¸€å¸§çš„pos + size pos=810874 flags=K_ [/PACKET] æŸ¥çœ‹éŸ³è§†é¢‘æ–‡ä»¶è§£ç åçš„å¸§ä¿¡æ¯ # // -select_streamsè¡¨ç¤ºé€‰æ‹©éŸ³é¢‘æˆ–è€…è§†é¢‘ ffprobe -show_frames [-select_streams audio | video] inputFile é¦–å…ˆçœ‹ä¸‹è§†é¢‘æµçš„ç¬¬ä¸€å¸§å’Œç¬¬äºŒå¸§ï¼š\n[FRAME] // å¸§ç±»å‹ï¼Œå³av_get_media_type_string(AVStream-\u0026gt;codecpar-\u0026gt;codec_type) media_type=video // å½“å‰å¸§æ‰€å±æµçš„ç´¢å¼•ä¿¡æ¯, å¯¹åº”äºAVStream-\u0026gt;index stream_index=0 // æ˜¯å¦å…³é”®å¸§ï¼Œ1ï¼šå…³é”®å¸§ï¼Œ0ï¼šéå…³é”®å¸§ï¼Œå³AVFrame-\u0026gt;key_frame key_frame=1 // å¸§å±•ç¤ºæ—¶é—´, å³AVFrame-\u0026gt;pts, åŸºäºAVStream-\u0026gt;time_baseæ—¶é—´åŸºå‡† pkt_pts=0 // æ¢ç®—ä¸ºç§’ pkt_pts_time=0.000000 // å¸§è§£ç æ—¶é—´ï¼Œä»å¯¹åº”çš„AVPacket copyè€Œæ¥ï¼Œå³AVFrame-\u0026gt;pkt_dtsï¼ŒåŸºäºAVStream-\u0026gt;time_baseæ—¶é—´åŸºå‡† pkt_dts=0 // æ¢ç®—ä¸ºç§’ pkt_dts_time=0.000000 // å¸§æ—¶é—´æˆ³ï¼ŒåŸºæœ¬ä¸ptsç›¸åŒï¼Œå³AVFrame-\u0026gt;best_effort_timestampï¼ŒåŸºäºAVStream-\u0026gt;time_baseæ—¶é—´åŸºå‡† best_effort_timestamp=0 // æ¢ç®—ä¸ºç§’ best_effort_timestamp_time=0.000000 // å¯¹åº”çš„AVPacketçš„å¸§æ—¶é•¿ï¼Œå³AVFrame-\u0026gt;pkt_durationï¼ŒåŸºäºAVStream-\u0026gt;time_baseæ—¶é—´åŸºå‡† pkt_duration=12972 // æ¢ç®—ä¸ºç§’ pkt_duration_time=0.144133 // ä»æœ€åä¸€ä¸ªå·²è¾“å…¥è§£ç å™¨çš„AVPacketé‡æ–°æ’åºçš„posï¼Œå³AVFrame-\u0026gt;pkt_pos pkt_pos=830842 // å¯¹åº”çš„AVPacketçš„å¸§sizeï¼Œå³AVFrame-\u0026gt;pkt_size pkt_size=187872 // æ—‹è½¬ä¹‹å‰çš„å¸§å®½åº¦ï¼Œå³AVFrame-\u0026gt;width width=1920 // æ—‹è½¬ä¹‹å‰çš„å¸§é«˜åº¦ï¼Œå³AVFrame-\u0026gt;height height=1080 // è§†é¢‘å¸§çš„åƒç´ æ ¼å¼ï¼Œå³av_get_pix_fmt_name(AVFrame-\u0026gt;format) pix_fmt=yuvj420p // sarï¼Œå›¾åƒé‡‡é›†æ—¶ï¼Œæ¨ªå‘é‡‡é›†ç‚¹æ•°ä¸çºµå‘é‡‡é›†ç‚¹æ•°çš„æ¯”ä¾‹ // FFmpegæä¾›äº†å¤šä¸ªsarï¼šAVStream-\u0026gt;sample_aspect_ratioã€AVStream-\u0026gt;codecpar-\u0026gt;sample_aspect_ratioã€AVFrame-\u0026gt;sample_aspect_ratio // é€šè¿‡av_guess_sample_aspect_ratioè·å–æœ€ç»ˆçš„sar sample_aspect_ratio=1:1 // è§†é¢‘å¸§çš„å›¾ç‰‡ç±»å‹ï¼Œæ­¤å¤„ä¸ºIå¸§ï¼Œå³av_get_picture_type_char(frame-\u0026gt;pict_type) pict_type=I // picture number in bitstream order, å³AVFrame-\u0026gt;coded_picture_number coded_picture_number=0 // picture number in display order, å³AVFrame-\u0026gt;display_picture_number display_picture_number=0 // è§†é¢‘å¸§å†…å®¹æ˜¯å¦æ˜¯äº¤é”™çš„, å³AVFrame-\u0026gt;interlaced_frame interlaced_frame=0 // è‹¥è§†é¢‘å¸§å†…å®¹æ˜¯äº¤é”™çš„ï¼Œè¡¨ç¤ºé¦–å…ˆå±•ç¤ºçš„é¡¶éƒ¨å­—æ®µï¼Œå³AVFrame-\u0026gt;top_field_first top_field_first=0 // å½“è§£ç æ—¶ï¼Œè¿™ä¸ªä¿¡å·è¡¨æ˜è§†é¢‘å¸§å¿…é¡»å»¶è¿Ÿå¤šå°‘ã€‚extra_delay = repeat_pict / (2*fps), å³AVFrame-\u0026gt;repeat_pict repeat_pict=0 // é¢å¤–çš„è‰²å½©ç©ºé—´ç‰¹å¾ï¼Œå³av_color_range_name(AVFrame-\u0026gt;color_range)ï¼ŒAVCOL_RANGE_MPEGå¯¹åº”tvï¼ŒAVCOL_RANGE_JPEGå¯¹åº”pc color_range=pc // YUVå½©è‰²ç©ºé—´ç±»å‹ï¼Œå³av_color_space_name(AVFrame-\u0026gt;colorspace) color_space=bt470bg // å³av_color_primaries_name(AVFrame-\u0026gt;color_primaries) color_primaries=bt470bg // é¢œè‰²ä¼ è¾“ç‰¹æ€§ï¼Œå³av_color_transfer_name(AVFrame-\u0026gt;color_trc) color_transfer=smpte170m // è‰²åº¦æ ·å“çš„ä½ç½®ï¼Œå³av_chroma_location_name(AVFrame-\u0026gt;chroma_location) chroma_location=left [/FRAME] [FRAME] media_type=video stream_index=0 // éå…³é”®å¸§ key_frame=0 pkt_pts=12972 // 12972 / 90000 pkt_pts_time=0.144133 pkt_dts=12972 pkt_dts_time=0.144133 best_effort_timestamp=12972 best_effort_timestamp_time=0.144133 pkt_duration=2999 pkt_duration_time=0.033322 pkt_pos=1018714 pkt_size=31200 width=1920 height=1080 pix_fmt=yuvj420p sample_aspect_ratio=1:1 // è§†é¢‘å¸§çš„å›¾ç‰‡ç±»å‹ï¼Œæ­¤å¤„ä¸ºPå¸§ï¼Œå³av_get_picture_type_char(frame-\u0026gt;pict_type) pict_type=P coded_picture_number=1 display_picture_number=0 interlaced_frame=0 top_field_first=0 repeat_pict=0 color_range=pc color_space=bt470bg color_primaries=bt470bg color_transfer=smpte170m chroma_location=left [/FRAME] ç„¶åçœ‹ä¸‹éŸ³é¢‘æµçš„ç¬¬ä¸€å¸§å’Œç¬¬äºŒå¸§ï¼š\n[FRAME] // å¸§ç±»å‹ï¼Œå³av_get_media_type_string(AVStream-\u0026gt;codecpar-\u0026gt;codec_type) media_type=audio // å½“å‰å¸§æ‰€å±æµçš„ç´¢å¼•ä¿¡æ¯, å¯¹åº”äºAVStream-\u0026gt;index stream_index=1 // æ˜¯å¦å…³é”®å¸§ key_frame=1 // å¸§å±•ç¤ºæ—¶é—´, å³AVFrame-\u0026gt;pts, åŸºäºAVStream-\u0026gt;time_baseæ—¶é—´åŸºå‡† pkt_pts=0 // æ¢ç®—ä¸ºç§’ pkt_pts_time=0.000000 // å¸§è§£ç æ—¶é—´ï¼Œä»å¯¹åº”çš„AVPacket copyè€Œæ¥ï¼Œå³AVFrame-\u0026gt;pkt_dtsï¼ŒåŸºäºAVStream-\u0026gt;time_baseæ—¶é—´åŸºå‡† pkt_dts=0 // æ¢ç®—ä¸ºç§’ pkt_dts_time=0.000000 // å¸§æ—¶é—´æˆ³ï¼ŒåŸºæœ¬ä¸ptsç›¸åŒï¼Œå³AVFrame-\u0026gt;best_effort_timestampï¼ŒåŸºäºAVStream-\u0026gt;time_baseæ—¶é—´åŸºå‡† best_effort_timestamp=0 // æ¢ç®—ä¸ºç§’ best_effort_timestamp_time=0.000000 // å¯¹åº”çš„AVPacketçš„å¸§æ—¶é•¿ï¼Œå³AVFrame-\u0026gt;pkt_durationï¼ŒåŸºäºAVStream-\u0026gt;time_baseæ—¶é—´åŸºå‡† pkt_duration=1024 // æ¢ç®—ä¸ºç§’ pkt_duration_time=0.021333 // ä»æœ€åä¸€ä¸ªå·²è¾“å…¥è§£ç å™¨çš„AVPacketé‡æ–°æ’åºçš„posï¼Œå³AVFrame-\u0026gt;pkt_pos pkt_pos=810458 // å¯¹åº”çš„AVPacketçš„å¸§sizeï¼Œå³AVFrame-\u0026gt;pkt_size pkt_size=416 // éŸ³é¢‘é‡‡æ ·ç‚¹æ ¼å¼ï¼Œå³av_get_sample_fmt_name(AVFrame-\u0026gt;format) sample_fmt=fltp // å½“å‰éŸ³é¢‘å¸§çš„é‡‡æ ·ç‚¹æ•°ï¼Œå³AVFrame-\u0026gt;nb_samples nb_samples=1024 // é€šé“æ•°ï¼Œå³AVFrame-\u0026gt;channels channels=2 // é€šé“å¸ƒå±€ï¼Œé€šè¿‡av_bprint_channel_layoutå¾—åˆ°ï¼Œä¸channelså¯¹åº” channel_layout=stereo [/FRAME] [FRAME] media_type=audio stream_index=1 key_frame=1 pkt_pts=1024 pkt_pts_time=0.021333 pkt_dts=1024 pkt_dts_time=0.021333 best_effort_timestamp=1024 best_effort_timestamp_time=0.021333 pkt_duration=1024 pkt_duration_time=0.021333 pkt_pos=810874 pkt_size=416 sample_fmt=fltp nb_samples=1024 channels=2 channel_layout=stereo [/FRAME] å‚è€ƒæ–‡ç«  # FFmpegè·å–è§†é¢‘æ­£ç¡®çš„å®½é«˜æ¯”\nè½¬è½½è‡ª-\u0026gt;https://www.zybuluo.com/ltlovezh/note/1534824\n"},{"id":39,"href":"/blog/macos/MiSev5_HW/","title":"upx for macos ä¹‹æºç ç¼–è¯‘","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" UPX (the Ultimate Packer for eXecutables)æ˜¯ä¸€æ¬¾å…ˆè¿›çš„å¯æ‰§è¡Œç¨‹åºæ–‡ä»¶å‹ç¼©å™¨ï¼Œå‹ç¼©è¿‡çš„å¯æ‰§è¡Œæ–‡ä»¶ä½“ç§¯ç¼©å°50%-70% ï¼Œè¿™æ ·å‡å°‘äº†ç£ç›˜å ç”¨ç©ºé—´ã€ç½‘ç»œä¸Šä¼ ä¸‹è½½çš„æ—¶é—´å’Œå…¶å®ƒåˆ†å¸ƒä»¥åŠå­˜å‚¨è´¹ç”¨ã€‚\nå‡†å¤‡æºç  # git clone https://github.com/upx/upx.git git clone https://github.com/upx/upx-lzma-sdk.git lzma-sdk wget http://www.oberhumer.com/opensource/ucl/download/ucl-1.03.tar.gz ç¼–è¯‘æºç  # tar -xzvf ucl-1.03.tar.gz cd ucl-1.03 ./configure --prefix=/home/o/ucl CC=clang make cd ../upx make all UPX_UCLDIR=../ucl-1.03 UPX_LZMADIR=../lzma-sdk ç¼–è¯‘å®Œæˆä¹‹åå†srcç›®å½•ä¸‹èƒ½æ‰¾åˆ°upx.outæ–‡ä»¶å°±æˆåŠŸäº†\n"},{"id":40,"href":"/blog/ffmpeg/ovfEIBOES/","title":"ffmpeg åˆ é™¤éŸ³è§†é¢‘æ–‡ä»¶ä¸­çš„å…ƒæ•°æ®","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" æ¸…é™¤mp3æ–‡ä»¶ä¸­è‡ªå¸¦çš„ä¸“è¾‘ï¼ˆalbumï¼‰ï¼Œè‰ºæœ¯å®¶ï¼ˆartistï¼‰ï¼Œæµæ´¾ï¼ˆgenreï¼‰ç­‰å…ƒæ•°æ®ã€‚\nffmpeg -i \u0026#34;test.mp3\u0026#34; -b:a 320k -map_metadata -1 -y \u0026#34;out.mp3\u0026#34; -map_metadata -1 è¡¨ç¤ºæ¸…é™¤æ‰€æœ‰å…ƒæ•°æ®\n"},{"id":41,"href":"/blog/linux/roH7hpe6L/","title":"mediainfo é™æ€ç¼–è¯‘è„šæœ¬","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" å› ä¸ºéœ€è¦mediainfoæ”¯æŒhttpåè®®ï¼Œåœ¨è€çš„ç‰ˆæœ¬ä¸­æ˜¯ä¸æ”¯æŒçš„ï¼Œæ‰€ä»¥åªèƒ½è‡ªå·±åŠ¨æ‰‹ç¼–è¯‘äº†ã€‚\nè¯´æ˜ # ç³»ç»Ÿï¼šubuntu 14.04 (å…¶ä»–ç‰ˆæœ¬å¯èƒ½ä¼šæœ‰å°‘è®¸æ”¹åŠ¨)\nmediainfoç‰ˆæœ¬ï¼š0.7.71\nç¼–è¯‘ç¯å¢ƒï¼šc/c++\nè„šæœ¬ # #!/bin/bash cd ~/ apt-get install git automake autoconf libtool pkg-config make g++ zlib1g-dev libcurl4-gnutls-dev git clone https://github.com/MediaArea/ZenLib.git cd ZenLib make clean git checkout v0.4.37 cd Project/GNU/Library ./autogen.sh ./configure --enable-static make -j2 cd ~/ git clone https://github.com/openssl/openssl.git cd openssl make clean git checkout OpenSSL_1_0_2i ./Configure linux-generic64 make -j2 curl_vserion=7.50.0 cd ~/ wget --no-check-certificate https://curl.haxx.se/download/curl-$curl_vserion.tar.gz tar -zxvf curl-$curl_vserion.tar.gz cd curl-$curl_vserion/ make clean ./configure --enable-static --disable-share --disable-ldap --disable-ldaps --without-librtmp --without-libidn make -j2 cd ~/ git clone https://github.com/MediaArea/MediaInfoLib.git cd MediaInfoLib git checkout v0.7.71 cd Project/GNU/Library/ make clean ./autogen ./configure --enable-static --with-libcurl=../../../../curl-$curl_vserion/ make -j2 cd ~/ git clone https://github.com/MediaArea/MediaInfo.git cd MediaInfo git checkout v0.7.71 cd Project/GNU/CLI make clean ./autogen ./configure --enable-staticlibs make -j2 # make install g++ -static -O2 -DUNICODE -DUNICODE -DSIZE_T_IS_LONG -o mediainfo CLI_Main.o CommandLine_Parser.o Help.o Core.o ../../../../MediaInfoLib/Project/GNU/Library/.libs/libmediainfo.a -lz ../../../../ZenLib/Project/GNU/Library/.libs/libzen.a ../../../../curl-$curl_vserion/lib/.libs/libcurl.a ../../../../openssl/libssl.a ../../../../openssl/libcrypto.a -lpthread -lstdc++ -pthread -Wl,-rpath -Wl,../../../../ZenLib/Project/GNU/Library/.libs -Wl,-rpath -Wl,../../../../curl-$curl_vserion/lib/.libs -Wl,-rpath -Wl,../../../../openssl -ldl "},{"id":42,"href":"/blog/linux/RRaHkWbSu/","title":"sshå…ç§˜é’¥ç™»é™†å¸¸è§é—®é¢˜","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" æ”¶é›†ä¸€äº›sshç™»é™†å¸¸è§çš„é—®é¢˜ï¼Œæ–¹ä¾¿å¿«é€Ÿè§£å†³é—®é¢˜ã€‚\né‡è¦äº‹æƒ… # cat /var/log/secure cat /var/log/message æ— è®ºä½ é‡åˆ°ä»»ä½•å¥‡è‘©çš„sshdé—®é¢˜ï¼Œä½ å…ˆæ‰§è¡Œä¸Šé¢çš„å‘½ä»¤æŸ¥çœ‹ä¸‹æ—¥å¿—ã€‚\né”™è¯¯ä¸€ # é—®é¢˜æè¿° # Authentication refused:bad ownership or modes for dircetory /root è§£å†³æ–¹æ³• # chmod 700 /root å…¶ä»–ç›¸å…³ # id_ras æƒé™ä¸º600\n/root/.ssh æƒé™ä¸º600\n"},{"id":43,"href":"/blog/linux/JQIo7dGc1/","title":"openssl - https SANè‡ªç­¾åè¯ä¹¦","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" ä½¿ç”¨opensslç”Ÿäº§è‡ªç­¾åè¯ä¹¦ï¼Œç”¨äºhttpsæµ‹è¯•ã€‚\nCAæ ¹è¯ä¹¦åˆ¶ä½œ # #1.ç”Ÿæˆæ ¹è¯ä¹¦å¯†é’¥ $ openssl genrsa -out ca.key 4096 #å»ºè®®é•¿åº¦ä¸º4096,1024é•¿åº¦å·²ç»è¢«åˆ—ä¸ºä¸å®‰å…¨ã€‚ #2.ç”Ÿæˆè‡ªç­¾åæ ¹è¯ä¹¦ $ openssl req -new -x509 -days 3650 -key ca.key -out ca.crt #è¿™é‡Œåœ¨è¾“å…¥CommonNameçš„æ—¶å€™è¾“å…¥åç§°è€Œä¸æ˜¯åŸŸåæˆ–è€…ip,å°±æ˜¯è¯ä¹¦ä¸Šæ˜¾ç¤ºçš„é¢å‘è€…ï¼Œè™½ç„¶æ˜¯è‡ªç­¾åè¯ä¹¦ï¼Œä½†æ˜¯å°½é‡è®©è¯ä¹¦çœ‹èµ·æ¥æ ‡å‡†ä¸€äº› ä½¿ç”¨æ ¹è¯ä¹¦æ¥ç­¾åå…¶å®ƒè¯ä¹¦ # 1.ç”Ÿæˆè¯ä¹¦å¯†é’¥ # $ openssl genrsa -out server.key 4096 2. Subject Alt Name(SAN) # é«˜ç‰ˆæœ¬çš„Chromeæµè§ˆå™¨ä¼šè¦æ±‚è®¾ç½® subjectAltName,å¦‚æœæ²¡æœ‰è®¾ç½®SANä¼šæŠ¥è¯ä¹¦é”™è¯¯\nå‚è€ƒopensslé…ç½®æ–‡ä»¶,LinuxæœåŠ¡å™¨ä¸Šé€šå¸¸åœ¨ /etc/pki/tls/openssl.cnf\næ–°å»ºæ–‡ä»¶ san.conf\n[req] default_bits = 4096 distinguished_name = req_distinguished_name req_extensions = v3_req [req_distinguished_name] countryName = country stateOrProvinceName = province localityName = city organizationName = company name commonName = domain name or ip [v3_req] subjectAltName = @alt_names [alt_names] NDS.1=domain #å¯ä»¥ä½¿ç”¨é€šé…ç¬¦ IP.1=xxx.xxx.xxx.xxx 3. ç”Ÿæˆè¯ä¹¦ç­¾åè¯·æ±‚(CSR) # å‘æ ¹è¯ä¹¦è¯·æ±‚ç­¾åä¸€ä¸ªæ–°çš„è¯ä¹¦ï¼Œç”±äºç”¨æˆ·ä¿¡ä»»äº†ä½ çš„æ ¹è¯ä¹¦ï¼Œæ‰€ä»¥æ ¹è¯ä¹¦ç­¾åçš„å…¶å®ƒè¯ä¹¦ä¹Ÿä¼šè¢«ä¿¡ä»»\n# ç”Ÿæˆcsr æ³¨æ„è¦ä½¿ç”¨sha256ç®—æ³•ï¼ˆæ¨èæ˜¯sha256ç®—æ³•ï¼Œé»˜è®¤ç®—æ³•æµè§ˆå™¨ä¼šæŠ¥å¼±åŠ å¯†ç®—æ³•é”™è¯¯ï¼‰ $ openssl req -new -key server.key -out server.csr -config san.conf -sha256 # æŸ¥çœ‹csrä¿¡æ¯ $ openssl req -text -in server.csr csrä¿¡æ¯ä¸­ä¼šæœ‰ç±»ä¼¼çš„ä¿¡æ¯\nRequested Extensions: X509v3 Subject Alternative Name: IP Address:xxxxxx 4.ä½¿ç”¨æ ¹è¯ä¹¦æŒ‰ç…§csrç»™è¯ä¹¦ç­¾åï¼Œç”Ÿæˆæ–°è¯ä¹¦server.crt # $ openssl x509 -req -days 365 -in server.csr -CA ca.crt -CAkey ca.key -set_serial 01 -out server.crt -extfile san.conf -extensions v3_req æŸ¥çœ‹è¯ä¹¦ä¿¡æ¯\n$ openssl x509 -text -in server.crt è¯ä¹¦ä¿¡æ¯ä¸­ä¼šæœ‰ç±»ä¼¼ä¿¡æ¯\nX509v3 extensions: X509v3 Subject Alternative Name: IP Address:xxxxxx "},{"id":44,"href":"/blog/linux/yhK4y-gaU/","title":"Centos7-yumå®‰è£…MySQL5.6","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" centosè‡ªå¸¦çš„repoæ˜¯ä¸ä¼šè‡ªåŠ¨æ›´æ–°æ¯ä¸ªè½¯ä»¶çš„æ–°ç‰ˆæœ¬ï¼Œæ‰€ä»¥æ— æ³•é€šè¿‡yumæ–¹å¼å®‰è£…MySQLçš„é«˜ç‰ˆæœ¬ï¼Œæ‰€ä»¥ä¸€èˆ¬é€šè¿‡ç¤¾åŒºrpmåŒ…å®‰è£…ã€‚\nå®‰è£…yumæº # rpm -Uvh http://dev.mysql.com/get/mysql-community-release-el7-5.noarch.rpm æŸ¥çœ‹mysqlå®‰è£…æº # yum repolist enabled | grep \u0026#34;mysql.*-community.*\u0026#34; å®‰è£…mysql56 # yum -y install mysql-community-server å¼€æœºå¯åŠ¨ # systemctl enable mysqld å¯åŠ¨æœåŠ¡ # systemctl start mysqld é‡ç½®å¯†ç  # mysql_secure_installation NOTE: RUNNING ALL PARTS OF THIS SCRIPT IS RECOMMENDED FOR ALL MySQL SERVERS IN PRODUCTION USE! PLEASE READ EACH STEP CAREFULLY! In order to log into MySQL to secure it, we\u0026#39;ll need the current password for the root user. If you\u0026#39;ve just installed MySQL, and you haven\u0026#39;t set the root password yet, the password will be blank, so you should just press enter here. Enter current password for root (enter for none): ERROR 1045 (28000): Access denied for user \u0026#39;root\u0026#39;@\u0026#39;localhost\u0026#39; (using password: YES) Enter current password for root (enter for none): ERROR 1045 (28000): Access denied for user \u0026#39;root\u0026#39;@\u0026#39;localhost\u0026#39; (using password: YES) Enter current password for root (enter for none): OK, successfully used password, moving on... Setting the root password ensures that nobody can log into the MySQL root user without the proper authorisation. Set root password? [Y/n] y New password: Re-enter new password: Password updated successfully! Reloading privilege tables.. ... Success! By default, a MySQL installation has an anonymous user, allowing anyone to log into MySQL without having to have a user account created for them. This is intended only for testing, and to make the installation go a bit smoother. You should remove them before moving into a production environment. Remove anonymous users? [Y/n] Y ... Success! Normally, root should only be allowed to connect from \u0026#39;localhost\u0026#39;. This ensures that someone cannot guess at the root password from the network. Disallow root login remotely? [Y/n] n ... skipping. By default, MySQL comes with a database named \u0026#39;test\u0026#39; that anyone can access. This is also intended only for testing, and should be removed before moving into a production environment. Remove test database and access to it? [Y/n] n ... skipping. Reloading the privilege tables will ensure that all changes made so far will take effect immediately. Reload privilege tables now? [Y/n] Y ... Success! All done! If you\u0026#39;ve completed all of the above steps, your MySQL installation should now be secure. Thanks for using MySQL! Cleaning up... "},{"id":45,"href":"/blog/linux/B1G3FwCaN/","title":"supervisor å®‰è£…å’Œä½¿ç”¨æ–¹æ³•","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" Supervisoræ˜¯ç”¨Pythonå¼€å‘çš„ä¸€å¥—é€šç”¨çš„è¿›ç¨‹ç®¡ç†ç¨‹åºï¼Œèƒ½å°†ä¸€ä¸ªæ™®é€šçš„å‘½ä»¤è¡Œè¿›ç¨‹å˜ä¸ºåå°daemonï¼Œå¹¶ç›‘æ§è¿›ç¨‹çŠ¶æ€ï¼Œå¼‚å¸¸é€€å‡ºæ—¶èƒ½è‡ªåŠ¨é‡å¯ã€‚\nå‡†å¤‡å·¥ä½œ # yum install epel-* -y yum install python34 -y wget --no-check-certificate python3 get-pip.py å®‰è£…supervisor # pip3 install supervisor é…ç½®supervisor # echo_supervisord_conf \u0026gt;/etc/supervisord.conf vi /etc/supervisord.conf ...... ;[include] ;è¿™ä¸ªä¸œè¥¿æŒºæœ‰ç”¨çš„ï¼Œå½“æˆ‘ä»¬è¦ç®¡ç†çš„è¿›ç¨‹å¾ˆå¤šçš„æ—¶å€™ï¼Œå†™åœ¨ä¸€ä¸ªæ–‡ä»¶é‡Œé¢å°±æœ‰ç‚¹å¤§äº†ã€‚æˆ‘ä»¬å¯ä»¥æŠŠé…ç½®ä¿¡æ¯å†™åˆ°å¤šä¸ªæ–‡ä»¶ä¸­ï¼Œç„¶åincludeè¿‡æ¥ ;files = relative/directory/*.ini å»æ‰ä¸Šé¢ä¸¤è¡Œçš„â€;â€œç„¶åå°†filesæ”¹æˆè‡ªå·±çš„ç›®å½•\nvi /etc/supervisord.conf [unix_http_server] file=/tmp/supervisor.sock ;UNIX socket æ–‡ä»¶ï¼Œsupervisorctl ä¼šä½¿ç”¨ ;chmod=0700 ;socketæ–‡ä»¶çš„modeï¼Œé»˜è®¤æ˜¯0700;chown=nobody:nogroup ;socketæ–‡ä»¶çš„ownerï¼Œæ ¼å¼ï¼šuid:gid ;[inet_http_server] ;HTTPæœåŠ¡å™¨ï¼Œæä¾›webç®¡ç†ç•Œé¢ ;port=127.0.0.1:9001 ;Webç®¡ç†åå°è¿è¡Œçš„IPå’Œç«¯å£ï¼Œå¦‚æœå¼€æ”¾åˆ°å…¬ç½‘ï¼Œéœ€è¦æ³¨æ„å®‰å…¨æ€§ ;username=user ;ç™»å½•ç®¡ç†åå°çš„ç”¨æˆ·å ;password=123 ;ç™»å½•ç®¡ç†åå°çš„å¯†ç  [supervisord] logfile=/tmp/supervisord.log ;æ—¥å¿—æ–‡ä»¶ï¼Œé»˜è®¤æ˜¯ $CWD/supervisord.loglogfile_maxbytes=50MB ;æ—¥å¿—æ–‡ä»¶å¤§å°ï¼Œè¶…å‡ºä¼šrotateï¼Œé»˜è®¤ 50MBï¼Œå¦‚æœè®¾æˆ0ï¼Œè¡¨ç¤ºä¸é™åˆ¶å¤§å° logfile_backups=10 ;æ—¥å¿—æ–‡ä»¶ä¿ç•™å¤‡ä»½æ•°é‡é»˜è®¤10ï¼Œè®¾ä¸º0è¡¨ç¤ºä¸å¤‡ä»½ loglevel=info ;æ—¥å¿—çº§åˆ«ï¼Œé»˜è®¤infoï¼Œå…¶å®ƒ: debug,warn,trace pidfile=/tmp/supervisord.pid ;pid æ–‡ä»¶ nodaemon=false ;æ˜¯å¦åœ¨å‰å°å¯åŠ¨ï¼Œé»˜è®¤æ˜¯falseï¼Œå³ä»¥ daemon çš„æ–¹å¼å¯åŠ¨ minfds=1024 ;å¯ä»¥æ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦çš„æœ€å°å€¼ï¼Œé»˜è®¤ 1024minprocs=200 ;å¯ä»¥æ‰“å¼€çš„è¿›ç¨‹æ•°çš„æœ€å°å€¼ï¼Œé»˜è®¤ 200 [supervisorctl] serverurl=unix:///tmp/supervisor.sock ;é€šè¿‡UNIX socketè¿æ¥supervisordï¼Œè·¯å¾„ä¸unix_http_serveréƒ¨åˆ†çš„fileä¸€è‡´;serverurl=http://127.0.0.1:9001 ; é€šè¿‡HTTPçš„æ–¹å¼è¿æ¥supervisord ; [program:xx]æ˜¯è¢«ç®¡ç†çš„è¿›ç¨‹é…ç½®å‚æ•°ï¼Œxxæ˜¯è¿›ç¨‹çš„åç§° [program:xx] command=/opt/apache-tomcat-8.0.35/bin/catalina.sh run ; ç¨‹åºå¯åŠ¨å‘½ä»¤ autostart=true ; åœ¨supervisordå¯åŠ¨çš„æ—¶å€™ä¹Ÿè‡ªåŠ¨å¯åŠ¨ startsecs=10 ; å¯åŠ¨10ç§’åæ²¡æœ‰å¼‚å¸¸é€€å‡ºï¼Œå°±è¡¨ç¤ºè¿›ç¨‹æ­£å¸¸å¯åŠ¨äº†ï¼Œé»˜è®¤ä¸º1ç§’ autorestart=true ; ç¨‹åºé€€å‡ºåè‡ªåŠ¨é‡å¯,å¯é€‰å€¼ï¼š[unexpected,true,false]ï¼Œé»˜è®¤ä¸ºunexpectedï¼Œè¡¨ç¤ºè¿›ç¨‹æ„å¤–æ€æ­»åæ‰é‡å¯ startretries=3 ; å¯åŠ¨å¤±è´¥è‡ªåŠ¨é‡è¯•æ¬¡æ•°ï¼Œé»˜è®¤æ˜¯3user=tomcat ; ç”¨å“ªä¸ªç”¨æˆ·å¯åŠ¨è¿›ç¨‹ï¼Œé»˜è®¤æ˜¯root priority=999 ; è¿›ç¨‹å¯åŠ¨ä¼˜å…ˆçº§ï¼Œé»˜è®¤999ï¼Œå€¼å°çš„ä¼˜å…ˆå¯åŠ¨ redirect_stderr=true ; æŠŠstderré‡å®šå‘åˆ°stdoutï¼Œé»˜è®¤falsestdout_logfile_maxbytes=20MB ; stdout æ—¥å¿—æ–‡ä»¶å¤§å°ï¼Œé»˜è®¤50MB stdout_logfile_backups = 20 ; stdout æ—¥å¿—æ–‡ä»¶å¤‡ä»½æ•°ï¼Œé»˜è®¤æ˜¯10; stdout æ—¥å¿—æ–‡ä»¶ï¼Œéœ€è¦æ³¨æ„å½“æŒ‡å®šç›®å½•ä¸å­˜åœ¨æ—¶æ— æ³•æ­£å¸¸å¯åŠ¨ï¼Œæ‰€ä»¥éœ€è¦æ‰‹åŠ¨åˆ›å»ºç›®å½•ï¼ˆsupervisord ä¼šè‡ªåŠ¨åˆ›å»ºæ—¥å¿—æ–‡ä»¶ï¼‰ stdout_logfile=/opt/apache-tomcat-8.0.35/logs/catalina.out stopasgroup=false ;é»˜è®¤ä¸ºfalse,è¿›ç¨‹è¢«æ€æ­»æ—¶ï¼Œæ˜¯å¦å‘è¿™ä¸ªè¿›ç¨‹ç»„å‘é€stopä¿¡å·ï¼ŒåŒ…æ‹¬å­è¿›ç¨‹ killasgroup=false ;é»˜è®¤ä¸ºfalseï¼Œå‘è¿›ç¨‹ç»„å‘é€killä¿¡å·ï¼ŒåŒ…æ‹¬å­è¿›ç¨‹ ;åŒ…å«å…¶å®ƒé…ç½®æ–‡ä»¶ [include] files = /etc/supervisord.d/*.ini ;å¯ä»¥æŒ‡å®šä¸€ä¸ªæˆ–å¤šä¸ªä»¥.iniç»“æŸçš„é…ç½®æ–‡ä»¶ mkdir /etc/supervisord.d/ å¯åŠ¨supervisor # supervisord -c /etc/supervisord.conf å¸¸ç”¨å‘½ä»¤ # æŸ¥çœ‹çŠ¶æ€ # supervisorctl status å¯åŠ¨æœåŠ¡ # supervisorctl start æœåŠ¡å åœæ­¢æœåŠ¡ # supervisorctl stop æœåŠ¡å é‡å¯æœåŠ¡ # supervisorctl restart æœåŠ¡å å¢åŠ æœåŠ¡ # vim /etc/supervisord.d/test.ini [program:test] #ç¨‹åºçš„åå­—ï¼Œåœ¨supervisorä¸­å¯ä»¥ç”¨è¿™ä¸ªåå­—æ¥ç®¡ç†è¯¥ç¨‹åºã€‚ user=root #æŒ‡å®šè¿è¡Œç”¨æˆ· command=bash /root/1.sh #å¯åŠ¨ç¨‹åºçš„å‘½ä»¤ autorstart=true #è®¾ç½®æ”¹ç¨‹åºæ˜¯å¦è™½supervisorçš„å¯åŠ¨è€Œå¯åŠ¨ directory=/home/lege #ç›¸å½“äºåœ¨è¯¥ç›®å½•ä¸‹æ‰§è¡Œç¨‹åº autorestart=true #ç¨‹åºåœæ­¢ä¹‹åæ˜¯å¦éœ€è¦é‡æ–°å°†å…¶å¯åŠ¨ startsecs=5 #é‡æ–°å¯åŠ¨æ—¶ï¼Œç­‰å¾…çš„æ—¶é—´ startretries=100 #é‡å¯ç¨‹åºçš„æ¬¡æ•° redirect_stderr=true #æ˜¯å¦å°†ç¨‹åºé”™è¯¯ä¿¡æ¯é‡å®šå‘çš„åˆ°æ–‡ä»¶ stdout_logfile=/var/log/log.txt #å°†ç¨‹åºè¾“å‡ºé‡å®šå‘åˆ°è¯¥æ–‡ä»¶ stderr_logfile=/var/log/err.txt #å°†ç¨‹åºé”™è¯¯ä¿¡æ¯é‡å®šå‘åˆ°è¯¥æ–‡ä»¶ supervisorctl update "},{"id":46,"href":"/blog/linux/HkCTnskvV/","title":"error while loading shared libraries: libc.so.6: cannot open shared object file: No such file or directory","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" ä¸å°å¿ƒè¯¯åˆ libc.so.6\nå®‰è£…å®Œæˆå, å»ºç«‹è½¯é“¾æŒ‡å‘glibc-2.14, æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤:\n$ rm -rf /lib64/libc.so.6 // å…ˆåˆ é™¤å…ˆå‰çš„libc.so.6è½¯é“¾\n$ ln -s /opt/glibc-2.14/lib/libc-2.14.so /lib64/libc.so.6 æ³¨æ„ï¼šåˆ é™¤libc.so.6ä¹‹åå¯èƒ½å¯¼è‡´ç³»ç»Ÿå‘½ä»¤ä¸å¯ç”¨çš„æƒ…å†µ, å¯ä½¿ç”¨å¦‚ä¸‹æ–¹æ³•è§£å†³:\n$ LD_PRELOAD=/opt/glibc-2.14/lib/libc-2.14.so ln -s /opt/glibc-2.14/lib/libc-2.14.so /lib64/libc.so.6 å¦‚æœä¸Šè¿°æ›´æ–°å¤±è´¥å¯ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤è¿˜åŸ:\n$ LD_PRELOAD=/lib64/libc-2.12.so ln -s /lib64/libc-2.12.so /lib64/libc.so.6 // libc-2.12.so æ­¤é¡¹æ˜¯ç³»ç»Ÿå‡çº§å‰çš„ç‰ˆæœ¬ "},{"id":47,"href":"/blog/linux/rk-lmMGL4/","title":"yumé”™è¯¯:problem making ssl connection Trying other mirror","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" yumæ— æ³•ä½¿ç”¨å¸¦httpsçš„æº\nç¯å¢ƒ # yum install epel-release è¿è¡Œä»¥ä¸Šå‘½ä»¤ä¹‹åï¼Œå®‰è£…å…¶ä»–è½¯ä»¶å°±æŠ¥é”™ã€‚\né”™è¯¯æç¤º # [Errno 14] problem making ssl connection Trying other mirror. Trying other mirror Error: Cannot retrieve repository metadata (repomd.xml) for repository: xxxx. Please verify its path and try again ç»è¿‡googleæŸ¥è¯¢ï¼Œå‘ç°ä¼¼ä¹æ˜¯sslè¯ä¹¦çš„åŸå› ã€‚\nè§£å†³æ–¹æ³•1 # # cd /etc/yum.repos.d/ # ls CentOS6-Base-163.repo epel.repoï¼ˆä¿®æ”¹ä»–ï¼‰ epel-testing.repo # pwd /etc/yum.repos.d # vim /etc/yum.repos.d/epel.repo [epel] name=Extra Packages for Enterprise Linux 6 - $basearch baseurl=http://download.fedoraproject.org/pub/epel/6/$basearch #mirrorlist=https://mirrors.fedoraproject.org/metalink?repo=epel-6\u0026amp;arch=$basearch failovermethod=priority enabled=1 gpgcheck=1 gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-6 æŠŠbaseurlæ³¨é‡Šå»æ‰ï¼Œç»™mirrorliståŠ ä¸Šæ³¨é‡Šã€‚ç„¶åå°†enabeld=1å˜ä¸º0ï¼Œç¦ç”¨sslè¯ä¹¦éªŒè¯ã€‚\nè§£å†³æ–¹æ³•2 # yum install ca-certificates yum update curl å°†enableè®¾ç½®ä¸º1å³å¯\n"},{"id":48,"href":"/blog/linux/H10_K-VQ4/","title":"CentOS7 php5.6 ç¼–è¯‘å®‰è£…amqpæ‰©å±•","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" php å®‰è£…æœ€æ–°rabbitmqæ‰©å±•\n1ã€å®‰è£…ç¼–è¯‘ç¯å¢ƒ # yum install cmake gcc gcc-c++ make openssl-devel 2ã€å®‰è£…rabbitmq-c # wget https://github.com/alanxz/rabbitmq-c/archive/v0.9.0.zip unzip v0.9.0.zip cd rabbitmq-c-0.9.0/ cmake -DCMAKE_INSTALL_PREFIX=/usr/local/rabbitmq-c-0.9.0/ make \u0026amp;\u0026amp; make install 3ã€å®‰è£…amqp # wget http://pecl.php.net/get/amqp-1.9.4.tgz tar zxf amqp-1.9.4.tgz cd amqp-1.9.4 /usr/bin/phpize ./configure --with-php-config=/usr/bin/php-config --with-amqp --with-librabbitmq-dir=/usr/local/rabbitmq-c-0.9.0 #ç”±äºrabbitmq-cç¼–è¯‘å‡ºæ¥çš„libç›®å½•æ˜¯lib64ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦åšä¸€äº›å°çš„ä¿®æ”¹ vim Makefile #å°† AMQP_SHARED_LIBADD = -Wl,-rpath,/usr/local/rabbitmq-c-0.9.0/lib -L/usr/local/rabbitmq-c-0.9.0/lib -lrabbitmq #ä¿®æ”¹ä¸º AMQP_SHARED_LIBADD = -Wl,-rpath,/usr/local/rabbitmq-c-0.9.0/lib64 -L/usr/local/rabbitmq-c-0.9.0/lib64 -lrabbitmq make \u0026amp;\u0026amp; make install 4ã€php.ini æ·»åŠ æ¨¡å— # vi /usr/local/php/etc/php.ini #å¢åŠ  extension = /usr/lib64/php/modules/amqp.so 5ã€é‡å¯æœåŠ¡ # systemctl restart php-fpm "},{"id":49,"href":"/blog/linux/S1wDPAKf4/","title":"hadoopä¸‹è½½æ–‡ä»¶é‡åˆ°çš„å‘","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" hadoop fs -get ä¸‹è½½å¸¦ç‰¹æ®Šå­—ç¬¦æ–‡ä»¶å¤±è´¥çš„ä¸€äº›è§£å†³æ–¹æ³•ã€‚\né”™è¯¯èŒƒä¾‹ # hadoop fs -get \u0026#34;/xxx/xxxåˆ†ç±»/åŠ¨æ¼«Y/2005/è“çŒ«æ·˜æ°”3000é—® èˆªå¤©ç³»åˆ—ï¼ˆå¤ªç©ºå†é™©è®°ï¼‰/ç¬¬363é›† åè®®.ts\u0026#34; \u0026#34;/media/bak/åª’èµ„æºç´ æåˆ†ç±»/åŠ¨æ¼«Y/2005/è“çŒ«æ·˜æ°”3000é—® èˆªå¤©ç³»åˆ—ï¼ˆå¤ªç©ºå†é™©è®°ï¼‰/ç¬¬363é›† åè®®.ts\u0026#34; è¿è¡Œä»¥ä¸Šå‘½ä»¤å°±æŠ¥â€œunexpexted URISyntaxExceptionâ€\nè§£å†³æ–¹æ³• # hadoop fs -get \u0026#34;/xxx/xxxåˆ†ç±»/åŠ¨æ¼«Y/2005/è“çŒ«æ·˜æ°”3000é—® èˆªå¤©ç³»åˆ—ï¼ˆå¤ªç©ºå†é™©è®°ï¼‰/ç¬¬363é›† åè®®.ts\u0026#34; \u0026#34;%2Fmedia%2Fbak%2F%E5%AA%92%E8%B5%84%E6%BA%90%E7%B4%A0%E6%9D%90%E5%88%86%E7%B1%BB%2F%E5%8A%A8%E6%BC%ABY%2F2005%2F%E8%93%9D%E7%8C%AB%E6%B7%98%E6%B0%943000%E9%97%AE%20%E8%88%AA%E5%A4%A9%E7%B3%BB%E5%88%97%EF%BC%88%E5%A4%AA%E7%A9%BA%E5%8E%86%E9%99%A9%E8%AE%B0%EF%BC%89%2F%E7%AC%AC363%E9%9B%86%20%E5%8D%8F%E8%AE%AE.ts\u0026#34; å°†å†™åˆ°æœ¬åœ°çš„è·¯å¾„è¿›è¡Œurlç¼–ç ï¼Œç„¶åç¥å¥‡çš„å°±ä¸‹è½½æˆåŠŸäº†ï¼Œç„¶åè·¯å¾„ä¹Ÿæ˜¯æ²¡æœ‰ç¼–ç çš„ç»å¯¹è·¯å¾„ã€‚\n"},{"id":50,"href":"/blog/linux/B1rSV2FzE/","title":"linux-iftopå®æ—¶æµé‡ç›‘æ§","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" iftopæ˜¯ç±»ä¼¼äºtopçš„å®æ—¶æµé‡ç›‘æ§å·¥å…·ã€‚å¯ä»¥ç”¨æ¥ç›‘æ§ç½‘å¡çš„å®æ—¶æµé‡ï¼ˆå¯ä»¥æŒ‡å®šç½‘æ®µï¼‰ã€åå‘è§£æIPã€æ˜¾ç¤ºç«¯å£ä¿¡æ¯ç­‰ã€‚\nå®‰è£… # Debian/Ubuntu/Deepinï¼š\nsudo apt update sudo apt -y install iftop CentOS/RHELï¼š\nyum -y install epel-release yum -y install iftop iftopç›¸å…³å‚æ•° # å¸¸ç”¨çš„å‚æ•°\n-i è®¾å®šç›‘æµ‹çš„ç½‘å¡ï¼Œå¦‚ï¼š# iftop -i eth0\n-B ä»¥bytesä¸ºå•ä½æ˜¾ç¤ºæµé‡(é»˜è®¤æ˜¯bits)ï¼Œå¦‚ï¼š# iftop -B\n-n ä½¿ä¸»æœºåä¿¡æ¯é»˜è®¤ç›´æ¥éƒ½æ˜¾ç¤ºIPï¼Œå¦‚ï¼š# iftop -n\n-N ä½¿ç«¯å£ä¿¡æ¯é»˜è®¤ç›´æ¥éƒ½æ˜¾ç¤ºç«¯å£å·ï¼Œå¦‚: # iftop -N\n-F æ˜¾ç¤ºç‰¹å®šç½‘æ®µçš„è¿›å‡ºæµé‡ï¼Œå¦‚# iftop -F 192.168.1.0/24æˆ–# iftop -F 192.168.1.0/255.255.255.0\n-h å¸®åŠ©ï¼Œæ˜¾ç¤ºå‚æ•°ä¿¡æ¯\n-p ä½¿ç”¨è¿™ä¸ªå‚æ•°åï¼Œä¸­é—´çš„åˆ—è¡¨æ˜¾ç¤ºçš„æœ¬åœ°ä¸»æœºä¿¡æ¯ï¼Œå‡ºç°äº†æœ¬æœºä»¥å¤–çš„IPä¿¡æ¯;\n-b ä½¿æµé‡å›¾å½¢æ¡é»˜è®¤å°±æ˜¾ç¤º;\n-P ä½¿ä¸»æœºåä¿¡æ¯åŠç«¯å£ä¿¡æ¯ï¼Œé»˜è®¤å°±éƒ½æ˜¾ç¤ºï¼›\n-m è®¾ç½®ç•Œé¢æœ€ä¸Šè¾¹çš„åˆ»åº¦çš„æœ€å¤§å€¼ï¼Œåˆ»åº¦åˆ†äº”ä¸ªå¤§æ®µæ˜¾ç¤ºï¼Œä¾‹ï¼š# iftop -m 500M\niftopç•Œé¢ç›¸å…³è¯´æ˜ # ç•Œé¢ä¸Šé¢æ˜¾ç¤ºçš„æ˜¯ç±»ä¼¼åˆ»åº¦å°ºçš„åˆ»åº¦èŒƒå›´ï¼Œä¸ºæ˜¾ç¤ºæµé‡å›¾å½¢çš„é•¿æ¡ä½œæ ‡å°ºç”¨çš„ã€‚\nä¸­é—´çš„\u0026lt;= =\u0026gt;è¿™ä¸¤ä¸ªå·¦å³ç®­å¤´ï¼Œè¡¨ç¤ºçš„æ˜¯æµé‡çš„æ–¹å‘ï¼Œæœ€åä¸‰åˆ—è¡¨ç¤ºè¿‡å» 2s 10s 40s çš„å¹³å‡æµé‡ã€‚\nTXï¼šå‘é€æµé‡\nRXï¼šæ¥æ”¶æµé‡\nTOTALï¼šæ€»æµé‡\ncumï¼šè¿è¡Œiftopåˆ°ç›®å‰æ—¶é—´çš„æ€»æµé‡\npeakï¼šæµé‡å³°å€¼\nratesï¼šåˆ†åˆ«è¡¨ç¤ºè¿‡å» 2s 10s 40s çš„å¹³å‡æµé‡\nä½¿ç”¨ # è¿›å…¥iftopç”»é¢åçš„ä¸€äº›æ“ä½œå‘½ä»¤\nh åˆ‡æ¢æ˜¯å¦æ˜¾ç¤ºå¸®åŠ©;\nn åˆ‡æ¢æ˜¾ç¤ºæœ¬æœºçš„IPæˆ–ä¸»æœºå;\ns åˆ‡æ¢æ˜¯å¦æ˜¾ç¤ºæœ¬æœºçš„ä¸»æœºåä¿¡æ¯;\nd åˆ‡æ¢æ˜¯å¦æ˜¾ç¤ºè¿œç«¯ç›®æ ‡ä¸»æœºçš„ä¸»æœºåä¿¡æ¯;\nt åˆ‡æ¢æ˜¾ç¤ºæ ¼å¼ä¸º2è¡Œ/1è¡Œ/åªæ˜¾ç¤ºå‘é€æµé‡/åªæ˜¾ç¤ºæ¥æ”¶æµé‡;\nN åˆ‡æ¢æ˜¾ç¤ºç«¯å£å·æˆ–ç«¯å£æœåŠ¡åç§°;\nS åˆ‡æ¢æ˜¯å¦æ˜¾ç¤ºæœ¬æœºçš„ç«¯å£ä¿¡æ¯;\nD åˆ‡æ¢æ˜¯å¦æ˜¾ç¤ºè¿œç«¯ç›®æ ‡ä¸»æœºçš„ç«¯å£ä¿¡æ¯;\np åˆ‡æ¢æ˜¯å¦æ˜¾ç¤ºç«¯å£ä¿¡æ¯;\nP åˆ‡æ¢æš‚åœ/ç»§ç»­æ˜¾ç¤º;\nb åˆ‡æ¢æ˜¯å¦æ˜¾ç¤ºå¹³å‡æµé‡å›¾å½¢æ¡;\nB åˆ‡æ¢è®¡ç®—2ç§’æˆ–10ç§’æˆ–40ç§’å†…çš„å¹³å‡æµé‡;\nT åˆ‡æ¢æ˜¯å¦æ˜¾ç¤ºæ¯ä¸ªè¿æ¥çš„æ€»æµé‡;\nl æ‰“å¼€å±å¹•è¿‡æ»¤åŠŸèƒ½ï¼Œè¾“å…¥è¦è¿‡æ»¤çš„å­—ç¬¦ï¼Œæ¯”å¦‚ip,æŒ‰å›è½¦åï¼Œå±å¹•å°±åªæ˜¾ç¤ºè¿™ä¸ªIPç›¸å…³çš„æµé‡ä¿¡æ¯;\nL åˆ‡æ¢æ˜¾ç¤ºç”»é¢ä¸Šè¾¹çš„åˆ»åº¦;åˆ»åº¦ä¸åŒï¼Œæµé‡å›¾å½¢æ¡ä¼šæœ‰å˜åŒ–;\nj æˆ– k å¯ä»¥å‘ä¸Šæˆ–å‘ä¸‹æ»šåŠ¨å±å¹•æ˜¾ç¤ºçš„è¿æ¥è®°å½•;\n1 æˆ– 2 æˆ– 3 å¯ä»¥æ ¹æ®å³ä¾§æ˜¾ç¤ºçš„ä¸‰åˆ—æµé‡æ•°æ®è¿›è¡Œæ’åº;\n\u0026lt; æ ¹æ®å·¦è¾¹çš„æœ¬æœºåæˆ–IPæ’åº;\næ ¹æ®è¿œç«¯ç›®æ ‡ä¸»æœºçš„ä¸»æœºåæˆ–IPæ’åº;\no åˆ‡æ¢æ˜¯å¦å›ºå®šåªæ˜¾ç¤ºå½“å‰çš„è¿æ¥;\nq é€€å‡ºç›‘æ§ã€‚\n"},{"id":51,"href":"/blog/linux/H1xaQL3-N/","title":"Centos7+Python2.7ä¸‹yumå®‰è£…è½¯ä»¶æŠ¥é”™è§£å†³åŠæ³•","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" yumå®‰è£…è½¯ä»¶æŠ¥é”™ï¼Œä½†å¯ä»¥ä¸‹è½½æ–‡ä»¶ã€‚\né”™è¯¯ä¿¡æ¯ # Downloading packages: Running transaction check Running transaction test Transaction test succeeded Running transaction Traceback (most recent call last): File \u0026#34;/usr/bin/yum\u0026#34;, line 29, in \u0026lt;module\u0026gt; yummain.user_main(sys.argv[1:], exit_code=True) File \u0026#34;/usr/share/yum-cli/yummain.py\u0026#34;, line 365, in user_main errcode = main(args) File \u0026#34;/usr/share/yum-cli/yummain.py\u0026#34;, line 271, in main return_code = base.doTransaction() File \u0026#34;/usr/share/yum-cli/cli.py\u0026#34;, line 773, in doTransaction resultobject = self.runTransaction(cb=cb) File \u0026#34;/usr/lib/python2.7/site-packages/yum/__init__.py\u0026#34;, line 1736, in runTransaction if self.fssnap.available and ((self.conf.fssnap_automatic_pre or File \u0026#34;/usr/lib/python2.7/site-packages/yum/__init__.py\u0026#34;, line 1126, in \u0026lt;lambda\u0026gt; fssnap = property(fget=lambda self: self._getFSsnap(), File \u0026#34;/usr/lib/python2.7/site-packages/yum/__init__.py\u0026#34;, line 1062, in _getFSsnap devices=devices) File \u0026#34;/usr/lib/python2.7/site-packages/yum/fssnapshots.py\u0026#34;, line 158, in __init__ self._vgnames = _list_vg_names() if self.available else [] File \u0026#34;/usr/lib/python2.7/site-packages/yum/fssnapshots.py\u0026#34;, line 56, in _list_vg_names names = lvm.listVgNames() lvm.LibLVMError: (0, \u0026#39;\u0026#39;) è§£å†³æ–¹æ³• # mkdir /tmp/down/ yum install --downloadonly --downloaddir=/tmp/down/ yum cd /tmp/down/ rpm -Uvh * yum clean metadata yum clean all "},{"id":52,"href":"/blog/macos/HJvNDli-4/","title":"macos æ¢å¤launchpadé»˜è®¤å¸ƒå±€","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" åœ¨Mac OS ä¸­é‡ç½®Launchpadå¸ƒå±€\nLaunchpadå¯ä»¥ä½œä¸ºä»ç†Ÿæ‚‰çš„ç±»ä¼¼iOSçš„å›¾æ ‡ç½‘æ ¼ç•Œé¢åœ¨Macä¸Šæ‰“å¼€åº”ç”¨ç¨‹åºçš„å¿«æ·æ–¹å¼ã€‚å¦‚æœæ‚¨å·²ç»è‡ªå®šä¹‰äº†è¿™äº›åº”ç”¨ç¨‹åºå›¾æ ‡å¹¶åœ¨Launchpadä¸­è¿›è¡Œäº†æ’åˆ—ï¼Œé‚£ä¹ˆæ‚¨å¯èƒ½ä¼šå†³å®šä»å¤´å¼€å§‹å¹¶å°†å…¶é¡ºåºé‡ç½®ä¸ºé¦–æ¬¡è´­ä¹°Macæ—¶çš„æ˜¾ç¤ºæ–¹å¼ã€‚å¦‚æœè¦é‡æ–°æ’åˆ—Launchpadå›¾æ ‡çš„æ˜¾ç¤ºæ–¹å¼ï¼Œè¿™ä¹Ÿå¾ˆæœ‰ç”¨ï¼Œä½†ä½¿ç”¨Launchpadè§£å†³æŸäº›æ˜¾ç¤ºé”™è¯¯ä¹Ÿå¾ˆæœ‰å¸®åŠ©ï¼Œå°¤å…¶æ˜¯åœ¨å›¾æ ‡æœªæ˜¾ç¤ºæˆ–æ˜¾ç¤ºä¸æ­£ç¡®çš„æƒ…å†µä¸‹ã€‚\nåœ¨OS Xçš„æ—©æœŸç‰ˆæœ¬ä¸­ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡è½¬å‚¨ä¸€äº›æ•°æ®åº“æ–‡ä»¶æ¥åˆ·æ–°Launchpadå†…å®¹ï¼Œä½†åœ¨Mac OSå’ŒOS X\n10.10.xä»¥åï¼Œæ‚¨éœ€è¦ä½¿ç”¨é»˜è®¤å‘½ä»¤å­—ç¬¦ä¸²æ¥é‡ç½®Launchpadå†…å®¹å’Œå¸ƒå±€ä»£æ›¿ã€‚\nå¦‚ä½•åœ¨MacOSä¸­é‡ç½®Launchpadå¸ƒå±€\næ‰“å¼€ç»ˆç«¯åº”ç”¨ç¨‹åºå¹¶è¾“å…¥ä»¥ä¸‹é»˜è®¤å€¼å†™å…¥å‘½ä»¤å­—ç¬¦ä¸²ï¼š\ndefaults write com.apple.dock ResetLaunchPad -bool true; killall Dock ç‚¹å‡»è¿”å›å¹¶ç­‰å¾…Docké‡æ–°å¯åŠ¨å¹¶é‡å¯Launchpad\nå†æ¬¡æ‰“å¼€Launchpadæ—¶ï¼Œå¸ƒå±€å°†æ¢å¤ä¸ºé»˜è®¤çŠ¶æ€ï¼Œå°†æ‰€æœ‰æ†ç»‘çš„åº”ç”¨ç¨‹åºæ”¾åœ¨Launchpadçš„ç¬¬ä¸€ä¸ªå±å¹•ä¸Šï¼Œå°†ç¬¬ä¸‰æ–¹åº”ç”¨ç¨‹åºæ”¾åˆ°è¾…åŠ©ï¼ˆä»¥åŠç¬¬ä¸‰ä¸ªï¼Œå¦‚æœé€‚ç”¨ï¼‰å±å¹•ä¸Šã€‚\næ‚¨ç°åœ¨å¯ä»¥æ ¹æ®éœ€è¦é‡æ–°æ’åˆ—Launchpadçš„å›¾æ ‡å’Œå¸ƒå±€ï¼Œæˆ–è€…åªåœ¨ç¬¬ä¸€ä¸ªå±å¹•ä¸Šä¿ç•™Appleåº”ç”¨ç¨‹åºçš„é»˜è®¤å¸ƒå±€ï¼Œåœ¨åé¢çš„å±å¹•ä¸Šæ·»åŠ ç¬¬ä¸‰æ–¹åº”ç”¨ç¨‹åºå’Œæ·»åŠ å†…å®¹ã€‚\nè¿™ä¸ªé»˜è®¤çš„å‘½ä»¤å­—ç¬¦ä¸²æ˜¯åœ¨stackexchangeä¸Šæ‰¾åˆ°çš„ï¼Œè™½ç„¶æåˆ°å®ƒçš„ç”¨æˆ·ä»ç„¶åˆ—å‡ºæ—§çš„æ•°æ®åº“è½¬å‚¨æŠ€å·§ä½œä¸ºå¿…è¦çš„æ­¥éª¤ - åœ¨æµ‹è¯•ä¸­ï¼Œåé¢çš„\nLaunchpadæ•°æ®åº“åˆ é™¤å‘½ä»¤ä¸éœ€è¦ç®€å•åœ°é‡ç½®OS Xä¸­çš„Launchpadå¸ƒå±€Yosemite 10.10 .x +ã€‚\n"},{"id":53,"href":"/blog/linux/B11j0sF-N/","title":"è®°ä¸€æ¬¡æ—¶é—´åŒæ­¥å¼•èµ·çš„æ•…éšœ","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" ntpdateåŒæ­¥æ—¶é—´ï¼Œæ—¶é—´è·³è·ƒï¼Œå¼•èµ·æœåŠ¡ä¸­æ–­ã€‚\nè®¡åˆ’ä»»åŠ¡ # 0 4 * * * /usr/sbin/ntpdate 10.200.3.71 æ—¥å¿— # Dec 30 04:00:01 localhost systemd: Created slice user-0.slice. Dec 30 04:00:01 localhost systemd: Starting user-0.slice. Dec 30 04:00:01 localhost systemd: Started Session 16 of user root. Dec 30 04:00:01 localhost systemd: Starting Session 16 of user root. Dec 29 20:09:59 localhost systemd: Time has been changed Dec 29 20:09:59 localhost systemd: Removed slice user-0.slice. Dec 29 20:09:59 localhost systemd: Stopping user-0.slice. æ•…éšœ # å› ä¸ºè·³è·ƒçš„æ—¶é—´å¤ªå¤§ï¼Œå¯¼è‡´ç³»ç»Ÿçš„å„ç§æœåŠ¡ä¸­æ–­ï¼ˆç½‘ç»œä¸­æ–­å’Œsystemctlç®¡ç†çš„æœåŠ¡ä¹Ÿæœ‰é—®é¢˜ï¼‰ã€‚\nè§£æ # ntpdateåŒæ­¥æ—¶é—´ï¼Œä¼šé€ æˆæ—¶é—´çš„è·³è·ƒï¼Œå¯¹ä¸€äº›ä¾èµ–æ—¶é—´çš„ç¨‹åºå’ŒæœåŠ¡ä¼šé€ æˆå½±å“ã€‚æ¯”å¦‚sleepï¼Œtimerç­‰ã€‚è€Œä¸”ï¼ŒntpdæœåŠ¡å¯ä»¥åœ¨ä¿®æ­£æ—¶é—´çš„åŒæ—¶ï¼Œä¿®æ­£cpu\ntickã€‚ç†æƒ³çš„åšæ³•ä¸ºï¼Œåœ¨å¼€æœºçš„æ—¶å€™ï¼Œä½¿ç”¨ntpdateå¼ºåˆ¶åŒæ­¥æ—¶é—´ï¼Œåœ¨å…¶ä»–æ—¶å€™ä½¿ç”¨ntpdæœåŠ¡æ¥åŒæ­¥æ—¶é—´ã€‚\nè¦æ³¨æ„çš„æ˜¯ï¼Œntpdæœ‰ä¸€ä¸ªè‡ªæˆ‘ä¿æŠ¤è®¾ç½®: å¦‚æœæœ¬æœºä¸ä¸Šæºæ—¶é—´ç›¸å·®å¤ªå¤§, ntpdä¸è¿è¡Œ. æ‰€ä»¥æ–°è®¾ç½®çš„æ—¶é—´æœåŠ¡å™¨ä¸€å®šè¦å…ˆntpdateä»ä¸Šæºå–å¾—æ—¶é—´åˆå€¼,\nç„¶åå¯åŠ¨ntpdæœåŠ¡ã€‚ntpdæœåŠ¡è¿è¡Œå, å…ˆæ˜¯æ¯éš”æŒ‡å®šçš„æ—¶é—´ä¸ä¸ŠæºæœåŠ¡å™¨åŒæ­¥ä¸€æ¬¡, æ ¹æ®æ¯æ¬¡åŒæ­¥æ—¶æµ‹å¾—çš„è¯¯å·®å€¼ç»å¤æ‚è®¡ç®—é€æ­¥è°ƒæ•´è‡ªå·±çš„æ—¶é—´,\néšç€è¯¯å·®å‡å°, é€æ­¥å¢åŠ åŒæ­¥çš„é—´éš”. æ¯æ¬¡è·³åŠ¨, éƒ½ä¼šé‡å¤è¿™ä¸ªè°ƒæ•´çš„è¿‡ç¨‹.\n"},{"id":54,"href":"/blog/ffmpeg/BkjYYAI3X/","title":"ffmpegåŠ æ°´å°","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" FFmpegæ˜¯ä¸€å¥—å¯ä»¥ç”¨æ¥è®°å½•ã€è½¬æ¢æ•°å­—éŸ³é¢‘ã€è§†é¢‘ï¼Œå¹¶èƒ½å°†å…¶è½¬åŒ–ä¸ºæµçš„å¼€æºè®¡ç®—æœºç¨‹åºã€‚é‡‡ç”¨LGPLæˆ–GPLè®¸å¯è¯ã€‚å®ƒæä¾›äº†å½•åˆ¶ã€è½¬æ¢ä»¥åŠæµåŒ–éŸ³è§†é¢‘çš„å®Œæ•´è§£å†³æ–¹æ¡ˆã€‚å®ƒåŒ…å«äº†éå¸¸å…ˆè¿›çš„éŸ³é¢‘/è§†é¢‘ç¼–è§£ç åº“libavcodecï¼Œä¸ºäº†ä¿è¯é«˜å¯ç§»æ¤æ€§å’Œç¼–è§£ç è´¨é‡ï¼Œlibavcodecé‡Œå¾ˆå¤šcodeéƒ½æ˜¯ä»å¤´å¼€å‘çš„ã€‚\nmovieè¿‡æ»¤å™¨ # ffmpeg -i inputfile -vf \u0026#34;movie=masklogo,scale= 60: 30[watermask]; [in] [watermask] overlay=30:10 [out]\u0026#34; outfile å‚æ•°è¯´æ˜\nmarklogo:æ·»åŠ çš„æ°´å°å›¾ç‰‡ï¼›\nscaleï¼šæ°´å°å¤§å°ï¼Œæ°´å°é•¿åº¦ï¼Šæ°´å°çš„é«˜åº¦ï¼›\noverlayï¼šæ°´å°çš„ä½ç½®ï¼Œè·ç¦»å±å¹•å·¦ä¾§çš„è·ç¦»ï¼Šè·ç¦»å±å¹•ä¸Šä¾§çš„è·ç¦»ï¼›mainWä¸»è§†é¢‘å®½åº¦ï¼Œ\nmainHä¸»è§†é¢‘é«˜åº¦ï¼ŒoverlayWæ°´å°å®½åº¦ï¼ŒoverlayHæ°´å°é«˜åº¦\nå·¦ä¸Šè§’overlayå‚æ•°ä¸º overlay=0:0\nå³ä¸Šè§’ä¸º overlay= main_w-overlay_w:0\nå³ä¸‹è§’ä¸º overlay= main_w-overlay_w:main_h-overlay_h\nå·¦ä¸‹è§’ä¸º overlay=0: main_h-overlay_h\nä¸Šé¢çš„0å¯ä»¥æ”¹ä¸º5ï¼Œæˆ–10åƒç´ ï¼Œä»¥ä¾¿å¤šç•™å‡ºä¸€äº›ç©ºç™½ã€‚ åˆæµ # ffmpeg -i input -i logo -filter_complex \u0026#39;overlay=10:main_h-overlay_h-10\u0026#39; output input:è¾“å…¥æµ\nlogoï¼šæ°´å°æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªæµã€‚æ³¨æ„ï¼šéœ€è¦ç¼–è¯‘æ—¶æŠŠç›¸åº”çš„è§£ç å™¨ç¼–è¯‘ã€‚ä¾‹å¦‚PNGå›¾ç‰‡ã€‚éœ€è¦ç¼–è¯‘PNGè§£ç å™¨ã€‚Ffmpegæ‰èƒ½å¤Ÿè¯†åˆ«å›¾ç‰‡æ–‡ä»¶ï¼ŒæŠŠå›¾ç‰‡åšä¸ºä¸€\nç§æµã€‚æ³¨æ„ï¼šPNGå›¾ç‰‡å¿…é¡»å«æœ‰alphaé€šé“ã€‚Overlayè¿‡æ»¤å™¨æ˜¯æ ¹æ®alphaé€šé“æ¥è¿›è¡Œå¤ç›–çš„ã€‚æ‰€ä»¥ï¼Œä½ æƒ³è¦é€æ˜æ•ˆæœæ—¶ï¼Œé¡»å…ˆåˆ¶åšä¸€å¼ é€æ˜çš„PNGå›¾ç‰‡ã€‚\n"},{"id":55,"href":"/blog/linux/SJ10UoTom/","title":"solr7.3.1å•æœºç‰ˆæ·»åŠ core","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" Solræ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ä¼ä¸šçº§æœç´¢åº”ç”¨æœåŠ¡å™¨ï¼Œå®ƒå¯¹å¤–æä¾›ç±»ä¼¼äºWeb-serviceçš„APIæ¥å£ã€‚ç”¨æˆ·å¯ä»¥é€šè¿‡httpè¯·æ±‚ï¼Œå‘æœç´¢å¼•æ“æœåŠ¡å™¨æäº¤ä¸€å®šæ ¼å¼çš„XMLæ–‡ä»¶ï¼Œç”Ÿæˆç´¢å¼•ï¼›ä¹Ÿå¯ä»¥é€šè¿‡Http Getæ“ä½œæå‡ºæŸ¥æ‰¾è¯·æ±‚ï¼Œå¹¶å¾—åˆ°XMLæ ¼å¼çš„è¿”å›ç»“æœã€‚\nç¯å¢ƒ # SOLR_HOME=â€œ/DATA/solr/dataâ€\nsolrå®‰è£…ç›®å½• /opt/solr-7.3.1/\næ·»åŠ core # # cd /DATA/solr/data/ # cp -r /opt/solr-7.3.1/server/solr/configsets/_default/conf/ test # cd test # mkdir data # vim core.properties name=test # cd ../ # chown -R solr:solr test #ä¸€å®šè¦è®°å¾—ä¿®æ”¹å±ä¸»å’Œå±ç»„ï¼Œä¸ç„¶æ²¡æ³•åˆ›å»ºæ•°æ® é‡å¯æœåŠ¡ # # /etc/init.d/solr restart "},{"id":56,"href":"/blog/linux/BkKKGWnsQ/","title":"solr-7.3.1 å•æœºå®‰è£…æ•™ç¨‹","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" Solræ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ä¼ä¸šçº§æœç´¢åº”ç”¨æœåŠ¡å™¨ï¼Œå®ƒå¯¹å¤–æä¾›ç±»ä¼¼äºWeb-serviceçš„APIæ¥å£ã€‚ç”¨æˆ·å¯ä»¥é€šè¿‡httpè¯·æ±‚ï¼Œå‘æœç´¢å¼•æ“æœåŠ¡å™¨æäº¤ä¸€å®šæ ¼å¼çš„XMLæ–‡ä»¶ï¼Œç”Ÿæˆç´¢å¼•ï¼›ä¹Ÿå¯ä»¥é€šè¿‡Http Getæ“ä½œæå‡ºæŸ¥æ‰¾è¯·æ±‚ï¼Œå¹¶å¾—åˆ°XMLæ ¼å¼çš„è¿”å›ç»“æœã€‚\nç¯å¢ƒ # éœ€è¦ç”¨åˆ°çš„è½¯ä»¶æœ‰ï¼šJDKã€Solr\nå®‰è£…solr # solr-7.3.1/bin/install_solr_service.sh solr-7.3.1.zip JDKå’ŒZooKeeperä¹‹å‰ä¸‹è½½ç„¶åè§£å‹å³å¯ï¼Œæ³¨æ„ç›¸å¯¹è·¯å¾„å’Œç»å¯¹è·¯å¾„å°±å¯ä»¥äº†\né…ç½®JDK # cat \u0026lt;\u0026lt; EOF \u0026gt;\u0026gt; /etc/profile ## jdk ## JAVA_HOME=/usr/local/java/jdk CLASSPATH=$JAVA_HOME/lib/ PATH=$PATH:$JAVA_HOME/bin export PATH JAVA_HOME CLASSPATH EOF éƒ¨ç½²solr # unzip solr-7.3.1.zip å®‰è£…solr # # -d æŒ‡å®šæ•°æ®ç›®å½• -n å®‰è£…åä¸å¯åŠ¨æœåŠ¡ solr-7.3.1/bin/install_solr_service.sh solr-7.3.1.zip -n -d /data/solr/ å¯åŠ¨solr # /etc/init.d/solr start #service solr start OR systemctl start solr "},{"id":57,"href":"/blog/linux/HJJ4wWwim/","title":"è§£å†³rabbitmqä¾èµ–é—®é¢˜","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" MQå…¨ç§°ä¸ºMessage Queue, æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆMQï¼‰æ˜¯ä¸€ç§åº”ç”¨ç¨‹åºå¯¹åº”ç”¨ç¨‹åºçš„é€šä¿¡æ–¹æ³•ã€‚\né”™è¯¯æç¤º # warning: rabbitmq-server-3.6.6-1.el6.noarch.rpm: Header V4 RSA/SHA1 Signature, key ID 6026dfca: NOKEYerror: Failed dependencies: erlang \u0026gt;= R16B-03 is needed by rabbitmq-server-3.6.6-1.el6.noarch socat is needed by rabbitmq-server-3.6.6-1.el6.noarch è§£å†³æ–¹æ³• # cd /etc/yum.repos.d/ cat erlang.repo [erlang-solutions] name=Centos $releasever - $basearch - Erlang Solutions baseurl=http://packages.erlang-solutions.com/rpm/centos/$releasever/$basearch gpgcheck=0 gpgkey=http://packages.erlang-solutions.com/debian/erlang_solutions.asc enabled=1 ç„¶åå†å®‰è£…rabbitmq\nyum localinstall rabbitmq-server-3.6.6-1.el6.noarch.rpm å…¶ä»–é—®é¢˜ # # /etc/init.d/rabbitmq-server start Starting rabbitmq-server: FAILED - check /var/log/rabbitmq/startup_{log, _err} rabbitmq-server. # vim /var/log/rabbitmq/startup_err init terminating in do_boot (noproc) Crash dump is being written to: erl_crash.dump...done å¦‚æœå‡ºç°ä»¥ä¸Šé—®é¢˜ï¼Œè¯´æ˜erlangå’Œrabbitmqçš„ç‰ˆæœ¬ä¸ç›¸ç¬¦ã€‚åªèƒ½é‡æ–°å®‰è£…erlangäº†ã€‚\n"},{"id":58,"href":"/blog/linux/SJWuUJwsQ/","title":"grafanaé‡ç½®ç®¡ç†å‘˜å¯†ç ","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" Grafanaæ˜¯ä¸€ä¸ªå¯è§†åŒ–é¢æ¿ï¼ˆDashboardï¼‰ï¼Œæœ‰ç€éå¸¸æ¼‚äº®çš„å›¾è¡¨å’Œå¸ƒå±€å±•ç¤ºï¼ŒåŠŸèƒ½é½å…¨çš„åº¦é‡ä»ªè¡¨ç›˜å’Œå›¾å½¢ç¼–è¾‘å™¨ï¼Œæ”¯æŒGraphiteã€zabbixã€InfluxDBã€Prometheuså’ŒOpenTSDBä½œä¸ºæ•°æ®æºã€‚Grafanaä¸»è¦ç‰¹æ€§ï¼šçµæ´»ä¸°å¯Œçš„å›¾å½¢åŒ–é€‰é¡¹ï¼›å¯ä»¥æ··åˆå¤šç§é£æ ¼ï¼›æ”¯æŒç™½å¤©å’Œå¤œé—´æ¨¡å¼ï¼›å¤šä¸ªæ•°æ®æºã€‚\nè¦æ˜¾ç¤ºæ‰€æœ‰ç®¡ç†å‘˜å‘½ä»¤ï¼š grafana-cli admin\né‡ç½®å¯†ç  # ç¬¬ä¸€ç§æ–¹æ³• # æ‚¨å¯ä»¥ä½¿ç”¨CLIé‡ç½®adminç”¨æˆ·çš„å¯†ç ã€‚ä¸¢å¤±ç®¡ç†å‘˜å¯†ç æ—¶ï¼Œæ­¤å‘½ä»¤çš„ç”¨ä¾‹æ˜¯ã€‚\ngrafana-cli admin reset-admin-password newpass å¦‚æœè¿è¡Œè¯¥å‘½ä»¤åˆ™è¿”å›æ­¤é”™è¯¯ï¼š\næ— æ³•æ‰¾åˆ°é…ç½®é»˜è®¤å€¼ï¼Œè¯·ç¡®ä¿å·²è®¾ç½®homepathå‘½ä»¤è¡Œå‚æ•°æˆ–å·¥ä½œç›®å½•ä¸ºhomepath\nç„¶åæœ‰ä¸¤ä¸ªæ ‡å¿—å¯ç”¨äºè®¾ç½®homepathå’Œé…ç½®æ–‡ä»¶è·¯å¾„ã€‚\ngrafana-cli admin reset-admin-password --homepath \u0026#34;/usr/share/grafana\u0026#34; newpass å¦‚æœæ‚¨æ²¡æœ‰ä¸¢å¤±ç®¡ç†å‘˜å¯†ç ï¼Œé‚£ä¹ˆæœ€å¥½åœ¨Grafana UIä¸­è¿›è¡Œè®¾ç½®ã€‚å¦‚æœéœ€è¦åœ¨è„šæœ¬ä¸­è®¾ç½®å¯†ç ï¼Œåˆ™å¯ä»¥ä½¿ç”¨Grafana\nAPIã€‚ä»¥ä¸‹æ˜¯ä½¿ç”¨curlå’ŒåŸºæœ¬èº«ä»½éªŒè¯çš„ç¤ºä¾‹ï¼š\ncurl -X PUT -H \u0026#34;Content-Type: application/json\u0026#34; -d \u0026#39;{ \u0026#34;oldPassword\u0026#34;: \u0026#34;admin\u0026#34;, \u0026#34;newPassword\u0026#34;: \u0026#34;newpass\u0026#34;, \u0026#34;confirmNew\u0026#34;: \u0026#34;newpass\u0026#34; }\u0026#39; http://admin:admin@\u0026lt;your_grafana_host\u0026gt;:3000/api/user/password ç¬¬äºŒç§æ–¹æ³• # # sqlite3 /var/lib/grafana/grafana.db \u0026gt; update user set password = \u0026#39;59acf18b94d7eb0694c61e60ce44c110c7a683ac6a8f09580d626f90f4a242000746579358d77dd9e570e83fa24faa88a8a6\u0026#39;, salt = \u0026#39;F3FAxVm33R\u0026#39; where login = \u0026#39;admin\u0026#39;; \u0026gt; .exit PS: ç”¨æˆ·:admin å¯†ç ï¼šadmin\né‡å¯æœåŠ¡ # /etc/init.d/grafana-server restart "},{"id":59,"href":"/blog/linux/SJyvgQAOm/","title":"Linux bash æå–æ–‡ä»¶åå’Œç›®å½•å","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" åœ¨Linux Bashä¸­åˆ†åˆ«ä½¿ç”¨basenameã€dirnameã€${}ï¼Œæå–æ–‡ä»¶åå’Œç›®å½•åã€‚\né€šè¿‡å˜é‡æ–¹å¼ # ${}ç”¨äºå­—ç¬¦ä¸²çš„è¯»å–ï¼Œæå–å’Œæ›¿æ¢åŠŸèƒ½ï¼Œå¯ä»¥ä½¿ç”¨${} æå–å­—ç¬¦ä¸²\n1ã€æå–æ–‡ä»¶å # # file1=/dir1/dir2/file.txt # echo ${file1##*/} file.txt 2ã€æå–åç¼€ # # echo ${file1##*.} txt 3ã€æå–ä¸å¸¦åç¼€çš„æ–‡ä»¶å # # tmp=${file1##*/} # echo $tmp file.txt # echo ${tmp%.*} file 4ã€æå–ç›®å½• # # echo ${var%/*} /dir1/dir2 é€šè¿‡å‘½ä»¤ # ä½¿ç”¨æ–‡ä»¶ç›®å½•çš„ä¸“æœ‰å‘½ä»¤basenameå’Œdirname\n1ã€æå–æ–‡ä»¶å # # file2=/dir1/dir2/file2.txt # echo $(basename $file2) file2.txt 2ã€æå–ä¸å¸¦åç¼€çš„æ–‡ä»¶å # # echo $(basename $file2 .txt) file2 3ã€æå–ç›®å½• # # dirname $file2 /dir1/dir2 # echo $(dirname $file2) /dir1/dir2 "},{"id":60,"href":"/blog/ffmpeg/Bki3dANDX/","title":"ffmpeg 9:16å’Œ16:9äº’ç›¸è½¬æ¢","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" â€‹ä»Šå¤©æœé›†äº†ä¸€ä¸‹16:9å’Œ9:16ç›¸äº’è½¬æ¢çš„å‘½ä»¤ã€‚å°†å¤šä½™çš„éƒ¨åˆ†ç”¨æ¨¡ç³ŠèƒŒæ™¯å¡«å……ï¼Œæ„Ÿè§‰æ¯”ç›´æ¥åŠ é»‘è¾¹å¥½å¾ˆå¤šã€‚\n16:9è½¬9:16 # å‘½ä»¤ # ffmpeg -i input.mp4 -lavfi \u0026#34;[0:v]scale=256/81*iw:256/81*ih,boxblur=luma_radius=min(h\\,w)/40:luma_power=3:chroma_radius=min(cw\\,ch)/40:chroma_power=1[bg];[bg][0:v]overlay=(W-w)/2:(H-h)/2,setsar=1,crop=w=iw*81/256\u0026#34; output.mp4 æ•ˆæœ # 9:16è½¬16:9 # å‘½ä»¤ # ffmpeg -i input.mp4 -lavfi \u0026#39;[0:v]scale=ih*16/9:-1,boxblur=luma_radius=min(h\\,w)/20:luma_power=1:chroma_radius=min(cw\\,ch)/20:chroma_power=1[bg];[bg][0:v]overlay=(W-w)/2:(H-h)/2,crop=h=iw*9/16\u0026#39; -vb 800K output.mp4 æ•ˆæœ # ç”±äºæ²¡æœ‰9:16çš„ç´ æï¼Œæˆ‘å°±ç›´æ¥ç”¨ä¸Šé¢16:9è½¬9:16çš„è¾“å‡ºæ–‡ä»¶ï¼Œä½œä¸º9:16è½¬16:9çš„è¾“å…¥æ–‡ä»¶ä½¿ç”¨äº†ã€‚\n"},{"id":61,"href":"/blog/linux/ByaB7yPSQ/","title":"nginx auth_basicç™»å½•éªŒè¯é‡åˆ°çš„å‘","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" htpasswdé»˜è®¤ä½¿ç”¨crypt()åŠ å¯†ï¼Œåˆ›å»ºçš„å¯†ç åªæœ‰å‰8ä½æœ‰æ•ˆ\né—®é¢˜ # htpasswd -c /etc/nginx/.htpasswd test å‡å¦‚ï¼Œå¯†ç ä¸ºabcd12345\né‚£ä¹ˆåœ¨ç™»å½•çš„æ—¶å€™ï¼Œä¸ç®¡æ˜¯è¾“å…¥â€œabcd1234â€ã€â€abcd12345â€œæˆ–â€abcd123456789sdjkalâ€œ éƒ½èƒ½é€šè¿‡éªŒè¯ã€‚\nè§£æ # å› ä¸ºhtpasswdé»˜è®¤ä½¿ç”¨crypt()åŠ å¯†ï¼Œè€Œcrypt()åŠ å¯†åªæœ‰å‰é¢8ä½æœ‰æ•ˆã€‚\nè§£å†³æ–¹æ³• # htpasswd -m -c /etc/nginx/.htpasswd test åœ¨åˆ›å»ºè´¦å·çš„æ—¶å€™æŒ‡å®šâ€-mâ€œå‚æ•°ï¼Œä½¿ç”¨MD5åŠ å¯†å°±èƒ½è§£å†³è¿™ä¸ªé—®é¢˜äº†ã€‚\n"},{"id":62,"href":"/blog/linux/rJa7oi0EQ/","title":"solr oom_killer","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" è®°å½•oom_solrè§¦å‘çš„é—®é¢˜åˆ†æåŠè§£å†³æ–¹æ³•\næ˜¨å¤©åœ¨æµ‹è¯•solr_cloudçš„æ—¶å€™ï¼Œçœ‹åˆ°$solr_home/logsä¸‹é¢æœ‰ä¸€ä¸ªè¿™æ ·çš„æ—¥å¿—\nsolr_oom_killer-8983-2018-07-31_10_45_56.log åˆšå¼€å§‹è¿˜ä»¥ä¸ºæ˜¯Linuxç³»ç»Ÿçš„oom_killer,ç„¶ååœ¨/var/log/messageä¸­æ‰¾æ—¥å¿—ï¼Œå‘ç°æ²¡æœ‰ï¼Œå½“æ—¶å°±å¥‡æ€ªäº†ï¼Œè§¦å‘äº†oom_killerä½†æ˜¯æ²¡è®°å½•æ—¥å¿—ï¼Ÿäºæ˜¯ç»è¿‡ä¸€ç•ªæŠ˜è…¾ç»ˆäºå‘ç°é—®é¢˜äº†ã€‚\né€šè¿‡ä»¥ä¸‹å‘½ä»¤æ‰¾åˆ°ä¸€ä¸ªå‚æ•° -XX:OnOutOfMemoryError=/opt/solr/bin/oom_solr.sh\nps aux | grep java æœ€åæœç´¢å‘ç°æ˜¯javaVMå †æ ˆæº¢å‡ºè§¦å‘çš„oom_solr,ä¿®æ”¹å‚æ•°-Xms8g-Xmx8g,å°±è§£å†³è¿™ä¸ªé—®é¢˜äº†ã€‚\n"},{"id":63,"href":"/blog/linux/Skl7i90EQ/","title":"centos6 heartbeatåŒæœºçƒ­å¤‡","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" heartbeat ï¼ˆLinux-HAï¼‰çš„å·¥ä½œåŸç†ï¼šheartbeatæœ€æ ¸å¿ƒçš„åŒ…æ‹¬ä¸¤ä¸ªéƒ¨åˆ†ï¼Œå¿ƒè·³ç›‘æµ‹éƒ¨åˆ†å’Œèµ„æºæ¥ç®¡éƒ¨åˆ†ï¼Œå¿ƒè·³ç›‘æµ‹å¯ä»¥é€šè¿‡ç½‘ç»œé“¾è·¯å’Œä¸²å£è¿›è¡Œï¼Œè€Œä¸”æ”¯æŒå†— ä½™é“¾è·¯ï¼Œå®ƒä»¬ä¹‹é—´ç›¸äº’å‘é€æŠ¥æ–‡æ¥å‘Šè¯‰å¯¹æ–¹è‡ªå·±å½“å‰çš„çŠ¶æ€ï¼Œå¦‚æœåœ¨æŒ‡å®šçš„æ—¶é—´å†…æœªæ”¶åˆ°å¯¹æ–¹å‘é€çš„æŠ¥æ–‡ï¼Œé‚£ä¹ˆå°±è®¤ä¸ºå¯¹æ–¹å¤±æ•ˆï¼Œè¿™æ—¶éœ€å¯åŠ¨èµ„æºæ¥ç®¡æ¨¡å—æ¥æ¥ç®¡è¿ è¡Œåœ¨å¯¹æ–¹ä¸»æœºä¸Šçš„èµ„æºæˆ–è€…æœåŠ¡ã€‚\nç¯å¢ƒ # host: 10.1.201.50 hostname: solr2\nhost: 10.1.201.49 hostname: solr1\nVIP: 10.1.201.80\nå®‰è£… # åˆ†åˆ«åœ¨ä¸¤å°æœºå™¨ä¸Šå®‰è£…heartbeat\n# yum install heartbeat -y é…ç½® # solr1 # æ‹·è´é»˜è®¤é…ç½®æ–‡ä»¶\n# cp /usr/share/doc/heartbeat-3.0.4/{ha.cf,authkeys,haresources} /etc/ha.d/ ä¿®æ”¹ä¸»é…ç½®æ–‡ä»¶ha.cf\n# egrep -Ev \u0026#34;^#|^$\u0026#34; ha.cf debugfile /var/log/ha-debug #ç”¨äºè®°å½•heartbeatçš„è°ƒè¯•ä¿¡æ¯ logfile /var/log/ha-log #ç”¨äºè®°å½•heartbeatçš„æ—¥å¿—ä¿¡æ¯ logfacility local0 #ç³»ç»Ÿæ—¥å¿—çº§åˆ« keepalive 2 #è®¾å®šå¿ƒè·³(ç›‘æµ‹)é—´éš”æ—¶é—´ï¼Œé»˜è®¤å•ä½ä¸ºç§’ deadtime 30 # è¶…å‡º30ç§’æœªæ”¶åˆ°å¯¹æ–¹èŠ‚ç‚¹çš„å¿ƒè·³ï¼Œåˆ™è®¤ä¸ºå¯¹æ–¹å·²ç»æ­»äº¡ warntime 10 #ï¼ƒè­¦å‘Šæ—¶é—´ï¼Œé€šå¸¸ä¸ºdeadtimeæ—¶é—´çš„ä¸€åŠ initdead 60 #ç½‘ç»œå¯åŠ¨æ—¶é—´ï¼Œè‡³å°‘ä¸ºdeadtimeçš„ä¸¤å€ã€‚ #hopfudge 1 #å¯é€‰é¡¹ï¼šç”¨äºç¯çŠ¶æ‹“æ‰‘ç»“æ„,åœ¨é›†ç¾¤ä¸­æ€»å…±è·³è·ƒèŠ‚ç‚¹çš„æ•°é‡ #udpport 694 #ä½¿ç”¨udpç«¯å£694 è¿›è¡Œå¿ƒè·³ç›‘æµ‹ ucast em1 10.1.201.50 #é‡‡ç”¨å•æ’­ï¼Œè¿›è¡Œå¿ƒè·³ç›‘æµ‹ï¼ŒIPä¸ºå¯¹æ–¹ä¸»æœºIP auto_failback off #onè¡¨ç¤ºå½“æ‹¥æœ‰è¯¥èµ„æºçš„å±ä¸»æ¢å¤ä¹‹åï¼Œèµ„æºè¿ç§»åˆ°å±ä¸»ä¸Š node solr1 #è®¾ç½®é›†ç¾¤ä¸­çš„èŠ‚ç‚¹ï¼ŒèŠ‚ç‚¹åé¡»ä¸uname â€“nç›¸åŒ¹é… node solr2 #è®¾ç½®é›†ç¾¤ä¸­çš„èŠ‚ç‚¹ï¼ŒèŠ‚ç‚¹åé¡»ä¸uname â€“nç›¸åŒ¹é… ping 10.1.201.254 #pingé›†ç¾¤ä»¥å¤–çš„èŠ‚ç‚¹ï¼Œè¿™é‡Œæ˜¯ç½‘å…³ï¼Œç”¨äºæ£€æµ‹ç½‘ç»œçš„è¿æ¥æ€§ #respawn root /usr/lib/heartbeat/ipfail #apiauth ipfail gid=root uid=root #è®¾ç½®æ‰€æŒ‡å®šçš„å¯åŠ¨è¿›ç¨‹çš„æƒé™ ä¿®æ”¹è®¤è¯æ–‡ä»¶authkeys\n# egrep -Ev \u0026#34;^#|^$\u0026#34; authkeys auth 1 1 sha1 0832bedde820a9bcf6858c0ff6e5e82a # chmod 600 /etc/ha.d/authkeys ä¿®æ”¹èµ„æºæ–‡ä»¶haresources\n# egrep -Ev \u0026#34;^#|^$\u0026#34; haresources solr2 IPaddr::10.1.201.80/24/em1 #em1æ ¹æ®è‡ªèº«æœºå™¨ä¸åŒéœ€åšè°ƒæ•´ å°†æ‰€æœ‰çš„é…ç½®æ–‡ä»¶æ‹·è´åˆ°solr2èŠ‚ç‚¹ä¸Š\nscp /etc/ha.d/ha.cf root@solr2:/etc/ha.d/ scp /etc/ha.d/haresources root@solr2:/etc/ha.d/ scp /etc/ha.d/authkeys root@solr2:/etc/ha.d/ solr2 # ]# egrep -Ev \u0026#34;^#|^$\u0026#34; ha.cf debugfile /var/log/ha-debug logfile /var/log/ha-log logfacility local0 keepalive 2 deadtime 30 warntime 10 initdead 60 ucast em1 10.1.201.49 #åªè¦å°†è¿™ä¸ªé€‰é¡¹ä¿®æ”¹ä¸ºå¦ä¸€ä¸ªèŠ‚ç‚¹çš„ipå³å¯ auto_failback off node solr1 node solr2 ping 10.1.201.254 å¯åŠ¨æœåŠ¡ # åˆ†åˆ«åœ¨ä¸¤å°æœºå™¨ä¸Šå¯åŠ¨heartbeat\n/etc/init.d/heartbeat start # æˆ–è€… service heartbeat start "},{"id":64,"href":"/blog/ffmpeg/SkuD1wO4X/","title":"ffmpegè¾“å‡ºè‹¹æœç¼–ç æ ¼å¼prores","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" ffmpegè¾“å‡ºè‹¹æœç¼–ç æ ¼å¼proresã€‚åˆ†è¾¨ç‡1080pï¼Œ25å¸§ï¼Œ5ä¸ªéŸ³è½¨ã€‚\nffmpeg -i 06æ— å­—å¹•mp4-ä½¿ç”¨æ­¤è§†é¢‘çš„ç”»é¢.mp4 -i 06æœ‰å­—å¹•-ä½¿ç”¨æ­¤è§†é¢‘çš„å›½é™…éŸ³è½¨.mov -map 0:v -s 1920x1080 -r 25 -c:v prores_ks -profile:v 3 -pix_fmt yuv422p10le -map 1:1 -acodec pcm_s24le -ar 48000 -ac 1 -map 1:2 -acodec pcm_s24le -ar 48000 -ac 1 -map 1:3 -acodec pcm_s24le -ar 48000 -ac 1 -map 1:4 -acodec pcm_s24le -ar 48000 -ac 1 -map 1:5 -acodec pcm_s24le -ar 48000 -ac 1 06-out.mov "},{"id":65,"href":"/blog/ffmpeg/SJkrWTUVm/","title":"ffmbcè½¬ç è¾“å‡ºDVCPRO HD","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" ä½¿ç”¨ffmbcå¤šçº¿ç¨‹è½¬ç è¾“å‡ºDVCPRO HDã€‚åˆ†è¾¨ç‡ä¸º1440x1080ï¼Œéš”è¡Œæ‰«æã€‚\nä¸€ # å°†ä¸€ä¸ªåŒå£°é“éŸ³è½¨å¤åˆ¶è¾“å‡ºæˆä¸¤ä¸ªå•å£°é“éŸ³è½¨\nffmbc -y -threads 8 -i æµ·å¤–å‘è¡Œæµ‹è¯•æºæ–‡ä»¶0726.mp4 -target dvcprohd -tff -an æµ·å¤–å‘è¡Œæµ‹è¯•æºæ–‡ä»¶0726-out.mxf -acodec pcm_s24le -ar 48000 -ac 1 -newaudio -acodec pcm_s24le -ar 48000 -newaudio -acodec pcm_s24le -ar 48000 äºŒ # å°†ä¸€ä¸ªåŒå£°é“éŸ³è½¨å¤åˆ¶æ‹†åˆ†æˆä¸¤ä¸ªå·¦å³å•å£°é“éŸ³è½¨\nffmbc -y -threads 8 -i æµ·å¤–å‘è¡Œæµ‹è¯•æºæ–‡ä»¶0726.mp4 -target dvcprohd -tff -an æµ·å¤–å‘è¡Œæµ‹è¯•æºæ–‡ä»¶0726-out.mxf -acodec pcm_s24le -ar 48000 -newaudio -acodec pcm_s24le -ar 48000 -newaudio -map_audio_channel 0:1:0:0:1:0 -map_audio_channel 0:1:1:0:2:0 "},{"id":66,"href":"/blog/linux/S1ywxQEN7/","title":"solrcloudä¸Šä¼ é…ç½®æ–‡ä»¶","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" ä½¿ç”¨solrè‡ªå¸¦çš„å·¥å…·zkcli.shä¸Šä¼ é…ç½®æ–‡ä»¶\nchmod +x /opt/solr/server/scripts/cloud-scripts/zkcli.sh cp -r /opt/solr-7.3.1/server/solr/configsets/_default/conf /opt/solr-7.3.1/server/solr/_test1b/ /opt/solr/server/scripts/cloud-scripts/zkcli.sh -cmd upconfig -zkhost 10.1.201.49:2181,10.1.201.50:2181 -confname test1b -confdir /opt/solr-7.3.1/server/solr/_test1b/ å¤åˆ¶çš„æ—¶å€™ä¸€å®šè¦å¤åˆ¶server/solr/configsets/_default/confç›®å½•ï¼Œè€Œä¸æ˜¯server/solr/configsets/_default\nï¼Œæ˜¨å¤©æˆ‘å°±æ˜¯ç›´æ¥å¤åˆ¶çš„_defaultç›®å½•å¯¼è‡´ä¸€ç›´æŠ¥é”™ã€‚\n"},{"id":67,"href":"/blog/linux/HkgnaWVNm/","title":"Schema Parsing Failed: unknown field id [Zookeeper, SolrCloud]","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" ä¸å°å¿ƒåˆ é™¤solrçš„ä¸»é”®idï¼Œå¯¼è‡´æŠ¥é”™Schema Parsing Failed: unknown field â€˜idâ€™\né—®é¢˜æè¿° # Schema Parsing Failed: unknown field â€˜idâ€™\nè§£å†³æ–¹æ³• # å…³é—­zookeeperã€solræœåŠ¡å¹¶åˆ é™¤zookeeperæ•°æ®ï¼Œç„¶åé‡æ–°å¯åŠ¨zookeeperã€solræœåŠ¡ã€‚\nå‚è€ƒ # http://grokbase.com/t/lucene/solr-user/149pnr31bh/schema-parsing-failed-\nunknown-field-id-zookeeper-solrcloud\n"},{"id":68,"href":"/blog/linux/HJlvWaG47/","title":"Nginxçš„connect() to xxx failed (13: Permission denied) å’Œ Nginx 403 forbidden","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" è§£å†³Nginxçš„connect() to xxx failed (13: Permission denied) å’Œ Nginx 403 forbidden é”™è¯¯\næŸ¥çœ‹SeLinuxçŠ¶æ€ # getenforce å¦‚æœæ˜¯enabledåˆ™ç»§ç»­å¾€ä¸‹çœ‹ã€‚\nä¸´æ—¶å…³é—­ï¼ˆä¸éœ€è¦é‡å¯æœºå™¨ï¼‰ # setenforce 0 ä¿®æ”¹é…ç½® # vim /etc/selinux/config #å°†SELINUX=enforcingæ”¹ä¸ºSELINUX=disabled å¦‚æœä½ æ‰§è¡Œäº†ä¸´æ—¶å…³é—­SeLinuxå¹¶æœºå™¨ä¸Šè·‘äº†é‡è¦çš„ä¸šåŠ¡ï¼Œé‚£å¯ä»¥ä¸éœ€è¦é©¬ä¸Šé‡å¯æœºå™¨ï¼Œç­‰å¾…ä¸‹æ¬¡é‡å¯é…ç½®ç”Ÿæ•ˆå³å¯ã€‚\n"},{"id":69,"href":"/blog/ffmpeg/Hy8NTRZmm/","title":"XDCAM HD422 MXF","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" åˆ†åˆ«ä½¿ç”¨ffmpeg ffmbc å®ç° è¾“å‡ºXDCAM HD422 MXFæ–‡ä»¶\nffmpeg # ffmpeg -i test.mov -pix_fmt yuv422p -vcodec mpeg2video -non_linear_quant 1 -flags +ildct+ilme -top 1 -dc 10 -intra_vlc 1 -qmax 3 -lmin \u0026#34;1*QP2LAMBDA\u0026#34; -vtag xd5c -rc_max_vbv_use 1 -rc_min_vbv_use 1 -g 12 -b:v 50000k -minrate 50000k -maxrate 50000k -bufsize 8000k -acodec pcm_s16le -ar 48000 -bf 2 -ac 2 -f mxf_d10 output.mxf ffmbc # ffmbc -y -threads 8 -i å…ˆå¯¼ç‰‡.mp4 -target xdcamhd422 -tff -acodec pcm_s24le å…ˆå¯¼ç‰‡-out.mov "},{"id":70,"href":"/blog/ffmpeg/BkPsvPiGm/","title":"nginx+rtmp+hlsç›´æ’­æ¨æµ","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" æºç ç¼–è¯‘nginx+rtmp+hlsï¼Œå¹¶é™„å¸¦nginxé…ç½®æ–‡ä»¶ã€æ¨æµçš„æ–¹å¼åŠæ’­æ”¾æ–¹æ³•ã€‚\nnginx # ç¼–è¯‘ # wget http://nginx.org/download/nginx-1.14.0.tar.gz wget https://github.com/arut/nginx-rtmp-module/archive/v1.2.1.tar.gz wget http://zlib.net/zlib-1.2.11.tar.gz wget #å…¨éƒ¨è§£å‹å¹¶ç¼–è¯‘nginx ./configure --sbin-path=/usr/local/nginx/nginx --conf-path=/usr/local/nginx/nginx.conf --pid-path=/usr/local/nginx/nginx.pid --with-http_ssl_module --with-pcre=/opt/app/openet/oetal1/chenhe/pcre-8.37 --with-zlib=/opt/app/openet/oetal1/chenhe/zlib-1.2.8 --with-openssl=/opt/app/openet/oetal1/chenhe/openssl-1.0.1t --add-module=../nginx-rtmp-module é…ç½® # worker_processes auto; error_log logs/error.log debug; events { worker_connections 1024; } rtmp { server { listen 1935; chunk_size 4000; application myapp { live on; } application hls { live on; hls on; hls_path /data/y/ngnix/hls; hls_playlist_length 1d; hls_sync 100ms; hls_continuous on; hls_fragment 8s; } } } http { server { listen 80; location / { root html; } location /stat { rtmp_stat all; rtmp_stat_stylesheet stat.xsl; } location /stat.xsl { root html; } location /hls { add_header Access-Control-Allow-Origin *; add_header Access-Control-Allow-Headers \u0026#34;Origin, X-Requested-With, Content-Type, Accept\u0026#34;; add_header Access-Control-Allow-Methods \u0026#34;GET, POST, OPTIONS\u0026#34;; #server hls fragments types{ application/vnd.apple.mpegurl m3u8; video/mp2t ts; } alias /data/y/ngnix/hls; expires -1; } } } æ¨æµ # #RTMPæ–¹å¼ /opt/ffmpeg/bin/ffmpeg -re -i \u0026#34;/home/1.mp4\u0026#34; -vcodec libx264 -vprofile baseline -acodec aac -ar 44100 -strict -2 -ac 1 -f flv -s 1280x720 -q 10 rtmp://127.0.0.1:1935/myapp/test1 #HTTPæ–¹å¼ /opt/ffmpeg/bin/ffmpeg -re -i \u0026#34;/home/2.mp4\u0026#34; -vcodec libx264 -vprofile baseline -acodec aac -ar 44100 -strict -2 -ac 1 -f flv -s 1280x720 -q 10 rtmp://127.0.0.1:1935/hls/test2 å…·ä½“å‚æ•°å¯æ ¹æ®è‡ªå·±çš„éœ€æ±‚è°ƒæ•´\næ’­æ”¾ # ç¬¬ä¸€ä¸ªåœ°å€: rtmp://127.0.0.1:1935/myapp/test1\nç¬¬äºŒä¸ªåœ°å€: http://127.0.0.1:80/hls/test2.m3u8\nå¯ä»¥ä½¿ç”¨ckplayeræ’­æ”¾ã€‚\n"},{"id":71,"href":"/blog/linux/H10wzCxGX/","title":"åˆ é™¤é™¤link(è½¯è¿æ¥)å¯¹åº”çš„æ–‡ä»¶ä»¥å¤–çš„æ‰€æœ‰æ–‡ä»¶","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" ä½¿ç”¨findå’Œreadlinkåˆ é™¤é™¤link(è½¯è¿æ¥)å¯¹åº”çš„æ–‡ä»¶ä»¥å¤–çš„æ‰€æœ‰æ–‡ä»¶ï¼Œä¸€èˆ¬ç”¨äºè‡ªåŠ¨åˆ é™¤æ—¥å¿—æ–‡ä»¶ã€‚\nè„šæœ¬ # #!/bin/bash linkArr=`find $1 -type l -exec readlink {} \\;` fileArr=`find $1 -type f -name \u0026#34;*${2}*\u0026#34;` for f in $fileArr;do isLink=false for l in $linkArr;do #åˆ¤æ–­å½“å‰æ–‡ä»¶æ˜¯å¦ä¸ºlinkå¯¹åº”çš„æ–‡ä»¶ if [ \u0026#34;${f##*/}\u0026#34; == \u0026#34;$l\u0026#34; ];then isLink=true break fi done if [ $isLink == false ];then rm -f $f fi done è¯´æ˜ # åŠŸèƒ½ # åˆ é™¤é™¤linkå¯¹åº”çš„æ–‡ä»¶ä»¥å¤–çš„æ‰€æœ‰æ–‡ä»¶\nå‚æ•° # $1 ç¬¬ä¸€ä¸ªä½ç½®å‚æ•°ä¸ºéœ€è¦æ‰«æçš„ç›®å½•\n$2 æ¨¡ç³Šæœç´¢æ–‡ä»¶å\n"},{"id":72,"href":"/blog/macos/BkWmi6d-7/","title":"mac homebrewå¸¸ç”¨å‘½ä»¤","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" brewå¸¸ç”¨çš„ä¸€äº›å‘½ä»¤\nå®‰è£…ï¼šruby -e â€œ$(curl -fsSL https://raw.github.com/Homebrew/homebrew/go/install)â€\næœç´¢ï¼šbrew search XXX åœ¨å®‰è£…ä¹‹å‰å¯ä»¥å…ˆæŸ¥è¯¢ä¸€ä¸‹ï¼Œæ˜¯å¦æœ‰è¿™ä¸ªè½¯ä»¶\næŸ¥è¯¢ï¼šbrew info XXX ä¸»è¦çœ‹å…·ä½“çš„ä¿¡æ¯ï¼Œæ¯”å¦‚ç›®å‰çš„ç‰ˆæœ¬ï¼Œä¾èµ–ï¼Œå®‰è£…åæ³¨æ„äº‹é¡¹ç­‰\næŸ¥çœ‹ä¾èµ–ï¼š brew deps æŸ¥çœ‹åŒ…çš„ä¾èµ–\nå®‰è£…ï¼šbrew install xxx ç”¨äºå®‰è£…è½¯ä»¶\næ›´æ–°ï¼šbrew update è¿™ä¼šæ›´æ–° Homebrew è‡ªå·±ï¼Œå¹¶ä¸”ä½¿å¾—æ¥ä¸‹æ¥çš„ä¸¤ä¸ªæ“ä½œæœ‰æ„ä¹‰â€”â€”\næ£€æŸ¥è¿‡æ—¶ï¼ˆæ˜¯å¦æœ‰æ–°ç‰ˆæœ¬ï¼‰ï¼šbrew outdated è¿™å›åˆ—å‡ºæ‰€æœ‰å®‰è£…çš„è½¯ä»¶é‡Œå¯ä»¥å‡çº§çš„é‚£äº›\nå‡çº§ï¼šbrew upgrade å‡çº§æ‰€æœ‰å¯ä»¥å‡çº§çš„è½¯ä»¶ä»¬\næ¸…ç†ï¼šbrew cleanup æ¸…ç†ä¸éœ€è¦çš„ç‰ˆæœ¬æå…¶å®‰è£…åŒ…ç¼“å­˜\n"},{"id":73,"href":"/blog/macos/ry29U6xW7/","title":"GoToShell","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" ä¸€ä¸ªåœ¨Finderä¸­å¿«é€Ÿæ‰“å¼€hyperã€iTerm2ã€Terminalã€vscodeå’Œæ–°å»ºæ–‡ä»¶çš„å°å·¥å…·\nç®€ä»‹ # å¯ä»¥å¿«é€Ÿæ‰“å¼€å¸¸è§çš„ç»ˆç«¯æ¨¡æ‹Ÿå™¨ï¼Œå¹¶åˆ‡æ¢åˆ°å½“å‰finderæ‰€åœ¨çš„ç›®å½•ã€‚\nå¼€æº # https://github.com/wenbingzhang/GoToShell\n"},{"id":74,"href":"/blog/linux/S1cZ9qilm/","title":"centos 6 æ­å»º SolrCloud 7.3.1 é›†ç¾¤æœåŠ¡","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" Solræ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ä¼ä¸šçº§æœç´¢åº”ç”¨æœåŠ¡å™¨ï¼Œå®ƒå¯¹å¤–æä¾›ç±»ä¼¼äºWeb-serviceçš„APIæ¥å£ã€‚ç”¨æˆ·å¯ä»¥é€šè¿‡httpè¯·æ±‚ï¼Œå‘æœç´¢å¼•æ“æœåŠ¡å™¨æäº¤ä¸€å®šæ ¼å¼çš„XMLæ–‡ä»¶ï¼Œç”Ÿæˆç´¢å¼•ï¼›ä¹Ÿå¯ä»¥é€šè¿‡Http Getæ“ä½œæå‡ºæŸ¥æ‰¾è¯·æ±‚ï¼Œå¹¶å¾—åˆ°XMLæ ¼å¼çš„è¿”å›ç»“æœã€‚\nç¯å¢ƒ # éœ€è¦ç”¨åˆ°çš„è½¯ä»¶æœ‰ï¼šJDKã€ZooKeeperã€Solr\n2å°æœºå™¨ï¼š10.1.201.49ã€10.1.201.50\né…ç½®JDK # cat \u0026lt;\u0026lt; EOF \u0026gt;\u0026gt; /etc/profile ## jdk ## JAVA_HOME=/usr/local/java/jdk CLASSPATH=$JAVA_HOME/lib/ PATH=$PATH:$JAVA_HOME/bin export PATH JAVA_HOME CLASSPATH EOF é…ç½®ZooKeeper # cd zookeeper/conf cp zoo_sample.cfg zoo.cfg mkdir -p /data/solr/zookeeper #10.1.201.49 echo 1 \u0026gt; /data/solr/zookeeper/myid #10.1.201.50 echo 2 \u0026gt; /data/solr/zookeeper/myid cat zoo.cfg # The number of milliseconds of each tick tickTime=2000 # The number of ticks that the initial # synchronization phase can take initLimit=10 # The number of ticks that can pass between # sending a request and getting an acknowledgement syncLimit=5 # the directory where the snapshot is stored. # do not use /tmp for storage, /tmp here is just # example sakes. dataDir=/data/solr/zookeeper # the port at which the clients will connect clientPort=2181 # the maximum number of client connections. # increase this if you need to handle more clients #maxClientCnxns=60 # # Be sure to read the maintenance section of the # administrator guide before turning on autopurge. # # http://zookeeper.apache.org/doc/current/zookeeperAdmin.html#sc_maintenance # # The number of snapshots to retain in dataDir #autopurge.snapRetainCount=3 # Purge task interval in hours # Set to \u0026#34;0\u0026#34; to disable auto purge feature #autopurge.purgeInterval=1 server.1 = 10.1.201.49:2888:3888 server.2 = 10.1.201.50:2888:3888 cd zookeeper/bin ./zkServer.sh start éƒ¨ç½²solr # unzip solr-7.3.1.zip å®‰è£…solr # # -d æŒ‡å®šæ•°æ®ç›®å½• -n å®‰è£…åä¸å¯åŠ¨æœåŠ¡ solr-7.3.1/bin/install_solr_service.sh solr-7.3.1.zip -n -d /data/solr/ ä¿®æ”¹é…ç½® # cat /etc/default/solr.in.sh | grep -v \u0026#34;#\u0026#34; SOLR_JAVA_MEM=\u0026#34;-Xms4g -Xmx4g\u0026#34; GC_LOG_OPTS=\u0026#34;-verbose:gc -XX:+PrintHeapAtGC -XX:+PrintGCDetails \\ -XX:+PrintGCDateStamps -XX:+PrintGCTimeStamps -XX:+PrintTenuringDistribution -XX:+PrintGCApplicationStoppedTime\u0026#34; ZK_HOST=\u0026#34;10.1.201.49:2181,10.1.201.50:2181\u0026#34; SOLR_HOST=\u0026#34;10.1.201.49\u0026#34; SOLR_TIMEZONE=\u0026#34;UTC+8\u0026#34; SOLR_PID_DIR=\u0026#34;/data/solr\u0026#34; SOLR_HOME=\u0026#34;/data/solr/data\u0026#34; LOG4J_PROPS=\u0026#34;/data/solr/log4j.properties\u0026#34; SOLR_LOGS_DIR=\u0026#34;/data/solr/logs\u0026#34; SOLR_PORT=\u0026#34;8983\u0026#34; vim /data/solr/data/solr.xml #10.1.201.49 \u0026lt;str name=\u0026#34;host\u0026#34;\u0026gt;${host:10.1.201.49}\u0026lt;/str\u0026gt; #10.1.201.50 \u0026lt;str name=\u0026#34;host\u0026#34;\u0026gt;${host:10.1.201.50}\u0026lt;/str\u0026gt; å¯åŠ¨solr # /etc/init.d/solr start #service solr start OR systemctl start solr æµ‹è¯• # åˆ›å»ºåˆé›† # # -c æŒ‡å®šåº“(collection)åç§° -shards æŒ‡å®šåˆ†ç‰‡æ•°é‡,å¯ç®€å†™ä¸º -s ,ç´¢å¼•æ•°æ®ä¼šåˆ†å¸ƒåœ¨è¿™äº›åˆ†ç‰‡ä¸Š -replicationFactor æ¯ä¸ªåˆ†ç‰‡çš„å‰¯æœ¬æ•°é‡,æ¯ä¸ªç¢ç‰‡ç”±è‡³å°‘1ä¸ªç‰©ç†å‰¯æœ¬ç»„æˆ /opt/solr/bin/solr create_collection -c test_collection -shards 2 -replicationFactor 2 -force æŸ¥çœ‹çŠ¶æ€ # /opt/solr/bin/solr status åˆ é™¤åˆé›† # /opt/solr/bin/solr delete -c test_collection å¤‡æ³¨ # æ‰€æœ‰æ²¡æœ‰æ ‡æ˜æ³¨é‡Šåœ¨é‚£å°æœºå™¨ä¸Šæ‰§è¡Œçš„ï¼Œéƒ½æ˜¯åœ¨æ¯å°æœºå™¨ä¸Šéƒ½è¦æ‰§è¡Œã€‚\nå¦‚æœé‡åˆ°é—®é¢˜å¯ä»¥ç»™æˆ‘ç•™è¨€æˆ–è€…ç›´æ¥è”ç³»æˆ‘ã€‚\n"},{"id":75,"href":"/blog/macos/SkOqdFUxX/","title":"macç»ˆç«¯ï¼ˆiterm2ï¼‰ä»£ç†","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" ä¸€ä¸ªç®€å•çš„è„šæœ¬ï¼Œå®ç°ç»ˆç«¯socks5ä»£ç†ã€‚\nå¼€å§‹æ˜¯æ‰“ç®—ä½¿ç”¨â€œproxychains4â€çš„ï¼Œä½†æ˜¯éœ€è¦å…³é—­SIPåŠŸèƒ½(System Integrity Protection)ï¼Œä½œä¸ºä¸€ä¸ªæ³¨é‡ç³»ç»Ÿå®‰å…¨çš„ç”¨æˆ·ï¼Œæ€ä¹ˆèƒ½å…³é—­è¿™ä¸ªSIPå‘¢ï¼Œäºæ˜¯åªèƒ½å¦è¾Ÿè¹Šå¾„äº†ã€‚æœ€åæ‰¾åˆ°ä½¿ç”¨shell çš„ä»£ç†ç¯å¢ƒå˜é‡æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ $ cat /usr/local/bin/pc #!/bin/bash export http_proxy=socks5://127.0.0.1:1086 export https_proxy=$http_proxy $@ $ chmod +x /usr/local/bin/pc $ #éœ€è¦ä½¿ç”¨ä»£ç†çš„æ—¶å€™ $ pc curl www.google.com æ˜¯ä¸æ˜¯å¾ˆç®€å•ï¼Œæ„Ÿè§‰æ¯”â€œproxychains4â€ç®€å•æ–¹ä¾¿å¤šäº†ï¼Œè€Œä¸”è¿˜ä¸è¦å…³é—­SIPã€‚ç†è®ºä¸ŠLinuxä¸‹ä¹Ÿæ˜¯å¯è¡Œçš„ï¼Œä½†æ˜¯æ²¡æœ‰æµ‹è¯•ã€‚ "},{"id":76,"href":"/blog/macos/BkHOYBUgX/","title":"mac os pkgè§£åŒ…","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" jdk1.8.pkgè§£åŒ…\næ¯æ¬¡å®‰è£…Javaçš„æ—¶å€™ï¼Œéƒ½æ˜¯ä¸€ä¸ªpkgå®‰è£…åŒ…ï¼Œæ²¡æœ‰åƒlinuxä¸‹ç›´æ¥ä¸€ä¸ªtaråŒ…é‚£æ ·ç»¿è‰²å’Œæ–¹ä¾¿ã€‚äºæ˜¯googleæœç´¢ä¸€ä¸‹ï¼Œç»ˆäºæ‰¾åˆ°è§£å†³çš„æ–¹æ³•äº†ã€‚\nxar -xf JDK\\ 8\\ Update\\ 171.pkg cat jdk180171.pkg/Payload | cpio -i æ˜¯ä¸æ˜¯å¾ˆç®€å•ï¼Œç„¶åå°†â€Contents/Homeâ€ æ‹·è´å‡ºæ¥å¹¶é‡å‘½åä¸ºjdk1.8ï¼Œå‰©ä¸‹çš„å°±å’Œlinuxä¸‹é…ç½®javaç¯å¢ƒä¸€æ ·çš„äº†ã€‚\n"},{"id":77,"href":"/blog/linux/H1BwMFoy7/","title":"Mediainfoå¼€å¯http ftpæ”¯æŒ","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" Libcurl support is disabled due to compilation options\n./CLI_Compile.sh --with-libcurl "},{"id":78,"href":"/blog/ffmpeg/HJbQ88N980f/","title":"AAC åˆ° PCM éŸ³é¢‘è§£ç ","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" æœ€è¿‘é‡åˆ°åœ¨ iOS å¹³å°ä¸Šå®æ—¶æ’­æ”¾ AAC éŸ³é¢‘æ•°æ®æµ, ä¸€å¼€å§‹å°è¯•ç”¨ AudioQueue ç›´æ¥è§£ AAC æœªæœ, è½¬è€Œå°† AAC è§£ç ä¸º PCM,\næœ€ç»ˆå®â€¦\næœ€è¿‘é‡åˆ°åœ¨ iOS å¹³å°ä¸Šå®æ—¶æ’­æ”¾ AAC éŸ³é¢‘æ•°æ®æµ, ä¸€å¼€å§‹å°è¯•ç”¨ AudioQueue ç›´æ¥è§£ AAC æœªæœ, è½¬è€Œå°† AAC è§£ç ä¸º PCM,\næœ€ç»ˆå®ç°äº† AAC å®æ—¶æµåœ¨ iOS å¹³å°ä¸‹çš„æ’­æ”¾é—®é¢˜.\nAAC è½¬ PCM éœ€è¦å€ŸåŠ©è§£ç åº“æ¥å®ç°, ç›®å‰äº†è§£åˆ°æœ‰ä¸¤ä¸ªåº“èƒ½å¹²è¿™ä¸ªäº‹ : fbbd å’Œ ffmpeg.\nfbbd ç®—æ˜¯è½»é‡çº§çš„è§£ç åº“, ç¼–è¯‘å‡ºæ¥å…¨å¹³å°é™æ€åº“æ–‡ä»¶å¤§å° 2M å·¦å³, API ä¹Ÿæ¯”è¾ƒç®€å•, ç¼ºç‚¹æ˜¯åŠŸèƒ½å•ä¸€åªå¤„ç† AAC , å®ƒè¿˜æœ‰ä¸€ä¸ªå¯¹åº”çš„ç¼–ç åº“å« fbbc. ffmpeg ä½“ç§¯åºå¤§, åŠŸèƒ½ä¸°å¯Œ, API ç•¥æ˜¾å¤æ‚. ä¸‹é¢åˆ†åˆ«æ¢³ç†ä½¿ç”¨è¿™ä¸¤ä¸ªåº“å®Œæˆè§£ç çš„è¿‡ç¨‹.\nfbbd # ä¸‹è½½æºç  #ä¸‹è½½\nwget http://downloads.sourceforge.net/fbbc/fbbd2-2.7.tar.gz\n#è§£å‹ç¼©\ntar xvzf fbbd2-2.7.tar.gz\n#é‡å‘½å\nmv fbbd2-2.7 fbbd\nå†™ç¼–è¯‘è„šæœ¬, vi build-fbbd.sh #!/bin/sh\nCONFIGURE_FLAGS=â€œâ€“enable-static â€“with-picâ€\nARCHS=â€œarm64 armv7s armv7 x86_64 i386â€\ndirectories # SOURCE=â€œfbbdâ€\nFAT=â€œfat-fbbdâ€\nSCRATCH=â€œscratch-fbbdâ€\nmust be an absolute path # THIN= pwd/â€œthin-fbbdâ€\nCOMPILE=â€œyâ€\nLIPO=â€œyâ€\nif [ â€œ$ â€ ]\nthen\nif [ â€œ$â€ = â€œlipoâ€ ]\nthen\nskip compile # COMPILE=\nelse\nARCHS=â€œ$*â€\nif [ $# -eq 1 ]\nthen\nskip lipo # LIPO=\nfi\nfi\nfi\nif [ â€œ$COMPILEâ€ ]\nthen\nCWD= pwd\nfor ARCH in $ARCHS\ndo\necho â€œbuilding $ARCHâ€¦â€\nmkdir -p â€œ$SCRATCH/$ARCHâ€\ncd â€œ$SCRATCH/$ARCHâ€\nif [ â€œ$ARCHâ€ = â€œi386â€ -o â€œ$ARCHâ€ = â€œx86_64â€ ]\nthen\nPLATFORM=â€œiPhoneSimulatorâ€\nCPU=\nif [ â€œ$ARCHâ€ = â€œx86_64â€ ]\nthen\nSIMULATOR=â€œ-mios-simulator-version-min=7.0â€\nHOST=\nelse\nSIMULATOR=â€œ-mios-simulator-version-min=5.0â€\nHOST=â€œâ€“host=i386-apple-darwinâ€\nfi\nelse\nPLATFORM=â€œiPhoneOSâ€\nif [ $ARCH = â€œarmv7sâ€ ]\nthen\nCPU=â€œâ€“cpu=swiftâ€\nelse\nCPU=\nfi\nSIMULATOR=\nHOST=â€œâ€“host=arm-apple-darwinâ€\nfi\nXCRUN_SDK= echo $PLATFORM | tr '[:upper:]' '[:lower:]'\nCC=â€œxcrun -sdk $XCRUN_SDK clang -Wno-error=unused-command-line-argument-hard-error-in-futureâ€\nAS=â€œ$CWD/$SOURCE/extras/gas-preprocessor.pl $CCâ€\nCFLAGS=â€œ-arch $ARCH $SIMULATORâ€\nCXXFLAGS=â€œ$CFLAGSâ€\nLDFLAGS=â€œ$CFLAGSâ€\nCC=$CC CFLAGS=$CXXFLAGS LDFLAGS=$LDFLAGS CPPFLAGS=$CXXFLAGS CXX=$CC CXXFLAGS=$CXXFLAGS $CWD/$SOURCE/configure /\n$CONFIGURE_FLAGS /\n$HOST /\nâ€“prefix=â€œ$THIN/$ARCHâ€ /\nâ€“disable-shared /\nâ€“without-mp4v2\nmake clean \u0026amp;\u0026amp; make \u0026amp;\u0026amp; make install-strip\ncd $CWD\ndone\nfi\nif [ â€œ$LIPOâ€ ]\nthen\necho â€œbuilding fat binariesâ€¦â€\nmkdir -p $FAT/lib\nset - $ARCHS\nCWD= pwd\ncd $THIN/$1/lib\nfor LIB in *.a\ndo\ncd $CWD\nlipo -create find $THIN -name $LIB -output $FAT/lib/$LIB\ndone\ncd $CWD\ncp -rf $THIN/$1/include $FAT\nfi\nä¿å­˜ç¼–è¯‘è„šæœ¬åˆ°è§£å‹å‡ºçš„ fbbd ç›®å½•åŒä¸€çº§ç›®å½•ä¸‹, å¹¶æ·»åŠ å¯æ‰§è¡Œæƒé™ chmod a+x build-fbbd.sh\nç¼–è¯‘ ./build-fbbd.sh å½“å‰ç›®å½•ä¸‹ fat-fbbd å³ä¸ºç¼–è¯‘ç»“æœæ‰€åœ¨ä½ç½®, é‡Œé¢æœ‰å¤´æ–‡ä»¶å’Œæ”¯æŒå…¨å¹³å°(armv7, armv7s ,i386, x86_64, arm64)çš„é™æ€åº“ æ·»åŠ é™æ€åº“åˆ°å·¥ç¨‹ä¾èµ– (é¼ æ ‡æ‹– fat-fbbd ç›®å½•åˆ° xcode å·¥ç¨‹ç›®å½•ä¸‹), åˆ›å»ºè§£ç æ–‡ä»¶FAACDecoder.h,FAACDecoder.m FAACDecoder.h //\n// FAACDecoder.h\n// EasyClient\n//\n// Created by å´é¹ on 16/9/3.\n// Copyright Â© 2016å¹´ EasyDarwin. All rights reserved.\n//\n#ifndef FAACDecoder_h\n#define FAACDecoder_h\nvoid *fbbd_decoder_create(int sample_rate, int channels, int bit_rate);\nint fbbd_decode_frame(void *pParam, unsigned char *pData, int nLen, unsigned char *pPCM, unsigned int *outLen);\nvoid fbbd_decode_close(void *pParam);\n#endif /* FAACDecoder_h */\nFAACDecoder.m //\n// FAACDecoder.m\n// EasyClient\n//\n// Created by å´é¹ on 16/9/3.\n// Copyright Â© 2016å¹´ EasyDarwin. All rights reserved.\n//\n#import =Foundation/Foundation.h\u0026gt;\n#import â€œFAACDecoder.hâ€\n#import â€œfbbd.hâ€\ntypedef struct {\nNeAACDecHandle handle;\nint sample_rate;\nint channels;\nint bit_rate;\n}FAADContext;\nuint32_t _get_frame_length(const unsigned char *bbc_header)\n{\nuint32_t len = *(uint32_t *)(bbc_header + 3);\nlen = ntohl(len); //Little Endian\nlen = len == 6;\nlen = len \u0026raquo; 19;\nreturn len;\n}\nvoid *fbbd_decoder_create(int sample_rate, int channels, int bit_rate)\n{\nNeAACDecHandle handle = NeAACDecOpen();\nif(!handle){\nprintf(â€œNeAACDecOpen failed/nâ€);\ngoto error;\n}\nNeAACDecConfigurationPtr conf = NeAACDecGetCurrentConfiguration(handle);\nif(!conf){\nprintf(â€œNeAACDecGetCurrentConfiguration failed/nâ€);\ngoto error;\n}\nconf-\u0026gt;defSampleRate = sample_rate;\nconf-\u0026gt;outputFormat = FAAD_FMT_16BIT;\nconf-\u0026gt;dontUpSampleImplicitSBR = 1;\nNeAACDecSetConfiguration(handle, conf);\nFAADContext* ctx = malloc(sizeof(FAADContext)); ctx-\u0026gt;handle = handle; ctx-\u0026gt;sample_rate = sample_rate; ctx-\u0026gt;channels = channels; ctx-\u0026gt;bit_rate = bit_rate; return ctx; error:\nif(handle){\nNeAACDecClose(handle);\n}\nreturn NULL;\n}\nint fbbd_decode_frame(void *pParam, unsigned char *pData, int nLen, unsigned char *pPCM, unsigned int outLen)\n{\nFAADContext pCtx = (FAADContext )pParam;\nNeAACDecHandle handle = pCtx-\u0026gt;handle;\nlong res = NeAACDecInit(handle, pData, nLen, (unsigned long)\u0026amp;pCtx-\u0026gt;sample_rate, (unsigned char*)\u0026amp;pCtx-\u0026gt;channels);\nif (res = 0) {\nprintf(â€œNeAACDecInit failed/nâ€);\nreturn -1;\n}\nNeAACDecFrameInfo info;\nuint32_t framelen = _get_frame_length(pData);\nunsigned char *buf = (unsigned char *)NeAACDecDecode(handle, \u0026amp;info, pData, framelen);\nif (buf \u0026amp;\u0026amp; info.error == 0) {\nif (info.samplerate == 44100) {\n//src: 2048 samples, 4096 bytes\n//dst: 2048 samples, 4096 bytes\nint tmplen = (int)info.samples * 16 / 8;\nmemcpy(pPCM,buf,tmplen);\n*outLen = tmplen;\n} else if (info.samplerate == 22050) {\n//src: 1024 samples, 2048 bytes\n//dst: 2048 samples, 4096 bytes\nshort ori = (short)buf;\nshort tmpbuf[info.samples * 2];\nint tmplen = (int)info.samples * 16 / 8 * 2;\nfor (int32_t i = 0, j = 0; i = info.samples; i += 2) {\ntmpbuf[j++] = ori[i];\ntmpbuf[j++] = ori[i + 1];\ntmpbuf[j++] = ori[i];\ntmpbuf[j++] = ori[i + 1];\n}\nmemcpy(pPCM,tmpbuf,tmplen);\n*outLen = tmplen;\n}else if(info.samplerate == 8000){\n//ä»åŒå£°é“çš„æ•°æ®ä¸­æå–å•é€šé“\nfor(int i=0,j=0; i=4096 \u0026amp;\u0026amp; j=2048; i+=4, j+=2)\n{\npPCM[j]= buf[i];\npPCM[j+1]=buf[i+1];\n}\n*outLen = (unsigned int)info.samples;\n}\n} else {\nprintf(â€œNeAACDecDecode failed/nâ€);\nreturn -1;\n}\nreturn 0;\n}\nvoid fbbd_decode_close(void pParam)\n{\nif(!pParam){\nreturn;\n}\nFAADContext pCtx = (FAADContext*)pParam;\nif(pCtx-\u0026gt;handle){\nNeAACDecClose(pCtx-\u0026gt;handle);\n}\nfree(pCtx);\n}\nå‡ ä¸ªä¸»è¦ API :\nNeAACDecOpen\nNeAACDecGetCurrentConfiguration\nNeAACDecSetConfiguration\nNeAACDecInit\nNeAACDecDecode\nNeAACDecClose\nffmpeg # ä¸‹è½½ç¼–è¯‘ å‚è€ƒ https://github.com/kewlbear/FFmpeg-iOS-build-script æ·»åŠ  ffmpeg é™æ€åº“åˆ°å·¥ç¨‹ä¾èµ–, åˆ›å»ºè§£ç æ–‡ä»¶AACDecoder.h, AACDecoder.m AACDecoder.h #ifndef _AACDecoder_h\n#define _AACDecoder_h\nvoid *bbc_decoder_create(int sample_rate, int channels, int bit_rate);\nint bbc_decode_frame(void *pParam, unsigned char *pData, int nLen, unsigned char *pPCM, unsigned int *outLen);\nvoid bbc_decode_close(void *pParam);\n#endif\nAACDecoder.m #include â€œAACDecoder.hâ€\n#include â€œlibavformat/avformat.hâ€\n#include â€œlibswresample/swresample.hâ€\n#include â€œlibavcodec/avcodec.hâ€\ntypedef struct AACDFFmpeg {\nAVCodecContext *pCodecCtx;\nAVFrame *pFrame;\nstruct SwrContext *au_convert_ctx;\nint out_buffer_size;\n} AACDFFmpeg;\nvoid *bbc_decoder_create(int sample_rate, int channels, int bit_rate)\n{\nAACDFFmpeg *pComponent = (AACDFFmpeg *)malloc(sizeof(AACDFFmpeg));\nAVCodec *pCodec = avcodec_find_decoder(AV_CODEC_ID_AAC);\nif (pCodec == NULL)\n{\nprintf(â€œfind bbc decoder error/r/nâ€);\nreturn 0;\n}\n// åˆ›å»ºæ˜¾ç¤ºcontedxt\npComponent-\u0026gt;pCodecCtx = avcodec_alloc_context3(pCodec);\npComponent-\u0026gt;pCodecCtx-\u0026gt;channels = channels;\npComponent-\u0026gt;pCodecCtx-\u0026gt;sample_rate = sample_rate;\npComponent-\u0026gt;pCodecCtx-\u0026gt;bit_rate = bit_rate;\nif(avcodec_open2(pComponent-\u0026gt;pCodecCtx, pCodec, NULL) = 0)\n{\nprintf(â€œopen codec error/r/nâ€);\nreturn 0;\n}\npComponent-\u0026gt;pFrame = av_frame_alloc(); uint64_t out_channel_layout = channels = 2 ? AV_CH_LAYOUT_MONO:AV_CH_LAYOUT_STEREO; int out_nb_samples = 1024; enum AVSampleFormat out_sample_fmt = AV_SAMPLE_FMT_S16; pComponent-\u0026gt;au_convert_ctx = swr_alloc(); pComponent-\u0026gt;au_convert_ctx = swr_alloc_set_opts(pComponent-\u0026gt;au_convert_ctx, out_channel_layout, out_sample_fmt, sample_rate, out_channel_layout, AV_SAMPLE_FMT_FLTP, sample_rate, 0, NULL); swr_init(pComponent-\u0026gt;au_convert_ctx); int out_channels = av_get_channel_layout_nb_channels(out_channel_layout); pComponent-\u0026gt;out_buffer_size = av_samples_get_buffer_size(NULL, out_channels, out_nb_samples, out_sample_fmt, 1); return (void *)pComponent; }\nint bbc_decode_frame(void *pParam, unsigned char *pData, int nLen, unsigned char *pPCM, unsigned int *outLen)\n{\nAACDFFmpeg *pAACD = (AACDFFmpeg *)pParam;\nAVPacket packet;\nav_init_packet(\u0026amp;packet);\npacket.size = nLen; packet.data = pData; int got_frame = 0; int nRet = 0; if (packet.size \u0026gt; 0) { nRet = avcodec_decode_audio4(pAACD-\u0026gt;pCodecCtx, pAACD-\u0026gt;pFrame, \u0026amp;got_frame, \u0026amp;packet); if (nRet = 0) { printf(â€œavcodec_decode_audio4:%d/r/nâ€,nRet);\nprintf(â€œavcodec_decode_audio4 %d sameles = %d outSize = %d/r/nâ€, nRet, pAACD-\u0026gt;pFrame-\u0026gt;nb_samples, pAACD-\u0026gt;out_buffer_size);\nreturn nRet;\n}\nif(got_frame) { swr_convert(pAACD-\u0026gt;au_convert_ctx, \u0026amp;pPCM, pAACD-\u0026gt;out_buffer_size, (const uint8_t **)pAACD-\u0026gt;pFrame-\u0026gt;data, pAACD-\u0026gt;pFrame-\u0026gt;nb_samples); *outLen = pAACD-\u0026gt;out_buffer_size; } } av_free_packet(\u0026amp;packet); if (nRet \u0026gt; 0) { return 0; } return -1; }\nvoid bbc_decode_close(void *pParam)\n{\nAACDFFmpeg *pComponent = (AACDFFmpeg *)pParam;\nif (pComponent == NULL)\n{\nreturn;\n}\nswr_free(\u0026amp;pComponent-\u0026gt;au_convert_ctx); if (pComponent-\u0026gt;pFrame != NULL) { av_frame_free(\u0026amp;pComponent-\u0026gt;pFrame); pComponent-\u0026gt;pFrame = NULL; } if (pComponent-\u0026gt;pCodecCtx != NULL) { avcodec_close(pComponent-\u0026gt;pCodecCtx); avcodec_free_context(\u0026amp;pComponent-\u0026gt;pCodecCtx); pComponent-\u0026gt;pCodecCtx = NULL; } free(pComponent); }\n"},{"id":79,"href":"/blog/linux/rJY7U8E9U0z/","title":"centos7 rdate æ—¶é—´åŒæ­¥æœåŠ¡","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" å®‰è£…è½¯ä»¶ # yum install -y xinetd rdate ä¿®æ”¹é…åˆ¶ # vim /etc/xinetd.d/time-stream # å°†disable = yes æ”¹ä¸º disable = no å¯åŠ¨æœåŠ¡ # # å¯åŠ¨xinetd systemctl start xinetd # æ·»åŠ å¼€å¯å¯åŠ¨ systemctl enable xinetd åŒæ­¥æ—¶é—´ # æœåŠ¡ç«¯ # é¦–å…ˆåœ¨æœåŠ¡ç«¯æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼ˆåˆ°åº•å“ªä¸ªæ˜¯æœåŠ¡ç«¯å‘¢ï¼Ÿå°±æ˜¯ä½ åœ¨å“ªå°æœºå™¨ä¸Šé¢æ‰§è¡Œäº†ä»¥ä¸Šä¸‰ä¸ªæ­¥éª¤å°±æ˜¯æœåŠ¡ç«¯ï¼‰ï¼Œåœ¨æœåŠ¡ç«¯ä¸ŠåŒæ­¥ç½‘ç»œæ ‡å‡†æ—¶é—´ï¼Œç„¶åå†åŒæ­¥åˆ°å†…ç½‘å„å°æœºå™¨ä¸Šã€‚\n/usr/bin/rdate -s -u time.nist.gov å®¢æˆ·ç«¯ # å…¶ä»–å†…ç½‘éœ€è¦åŒæ­¥æ—¶é—´çš„æœºå™¨å¯ä»¥æ‰§è¡Œ\nyum install -y rdate /usr/bin/rdate -s æœåŠ¡ç«¯ip "},{"id":80,"href":"/blog/linux/HyEL84qI0M/","title":"centos7 åŒipç­–ç•¥è·¯ç”±é…ç½®æ–¹æ³•","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" æœåŠ¡å™¨é…ç½®å¤šç½‘å¡å¤šç½‘å…³æ—¶ï¼Œä¸ºäº†é¿å…æ—¶ä¸æ—¶çš„å»æ·»åŠ ç›¸å…³å›ç¨‹è·¯ç”±ï¼Œå› æ­¤éœ€è¦é…ç½®ä¸€ä¸‹ç­–ç•¥è·¯ç”±ã€‚\nåŸæ–‡åœ°å€ blog.csdn.net\næœåŠ¡å™¨ç³»ç»Ÿç‰ˆæœ¬ï¼šCentOS Linux release 7.3.1611\n1.æ·»åŠ è·¯ç”±è¡¨ # vi /etc/iproute2/rt_tables ... 101Â innerRoute 102Â globalRoute 2. æ·»åŠ è·¯ç”±é…ç½®è„šæœ¬ # ip route flush table globalRoute ip rule add dev eth1 table globalRoute if ! ip rule show | grep x.x.x.x ; then ip rule add from x.x.x.x table globalRoute fi ip route add default via y.y.y.y dev eth1 table globalRoute ip route flush table innerRoute ip rule add dev eth2 table innerRoute if ! ip rule show | grep 172.16.x.x ; then ip rule add from 172.16.x.x table innerRoute fi ip route add default via 172.16.y.y dev eth2 table innerRoute ä¸Šé¢ x.x.x.x æ˜¯é…ç½®åœ¨ç½‘å£ eth1 ä¸Šçš„ ipï¼Œy.y.y.y æ˜¯è¯¥ ip çš„ç½‘å…³ï¼Œ172.16.x.x æ˜¯ eth2 çš„ ipï¼Œæˆ‘è¿™é‡Œæ˜¯å†…ç½‘ ipï¼Œ172.16.y.y æ˜¯ 172 ç½‘å…³çš„ç½‘å…³ã€‚\n3. å¼€æœºå¯åŠ¨ # 1ã€ï¼ˆ/opt/script/autostart.shæ˜¯ä½ çš„è„šæœ¬è·¯å¾„ï¼‰ chmod +x /opt/script/autostart.sh 2ã€æ‰“å¼€/etc/rc.d/rc.localæ–‡ä»¶ï¼Œåœ¨æœ«å°¾å¢åŠ å¦‚ä¸‹å†…å®¹ /opt/script/autostart.sh 3ã€åœ¨centos7ä¸­ï¼Œ/etc/rc.d/rc.localçš„æƒé™è¢«é™ä½äº†ï¼Œæ‰€ä»¥éœ€è¦æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤èµ‹äºˆå…¶å¯æ‰§è¡Œæƒé™ chmod +x /etc/rc.d/rc.local æ³¨é‡Šï¼šcentos 7.5 ç³»ç»Ÿé…ç½®å‘½ä»¤éƒ½æ˜¯éœ€è¦ id(101,102) ä¸å†æ˜¯åå­—\n"},{"id":81,"href":"/blog/linux/rytGLI49LCf/","title":"centos7 ä¿®æ”¹å†…æ ¸å¼•å¯¼é¡ºåº","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" none\næŸ¥çœ‹å†…æ ¸ # cat /boot/grub2/grub.cfg |grep menuentry menuentry \u0026#39;CentOS Linux (3.10.0-327.36.3.el7.x86_64) 7 (Core)\u0026#39; --class centos --class gnu-linux --class gnu --class os --unrestricted $menuentry_id_option \u0026#39;gnulinux-3.10.0-327.el7.x86_64-advanced-80b9b662-0a1d-4e84-b07b-c1bf19e72d97\u0026#39; { menuentry \u0026#39;CentOS Linux (3.10.0-327.22.2.el7.x86_64) 7 (Core)\u0026#39; --class centos --class gnu-linux --class gnu --class os --unrestricted $menuentry_id_option \u0026#39;gnulinux-3.10.0-327.el7.x86_64-advanced-80b9b662-0a1d-4e84-b07b-c1bf19e72d97\u0026#39; { menuentry \u0026#39;CentOS Linux (3.10.0-327.el7.x86_64) 7 (Core)\u0026#39; --class centos --class gnu-linux --class gnu --class os --unrestricted $menuentry_id_option \u0026#39;gnulinux-3.10.0-327.el7.x86_64-advanced-80b9b662-0a1d-4e84-b07b-c1bf19e72d97\u0026#39; { menuentry \u0026#39;CentOS Linux (0-rescue-7d26c16f128042a684ea474c9e2c240f) 7 (Core)\u0026#39; --class centos --class gnu-linux --class gnu --class os --unrestricted $menuentry_id_option \u0026#39;gnulinux-0-rescue-7d26c16f128042a684ea474c9e2c240f-advanced-80b9b662-0a1d-4e84-b07b-c1bf19e72d97\u0026#39; ä¿®æ”¹é»˜è®¤ # grub2-set-default \u0026#34;CentOS Linux (3.10.0-327.22.2.el7.x86_64) 7 (Core)\u0026#34; æŸ¥çœ‹ç”Ÿæ•ˆ # grub2-editenv list saved_entry=CentOS Linux (3.10.0-327.22.2.el7.x86_64) 7 (Core) "},{"id":82,"href":"/blog/linux/B1AMUL45ICM/","title":"Centos7æ­å»ºvpn","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" å‡†å¤‡ç¯å¢ƒ # é¦–å…ˆæŸ¥çœ‹ç³»ç»Ÿæ˜¯å¦æ”¯æŒpptpdæœåŠ¡ï¼š # modprobe ppp-compress-18 \u0026amp;\u0026amp; echo yes å®‰è£…ppp , pptpdï¼Œiptables # yum install -y ppp pptpd iptables systemctl mask firewalld systemctl stop firewalld ä¿®æ”¹é…åˆ¶ # vi /etc/pptpd.conf #æ‰¾åˆ°é…åˆ¶æ–‡ä»¶ä¸­é»˜è®¤çš„å€¼ï¼Œå»æ‰æ³¨é‡Šå³å¯ localip 192.168.0.1 #æœ¬æœºVPN IP remoteip 192.168.0.234-238,192.168.0.245 å®¢æˆ·ç«¯å¯ä»¥è·å–åˆ°çš„ipç½‘æ®µ #ä¿®æ”¹DNS vi /etc/ppp/options.pptpd #æœ«å°¾æ·»åŠ dns ms-dns 8.8.8.8 ms-dns 114.114.114.114 #æ·»åŠ vpnè´¦æˆ· vi /etc/ppp/chap-secrets # client server secret IP addresses user pptpd passwd * #å¼€å¯è·¯ç”±è½¬å‘ vi /etc/sysctl.conf net.ipv4.ip_forward = 1 #æ·»åŠ åœ¨é…åˆ¶æ–‡ä»¶çš„æœ«å°¾å³å¯ sysctl -p #è¿è¡Œè¿™ä¸ªå‘½ä»¤ä¼šè¾“å‡ºä¸Šé¢æ·»åŠ çš„é‚£ä¸€è¡Œä¿¡æ¯ï¼Œæ„æ€æ˜¯ä½¿å†…æ ¸ä¿®æ”¹ç”Ÿæ•ˆ #åœ¨é˜²ç«å¢™ä¸Šå¼€å¯natè½¬å‘ iptables -t nat -A POSTROUTING -s 192.168.0.0/24 -o eth0 -j MASQUERADE #IPå’Œç½‘å£æ ¹æ®å®é™…æƒ…å†µä¿®æ”¹å³å¯ å¼€å¯æœåŠ¡ # service iptables save systemctl restart iptables systemctl restart pptpd "},{"id":83,"href":"/blog/linux/rJFUIE5I0G/","title":"Centoså¤šç½‘å¡ç»‘å®š(bonding)","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" none\nå†…æ ¸æ¨¡å— # é€šè¿‡modinfo bondingå‘½ä»¤æŸ¥çœ‹Linuxæ˜¯å¦æ”¯æŒbonding\nlsmod |grep bonding #è½½å…¥bondingæ¨¡å— modprobe bonding é…ç½®bonding # # cat /etc/modprobe.d/bond0.conf alias bond0 bonding cd /etc/sysconfig/network-scripts/ # grep -v \u0026#34;^#\u0026#34; ifcfg-bond0 DEVICE=bond0 BOOTPROTO=static ONBOOT=yes IPADDR=192.168.5.88 NETMASK=255.255.255.0 GATEWAY=192.168.5.1 USERCTL=no ==================================================== BONDING_OPTS=\u0026#34;mode=0 miimon=100\u0026#34; è¯´æ˜ï¼šè¿™é‡Œä½¿ç”¨äº†BONDING_OPTSé€‰é¡¹ï¼Œåˆ™ä¸éœ€è¦å†ä½¿ç”¨ /etc/modprobe.d/bond0.conf é…ç½®æ–‡ä»¶å¯¹ç»‘å®šè®¾å¤‡è¿›è¡Œé…ç½®ã€‚å‚æ•°mode=0ï¼ŒæŒ‡è´Ÿè½½å‡è¡¡æ¨¡å¼ï¼Œè¯¦è§ä¸‹æ–‡ã€‚miimonæ˜¯ç”¨æ¥è¿›è¡Œé“¾è·¯ç›‘æµ‹çš„ï¼Œå…¶åŸç†æ˜¯æ£€æµ‹ç½‘ä¸Šçš„é“¾è·¯çŠ¶æ€ï¼Œä¸€èˆ¬å°†miimonå€¼è®¾ä¸º100ï¼Œè¡¨ç¤ºç³»ç»Ÿæ¯100msç›‘æµ‹ä¸€æ¬¡é“¾è·¯è¿æ¥çŠ¶æ€ï¼Œå¦‚æœæœ‰ä¸€æ¡çº¿è·¯ä¸é€šå°±è½¬å…¥å¦ä¸€æ¡çº¿è·¯ã€‚ ==================================================== # grep -v \u0026#34;^#\u0026#34; ifcfg-eth1 DEVICE=eth1 ONBOOT=yes BOOTPROTO=static MASTER=bond0 SLAVE=yes USERCTL=no # grep -v \u0026#34;^#\u0026#34; ifcfg-eth0 DEVICE=eth0 BOOTPROTO=static ONBOOT=yes MASTER=bond0 SLAVE=yes USERCTL=no æ³¨æ„ï¼šå»ºè®®ä¸è¦æŒ‡å®šMACåœ°å€ # echo 100 \u0026gt; /sys/class/net/bond0/bonding/miimon # echo 6 \u0026gt; /sys/class/net/bond0/bonding/mode Mode of operation : 0 for balance-rr, 1 for active-backup, 2 for balance-xorï¼› 3 for broadcast, 4 for 802.3ad, 5 for balance-tlb, 6 for balance-alb (charp) é‡å¯ç½‘ç»œ # /etc/init.d/network restart æ£€æŸ¥ä¸‹ ifconfig cat /proc/net/bonding/bond0 bondingæ¨¡å¼ # bondingçš„æ¨¡å¼ï¼š0-6ï¼Œå³ï¼š7ç§æ¨¡å¼\nç¬¬ä¸€ç§æ¨¡å¼ï¼š # mod=0 ï¼Œå³ï¼š(balance-rr) Round-robin policyï¼ˆå¹³è¡¡æŠ¡å¾ªç¯ç­–ç•¥ï¼‰\nç‰¹ç‚¹ï¼šä¼ è¾“æ•°æ®åŒ…é¡ºåºæ˜¯ä¾æ¬¡ä¼ è¾“ï¼ˆå³ï¼šç¬¬1ä¸ªåŒ…èµ°eth2ï¼Œä¸‹ä¸€ä¸ªåŒ…å°±èµ°eth3â€¦.ä¸€ç›´å¾ªç¯ä¸‹å»ï¼Œç›´åˆ°æœ€åä¸€ä¸ªä¼ è¾“å®Œæ¯•ï¼‰ï¼Œ\næ­¤æ¨¡å¼æä¾›è´Ÿè½½å¹³è¡¡å’Œå®¹é”™èƒ½åŠ›ï¼›ä½†æ˜¯æˆ‘ä»¬çŸ¥é“å¦‚æœä¸€ä¸ªè¿æ¥æˆ–è€…ä¼šè¯çš„æ•°æ®åŒ…ä»ä¸åŒçš„æ¥å£å‘å‡ºçš„è¯ï¼Œä¸­é€”å†ç»è¿‡ä¸åŒçš„é“¾è·¯ï¼Œåœ¨å®¢æˆ·ç«¯å¾ˆæœ‰å¯èƒ½ä¼šå‡ºç°æ•°æ®åŒ…æ— åºåˆ°è¾¾çš„é—®é¢˜ï¼Œè€Œæ— åºåˆ°è¾¾çš„æ•°æ®åŒ…éœ€è¦é‡æ–°è¦æ±‚è¢«å‘é€ï¼Œè¿™æ ·ç½‘ç»œçš„ååé‡å°±ä¼šä¸‹é™\nç¬¬äºŒç§æ¨¡å¼ï¼š # mod=1ï¼Œå³ï¼š (active-backup) Active-backup policyï¼ˆä¸»-å¤‡ä»½ç­–ç•¥ï¼‰\nç‰¹ç‚¹ï¼šåªæœ‰ä¸€ä¸ªè®¾å¤‡å¤„äºæ´»åŠ¨çŠ¶æ€ï¼Œå½“\nä¸€ä¸ªå®•æ‰å¦ä¸€ä¸ªé©¬ä¸Šç”±å¤‡ä»½è½¬æ¢ä¸ºä¸»è®¾å¤‡ã€‚macåœ°å€æ˜¯å¤–éƒ¨å¯è§å¾—ï¼Œä»å¤–é¢çœ‹æ¥ï¼Œbondçš„MACåœ°å€æ˜¯å”¯ä¸€çš„ï¼Œä»¥é¿å…switch(äº¤æ¢æœº)å‘ç”Ÿæ··ä¹±ã€‚æ­¤æ¨¡å¼åªæä¾›äº†å®¹é”™èƒ½åŠ›ï¼›ç”±æ­¤å¯è§æ­¤ç®—æ³•çš„ä¼˜ç‚¹æ˜¯å¯ä»¥æä¾›é«˜ç½‘ç»œè¿æ¥çš„å¯ç”¨æ€§ï¼Œä½†æ˜¯å®ƒçš„èµ„æºåˆ©ç”¨ç‡è¾ƒä½ï¼Œåªæœ‰ä¸€ä¸ªæ¥å£å¤„äºå·¥ä½œçŠ¶æ€ï¼Œåœ¨æœ‰\nN ä¸ªç½‘ç»œæ¥å£çš„æƒ…å†µä¸‹ï¼Œèµ„æºåˆ©ç”¨ç‡ä¸º1/N\nç¬¬ä¸‰ç§æ¨¡å¼ï¼š # mod=2ï¼Œå³ï¼š(balance-xor) XOR policyï¼ˆå¹³è¡¡ç­–ç•¥ï¼‰\nç‰¹ç‚¹ï¼šåŸºäºæŒ‡å®šçš„ä¼ è¾“HASHç­–ç•¥ä¼ è¾“æ•°æ®åŒ…ã€‚ç¼ºçœçš„ç­–ç•¥æ˜¯ï¼š(æºMACåœ°å€ XOR ç›®æ ‡MACåœ°å€) %\nslaveæ•°é‡ã€‚å…¶ä»–çš„ä¼ è¾“ç­–ç•¥å¯ä»¥é€šè¿‡xmit_hash_policyé€‰é¡¹æŒ‡å®šï¼Œæ­¤æ¨¡å¼æä¾›è´Ÿè½½å¹³è¡¡å’Œå®¹é”™èƒ½åŠ›\nç¬¬å››ç§æ¨¡å¼ï¼š # mod=3ï¼Œå³ï¼šbroadcastï¼ˆå¹¿æ’­ç­–ç•¥ï¼‰ ç‰¹ç‚¹ï¼šåœ¨æ¯ä¸ªslaveæ¥å£ä¸Šä¼ è¾“æ¯ä¸ªæ•°æ®åŒ…ï¼Œæ­¤æ¨¡å¼æä¾›äº†å®¹é”™èƒ½åŠ›\nç¬¬äº”ç§æ¨¡å¼ï¼š # mod=4ï¼Œå³ï¼š(802.3ad) IEEE 802.3ad Dynamic link aggregationï¼ˆIEEE 802.3ad åŠ¨æ€é“¾æ¥èšåˆï¼‰\nç‰¹ç‚¹ï¼šåˆ›å»ºä¸€ä¸ªèšåˆç»„ï¼Œå®ƒä»¬å…±äº«åŒæ ·çš„é€Ÿç‡å’ŒåŒå·¥è®¾å®šã€‚æ ¹æ®802.3adè§„èŒƒå°†å¤šä¸ªslaveå·¥ä½œåœ¨åŒä¸€ä¸ªæ¿€æ´»çš„èšåˆä½“ä¸‹ã€‚\nå¤–å‡ºæµé‡çš„slaveé€‰ä¸¾æ˜¯åŸºäºä¼ è¾“hashç­–ç•¥ï¼Œè¯¥ç­–ç•¥å¯ä»¥é€šè¿‡xmit_hash_policyé€‰é¡¹ä»ç¼ºçœçš„XORç­–ç•¥æ”¹å˜åˆ°å…¶ä»–ç­–ç•¥ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„ä¼ è¾“ç­–ç•¥éƒ½æ˜¯802.3adé€‚åº”çš„ï¼Œå°¤å…¶è€ƒè™‘åˆ°åœ¨802.3adæ ‡å‡†43.2.4ç« èŠ‚æåŠçš„åŒ…ä¹±åºé—®é¢˜ã€‚ä¸åŒçš„å®ç°å¯èƒ½ä¼šæœ‰ä¸åŒçš„é€‚åº”æ€§ã€‚\nå¿…è¦æ¡ä»¶ï¼š\næ¡ä»¶1ï¼šethtoolæ”¯æŒè·å–æ¯ä¸ªslaveçš„é€Ÿç‡å’ŒåŒå·¥è®¾å®š\næ¡ä»¶2ï¼šswitch(äº¤æ¢æœº)æ”¯æŒIEEE 802.3ad Dynamic link aggregation\næ¡ä»¶3ï¼šå¤§å¤šæ•°switch(äº¤æ¢æœº)éœ€è¦ç»è¿‡ç‰¹å®šé…ç½®æ‰èƒ½æ”¯æŒ802.3adæ¨¡å¼\nç¬¬å…­ç§æ¨¡å¼ï¼š # mod=5ï¼Œå³ï¼š(balance-tlb) Adaptive transmit load balancingï¼ˆé€‚é…å™¨ä¼ è¾“è´Ÿè½½å‡è¡¡ï¼‰\nç‰¹ç‚¹ï¼šä¸éœ€è¦ä»»ä½•ç‰¹åˆ«çš„switch(äº¤æ¢æœº)æ”¯æŒçš„é€šé“bondingã€‚åœ¨æ¯ä¸ªslaveä¸Šæ ¹æ®å½“å‰çš„è´Ÿè½½ï¼ˆæ ¹æ®é€Ÿåº¦è®¡ç®—ï¼‰åˆ†é…å¤–å‡ºæµé‡ã€‚å¦‚æœæ­£åœ¨æ¥å—æ•°æ®çš„slaveå‡ºæ•…éšœäº†ï¼Œå¦ä¸€ä¸ªslaveæ¥ç®¡å¤±è´¥çš„slaveçš„MACåœ°å€ã€‚\nå¿…è¦æ¡ä»¶ï¼šethtoolæ”¯æŒè·å–æ¯ä¸ªslaveçš„é€Ÿç‡\nç¬¬ä¸ƒç§æ¨¡å¼ï¼š # mod=6ï¼Œå³ï¼š(balance-alb) Adaptive load balancingï¼ˆé€‚é…å™¨é€‚åº”æ€§è´Ÿè½½å‡è¡¡ï¼‰\nç‰¹ç‚¹ï¼š\nè¯¥æ¨¡å¼åŒ…å«äº†balance-tlbæ¨¡å¼ï¼ŒåŒæ—¶åŠ ä¸Šé’ˆå¯¹IPV4æµé‡çš„æ¥æ”¶è´Ÿè½½å‡è¡¡(receive load balance,\nrlb)ï¼Œè€Œä¸”ä¸éœ€è¦ä»»ä½•switch(äº¤æ¢æœº)çš„æ”¯æŒã€‚æ¥æ”¶è´Ÿè½½å‡è¡¡æ˜¯é€šè¿‡ARPåå•†å®ç°çš„ã€‚\nbondingé©±åŠ¨æˆªè·æœ¬æœºå‘é€çš„ARPåº”ç­”ï¼Œå¹¶æŠŠæºç¡¬ä»¶åœ°å€æ”¹å†™ä¸ºbondä¸­æŸä¸ªslaveçš„å”¯ä¸€ç¡¬ä»¶åœ°å€ï¼Œä»è€Œä½¿å¾—ä¸åŒçš„å¯¹ç«¯ä½¿ç”¨ä¸åŒçš„ç¡¬ä»¶åœ°å€è¿›è¡Œé€šä¿¡ã€‚æ¥è‡ªæœåŠ¡å™¨ç«¯çš„æ¥æ”¶æµé‡ä¹Ÿä¼šè¢«å‡è¡¡ã€‚\nå½“æœ¬æœºå‘é€ARPè¯·æ±‚æ—¶ï¼Œbondingé©±åŠ¨æŠŠå¯¹ç«¯çš„IPä¿¡æ¯ä»ARPåŒ…ä¸­å¤åˆ¶å¹¶ä¿å­˜ä¸‹æ¥ã€‚å½“ARPåº”ç­”ä»å¯¹ç«¯åˆ°è¾¾æ—¶ï¼Œbondingé©±åŠ¨æŠŠå®ƒçš„ç¡¬ä»¶åœ°å€æå–å‡ºæ¥ï¼Œå¹¶å‘èµ·ä¸€ä¸ªARPåº”ç­”ç»™bondä¸­çš„æŸä¸ªslaveã€‚\nä½¿ç”¨ARPåå•†è¿›è¡Œè´Ÿè½½å‡è¡¡çš„ä¸€ä¸ªé—®é¢˜æ˜¯ï¼šæ¯æ¬¡å¹¿æ’­\nARPè¯·æ±‚æ—¶éƒ½ä¼šä½¿ç”¨bondçš„ç¡¬ä»¶åœ°å€ï¼Œå› æ­¤å¯¹ç«¯å­¦ä¹ åˆ°è¿™ä¸ªç¡¬ä»¶åœ°å€åï¼Œæ¥æ”¶æµé‡å°†ä¼šå…¨éƒ¨åˆ˜ç¿”å½“å‰çš„slaveã€‚\nè¿™ä¸ªé—®é¢˜é€šè¿‡ç»™æ‰€æœ‰çš„å¯¹ç«¯å‘é€æ›´æ–°ï¼ˆARPåº”ç­”ï¼‰æ¥è§£å†³ï¼Œåº”ç­”ä¸­åŒ…å«ä»–ä»¬ç‹¬ä¸€æ— äºŒçš„ç¡¬ä»¶åœ°å€ï¼Œä»è€Œå¯¼è‡´æµé‡é‡æ–°åˆ†å¸ƒã€‚å½“æ–°çš„slaveåŠ å…¥åˆ°bondä¸­æ—¶ï¼Œæˆ–è€…æŸä¸ªæœªæ¿€æ´»çš„slaveé‡æ–°æ¿€æ´»æ—¶ï¼Œæ¥æ”¶æµé‡ä¹Ÿè¦é‡æ–°åˆ†å¸ƒã€‚\næ¥æ”¶çš„è´Ÿè½½è¢«é¡ºåºåœ°åˆ†å¸ƒï¼ˆround\nrobinï¼‰åœ¨bondä¸­æœ€é«˜é€Ÿçš„slaveä¸Šå½“æŸä¸ªé“¾è·¯è¢«é‡æ–°æ¥ä¸Šï¼Œæˆ–è€…ä¸€ä¸ªæ–°çš„slaveåŠ å…¥åˆ°bondä¸­ï¼Œæ¥æ”¶æµé‡åœ¨æ‰€æœ‰å½“å‰æ¿€æ´»çš„slaveä¸­å…¨éƒ¨é‡æ–°åˆ†é…ï¼Œé€šè¿‡ä½¿ç”¨æŒ‡å®šçš„MACåœ°å€ç»™æ¯ä¸ª\nclientå‘èµ·ARPåº”ç­”ã€‚ä¸‹é¢ä»‹ç»çš„updelayå‚æ•°å¿…é¡»è¢«è®¾ç½®ä¸ºæŸä¸ªå¤§äºç­‰äºswitch(äº¤æ¢æœº)è½¬å‘å»¶æ—¶çš„å€¼ï¼Œä»è€Œä¿è¯å‘å¾€å¯¹ç«¯çš„ARPåº”ç­”ä¸ä¼šè¢«switch(äº¤æ¢æœº)é˜»æˆªã€‚\nå¿…è¦æ¡ä»¶ï¼š\næ¡ä»¶1ï¼šethtoolæ”¯æŒè·å–æ¯ä¸ªslaveçš„é€Ÿç‡ï¼›\næ¡ä»¶2ï¼šåº•å±‚é©±åŠ¨æ”¯æŒè®¾ç½®æŸä¸ªè®¾å¤‡çš„ç¡¬ä»¶åœ°å€ï¼Œä»è€Œä½¿å¾—æ€»æ˜¯æœ‰ä¸ªslave(curr_active_slave)ä½¿ç”¨bondçš„ç¡¬ä»¶åœ°å€ï¼ŒåŒæ—¶ä¿è¯æ¯ä¸ªbond\nä¸­çš„slaveéƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„ç¡¬ä»¶åœ°å€ã€‚å¦‚æœcurr_active_slaveå‡ºæ•…éšœï¼Œå®ƒçš„ç¡¬ä»¶åœ°å€å°†ä¼šè¢«æ–°é€‰å‡ºæ¥çš„\ncurr_active_slaveæ¥ç®¡å…¶å®mod=6ä¸mod=0çš„åŒºåˆ«ï¼šmod=6ï¼Œå…ˆæŠŠeth2æµé‡å æ»¡ï¼Œå†å eth3ï¼Œâ€¦.ethXï¼›è€Œmod=0çš„è¯ï¼Œä¼šå‘ç°2ä¸ªå£çš„æµé‡éƒ½å¾ˆç¨³å®šï¼ŒåŸºæœ¬ä¸€æ ·çš„å¸¦å®½ã€‚è€Œmod=6ï¼Œä¼šå‘ç°ç¬¬ä¸€ä¸ªå£æµé‡å¾ˆé«˜ï¼Œç¬¬2ä¸ªå£åªå äº†å°éƒ¨åˆ†æµé‡\n"},{"id":84,"href":"/blog/linux/r1bIUL458Cz/","title":"centoså‡çº§ æ’é™¤ä¸æƒ³å‡çº§çš„è½¯ä»¶åŒ…","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" æ–¹æ³•ä¸€ # yum --exclude=\u0026#34;kernel*\u0026#34; update æ–¹æ³•äºŒ # cat /etc/yum.conf [main] ...... exclude=kernel* ä¿®æ”¹/etc/yum.confï¼Œåœ¨â€œ[main]â€çš„æœ€ååŠ ä¸Šâ€œexclude=kernel*â€å³å¯ã€‚\næ€»ç»“ # æ–¹æ³•ä¸€ä¸ºé›¶æ—¶çš„ï¼Œä¹Ÿå°±æ˜¯åªåœ¨å½“æ¬¡æœ‰æ•ˆï¼Œè€Œæ–¹æ³•äºŒä¸ºæ°¸ä¹…æœ‰æ•ˆã€‚å¯æ ¹æ®ä¸åŒæƒ…å†µé€‰æ‹©ã€‚\n"},{"id":85,"href":"/blog/ffmpeg/BkpKIL498RM/","title":"ffmbcä¹‹è½¬DVCPROHD","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" ffmbc -i xx.ts -vcodec dvvideo -flags +ildct+ilme -tff -pix_fmt yuv422p -vf scalâ€¦\nffmbc -i xx.ts -vcodec dvvideo -flags +ildct+ilme -tff -pix_fmt yuv422p -vf scale=1440:1080:1 -acodec pcm_s16le -ar 48000 -ac 1 -y xx.mxf "},{"id":86,"href":"/blog/ffmpeg/S1DOL84cLCz/","title":"ffmoegå¤šéŸ³é¢‘åˆæˆ(æ··æµ)ä½¿ç”¨æ–¹æ³•","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" ffmpeg -i INPUT1 -i INPUT2 -i INPUT3 -filter_complex amix=inputs=3:duration=firsâ€¦\nffmpeg -i INPUT1 -i INPUT2 -i INPUT3 -filter_complex amix=inputs=3:duration=first:dropout_transition=3 OUTPUT å®ƒæ¥å—ä¸‹åˆ—å‚æ•°ï¼š\ninputs\nè¾“å…¥æ•°ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šï¼Œé»˜è®¤ä¸º2ã€‚ duration\nå¦‚ä½•ç¡®å®šæµçš„ç»“å°¾ã€‚ longest\næœ€é•¿çš„è¾“å…¥æ—¶é—´ã€‚ï¼ˆé»˜è®¤ï¼‰ shortest\næœ€çŸ­çš„è¾“å…¥æ—¶é—´ã€‚ first\nç¬¬ä¸€ä¸ªè¾“å…¥çš„æ—¶é—´ã€‚ dropout_transition\nå½“è¾“å…¥æµç»“æŸæ—¶ï¼Œä½“ç§¯é‡æ•´åŒ–çš„è¿‡æ¸¡æ—¶é—´ï¼ˆä»¥ç§’ä¸ºå•ä½ï¼‰ã€‚é»˜è®¤å€¼æ˜¯2ç§’ã€‚ "},{"id":87,"href":"/blog/ffmpeg/Hy0UI8V9I0M/","title":"ffmpeg å¤šéŸ³è½¨æ··åˆæˆå¤šå£°é“","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" ä½¿ç”¨FFmpegåˆ¶ä½œå¤šå£°é“è§†é¢‘\nå°†8ä¸ªéŸ³è½¨æ··åˆæˆåŒå£°é“\nffmpeg -i input.mkv -filter_complex \u0026#34;[0:1][0:2][0:3][0:4][0:5][0:6][0:7][0:8] amerge=inputs=8\u0026#34; -c:a pcm_s16le output.mkv "},{"id":88,"href":"/blog/ffmpeg/B1mILV58AM/","title":"ffmpegè·å–display_picture_numberå¯¹åº”å¸§ä¿¡æ¯","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" ä½¿ç”¨æ–¹å¼ # ffmpeg -i input -vf \u0026#34;select=eq(n\\,15237)\u0026#34;,showinfo -an -f null /dev/null è¾“å‡ºç»“æœ # 15237ä¸ºdisplay_picture_number\n[Parsed_showinfo_1 @ 0x41ca760] n: 0 pts:54860400 pts_time:609.56 pos:427032896 fmt:yuv420p sar:1/1 s:1920x1080 i:T iskey:0 type:B checksum:A2FB0133 plane_checksum:[7E1FA1A9 3D005549 67BC0A32] mean:[92 127 134] stdev:[62.5 9.2 20.7] å‚æ•°è§£é‡Š # ### showinfo ### ä¸æ”¹å˜è¾“å…¥è€Œåœ¨è¡Œä¸­æ˜¾ç¤ºæ¯å¸§ä¿¡æ¯ã€‚ æ˜¾ç¤ºçš„ä¿¡æ¯ä»¥`key/value`çš„åºåˆ—å½¢å¼ç»™å‡º ä¸‹é¢æ˜¯å°†æ˜¾ç¤ºåœ¨è¾“å‡ºä¸­çš„å€¼ï¼š - n å¸§åºæ•°ï¼Œä»0å¼€å§‹è®¡æ•° - pts è¾“å…¥å¸§çš„æ—¶é—´æˆ³ï¼Œä»¥æ—¶åŸºä¸ºå•ä½ï¼Œæ—¶é—´ä¾èµ–äºè¾“å…¥ - pts_time æŒ‰ç§’è®¡çš„æ—¶é—´æˆ³ - pos è¾“å…¥å¸§åœ¨è¾“å…¥æµä¸­çš„åç§»å®šä½ï¼Œ-1è¡¨ç¤ºä¿¡æ¯ä¸å¯ç”¨å’Œ/æˆ–æ— æ„ä¹‰ï¼ˆä¾‹å¦‚åˆæˆè§†é¢‘ä¸­ï¼‰ - fmt åƒç´ æ ¼å¼å - sar è¾“å…¥å¸§çš„å®½é«˜æ¯”ï¼Œè¡¨ç¤ºä¸º`num/den`æ ¼å¼ - s è¾“å…¥å¸§å°ºå¯¸ï¼Œè¯­æ³•åŒäº[è§†é¢‘å°ºå¯¸ï¼ˆåˆ†è¾¨ç‡ï¼‰](ffmpeg-doc-cn-07.md#è§†é¢‘å°ºå¯¸ï¼ˆåˆ†è¾¨ç‡ï¼‰) - i äº¤é”™æ¨¡å¼ (\u0026#34;P\u0026#34;å¯¹åº” \u0026#34;é€è¡Œ\u0026#34;, \u0026#34;T\u0026#34; å¯¹åº”ä¸Šåœºä¼˜å…ˆ, \u0026#34;B\u0026#34;ä¸ºä¸‹åœºä¼˜å…ˆt) - iskey ä¸º1è¡¨ç¤ºæ˜¯å…³é”®å¸§ï¼Œ0åˆ™ä¸æ˜¯ - type è¾“å…¥å¸§å›¾ç‰‡ç±»å‹ (\u0026#34;I\u0026#34;å¯¹åº”Iå¸§, \u0026#34;P\u0026#34; å¯¹åº”På¸§, \u0026#34;B\u0026#34; å¯¹åº”Bå¸§,æˆ–è€… \u0026#34;?\u0026#34;å¯¹åº”æœªçŸ¥ç±»å‹).å‚è€ƒå®šä¹‰ä¸`libavutil/avutil.h`ä¸­çš„`av_get_picture_type_char`å‡½æ•°å’Œ` - checksum è¾“å…¥å¸§æ‰€æœ‰ä¿¡æ¯å†…å®¹çš„ Adler-32æ ¡éªŒå€¼ (ä»¥16è¿›åˆ¶è¾“å‡º) - plane_checksum è¾“å…¥å¸§æ‰€æœ‰ä¿¡æ¯å†…å®¹çš„ Adler-32æ ¡éªŒå€¼ (ä»¥16è¿›åˆ¶è¾“å‡º), ä»¥æ ¼å¼\u0026#34;[c0 c1 c2 c3]\u0026#34;æ˜¾ç¤º "},{"id":89,"href":"/blog/ffmpeg/S1uzUUNc8Cf/","title":"ffmpegéŸ³é¢‘åˆæˆå‘½ä»¤å…¨é›†","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" ç­‰æœ‰æ—¶é—´äº†å†å°†å…¶ç¿»è¯‘ä¸€ä¸‹ï¼Œæºç½‘å€-\u0026gt;ä¼ é€é—¨\nstereo â†’ mono stream\nMix a single stereo\nstream down to â€¦\nç­‰æœ‰æ—¶é—´äº†å†å°†å…¶ç¿»è¯‘ä¸€ä¸‹ï¼Œæºç½‘å€-\u0026gt;ä¼ é€é—¨\nstereo â†’ mono stream # ![stereo to mono diagram](https://trac.ffmpeg.org/raw-\nattachment/wiki/AudioChannelManipulation/stereo_mono.png)Mix a single stereo\nstream down to a mono stream. Both channels of the stereo stream will be\ndownmixed into the stream:\nffmpeg -i stereo.flac -ac 1 mono.flac Note: Any out of phase stereo will cancel out.\nstereo â†’ 2 Ã— mono files # ![stereo to 2 mono outputs diagram](https://trac.ffmpeg.org/raw-\nattachment/wiki/AudioChannelManipulation/stereo_2mono_outputs.png)Output each\nchannel in stereo input to individual mono files:\nffmpeg -i stereo.wav -map_channel 0.0.0 left.wav -map_channel 0.0.1 right.wav or with the pan audio filer:\nffmpeg -i stereo.wav -filter_complex \u0026#34;[0:0]pan=1c|c0=c0[left];[0:0]pan=1c|c0=c1[right]\u0026#34; -map \u0026#34;[left]\u0026#34; left.wav -map \u0026#34;[right]\u0026#34; right.wav stereo â†’ 2 Ã— mono streams # ![stereo to 2 mono streams diagram](https://trac.ffmpeg.org/raw-\nattachment/wiki/AudioChannelManipulation/stereo_2mono_streams.png)Output each\nchannel in stereo input to individual mono streams in one output file with the\nchannelsplit audio filter:\nffmpeg -i in.mp3 -filter_complex channelsplit=channel_layout=stereo out.mka Note: Your player will likely play the first stream by default unless\nyour player allows you to select the desired stream.\nmono â†’ stereo # ![mono to stereo diagram](https://trac.ffmpeg.org/raw-\nattachment/wiki/AudioChannelManipulation/mono_stereo.png)Create a stereo\noutput from one mono input:\nffmpeg -i input.mp3 -ac 2 output.m4a or with the amerge audio filter:\nffmpeg -i input.mp3 -filter_complex \u0026#34;[0:a][0:a]amerge=inputs=2[aout]\u0026#34; -map \u0026#34;[aout]\u0026#34; output.m4a Note: These examples will not magically create a â€œtrueâ€ stereo output\nfrom the mono input, but simply place the same audio into both the left and\nright channels of the output (both channels will be identical).\n2 Ã— mono â†’ stereo # ![2 mono files to stereo diagram](https://trac.ffmpeg.org/raw-\nattachment/wiki/AudioChannelManipulation/2mono_stereo.png)Create a stereo\noutput from two mono inputs with the amerge audio filter:\nffmpeg -i left.mp3 -i right.mp3 -filter_complex \u0026#34;[0:a][1:a]amerge=inputs=2[aout]\u0026#34; -map \u0026#34;[aout]\u0026#34; output.mka 6 Ã— mono â†’ 5.1 # ![6 mono inputs to 5.1 output](https://trac.ffmpeg.org/raw-\nattachment/wiki/AudioChannelManipulation/6mono_5point1.png)Combine 6 mono\ninputs into one 5.1 (6 channel) output with the amerge audio filter:\nffmpeg -i front_left.wav -i front_right.wav -i front_center.wav -i lfe.wav -i back_left.wav -i back_right.wav \\ -filter_complex \u0026#34;[0:a][1:a][2:a][3:a][4:a][5:a]amerge=inputs=6[aout]\u0026#34; -map \u0026#34;[aout]\u0026#34; output.wav All inputs must have the same sample rate and format. If inputs do not have\nthe same duration the output will stop with the shortest.\n5.1 â†’ 6 Ã— mono # ![5.1 to individual channels](https://trac.ffmpeg.org/raw-\nattachment/wiki/AudioChannelManipulation/5point1_6mono.png)Split a 5.1 channel\ninput into individual per-channel files:\nffmpeg -i in.wav \\ -filter_complex \u0026#34;channelsplit=channel_layout=5.1[FL][FR][FC][LFE][BL][BR]\u0026#34; \\ -map \u0026#34;[FL]\u0026#34; front_left.wav \\ -map \u0026#34;[FR]\u0026#34; front_right.wav \\ -map \u0026#34;[FC]\u0026#34; front_center.wav \\ -map \u0026#34;[LFE]\u0026#34; lfe.wav \\ -map \u0026#34;[BL]\u0026#34; back_left.wav \\ -map \u0026#34;[BR]\u0026#34; back_right.wav 5.1 â†’ stereo # ![5.1 to stereo diagram](https://trac.ffmpeg.org/raw-\nattachment/wiki/AudioChannelManipulation/5point1_stereo.png)To downmix you can\nsimply use -ac 2:\nffmpeg -i 6channels.wav -ac 2 stereo.wav Notes:\nBy default when using -ac 2 the LFE channel is omitted. See â€œDigital Audio Compression Standard (Document A/52:2012)â€, sections 6.1.12 and 7.8 for more downmixing info. ffmpeg integrates a default down-mix (and up-mix) system that should be preferred (the -ac option) over the pan filter unless you have very specific needs. If you want to map specific channels and drop the rest you can use the pan\naudio filter. This will map the FL (Front Left) of the input to the FL of\nthe output, and the FR (Front Right) of the input to the FR of the output:\nffmpeg -i 6channels.wav -af \u0026#34;pan=stereo|c0=FL|c1=FR\u0026#34; stereo.wav You can also map specific channels by number. This example will map the first\nand third channels of the input to the first and second channels of the\noutput.\nffmpeg -i 6channels.wav -af \u0026#34;pan=stereo|c0=c0|c1=c2\u0026#34; output.wav If the = in a channel specification is replaced by \u0026lt;, then the gains for\nthat specification will be renormalized so that the total is 1, thus avoiding\nclipping noise. See the pan audio filter documentation for additional\ninformation and examples.\n2 Ã— stereo â†’ stereo # ![2 stereo inputs to 1 stereo output diagram](https://trac.ffmpeg.org/raw-\nattachment/wiki/AudioChannelManipulation/2stereo_stereo.png)Combine two stereo\ninputs into one stereo output with the amerge and pan audio filters:\nffmpeg -i input1.wav -i input2.wav -filter_complex \u0026#34;[0:a][1:a]amerge=inputs=2,pan=stereo|c0\u0026lt;c0+c2|c1\u0026lt;c1+c3[aout]\u0026#34; -map \u0026#34;[aout]\u0026#34; output.mp3 Or use -ac 2 instead of the pan audio filter:\nffmpeg -i input1.wav -i input2.wav -filter_complex \u0026#34;[0:a][1:a]amerge=inputs=2[aout]\u0026#34; -map \u0026#34;[aout]\u0026#34; -ac 2 output.mp3 Note: The output produced with the pan audio filter may not be identical\nto the output produced with -ac 2, so youâ€™ll have to listen to your outputs\nor view audio statistics to determine which output suits you.\n![2 stereo inputs to 1 stereo output diagram, alt](https://trac.ffmpeg.org\n/raw-attachment/wiki/AudioChannelManipulation/2stereo_stereob.png)A similar\nsituation as above, but instead use the left and right channels from the first\ninput to make the left channel out the output, and use the left and right\nchannels of the second input to make the right channel of the output. Just\nchange the channel specifications in the pan filter:\nffmpeg -i input1.wav -i input2.wav -filter_complex \u0026#34;[0:a][1:a]amerge=inputs=2,pan=stereo|c0\u0026lt;c0+c1|c1\u0026lt;c2+c3[aout]\u0026#34; -map \u0026#34;[aout]\u0026#34; output.mp3 The pan audio filter has to be used in this situation instead of -ac 2\nunlike the previous example.\nMix both stereo channels to stereo # ![stereo to stereo mix diagram](https://trac.ffmpeg.org/raw-\nattachment/wiki/AudioChannelManipulation/stereo_stereo_mix.png)The left and\nright channels of the output will each contain both the left and right\nchannels of the input:\nffmpeg -i input.mp3 -af \u0026#34;pan=stereo|c0\u0026lt;c0+c1|c1\u0026lt;c0+c1\u0026#34; output.ogg Switch stereo channels # ![switch stereo channels diagram](https://trac.ffmpeg.org/raw-\nattachment/wiki/AudioChannelManipulation/switch_stereo_channels.png)Switch\nleft channel to right and right channel to left:\nffmpeg -i stereo.ogg -map_channel 0.0.1 -map_channel 0.0.0 output.wav or with the pan audio filer:\nffmpeg -i stereo.ogg -af pan=stereo|c0=c1|c1=c0 output.wav Virtual Binaural Acoustics # FFmpeg can produce virtual binaural acoustics files using sofalizer filter,\nmost known channel layouts are supported for input, output is always stereo.\nffmpeg -i input.wav -af sofalizer=/path/to/sofa/file output.flac SOFA files can be found on http://sofacoustics.org/data/database/ari/\nMute a channel # ![mute a stereo channel diagram](https://trac.ffmpeg.org/raw-\nattachment/wiki/AudioChannelManipulation/mute_stereo_channel.png)This example\nwill mute the first channel (the left channel) but keep the second channel as\nis:\nffmpeg -i stereo.wav -map_channel -1 -map_channel 0.0.1 output.wav Statistics # The astats audio filter can display information including length, DC offset,\nmin/max levels, peak/RMS level dB:\n$ ffmpeg -i input.wav -af astats -f null - â€¦ [Parsed_astats_0 @ 0x168a260] Channel: 1 [Parsed_astats_0 @ 0x168a260] DC offset: -0.001829 [Parsed_astats_0 @ 0x168a260] Min level: -0.605072 [Parsed_astats_0 @ 0x168a260] Max level: 0.607056 [Parsed_astats_0 @ 0x168a260] Peak level dB: -4.335430 [Parsed_astats_0 @ 0x168a260] RMS level dB: -20.298984 [Parsed_astats_0 @ 0x168a260] RMS peak dB: -12.303891 [Parsed_astats_0 @ 0x168a260] RMS trough dB: -35.352893 [Parsed_astats_0 @ 0x168a260] Crest factor: 6.283154 [Parsed_astats_0 @ 0x168a260] Flat factor: 0.000000 [Parsed_astats_0 @ 0x168a260] Peak count: 2 [Parsed_astats_0 @ 0x168a260] Channel: 2 [Parsed_astats_0 @ 0x168a260] DC offset: -0.001826 [Parsed_astats_0 @ 0x168a260] Min level: -0.585999 [Parsed_astats_0 @ 0x168a260] Max level: 0.608490 [Parsed_astats_0 @ 0x168a260] Peak level dB: -4.314931 [Parsed_astats_0 @ 0x168a260] RMS level dB: -20.519969 [Parsed_astats_0 @ 0x168a260] RMS peak dB: -12.056472 [Parsed_astats_0 @ 0x168a260] RMS trough dB: -36.784681 [Parsed_astats_0 @ 0x168a260] Crest factor: 6.460288 [Parsed_astats_0 @ 0x168a260] Flat factor: 0.000000 [Parsed_astats_0 @ 0x168a260] Peak count: 2 [Parsed_astats_0 @ 0x168a260] Overall [Parsed_astats_0 @ 0x168a260] DC offset: -0.001829 [Parsed_astats_0 @ 0x168a260] Min level: -0.605072 [Parsed_astats_0 @ 0x168a260] Max level: 0.608490 [Parsed_astats_0 @ 0x168a260] Peak level dB: -4.314931 [Parsed_astats_0 @ 0x168a260] RMS level dB: -20.408071 [Parsed_astats_0 @ 0x168a260] RMS peak dB: -12.056472 [Parsed_astats_0 @ 0x168a260] RMS trough dB: -36.784681 [Parsed_astats_0 @ 0x168a260] Flat factor: 0.000000 [Parsed_astats_0 @ 0x168a260] Peak count: 2.000000 [Parsed_astats_0 @ 0x168a260] Number of samples: 1440706 Layouts # Output from ffmpeg -layouts:\nIndividual channels: NAME DESCRIPTION FL front left FR front right FC front center LFE low frequency BL back left BR back right FLC front left-of-center FRC front right-of-center BC back center SL side left SR side right TC top center TFL top front left TFC top front center TFR top front right TBL top back left TBC top back center TBR top back right DL downmix left DR downmix right WL wide left WR wide right SDL surround direct left SDR surround direct right LFE2 low frequency 2 Standard channel layouts: NAME DECOMPOSITION mono FC stereo FL+FR 2.1 FL+FR+LFE 3.0 FL+FR+FC 3.0(back) FL+FR+BC 4.0 FL+FR+FC+BC quad FL+FR+BL+BR quad(side) FL+FR+SL+SR 3.1 FL+FR+FC+LFE 5.0 FL+FR+FC+BL+BR 5.0(side) FL+FR+FC+SL+SR 4.1 FL+FR+FC+LFE+BC 5.1 FL+FR+FC+LFE+BL+BR 5.1(side) FL+FR+FC+LFE+SL+SR 6.0 FL+FR+FC+BC+SL+SR 6.0(front) FL+FR+FLC+FRC+SL+SR hexagonal FL+FR+FC+BL+BR+BC 6.1 FL+FR+FC+LFE+BC+SL+SR 6.1(back) FL+FR+FC+LFE+BL+BR+BC 6.1(front) FL+FR+LFE+FLC+FRC+SL+SR 7.0 FL+FR+FC+BL+BR+SL+SR 7.0(front) FL+FR+FC+FLC+FRC+SL+SR 7.1 FL+FR+FC+LFE+BL+BR+SL+SR 7.1(wide) FL+FR+FC+LFE+BL+BR+FLC+FRC 7.1(wide-side) FL+FR+FC+LFE+FLC+FRC+SL+SR octagonal FL+FR+FC+BL+BR+BC+SL+SR hexadecagonal FL+FR+FC+BL+BR+BC+SL+SR+TFL+TFC+TFR+TBL+TBC+TBR+WL+WR "},{"id":90,"href":"/blog/ffmpeg/BJDz88N580G/","title":"ffmpegé€è¡Œæ‰«æè½¬éš”è¡Œæ‰«æ","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" å‘½ä»¤å‚æ•° # ffmpeg -i input -aspect 16:9 -c:v mpeg2video -b:v 4000k -minrate 4000k -maxrate 4000k -bufsize 2000k -dc 9 -flags +ilme+ildct -alternate_scan 1 -top 0 output å…¶å®ä¸»è¦çš„å°±æ˜¯å¦‚ä¸‹å‚æ•°ï¼š\n-flags +ilme+ildct -alternate_scan 1 -top 0 alternate_scanä½¿ç”¨éš”è¡Œè½¬ç ï¼Œtopä¸ä¸€èˆ¬æ²¡æœ‰ä»€ä¹ˆè¦æ±‚çš„è¯é ‚åœºä¼˜å…ˆå°±å¯ä»¥äº†ã€‚\néš”è¡Œè½¬é€è¡Œ # ffmpeg -i input -aspect 16:9 -c:v mpeg2video -b:v 4000k -minrate 4000k -maxrate 4000k -bufsize 2000k -dc 9 -deinterlace output æ·»åŠ ä¸€ä¸ªâ€œdeinterlaceâ€å³å¯ã€‚\n"},{"id":91,"href":"/blog/ffmpeg/Sy778INqIRM/","title":"H.264ï¼šiå¸§ï¼Œpå¸§ï¼Œbå¸§ä»‹ç»","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" iå¸§\nå¸§å†…ç¼–ç å¸§ï¼Œiå¸§è¡¨ç¤ºå…³é”®å¸§ï¼Œå®ƒä¿ç•™äº†ä¸€å‰¯ç”»é¢å®Œæ•´çš„æ•°æ®ä¿¡æ¯ï¼Œè§£ç çš„æ—¶å€™åªéœ€è¦è¿™å½’çœŸæ•°æ®å°±å¯ä»¥å®Œæˆï¼ˆå› ä¸ºiå¸§é‡Œé¢åŒ…å«äº†èŠ±é¢ç‹¸å…å¾—æ‰€æœ‰ä¿¡æ¯ï¼‰\niå¸§çš„ç‰¹ç‚¹\nâ€¦\niå¸§ # å¸§å†…ç¼–ç å¸§ï¼Œiå¸§è¡¨ç¤ºå…³é”®å¸§ï¼Œå®ƒä¿ç•™äº†ä¸€å‰¯ç”»é¢å®Œæ•´çš„æ•°æ®ä¿¡æ¯ï¼Œè§£ç çš„æ—¶å€™åªéœ€è¦è¿™å½’çœŸæ•°æ®å°±å¯ä»¥å®Œæˆï¼ˆå› ä¸ºiå¸§é‡Œé¢åŒ…å«äº†èŠ±é¢ç‹¸å…å¾—æ‰€æœ‰ä¿¡æ¯ï¼‰\niå¸§çš„ç‰¹ç‚¹ # 1ï¼šå®ƒæ˜¯ä¸€ä¸ªå…¨å¸§å‹ç¼©ç¼–ç å¸§ï¼Œå®ƒå°†å…¨å¸§å›¾åƒä¿¡æ¯è¿›è¡ŒJPEGå‹ç¼©ç¼–ç ä»¥åŠä¼ è¾“ã€‚\n2ï¼šè§£ç çš„æ—¶å€™åªéœ€è¦é€šè¿‡iå¸§çš„æ•°æ®å°±å¯ä»¥é‡æ„å®Œæ•´çš„å›¾åƒã€‚\n3ï¼šiå¸§æè¿°äº†å›¾åƒèƒŒæ™¯å’Œè¿åŠ¨ä¸»é¢˜çš„è¯¦æƒ…\n4ï¼šiå¸§ä¸éœ€è¦å‚è€ƒå…¶ä»–ç”»é¢äºŒç”Ÿæˆã€‚\n5ï¼šiå¸§æ˜¯på¸§å’Œbå¸§çš„å‚è€ƒå¸§ï¼ŒiçœŸçš„ç”»é¢è´¨é‡ç›´æ¥å½±å“åˆ°äº†åé¢å‚è€ƒiå¸§çš„på¸§å’ŒbçœŸçš„å›¾åƒè´¨é‡ã€‚\n6ï¼šiå¸§æ˜¯åŸºç¡€å¸§ï¼Œæ¯ä¸€ç»„é‡Œé¢åªä¼šæœ‰ä¸€ä¸ªiå¸§ã€‚\n7ï¼šiå¸§ä¸éœ€è¦å‚è€ƒè¿åŠ¨çŸ¢é‡ã€‚\n8ï¼šiå¸§æ‰€å æ•°æ®çš„ä¿¡æ¯æ¯”è¾ƒå¤§ã€‚\npå¸§ # å‰å‘é¢„æµ‹ç¼–ç å¸§ï¼Œpå¸§è¡¨ç¤ºçš„æ˜¯è¿™ä¸€å¸§è·Ÿä¹‹å‰ä¸€ä¸ªå…³é”®å¸§ï¼ˆæˆ–på¸§ï¼‰ä¹‹é—´çš„å·®åˆ«ã€‚på¸§è§£ç çš„æ—¶å€™éœ€è¦ç”¨åˆ°å‰é¢ç¼“å­˜çš„ç”»é¢å†çˆ¹åŠ ä¸Šè¿™ä¸€é˜µçš„å·®åˆ«ä¿¡æ¯ï¼Œç”Ÿæˆå®Œæ•´çš„å›¾åƒä¿¡æ¯ã€‚\npå¸§çš„é¢„æµ‹ä¸é‡æ„ã€‚på¸§æ˜¯ä»¥iå¸§ä¸ºå‚è€ƒå¸§ï¼Œåœ¨iå¸§ä¸­æ‰¾å‡ºâ€æŸç‚¹â€çš„é¢„æµ‹å€¼å’Œè¿åŠ¨çŸ¢é‡ã€‚é¢„æµ‹å·®åˆ«å€¼å’Œè¿åŠ¨çŸ¢é‡ä¸€èµ·ä¼ è¾“ï¼Œåœ¨æ¥æ”¶ç«¯æ ¹æ®è¿åŠ¨çŸ¢é‡ä»iå¸§ä¸­æ‰¾å‡ºæ¥på¸§â€æŸç‚¹â€çš„é¢„æµ‹å€¼å¹¶ä¸”ä¸å·®å€¼ç›¸å åŠ å¾—åˆ°på¸§â€æŸç‚¹â€çš„ç»“æœã€‚ä»è€Œå¾—åˆ°ä¸€ä¸ªå®Œæ•´çš„på¸§ã€‚\npå¸§çš„ç‰¹ç‚¹ # 1ï¼špå¸§æ˜¯iå¸§åé¢ç›¸éš”1~2å¸§çš„ç¼–ç å¸§ã€‚\n2ï¼špå¸§é‡‡ç”¨è¿åŠ¨è¡¥å¿çš„æ–¹æ³•ä¼ é€å®ƒä¸å‰é¢çš„iå¸§æˆ–è€…på¸§çš„å·®å€¼ä»¥åŠè¿åŠ¨çŸ¢é‡ï¼ˆé¢„æµ‹è¯¯å·®ï¼‰ã€‚\n3ï¼šè§£ç çš„æ—¶å€™å¿…é¡»å°†iå¸§ä¸­çš„é¢„æµ‹å€¼ä¸é¢„æµ‹è¯¯å·®æ±‚å’Œä¹‹åæ‰èƒ½é‡æ„å®Œæ•´çš„pçœŸå›¾åƒã€‚\n4ï¼špå¸§å±äºå‘å‰é¢„æµ‹çš„å¸§é—´ç¼–ç ï¼Œå®ƒåªå‚è€ƒé’±çˆ±ä½ æœ€é è¿‘å®ƒçš„iå¸§æˆ–è€…på¸§ã€‚\n5ï¼špå¯ä»¥æ˜¯åé¢çš„pçœŸçš„å‚è€ƒå¸§ï¼Œä¹Ÿå¯ä»¥æ˜¯åé¢çš„bçœŸçš„å‚è€ƒå¸§ã€‚\n6ï¼šçŠ¹è±«på¸§æ˜¯å‚è€ƒå¸§ï¼Œå®ƒå¯èƒ½é€ æˆè§£ç é”™è¯¯çš„æ‰©æ•£ã€‚\n7ï¼špçœŸçš„å‹ç¼©æ¯”ä¾‹æ¯”è¾ƒé«˜ã€‚ Bå¸§:åŒå‘é¢„æµ‹å†…æ’ç¼–ç å¸§ã€‚\nBå¸§ # Bå¸§æ˜¯åŒå‘å·®åˆ«å¸§ï¼Œä¹Ÿå°±æ˜¯Bå¸§è®°å½•çš„æ˜¯æœ¬å¸§ä¸å‰åå¸§çš„å·®åˆ«ï¼ˆå…·ä½“æ¯”è¾ƒå¤æ‚ï¼Œæœ‰4ç§æƒ…å†µï¼Œä½†æˆ‘è¿™æ ·è¯´ç®€å•äº›ï¼‰ï¼Œæ¢è¨€ä¹‹ï¼Œè¦è§£ç Bå¸§ï¼Œä¸ä»…è¦å–å¾—ä¹‹å‰çš„ç¼“å­˜ç”»é¢ï¼Œè¿˜è¦è§£ç ä¹‹åçš„ç”»é¢ï¼Œé€šè¿‡å‰åç”»é¢çš„ä¸æœ¬å¸§æ•°æ®çš„å åŠ å–å¾—æœ€ç»ˆçš„ç”»é¢ã€‚Bå¸§å‹ç¼©ç‡é«˜ï¼Œä½†æ˜¯è§£ç æ—¶CPUä¼šæ¯”è¾ƒç´¯ã€‚\nBå¸§çš„é¢„æµ‹ä¸é‡æ„\nBå¸§ä»¥å‰é¢çš„Iæˆ–På¸§å’Œåé¢çš„På¸§ä¸ºå‚è€ƒå¸§,â€œæ‰¾å‡ºâ€Bå¸§â€œæŸç‚¹â€çš„é¢„æµ‹å€¼å’Œä¸¤ä¸ªè¿åŠ¨çŸ¢é‡,å¹¶å–é¢„æµ‹å·®å€¼å’Œè¿åŠ¨çŸ¢é‡ä¼ é€ã€‚æ¥æ”¶ç«¯æ ¹æ®è¿åŠ¨çŸ¢é‡åœ¨ä¸¤ä¸ªå‚è€ƒå¸§ä¸­â€œæ‰¾å‡º(ç®—å‡º)â€é¢„æµ‹å€¼å¹¶ä¸å·®å€¼æ±‚å’Œ,å¾—åˆ°Bå¸§â€œæŸç‚¹â€æ ·å€¼,ä»è€Œå¯å¾—åˆ°å®Œæ•´çš„Bå¸§ã€‚\nBå¸§ç‰¹ç‚¹ # 1.Bå¸§æ˜¯ç”±å‰é¢çš„Iæˆ–På¸§å’Œåé¢çš„På¸§æ¥è¿›è¡Œé¢„æµ‹çš„;\n2.Bå¸§ä¼ é€çš„æ˜¯å®ƒä¸å‰é¢çš„Iæˆ–På¸§å’Œåé¢çš„På¸§ä¹‹é—´çš„é¢„æµ‹è¯¯å·®åŠè¿åŠ¨çŸ¢é‡;\n3.Bå¸§æ˜¯åŒå‘é¢„æµ‹ç¼–ç å¸§;\n4.Bå¸§å‹ç¼©æ¯”æœ€é«˜,å› ä¸ºå®ƒåªåæ˜ ä¸™å‚è€ƒå¸§é—´è¿åŠ¨ä¸»ä½“çš„å˜åŒ–æƒ…å†µ,é¢„æµ‹æ¯”è¾ƒå‡†ç¡®;\n5.Bå¸§ä¸æ˜¯å‚è€ƒå¸§,ä¸ä¼šé€ æˆè§£ç é”™è¯¯çš„æ‰©æ•£ã€‚\næ³¨:Iã€Bã€På„å¸§æ˜¯æ ¹æ®å‹ç¼©ç®—æ³•çš„éœ€è¦ï¼Œæ˜¯äººä¸ºå®šä¹‰çš„,å®ƒä»¬éƒ½æ˜¯å®å®åœ¨åœ¨çš„ç‰©ç†å¸§ã€‚ä¸€èˆ¬æ¥è¯´ï¼ŒIå¸§çš„å‹ç¼©ç‡æ˜¯7ï¼ˆè·ŸJPGå·®ä¸å¤šï¼‰ï¼ŒPå¸§æ˜¯20ï¼ŒBå¸§å¯ä»¥è¾¾åˆ°50ã€‚å¯è§ä½¿ç”¨Bå¸§èƒ½èŠ‚çœå¤§é‡ç©ºé—´ï¼ŒèŠ‚çœå‡ºæ¥çš„ç©ºé—´å¯ä»¥ç”¨æ¥ä¿å­˜å¤šä¸€äº›Iå¸§ï¼Œè¿™æ ·åœ¨ç›¸åŒç ç‡ä¸‹ï¼Œå¯ä»¥æä¾›æ›´å¥½çš„ç”»è´¨ã€‚\n"},{"id":92,"href":"/blog/ffmpeg/S1cmUI4qUCf/","title":"H.264NALå¤´è§£æ","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" H.264 NALå¤´è§£æ å¦‚æœNALUå¯¹åº”çš„Sliceä¸ºä¸€å¸§çš„å¼€å§‹ï¼Œåˆ™ç”¨4å­—èŠ‚è¡¨ç¤ºï¼Œå³0x00000001ï¼›å¦åˆ™ç”¨3å­—èŠ‚è¡¨ç¤ºï¼Œ0x000001ã€‚\nNAL\nHeâ€¦\nH.264 NALå¤´è§£æ å¦‚æœNALUå¯¹åº”çš„Sliceä¸ºä¸€å¸§çš„å¼€å§‹ï¼Œåˆ™ç”¨4å­—èŠ‚è¡¨ç¤ºï¼Œå³0x00000001ï¼›å¦åˆ™ç”¨3å­—èŠ‚è¡¨ç¤ºï¼Œ0x000001ã€‚\nNAL\nHeaderï¼šforbidden_bitï¼Œnal_reference_bitï¼ˆä¼˜å…ˆçº§ï¼‰2bitï¼Œnal_unit_typeï¼ˆç±»å‹ï¼‰5bitã€‚æ ‡è¯†NALå•å…ƒä¸­çš„RBSPæ•°æ®ç±»å‹ï¼Œå…¶ä¸­ï¼Œnal_unit_typeä¸º1ï¼Œ\n2ï¼Œ 3ï¼Œ 4ï¼Œ 5çš„NALå•å…ƒç§°ä¸ºVCLçš„NALå•å…ƒï¼Œå…¶ä»–ç±»å‹çš„NALå•å…ƒä¸ºéVCLçš„NALå•å…ƒã€‚\n0ï¼šæœªè§„å®š\n1ï¼šéIDRå›¾åƒä¸­ä¸é‡‡ç”¨æ•°æ®åˆ’åˆ†çš„ç‰‡æ®µ\n2ï¼šéIDRå›¾åƒä¸­Aç±»æ•°æ®åˆ’åˆ†ç‰‡æ®µ\n3ï¼šéIDRå›¾åƒä¸­Bç±»æ•°æ®åˆ’åˆ†ç‰‡æ®µ\n4ï¼šéIDRå›¾åƒä¸­Cç±»æ•°æ®åˆ’åˆ†ç‰‡æ®µ\n5ï¼šIDRå›¾åƒçš„ç‰‡æ®µ\n6ï¼šè¡¥å……å¢å¼ºä¿¡æ¯ï¼ˆSEIï¼‰\n"},{"id":93,"href":"/blog/ffmpeg/SkNmLLVcUCf/","title":"iOS FFmpegé›†æˆ","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" FFmpegæ ‡å‡†åº“\næ¦‚å¿µ:\nFFmpegæ˜¯ä¸€å¥—å¯ä»¥ç”¨æ¥è®°å½•ã€è½¬æ¢æ•°å­—éŸ³é¢‘ã€è§†é¢‘ï¼Œå¹¶èƒ½å°†å…¶è½¬åŒ–ä¸ºæµçš„å¼€æºè®¡ç®—æœºç¨‹åºã€‚\né‡‡ç”¨LGPLæˆ–GPLè®¸å¯è¯ã€‚å®ƒæä¾›äº†å½•åˆ¶â€¦\nFFmpegæ ‡å‡†åº“ # æ¦‚å¿µ: # FFmpegæ˜¯ä¸€å¥—å¯ä»¥ç”¨æ¥è®°å½•ã€è½¬æ¢æ•°å­—éŸ³é¢‘ã€è§†é¢‘ï¼Œå¹¶èƒ½å°†å…¶è½¬åŒ–ä¸ºæµçš„å¼€æºè®¡ç®—æœºç¨‹åºã€‚\né‡‡ç”¨LGPLæˆ–GPLè®¸å¯è¯ã€‚å®ƒæä¾›äº†å½•åˆ¶ã€è½¬æ¢ä»¥åŠæµåŒ–éŸ³è§†é¢‘çš„å®Œæ•´è§£å†³æ–¹æ¡ˆã€‚ å®ƒåŒ…å«äº†éå¸¸å…ˆè¿›çš„éŸ³é¢‘/è§†é¢‘ç¼–è§£ç åº“libavcodec.\nåŠŸèƒ½: # å¤šåª’ä½“è§†é¢‘å¤„ç†å·¥å…·FFmpegæœ‰éå¸¸å¼ºå¤§çš„åŠŸèƒ½åŒ…æ‹¬è§†é¢‘é‡‡é›†åŠŸèƒ½ã€è§†é¢‘æ ¼å¼è½¬æ¢ã€è§†é¢‘æŠ“å›¾ã€ç»™è§†é¢‘åŠ æ°´å°ç­‰ã€‚\n1. è§†é¢‘é‡‡é›†åŠŸèƒ½: # ffmpegè§†é¢‘é‡‡é›†åŠŸèƒ½éå¸¸å¼ºå¤§ï¼Œä¸ä»…å¯ä»¥é‡‡é›†è§†é¢‘é‡‡é›†å¡æˆ–USBæ‘„åƒå¤´çš„å›¾åƒï¼Œè¿˜å¯ä»¥è¿›è¡Œå±å¹•å½•åˆ¶ï¼ŒåŒæ—¶è¿˜æ”¯æŒä»¥RTPæ–¹å¼å°†è§†é¢‘æµä¼ é€ç»™æ”¯æŒRTSPçš„æµåª’ä½“æœåŠ¡å™¨ï¼Œæ”¯æŒç›´æ’­åº”ç”¨ã€‚\n2. è§†é¢‘æ ¼å¼è½¬æ¢åŠŸèƒ½: # ffmpegå¯ä»¥è½»æ˜“åœ°å®ç°å¤šç§è§†é¢‘æ ¼å¼ä¹‹é—´çš„ç›¸äº’è½¬æ¢(wma,rm,avi,modç­‰)ï¼Œä¾‹å¦‚å¯ä»¥å°†æ‘„å½•ä¸‹çš„è§†é¢‘aviç­‰è½¬æˆè§†é¢‘ç½‘ç«™æ‰€é‡‡ç”¨çš„flvæ ¼å¼ã€‚\n3. è§†é¢‘æˆªå›¾åŠŸèƒ½: # å¯¹äºé€‰å®šçš„è§†é¢‘ï¼Œæˆªå–æŒ‡å®šæ—¶é—´çš„ç¼©ç•¥å›¾ã€‚è§†é¢‘æŠ“å›¾ï¼Œè·å–é™æ€å›¾å’ŒåŠ¨æ€å›¾ï¼Œä¸æå€¡æŠ“gifæ–‡ä»¶;å› ä¸ºæŠ“å‡ºçš„gifæ–‡ä»¶å¤§è€Œæ’­æ”¾ä¸æµç•…ã€‚\n4. ç»™è§†é¢‘åŠ æ°´å°åŠŸèƒ½: # ä½¿ç”¨ffmpegè§†é¢‘æ·»åŠ æ°´å°(logo)ã€‚\né¡¹ç›®ç»„æˆ: # libavformatï¼šç”¨äºå„ç§éŸ³è§†é¢‘å°è£…æ ¼å¼çš„ç”Ÿæˆå’Œè§£æï¼ŒåŒ…æ‹¬è·å–è§£ç æ‰€éœ€ä¿¡æ¯ä»¥ç”Ÿæˆè§£ç ä¸Šä¸‹æ–‡ç»“æ„å’Œè¯»å–éŸ³è§†é¢‘å¸§ç­‰åŠŸèƒ½ï¼›\nlibavcodecï¼šç”¨äºå„ç§ç±»å‹å£°éŸ³/å›¾åƒç¼–è§£ç ï¼›\nlibavutilï¼šåŒ…å«ä¸€äº›å…¬å…±çš„å·¥å…·å‡½æ•°ï¼›\nlibswscaleï¼šç”¨äºè§†é¢‘åœºæ™¯æ¯”ä¾‹ç¼©æ”¾ã€è‰²å½©æ˜ å°„è½¬æ¢ï¼›\nlibpostprocï¼šç”¨äºåæœŸæ•ˆæœå¤„ç†ï¼›\nffmpegï¼šè¯¥é¡¹ç›®æä¾›çš„ä¸€ä¸ªå·¥å…·ï¼Œå¯ç”¨äºæ ¼å¼è½¬æ¢ã€è§£ç æˆ–ç”µè§†å¡å³æ—¶ç¼–ç ç­‰ï¼›\nffseverï¼šä¸€ä¸ª HTTP å¤šåª’ä½“å³æ—¶å¹¿æ’­ä¸²æµæœåŠ¡å™¨ï¼›\nffplayï¼šæ˜¯ä¸€ä¸ªç®€å•çš„æ’­æ”¾å™¨ï¼Œä½¿ç”¨ffmpeg åº“è§£æå’Œè§£ç ï¼Œé€šè¿‡SDLæ˜¾ç¤º\né›†æˆ # 1. å‰æœŸå‡†å¤‡ # ä¸‹è½½è„šæœ¬:https://github.com/libav/gas-preprocessor\nå¤åˆ¶gas-preprocessor.plåˆ°/usr/sbinä¸‹ï¼Œ(è¿™é‡Œéœ€è¦å®Œå…¨å…³é—­è‹¹æœçš„SIPå®‰å…¨åŠŸèƒ½, å…·ä½“è¯·å‚è€ƒè¿™ç¯‡æ–‡ç« \nç»ˆç«¯ä¸‹ä¿®æ”¹æ–‡ä»¶æƒé™, æŒ‡ä»¤:\nchmod 777 /usr/sbin/gas-preprocessor.p å®‰è£…yasm, æŒ‡ä»¤å¦‚ä¸‹:\n* curl http://www.tortall.net/projects/yasm/releases/yasm-1.2.0.tar.gz \u0026gt;yasm.tar.gz * tar xzvf yasm.tar.gz * cd yasm-1.2.0 * ./configure * make * sudo make install 2. ä¸‹è½½ffmpeg # ä¸‹è½½è„šæœ¬ï¼šhttps://github.com/kewlbear/FFmpeg-iOS-build-script\nè§£å‹ï¼Œæ‰¾åˆ°æ–‡ä»¶ build-ffmpeg.sh\nç¼–è¯‘å®Œæˆåï¼Œç»ˆç«¯è¿›å…¥FFmpeg-iOS-build-scriptç›®å½•ï¼Œç„¶åç»ˆç«¯è¾“å…¥ ./build-ffmpeg.sh\nlipoï¼Œè¿™ä¸ªå‘½ä»¤æ˜¯å°†.aæ–‡ä»¶åˆå¹¶æˆä¸€ä¸ª\n3. é›†æˆ # æŠŠffmpeg-iOSæ–‡ä»¶åŠ å…¥åˆ°å·¥ç¨‹ä¸­, å¼•å…¥å¤´æ–‡ä»¶ #include \u0026quot;avformat.h\u0026quot;, æ‰§è¡Œæ–¹æ³•\nav_register_all(), å¹¶ä¿®æ”¹ä»»ä¸€æ–‡ä»¶åç”± .m å˜ä¸º .mm\næ³¨ : ç¼–è¯‘çš„æ—¶å€™æŠ¥é”™ï¼š libavcodec/avcodec.h' file not found ï¼Œä¿®æ”¹ Header search paths é‡Œçš„è·¯å¾„ï¼š$(PROJECT_DIR)/FFmpeg-iOS/include\næ·»åŠ é¢å¤–çš„åº“å¼•ç”¨: libz.tbd libbz2.tbd libiconv.tbd\nç¼–è¯‘, é€šè¿‡.\n"},{"id":94,"href":"/blog/linux/SkaWUIN5U0z/","title":"linux apache mysql php ä¼˜åŒ–","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" none\nä¸€ã€å‡†å¤‡ç¯å¢ƒ # 1ã€å®‰è£…mysql # #cmake -DCMAKE_INSTALL_PREFIX=/usr/local/mysql5.5 -DMYSQL_DATADIR=/usr/local/mysql5.5/data -DSYSCONFDIR=/usr/local/mysql5.5/etc -DWITH_INNOBASE_STORAGE_ENGINE=1 -DWITH_ARCHIVE_STORAGE_ENGINE=1 -DWITH_PERFSCHEMA_STORAGE_ENGINE=1 -DDEFAULT_CHARSET=utf8 -DDEFAULT_COLLATION=utf8_general_ci -DENABLED_LOCAL_INFILE=1 -DWITH_EXTRA_CHARSETS=all #make #make install 2ã€å®‰è£…nginx # #./configure --prefix=/usr/local/nginx --http-log-path=/var/log/nginx/access.log --error-log-path=/var/log/nginx/error.log --pid-path=/var/run/nginx/nginx.pid --user=daemon --group=daemon --with-pcre #make \u0026amp;\u0026amp; make install 3ã€å®‰è£…php # #./configure --prefix=/usr/local/php5 --enable-bcmath --with-mysql=/usr/local/mysql5.5 --enable-fpm --with-fpm-user=daemon --with-fpm-group=daemon --with-config-file-path=/usr/local/php5 #make \u0026amp;\u0026amp; make install 4ã€ä½¿nginxæ”¯æŒphp # (1)nginxé…ç½® # location ~ \\.php$ { root html; fastcgi_pass 127.0.0.1:9000; fastcgi_index index.php; fastcgi_param SCRIPT_FILENAME /usr/local/nginx/html$fastcgi_script_name; include fastcgi_params; } (2)phpé…ç½® # #vim /usr/local/php5/etc/php-fpm.conf #cd /usr/local/php5/sbin #./php-fpm -c /usr/local/php5/etc/php-fpm.conf äºŒã€phpä¼˜åŒ– # æ³¨æ„ï¼šå¦‚ä½•æ·»åŠ phpåŠŸèƒ½æ¨¡å— ä¾‹ï¼šå®‰è£…mbstringå¤šå­—èŠ‚æ”¯æŒåŠŸèƒ½æ¨¡å—\n#cd /usr/src/lamp/php-5.3.10/ext \\\\è¿›å…¥è¦å®‰è£…åŠŸèƒ½æ¨¡å—æºç ç›®å½•ä¸‹ #/usr/local/php5/bin/phpize \\\\è¿è¡Œphpizeå‘½ä»¤ï¼Œç”Ÿæˆconfigureæ–‡ä»¶ #./configure --enable-mbstring --with-php-config=/usr/local/php5/bin/php-config #make #make install #vim php.ini\nextension_dir = \u0026#34;/usr/local/php5/lib/php/extensions/no-debug-non-zts-20090626\u0026#34; extension = mbstring.so 1ã€phpåŠ é€Ÿå¤„ç† # (1)å¯¹phpç›¸å…³é€‰é¡¹è¿›è¡Œè°ƒæ•´ #vim php.ini # realpath_cache_size = 32k realpath_cache_ttl = 600000 max_excution_time = 60 max_input_time = 120 memory_limit = 128M display_errors = Off (2)å®‰è£…xcache # #tar xzvf xcache-2.0.0-rc1.tar.gz #cd xcache-2.0.0-rc1 #/usr/local/php5/bin/phpize #./configure --enable-xcache --enable-xcache-constant --with-php-config=/usr/local/php5/bin/php-config #make #make install #vim php.ini\nextension_dir = \u0026#34;/usr/local/php5/lib/php/extensions/no-debug-non-zts-20090626\u0026#34; extension = xcache.so [xcache] xcache.shm_scheme = \u0026#34;mmap\u0026#34; xcache.size = 16M xcache.count = 1 xcache.slots = 8K xcache.ttl = 0 xcache.gc_interval = 0 xcache.var_size = 4M xcache.var_count = 1 xcache.var_slots = 8K xcache.var_ttl = 0 xcache.var_maxttl = 0 xcache.var_gc_interval = 300 xcache.readonly_protection = Off xcache.mmap_path = \u0026#34;/dev/zero\u0026#34; xcache.coredump_directory = \u0026#34;\u0026#34; xcache.cacher = On xcache.stat = On xcache.optimizer = Off xcache.test = Off xcache.experimental = Off [xcache.coverager] xcache.coverager = Off xcache.coveragedump_directory = \u0026#34;\u0026#34; ä¸‰ã€mysqlä¼˜åŒ– # 1ã€æŸ¥è¯¢ä¼˜åŒ– # query-cache-size = 16M query-cache-type = on | off query-cache-limit = 2M mysql\u0026gt;show status like \u0026#39;qcache%\u0026#39;; Qcache_queries_in_cache ç›®å‰mysqlç¼“å­˜çš„æ•°ç›®\nQcache_inserts æ’å…¥çš„ç¼“å­˜æ¡ç›®æ•° Qcache_hits ç¼“å­˜å‘½ä¸­ç‡\nQcache_lowmem_prunes æœ‰å¤šå°‘æ¬¡å‡ºç°ç¼“å­˜è¿‡ä½\nQcache_free_blocks ç¼“å­˜ç¢ç‰‡æ•°é‡\n2ã€æ’åºä¼˜åŒ– # sort_buffer_size = 8M è®¾å®šæ’åºç¼“å†²åŒºå¤§å° max_sort_length = 8192 è®¾å®šæ’åºé˜Ÿåˆ—é•¿åº¦å¤§å° mysql\u0026gt;show status like \u0026#39;%sort%\u0026#39;; Sort_merge_passes è¡¨ç¤ºæ’åºç®—æ³•å·²ç»å®Œæˆçš„æ’åºæ•°é‡\nSort_range è¡¨ç¤ºåœ¨æŒ‡å®šèŒƒå›´å†…çš„æ’åº\nSort_rows è¡¨ç¤ºå·²ç»æ’åºäº†å¤šå°‘è¡Œ\nSort_scan é€šè¿‡æ‰«æå®Œæˆçš„æ’åºæ•°é‡\n3ã€ç´¢å¼•ä¼˜åŒ– # key_buffer_size è®¾ç½®ç´¢å¼•ç¼“å†²åŒºå¤§å° è‡ªå®šä¹‰ç´¢å¼•ç¼“å†²åŒºå’Œè½½å…¥ç´¢å¼•\nmysql\u0026gt;set global stu.key_buffer_size=8388608; è®¾ç½®è‡ªå®šä¹‰ç¼“å†²åŒº mysql\u0026gt;load index into cache test.stu; å°†ç´¢å¼•è½½å…¥åˆ°ç³»ç»Ÿç¼“å†²åŒº mysql\u0026gt;cache index test.stu in stu; å°†ç´¢å¼•åŠ è½½åˆ°è‡ªå®šä¹‰ç¼“å†²åŒº 4ã€mysqlæ€§èƒ½ä¼˜åŒ– # concurrent_insert æ˜¯å¦å…è®¸æ•°æ®å¹¶å‘æ’å…¥ï¼Œåªå¯¹myisamå¼•æ“ thread_concurrency å®šä¹‰å¹¶å‘çº¿ç¨‹æ•°é‡\ninnodb_flush_log_log_trx_commit è®¾ç½®æ—¥å¿—å†™å…¥æ–‡ä»¶çš„æ–¹å¼ innodb_buffer_pool_size\nå®šä¹‰ç¼“å†²åŒºå¤§å°ï¼Œä¸€èˆ¬è®¾ä¸ºå†…å­˜çš„80-85%\ninnodb_buffer_pool_instance å®šä¹‰é«˜é€Ÿç¼“å†²åŒºå¯å¹¶å‘æ“ä½œçš„å®ä¾‹æ•°é‡ innodb_open_files å®šä¹‰å¯æ‰“å¼€çš„æ–‡ä»¶æ•°\n5ã€å…¶å®ƒçš„é‡ç‚¹ä¼˜åŒ–å‚æ•° # max_connections = 1024 è®¾ç½®æ•°æ®åº“å…è®¸çš„æœ€å¤§è¿æ¥æ•° max_connect_errors = 32 è¡¨ç¤ºå…è®¸çš„é”™è¯¯è¿æ¥æ•° innodb_log_file_size = 512M è®¾ç½®æ—¥å¿—æ–‡ä»¶å¤§å° innodb_max_dirty_pages_pct=80 è®¾å®šå†™å…¥ç£ç›˜çš„è„æ•°æ®å ç”¨çš„ç¼“å†²åŒºæ¯”ä¾‹ "},{"id":95,"href":"/blog/linux/HJi_UUE5ICG/","title":"linux bashæˆªå–å­—ç¬¦ä¸²çš„å‡ ç§æ–¹æ³•","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" å·æˆªå–ï¼Œåˆ é™¤å·¦è¾¹å­—ç¬¦ï¼Œä¿ç•™å³è¾¹å­—ç¬¦ # var=http://www.aaa.com/123.htm\necho ${var#*//}\nå…¶ä¸­varæ˜¯å˜é‡åï¼Œâ€¦\n# å·æˆªå–ï¼Œåˆ é™¤å·¦è¾¹å­—ç¬¦ï¼Œä¿ç•™å³è¾¹å­—ç¬¦ # var=http://www.aaa.com/123.htm echo ${var#*//} å…¶ä¸­varæ˜¯å˜é‡åï¼Œ#å·æ˜¯è¿ç®—ç¬¦ï¼Œ å·æ˜¯é€šé…ç¬¦ï¼Œ//è¡¨ç¤ºä»å·¦è¾¹å¼€å§‹åˆ é™¤ç¬¬ä¸€ä¸ªåˆ°//å¤„çš„æ‰€æœ‰å­—ç¬¦å³åˆ é™¤http://\nç»“æœæ˜¯ ï¼šwww.aaa.com/123.htm\n## å·æˆªå–ï¼Œåˆ é™¤å·¦è¾¹å­—ç¬¦ï¼Œä¿ç•™å³è¾¹å­—ç¬¦ # var=http://www.aaa.com/123.htm echo ${var##*/} ##*/ è¡¨ç¤ºä»å·¦è¾¹å¼€å§‹åˆ é™¤æœ€åï¼ˆæœ€å³è¾¹ï¼‰ä¸€ä¸ª / å·åŠå·¦è¾¹çš„æ‰€æœ‰å­—ç¬¦å³åˆ é™¤ http://www.aaa.com/\nç»“æœæ˜¯ 123.htm\n% å·æˆªå–ï¼Œåˆ é™¤å³è¾¹å­—ç¬¦ï¼Œä¿ç•™å·¦è¾¹å­—ç¬¦ # var=http://www.aaa.com/123.htm echo ${var%/*} %/* è¡¨ç¤ºä»å³è¾¹å¼€å§‹ï¼Œåˆ é™¤ç¬¬ä¸€ä¸ª / å·åŠå³è¾¹çš„å­—ç¬¦\nç»“æœæ˜¯ï¼šhttp://www.aaa.com\n%% å·æˆªå–ï¼Œåˆ é™¤å³è¾¹å­—ç¬¦ï¼Œä¿ç•™å·¦è¾¹å­—ç¬¦ # var=http://www.aaa.com/123.htm echo ${var%%/*} %%/* è¡¨ç¤ºä»å³è¾¹å¼€å§‹ï¼Œåˆ é™¤æœ€åï¼ˆæœ€å·¦è¾¹ï¼‰ä¸€ä¸ª / å·åŠå³è¾¹çš„å­—ç¬¦\nç»“æœæ˜¯ï¼šhttp:\n: å·æˆªå–ï¼Œä»å·¦è¾¹ç¬¬å‡ ä¸ªå­—ç¬¦å¼€å§‹ï¼ŒåŠå­—ç¬¦çš„ä¸ªæ•° # var=http://www.aaa.com/123.htm echo ${var:0:5} å…¶ä¸­çš„ 0 è¡¨ç¤ºå·¦è¾¹ç¬¬ä¸€ä¸ªå­—ç¬¦å¼€å§‹ï¼Œ5 è¡¨ç¤ºå­—ç¬¦çš„æ€»ä¸ªæ•°ã€‚\nç»“æœæ˜¯ï¼šhttp:\n: å·æˆªå–ï¼Œä»å·¦è¾¹ç¬¬å‡ ä¸ªå­—ç¬¦å¼€å§‹ï¼Œä¸€ç›´åˆ°ç»“æŸ # var=http://www.aaa.com/123.htm echo ${var:7} å…¶ä¸­çš„ 7 è¡¨ç¤ºå·¦è¾¹ç¬¬8ä¸ªå­—ç¬¦å¼€å§‹ï¼Œä¸€ç›´åˆ°ç»“æŸã€‚\nç»“æœæ˜¯ ï¼šwww.aaa.com/123.htm\n: å·æˆªå–ï¼Œä»å³è¾¹ç¬¬å‡ ä¸ªå­—ç¬¦å¼€å§‹ï¼ŒåŠå­—ç¬¦çš„ä¸ªæ•° # var=http://www.aaa.com/123.htm echo ${var:0-7:3} å…¶ä¸­çš„ 0-7 è¡¨ç¤ºå³è¾¹ç®—èµ·ç¬¬ä¸ƒä¸ªå­—ç¬¦å¼€å§‹ï¼Œ3 è¡¨ç¤ºå­—ç¬¦çš„ä¸ªæ•°ã€‚\nç»“æœæ˜¯ï¼š123\n: å·æˆªå–ï¼Œä»å³è¾¹ç¬¬å‡ ä¸ªå­—ç¬¦å¼€å§‹ï¼Œä¸€ç›´åˆ°ç»“æŸ # var=http://www.aaa.com/123.htm echo ${var:0-7} è¡¨ç¤ºä»å³è¾¹ç¬¬ä¸ƒä¸ªå­—ç¬¦å¼€å§‹ï¼Œä¸€ç›´åˆ°ç»“æŸã€‚\nç»“æœæ˜¯ï¼š123.htm\næ³¨ï¼šï¼ˆå·¦è¾¹çš„ç¬¬ä¸€ä¸ªå­—ç¬¦æ˜¯ç”¨ 0 è¡¨ç¤ºï¼Œå³è¾¹çš„ç¬¬ä¸€ä¸ªå­—ç¬¦ç”¨ 0-1 è¡¨ç¤ºï¼‰\n"},{"id":96,"href":"/blog/linux/rJvbIUV580z/","title":"linux crontabè®¡åˆ’ä»»åŠ¡è¯¦è§£","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" crontabå‘½ä»¤å¸¸è§äºUnixå’Œç±»Unixçš„æ“ä½œç³»ç»Ÿä¹‹ä¸­ï¼Œç”¨äºè®¾ç½®å‘¨æœŸæ€§è¢«æ‰§è¡Œçš„æŒ‡ä»¤\né…ç½®æ–‡ä»¶ # cat /etc/crontab SHELL=/bin/bash è®¡åˆ’ä»»åŠ¡çš„é»˜è®¤è„šæœ¬bash shell PATH=/sbin:/bin:/usr/sbin:/usr/bin é»˜è®¤æœç´¢è·¯å¾„ MAILTO=root å½“è®¡åˆ’ä»»åŠ¡æœ‰æ ‡å‡†è¾“å‡ºæˆ–æ ‡å‡†é”™è¯¯è¾“å‡ºæ—¶ï¼Œä¼šå°†ç»“æœå‘é‚®ä»¶ç»™root HOME=/ # run-parts 01 * * * * root run-parts /etc/cron.hourly /etc/ åé¢ä¸€å®šæ˜¯ä¸ªæ–‡ä»¶å¤¹ï¼Œæ¯å°æ—¶æ‰§è¡Œ 02 4 * * * root run-parts /etc/cron.daily 22 4 * * 0 root run-parts /etc/cron.weekly 42 4 1 * * root run-parts /etc/cron.monthly æ³¨æ„äº‹é¡¹ # å¤šä¸ªè®¡åˆ’ä»»åŠ¡ä¸å®œåŒæ—¶è¿›è¡Œé˜²æ­¢æœ‰éæ³•è®¡åˆ’ä»»åŠ¡å‘¨å’Œæ—¥ï¼Œæœˆä¸å¯åŒæ—¶å¹¶å­˜ï¼Œå®¹æ˜“å¯¼è‡´è®¡åˆ’ä»»åŠ¡æ—¶é—´æ··ä¹±\nç®€è¦è¯´æ˜ # crond\næ˜¯linuxç”¨æ¥å®šæœŸæ‰§è¡Œç¨‹åºçš„å‘½ä»¤ã€‚å½“å®‰è£…å®Œæˆæ“ä½œç³»ç»Ÿä¹‹åï¼Œé»˜è®¤ä¾¿ä¼šå¯åŠ¨æ­¤ä»»åŠ¡è°ƒåº¦å‘½ä»¤ã€‚crondå‘½ä»¤æ¯åˆ†é”ºä¼šå®šæœŸæ£€æŸ¥æ˜¯å¦æœ‰è¦æ‰§è¡Œçš„å·¥ä½œï¼Œå¦‚æœæœ‰è¦æ‰§è¡Œçš„å·¥ä½œä¾¿ä¼šè‡ªåŠ¨æ‰§è¡Œè¯¥å·¥ä½œã€‚è€Œlinuxä»»åŠ¡è°ƒåº¦çš„å·¥ä½œä¸»è¦åˆ†ä¸ºä»¥ä¸‹ä¸¤ç±»ï¼š1ã€ç³»ç»Ÿæ‰§è¡Œçš„å·¥ä½œï¼šç³»ç»Ÿå‘¨æœŸæ€§æ‰€è¦æ‰§è¡Œçš„å·¥ä½œï¼Œå¦‚å¤‡ä»½ç³»ç»Ÿæ•°æ®ã€æ¸…ç†ç¼“å­˜ã€‚2ã€ä¸ªäººæ‰§è¡Œçš„å·¥ä½œï¼šæŸä¸ªç”¨æˆ·å®šæœŸè¦åšçš„å·¥ä½œï¼Œä¾‹å¦‚æ¯éš”10åˆ†é’Ÿæ£€æŸ¥é‚®ä»¶æœåŠ¡å™¨æ˜¯å¦æœ‰æ–°ä¿¡ï¼Œè¿™äº›å·¥ä½œå¯ç”±æ¯ä¸ªç”¨æˆ·è‡ªè¡Œè®¾ç½®\ncrontabæ˜¯UNIXç³»ç»Ÿä¸‹çš„å®šæ—¶ä»»åŠ¡è§¦å‘å™¨ï¼Œå…¶ä½¿ç”¨è€…çš„æƒé™è®°è½½åœ¨ä¸‹åˆ—ä¸¤ä¸ªæ–‡ä»¶ä¸­ï¼š\næ–‡ä»¶å«ä¹‰ # /etc/cron.deny è¯¥æ–‡ä»¶ä¸­æ‰€åˆ—çš„ç”¨æˆ·ä¸å…è®¸ä½¿ç”¨Crontabå‘½ä»¤\n/etc/cron.allow è¯¥æ–‡ä»¶ä¸­æ‰€åˆ—çš„ç”¨æˆ·å…è®¸ä½¿ç”¨Crontabå‘½ä»¤\n/var/spool/cron/ æ˜¯æ‰€æœ‰ç”¨æˆ·çš„crontabæ–‡ä»¶\n/var/spool/cron/crontabs /var/spool/cron/crontabs /etc/crontab ç³»ç»Ÿè®¡åˆ’ä»»åŠ¡åˆ—è¡¨æ–‡ä»¶\nCrontabå‘½ä»¤çš„æ ¼å¼ä¸ºï¼šcrontab â€“l|-r|-e|-i [username]ï¼Œå…¶å‚æ•°å«ä¹‰å¦‚è¡¨ä¸€ï¼š å‚æ•°åç§° å«ä¹‰ ç¤ºä¾‹ -l æ˜¾ç¤ºç”¨æˆ·çš„Crontabæ–‡ä»¶çš„å†…å®¹ crontabl â€“l -i åˆ é™¤ç”¨æˆ·çš„Crontabæ–‡ä»¶å‰ç»™æç¤º crontabl -ri -r ä»Crontabç›®å½•ä¸­åˆ é™¤ç”¨æˆ·çš„Crontabæ–‡ä»¶ crontabl -r -e ç¼–è¾‘ç”¨æˆ·çš„Crontabæ–‡ä»¶ crontabl -e åŸºæœ¬æ ¼å¼ # command \u0026lt;\u0026ndash;\u0026gt; åˆ†ã€€æ—¶ã€€æ—¥ã€€æœˆã€€å‘¨ã€€å‘½ä»¤ ç¬¬1åˆ—è¡¨ç¤ºåˆ†é’Ÿ1ï½59 æ¯åˆ†é’Ÿç”¨*æˆ–è€… */1è¡¨ç¤º\nç¬¬2åˆ—è¡¨ç¤ºå°æ—¶1ï½23ï¼ˆ0è¡¨ç¤º0ç‚¹ï¼‰\nç¬¬3åˆ—è¡¨ç¤ºæ—¥æœŸ1ï½31\nç¬¬4åˆ—è¡¨ç¤ºæœˆä»½1ï½12\nç¬¬5åˆ—æ ‡è¯†å·æ˜ŸæœŸ0ï½6ï¼ˆ0è¡¨ç¤ºæ˜ŸæœŸå¤©ï¼‰\nç¬¬6åˆ—è¦è¿è¡Œçš„å‘½ä»¤\næ—¶é—´æ•°å€¼ç‰¹æ®Šè¡¨ç¤ºæ–¹æ³• # ï¼Š è¡¨ç¤ºè¯¥èŒƒå›´å†…çš„ä»»æ„æ—¶é—´ ï¼Œè¡¨ç¤ºé—´éš”çš„å¤šä¸ªä¸è¿ç»­æ—¶é—´ç‚¹\nï¼ è¡¨ç¤ºä¸€ä¸ªè¿ç»­çš„æ—¶é—´èŒƒå›´\n/n æŒ‡å®šé—´éš”çš„æ—¶é—´é¢‘ç‡\nå¸¸ç”¨ä¾‹å­ # #æ¯æ™šçš„21:30é‡å¯apache 30 21 * * * /usr/local/etc/rc.d/lighttpd restart #æ¯æœˆ1ã€10ã€22æ—¥çš„4 : 45é‡å¯apache 45 4 1,10,22 * * /usr/local/etc/rc.d/lighttpd restart #æ¯å‘¨å…­ã€å‘¨æ—¥çš„1 : 10é‡å¯apache 10 1 * * 6,0 /usr/local/etc/rc.d/lighttpd restart #æ¯å¤©18 : 00è‡³23 : 00ä¹‹é—´æ¯éš”30åˆ†é’Ÿé‡å¯apache 0,30 18-23 * * * /usr/local/etc/rc.d/lighttpd restart #æ¯ä¸ªæ˜ŸæœŸçš„æ˜ŸæœŸå…­çš„11 : 00 pmé‡å¯apache 0 23 * * 6 /usr/local/etc/rc.d/lighttpd restart #æ¯ä¸€å°æ—¶é‡å¯apache * */1 * * * /usr/local/etc/rc.d/lighttpd restart #æ¯å¤©çš„æ™šä¸Š11ç‚¹åˆ°æ—©ä¸Š7ç‚¹ä¹‹é—´ï¼Œæ¯éš”ä¸€å°æ—¶é‡å¯apache * 23-7/1 * * * /usr/local/etc/rc.d/lighttpd restart #æ¯æœˆçš„4å·ä¸æ¯å‘¨ä¸€åˆ°å‘¨ä¸‰çš„11ç‚¹é‡å¯apache 0 11 4 * mon-wed /usr/local/etc/rc.d/lighttpd restart #æ¯å¹´çš„ä¸€æœˆä¸€å·çš„4ç‚¹é‡å¯apache 0 4 1 jan * /usr/local/etc/rc.d/lighttpd restart "},{"id":97,"href":"/blog/linux/B1CLLE98CG/","title":"linux DHCPç®€å•ä½¿ç”¨æ–¹æ³•","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":"é…ç½®\nvim /etc/dhcpd.conf default-lease-time 1296000; max-lease-time 4000000; #IPæœ€é•¿å¤±æ•ˆæ—¶é—´ option subnet-mask 255.255.255.0; #å­ç½‘çš„æ©ç  option broadcast-address 192.168.0.255; #ç½‘ç»œçš„å¹¿æ’­åœ°å€ option routers 192.168.0.254; #ç½‘å…³çš„åœ°å€ option domain-name-servers 211.151.48.59,211.151.48.47; #åŸŸåè§£æåœ°å€ ddns-update-style ad-hoc; subnet 192.168.0.0 netmask 255.255.255.0 { #å®šä¹‰IPæ± çš„å†…å®¹ range 192.168.0.100 192.168.0.240; #åœ°å€èŒƒå›´ä¸º 100-240 å…±140ä¸ªIPåœ°å€ã€‚ } #ä¹Ÿå¯ä»¥è±¡ä¸‹é¢ä¸€æ ·æŒ‰MACåœ°å€æŒ‡å®šIP #host Jephe {hardware ethernet 00:a0:c9:a6:96:33;fixed-address 192.168.1.12;} è¯¦è§£ # parametersï¼ˆå‚æ•°ï¼‰ # ddns-update-style é…ç½®DHCP-DNSäº’åŠ¨æ›´æ–°æ¨¡å¼ default-lease-time æŒ‡å®šç¼ºçœç§Ÿèµæ—¶é—´çš„é•¿åº¦ï¼Œå•ä½æ˜¯ç§’ max-\nlease-time æŒ‡å®šæœ€å¤§ç§Ÿèµæ—¶é—´é•¿åº¦ï¼Œå•ä½æ˜¯ç§’ hardware æŒ‡å®šç½‘å¡æ¥å£ç±»å‹å’ŒMACåœ°å€ server-name é€šçŸ¥DHCPå®¢æˆ·æœåŠ¡å™¨åç§°\nget-lease-hostnames flag æ£€æŸ¥å®¢æˆ·ç«¯ä½¿ç”¨çš„IPåœ°å€ fixed-address ip åˆ†é…ç»™å®¢æˆ·ç«¯ä¸€ä¸ªå›ºå®šçš„åœ°å€\nauthritative æ‹’ç»ä¸æ­£ç¡®çš„IPåœ°å€çš„è¦æ±‚\ndeclarationsï¼ˆå£°æ˜ï¼‰ # shared-network ç”¨æ¥å‘ŠçŸ¥æ˜¯å¦ä¸€äº›å­ç½‘ç»œåˆ†äº«ç›¸åŒç½‘ç»œ subnet æè¿°ä¸€ä¸ªIPåœ°å€æ˜¯å¦å±äºè¯¥å­ç½‘ range èµ·å§‹IP ç»ˆæ­¢IP\næä¾›åŠ¨æ€åˆ†é…IP çš„èŒƒå›´ host ä¸»æœºåç§° å‚è€ƒç‰¹åˆ«çš„ä¸»æœº group ä¸ºä¸€ç»„å‚æ•°æä¾›å£°æ˜ allow unknown-clientsæˆ–deny\nunknown-client æ˜¯å¦åŠ¨æ€åˆ†é…IPç»™æœªçŸ¥çš„ä½¿ç”¨è€… allow bootpæˆ–deny bootp æ˜¯å¦å“åº”æ¿€æ´»æŸ¥è¯¢ allow\nbootingæˆ–deny booting æ˜¯å¦å“åº”ä½¿ç”¨è€…æŸ¥è¯¢ filename å¼€å§‹å¯åŠ¨æ–‡ä»¶çš„åç§°ï¼Œåº”ç”¨äºæ— ç›˜å·¥ä½œç«™ next-server\nè®¾ç½®æœåŠ¡å™¨ä»å¼•å¯¼æ–‡ä»¶ä¸­è£…å¦‚ä¸»æœºåï¼Œåº”ç”¨äºæ— ç›˜å·¥ä½œç«™\noptionï¼ˆé€‰é¡¹ï¼‰ # subnet-mask ä¸ºå®¢æˆ·ç«¯è®¾å®šå­ç½‘æ©ç  domain-name ä¸ºå®¢æˆ·ç«¯æŒ‡æ˜DNSåå­— domain-name-servers\nä¸ºå®¢æˆ·ç«¯æŒ‡æ˜DNSæœåŠ¡å™¨IPåœ°å€ host-name ä¸ºå®¢æˆ·ç«¯æŒ‡å®šä¸»æœºåç§° routers ä¸ºå®¢æˆ·ç«¯è®¾å®šé»˜è®¤ç½‘å…³ broadcast-address\nä¸ºå®¢æˆ·ç«¯è®¾å®šå¹¿æ’­åœ°å€ ntp-server ä¸ºå®¢æˆ·ç«¯è®¾å®šç½‘ç»œæ—¶é—´æœåŠ¡å™¨IPåœ°å€ time-offset ä¸ºå®¢æˆ·ç«¯è®¾å®šå’Œæ ¼æ—å¨æ²»æ—¶é—´çš„åç§»æ—¶é—´ï¼Œå•ä½æ˜¯ç§’ã€‚\nä¸­ç»§ # é…ç½®æ­¥éª¤ # 1ã€å¼€å¯è·¯ç”±è½¬å‘\n2ã€è®¾ç½®å°±å“¦ä¸­ç»§æ¥å£åŠDHCPæœåŠ¡å™¨åœ°å€\n3ã€å¯åŠ¨dhcprelayä¸­ç»§æœåŠ¡ç¨‹åº\nå†…æ ¸å‚æ•° # vim /etc/sysctl.conf net.ipv4.ip_forward = 1 sysctl -p ä¿®æ”¹é…ç½® # vim /etc/sysconfig/dhcrelay INTERFACES=\u0026#34;eth0 eth1\u0026#34; DHCPSERVERS=\u0026#34;192.168.1.2\u0026#34; å¯åŠ¨ # chkconfig dhcrelay on chkconfig dhcp on /etx/init.d/dhcp start /etc/init.d/dhcrelay start "},{"id":98,"href":"/blog/linux/HkiLUE5UCf/","title":"linux dnsï¼ˆnamedï¼‰æœ€å°é…ç½®","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" none\nä¸€ã€ç®€ä»‹ # ç›¸å¯¹äºå­˜å‚¨å’Œå¤§æ•°æ®é¢†åŸŸï¼ŒCDNæ˜¯ä¸€ä¸ªç›¸å¯¹å°çš„é¢†åŸŸï¼Œä½†è¡Œè¡Œå‡ºçŠ¶å…ƒï¼ŒBINDå°±æ˜¯CDNé¢†åŸŸçš„è‰è”Nå±Šçš„çŠ¶å…ƒéƒã€‚BINDæ˜¯ä¸€æ¬¾éå¸¸å¸¸ç”¨çš„DNSå¼€æºæœåŠ¡å™¨ï¼Œå…¨çƒæœ‰90%çš„DNSç”¨BINDå®ç°ã€‚å€¼å¾—ä¸€æçš„æ˜¯ï¼ŒBIND9.8.1ç”¨Cè¯­è¨€å®ç°ï¼Œä»£ç é‡å·¨å¤§ï¼Œå…¶è®¾è®¡å®ç°å‡ ä¹æ¶µç›–äº†æœåŠ¡å™¨ç¼–ç¨‹çš„æ‰€æœ‰ç»†èŠ‚ã€‚\næœ¬æ–‡ç®€è¦ä»‹ç»ä¸€ä¸‹BIND9.8.1æœ€ç®€å•é…ç½®ï¼Œå…¶ä¸­ç©¿æ’ä»‹ç»BINDä¸­çš„æœ€åŸºæœ¬æ¦‚å¿µï¼Œä¸æ¶‰åŠBINDçš„å®‰è£…éƒ¨ç½²ï¼Œä¸æ¶‰åŠBINDæ¶æ„ç­‰è¯é¢˜ã€‚\näºŒã€Zoneå’Œèµ„æºè®°å½• # ä»‹ç»æœ€ç®€é…ç½®å‰éœ€è¦æ˜ç¡®ä¸¤ä¸ªé…ç½®ä¸­çš„æ¦‚å¿µï¼šzoneå’ŒRRã€‚\nBINDçš„é…ç½®æ–‡ä»¶æè¿°äº†ä¸€ä¸ªåŸŸåæœåŠ¡å™¨çš„æ‰€æœ‰å±æ€§ï¼Œè¿™äº›å±æ€§BINDçš„è¡Œä¸ºå’ŒåŠŸèƒ½ã€‚å…¶ä¸­çš„zoneæ–‡ä»¶æè¿°äº†åŸŸåæœåŠ¡å™¨ä¸­åŒ…å«çš„ä¸»æœºï¼Œæ‰€æä¾›çš„æœåŠ¡ç±»å‹ç­‰ä¿¡æ¯ï¼ŒBINDé€šè¿‡å°†zoneæ–‡ä»¶ä¸­çš„ä¿¡æ¯åŠ è½½åˆ°å†…å­˜æ•°æ®ç»“æ„ä¸­å¹¶æœ‰æ•ˆç»„ç»‡èµ·æ¥ï¼Œç„¶åå¯¹å¤–éƒ¨çš„DNSè¯·æ±‚æä¾›éªŒè¯å’ŒæŸ¥è¯¢è¯·æ±‚ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œzoneæ–‡ä»¶çš„æ ¼å¼ä¸æ˜¯ç”±BINDåˆ¶å®šçš„ï¼Œè€Œæ˜¯DNSæ ‡å‡†æ–‡æ¡£åˆ¶å®šçš„ï¼ˆè§RFC1035ï¼‰ã€‚\né€šå¸¸æƒ…å†µä¸‹ï¼Œä¸€ä¸ªzoneæ–‡ä»¶æè¿°è¯¥DNSæœåŠ¡å™¨æœåŠ¡çš„ä¸€ä¸ªæˆæƒæœåŠ¡å™¨åŸŸã€‚ä¾‹å¦‚æˆ‘æœ‰ä¸€ä¸ªDNSæœåŠ¡å™¨å¯ä»¥è§£ætaobao.comçš„åŸŸåå’Œbaidu.comçš„åŸŸåï¼Œé‚£ä¹ˆæˆ‘çš„DNSæœåŠ¡å™¨çš„é…ç½®æ–‡ä»¶ä¸­å°±å¯ä»¥è®¾ç½®ä¸¤ä¸ªzoneæ ‡ç­¾ï¼Œä¸€ä¸ªæè¿°taobao.comçš„åŸŸåä¿¡æ¯ï¼Œå¦ä¸€ä¸ªæè¿°baidu.comçš„åŸŸåä¿¡æ¯ã€‚\nèµ„æºè®°å½•resource\nRecordè®°å½•äº†ä¸€ä¸ªåŸŸ(domain)çš„å±æ€§å’Œç‰¹æ€§ï¼Œæ³¨æ„ï¼Œå±æ€§æ˜¯æŒ‡å…±æœ‰çš„ç‰¹å¾ï¼Œç‰¹æ€§æŒ‡ç‰¹æœ‰çš„ç‰¹å¾ã€‚ä¾‹å¦‚ä¸­å›½ç‰¹è‰²ç¤¾ä¼šä¸»ä¹‰å°±æ˜¯ä¸€ä¸ªç‰¹æ€§ã€‚\nä¸‰ï¼Œnamed.confæ–‡ä»¶é…ç½® # named.confæ˜¯BINDçš„å”¯ä¸€çš„ä¸»é…ç½®æ–‡ä»¶ï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥è‡ªå·±ç¼–å†™ä¸»é…ç½®æ–‡ä»¶ï¼Œä½†æ˜¯éœ€è¦åœ¨BINDä¸»è¿›ç¨‹namedå¯åŠ¨çš„æ—¶å€™ç”¨-\ncé€‰é¡¹æŒ‡å®šä¸»é…ç½®æ–‡ä»¶çš„è·¯å¾„ã€‚named.confç”±ä¸€ä¸ªä¸ªå­å¥ç»„æˆï¼Œæ¯ä¸ªå­å¥éƒ½æœ‰ä¸€ä¸ªå¤´è·Ÿä¸€å¯¹å¤§æ‹¬å·ç»„æˆï¼Œå¤§æ‹¬å·é‡Œé¢æ˜¯è¯¥å­å¥ä¸­çš„å› å­å’Œå€¼ï¼ˆå…·ä½“è§ä¸‹é¢çš„ä¾‹å­ï¼‰ã€‚\nä¸‹é¢çš„ä»£ç æ˜¯named.confçš„ä¸€ä¸ªæœ€ç®€é…ç½®ã€‚å…¶ä¸­å‡è®¾named.confåªè´Ÿè´£è§£ææˆæƒåŸŸåcobb.comã€‚ å…¶ä¸­çš„keyæ˜¯ç”±rndc-\nconfgenç”Ÿæˆçš„ã€‚\nkey \u0026#34;rndc-key\u0026#34; { algorithm hmac-md5; secret \u0026#34;eoiWMiCwCYPwNLWxl05rNw==\u0026#34;; }; controls { inet 127.0.0.1 port 953 allow { 127.0.0.1; } keys { \u0026#34;rndc-key\u0026#34;; }; }; options { //åŸŸåæ–‡ä»¶å­˜æ”¾çš„ç»å¯¹è·¯å¾„ directory \u0026#34;/usr/local/named/var\u0026#34;; //å¦‚æœbindå¯åŠ¨ï¼Œè‡ªåŠ¨ä¼šåœ¨/usr/local/named/varç›®å½•ç”Ÿæˆä¸€ä¸ªnamed.pidæ–‡ä»¶ï¼Œæ‰“å¼€æ–‡ä»¶å°±æ˜¯namedè¿›ç¨‹çš„ID pid-file \u0026#34;named.pid\u0026#34;; }; zone \u0026#34;.\u0026#34; IN { //æ ¹åŸŸåæœåŠ¡å™¨ type hint; //å­˜æ”¾åœ¨//usr/local/named/varç›®å½•ï¼Œæ–‡ä»¶åä¸ºnamed.root file \u0026#34;named.root\u0026#34;; }; //åŸŸcobb.comçš„zoneæ–‡ä»¶ zone \u0026#34;cobb.com\u0026#34; IN { type master; //è¯¥åŸŸåæœåŠ¡å™¨æ˜¯ä¸»åŸŸåæœåŠ¡å™¨ï¼Œè¿™ä¸ªé€‰é¡¹ä¸»è¦ç”¨åœ¨ä¸»å¤‡éƒ¨ç½²ä¸­ file \u0026#34;cobb.com.zone\u0026#34;; //è§£æåŸŸåcobb.comçš„zoneæ–‡ä»¶å†…å®¹ï¼Œå…¶è·¯å¾„ç”±optionsä¸­çš„directoryæŒ‡å®š allow-update { none; }; //å®šä¹‰äº†å…è®¸å‘ä¸»zoneæ–‡ä»¶å‘é€åŠ¨æ€æ›´æ–°çš„åŒ¹é…åˆ—è¡¨ }; //åå‘è§£æ zone \u0026#34;1.168.192.in-addr.arpa\u0026#34; in { type master; //å­˜æ”¾åå‘è§£æçš„æ–‡ä»¶ file \u0026#34;cobb.com.rev\u0026#34;; allow-update { none; }; }; ä¸Šé¢çš„ä»£ç ä¸­ï¼Œcontrolså­å¥å®šä¹‰äº†æœåŠ¡å™¨çš„æ§åˆ¶é€šé“çš„ä¸€äº›ä¿¡æ¯ï¼Œæ§åˆ¶é€šé“æ˜¯namedä¸ºå¤–éƒ¨æä¾›çš„ç®¡ç†namedæœåŠ¡å™¨çš„æ¥å£ã€‚é€šå¸¸æƒ…å†µä¸‹namedéƒ½åœ¨æœ¬æœºçš„953ç«¯å£ä¸Šç›‘å¬æ§åˆ¶ä¿¡æ¯ï¼›allowè¡¨ç¤ºå…è®¸æœ¬æœºä¸Šçš„rndcæ§åˆ¶ç¨‹åºæ§åˆ¶namedæœåŠ¡å™¨ï¼Œallowå‡ºäº†æŒ‡å®šipåœ°å€å¤–ï¼Œè¿˜å¯ä»¥æŒ‡å®šaclä¸­çš„ç”¨æˆ·åœ°å€ï¼›keysè¡¨ç¤ºrndcæ§åˆ¶namedæ—¶éœ€è¦æºå¸¦çš„å¯†é’¥\nï¼Œè¿™ä¸ªå¯†é’¥ç”±rndc-genç”Ÿæˆï¼Œå¹¶åœ¨named.confä¸­åŒ…å«ã€‚\næ¥ä¸‹æ¥çš„optionsé€‰é¡¹ä¸­åŒ…å«ä¸€äº›å…¨å±€çŠ¶æ€æè¿°ï¼Œè¿™äº›æè¿°ä¿¡æ¯åœ¨æ‰€æœ‰çš„zoneæ–‡ä»¶å’Œviewä¸­å¯è§ï¼ˆviewåé¢çš„ç³»åˆ—åšå®¢ä¼šä»‹ç»ï¼‰ï¼Œä½†å¦‚æœzoneæ–‡ä»¶æˆ–viewä¸­é‡æ–°å®šä¹‰è¿™äº›æè¿°ä¿¡æ¯ï¼Œåˆ™optionsä¸­çš„ä¿¡æ¯è¢«è¦†ç›–\nã€‚ä¸Šé¢ä¾‹å­ä¸­çš„directoryå’Œpid-fileçš„å«ä¹‰è§ä»£ç æ³¨é‡Šã€‚\nå››ã€zoneæ–‡ä»¶é…ç½® # æ–‡ä»¶cobb.com.zoneæ–‡ä»¶ä½äº/usr/local/named/varä¸­ï¼Œå…¶å†…å®¹å¦‚ä¸‹æ‰€ç¤ºï¼š\n$TTL 86400 $ORIGIN cobb.com. @ IN SOA ns1 root( 2013031901 ;serial 12h ;refresh 7200 ;retry 604800 ;expire 86400 ;mininum ) NS ns1.cobb.com. NS ns2.cobb.net. MX 10 mail.cobb.com. ns1 IN A 192.168.10.1 www IN A 192.168.10.10 IN A 192.168.10.11 mail IN A 192.168.10.20 ljx IN A 192.168.10.30 ftp IN CNAME ljx ä¸Šé¢çš„é…ç½®è¡¨ç¤ºï¼š\n1ï¼‰è¯¥zoneæœ‰ä¸¤ä¸ªåŸŸåæœåŠ¡å™¨ï¼Œä¸€ä¸ªæ˜¯ns1.cobb.comï¼Œipåœ°å€æ˜¯192.168.10.1ï¼Œå¦ä¸€ä¸ªæ˜¯ns2.cobb.net(å®ƒä¸åœ¨æœ¬åŸŸå†…)ï¼›\n2ï¼‰è¯¥zoneæœ‰ä¸€ä¸ªé‚®ä»¶æœåŠ¡å™¨ï¼ŒåŸŸåæ˜¯mail.cobb.comï¼ŒIPåœ°å€æ˜¯192.168.10.20ï¼›\n3ï¼‰è¯¥zoneæœ‰ä¸¤ä¸ªå¯¹å¤–æœåŠ¡çš„ä¸‡ç»´ç½‘æœåŠ¡å™¨ï¼Œå…¶åŸŸåæ˜¯www.cobb.comï¼ŒIPåœ°å€æ˜¯192.168.10.10å’Œ192.168.10.11ï¼›\n4ï¼‰è¯¥zoneæœ‰ä¸€ä¸ªå¯¹å¤–æœåŠ¡çš„ftpæœåŠ¡å™¨ï¼Œå…¶åŸŸåæ˜¯ftp.cobb.comï¼ŒIPåœ°å€æ˜¯192.168.10.30ï¼›\n5ï¼‰è¯¥zoneæœ‰ä¸€ä¸ªä¸»æœºï¼Œå…¶åŸŸåæ˜¯ljx.cobb.comï¼ŒIPåœ°å€ä¹Ÿæ˜¯192.168.10.30ï¼› å…¶ä¸­TTLå’ŒORIGINç­‰æ ‡ç­¾åœ¨BINDä¸­å«åšæŒ‡ä»¤ã€‚\nzoneæ–‡ä»¶ä¸­çš„æ‰€æœ‰æŒ‡ä»¤éƒ½ä»¥ä¸€ä¸ª$å¼€å§‹ï¼ŒæŒ‡ä»¤ä¸»è¦ç”¨æ¥è¡¨ç¤ºzoneæ–‡ä»¶ä¸­çš„ä¸€äº›æ§åˆ¶ä¿¡æ¯ã€‚\n$TTLæŒ‡ä»¤è¡¨ç¤ºä¸€ä¸ªèµ„æºè®°å½•åœ¨å…¶ä»–DNSæœåŠ¡å™¨ä¸­ï¼ˆè¿™ä¸ªDNSæœåŠ¡å™¨æ˜¯è¯·æ±‚æœ¬BINDçš„æœåŠ¡å™¨ï¼Œä¸€èˆ¬æƒ…å†µä¸‹æ˜¯local\ndnsï¼‰çš„ç¼“å­˜æ—¶é—´ï¼Œåœ¨è¿™ä¸ªç¼“å­˜æ—¶é—´å†…ï¼Œlocal dnsï¼ˆæš‚ä¸”å…ˆè¿™ä¹ˆè®¤ä¸ºï¼Œå¥½ä¸¾ä¾‹ï¼‰ä¸ä¼šå†è¯·æ±‚BINDï¼Œè€Œæ˜¯ç›´æ¥è¿”å›åŸŸåå¯¹åº”çš„IPåœ°å€ã€‚\n$ORIGINæŒ‡ä»¤è¡¨ç¤ºè¯¥zoneæ–‡ä»¶ç”¨æ¥æè¿°çš„åŸŸ(domain)åç§°ã€‚ SOA(start of\nauthority)èµ„æºè®°å½•ï¼šå®ƒå®šä¹‰äº†ä¸€ä¸ªåŸŸçš„å…¨å±€ç‰¹æ€§ï¼Œå¿…é¡»æ˜¯å‡ºç°åœ¨zoneæ–‡ä»¶ä¸­çš„ç¬¬ä¸€ä¸ªèµ„æºè®°å½•ï¼Œè€Œä¸”ä¸€ä¸ªzoneæ–‡ä»¶ä¸­å¿…é¡»åªæœ‰ä¸€ä¸ªSOAèµ„æºè®°å½•ã€‚å…¶ä¸­SOAåé¢çš„ns1ä¸rootåˆ†åˆ«æ˜¯åŸŸåæœåŠ¡å™¨å’Œç®¡ç†å‘˜é‚®ç®±(root@cobb.com)ï¼Œå…¶å…¨å†™åˆ†åˆ«æ˜¯ns1.cobb.com.å’Œroot.cobb.comï¼Œå› ä¸º$ORIGINæŒ‡æ˜äº†åŸŸåï¼Œæ‰€ä»¥è¿™ä¸ªåœ°æ–¹å¯ä»¥ç•¥å»ã€‚\nNS(name\nserver)èµ„æºè®°å½•ï¼šå®ƒå®šä¹‰äº†ä¸ºæœ¬åŸŸ(domain)(è¿™ä¸ªä¾‹å­ä¸­æ˜¯cobb.com)æœåŠ¡çš„åŸŸåæœåŠ¡å™¨ã€‚éœ€è¦æ³¨æ„çš„æ˜¯å¤–éƒ¨åŸŸåæœåŠ¡å™¨ï¼ˆä¾‹å­ä¸­çš„ns2ï¼‰å¿…é¡»ä¸ºzone\ncobb.comåŒ…å«ä¸€ä¸ªzoneæ–‡ä»¶ã€‚\nMX(mail exchanger)èµ„æºè®°å½•ï¼šå®ƒå®šä¹‰äº†æœ¬åŸŸä¸­çš„é‚®ä»¶æœåŠ¡å™¨ã€‚è¿™ä¸ªèµ„æºè®°å½•æ˜¯å¯é€‰çš„ï¼Œå› ä¸ºä¸€ä¸ªåŸŸä¸­ä¸ä¸€å®šæœ‰é‚®ä»¶æœåŠ¡å™¨ã€‚\nA(Address)èµ„æºè®°å½•ï¼šè¿™æ˜¯ä¸ªå¾ˆå…³é”®çš„è®°å½•ã€‚å®ƒå®šä¹‰äº†zoneæ–‡ä»¶ä¸­æåˆ°çš„ä¸»æœºæˆ–æœåŠ¡çš„IPv4åœ°å€ï¼ˆIPv6åœ°å€å«AAAAè®°å½•ï¼‰ï¼Œè€Œä¸”è¿™äº›IPv4åœ°å€å¿…é¡»æ˜¯å¤–éƒ¨å¯è§çš„ã€‚ä¾‹å¦‚ä¸‡ç»´ç½‘æœåŠ¡å™¨\nwww.cobb.comçš„IPv4åœ°å€æ˜¯192.168.10.10ã€‚\nCNAMEè®°å½•ï¼šæ˜¯ä¸€ä¸ªå·²ç»å®šä¹‰äº†IPv4åœ°å€çš„ä¸»æœºçš„åˆ«åè®°å½•ã€‚é€šå¸¸ç”¨æ¥ä¸ºå·²ç»å­˜åœ¨çš„ä¸»æœºåˆ†é…ä¸€ä¸ªæˆ–å¤šä¸ªæœåŠ¡ã€‚ç¤ºä¾‹ä¸­çš„ä¸»æœºljx.cobb.comæ—¢åšä¸»æœºåˆæä¾›ftpæœåŠ¡ã€‚ä»ä¸Šé¢çš„åˆ†æå¯ä»¥çœ‹å‡ºï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä¸ç”¨CNAMEï¼Œåªéœ€è¦ä¸ºä¸åŒçš„æœåŠ¡æŒ‡å®šç›¸åŒçš„IPåœ°å€å³å¯ã€‚\nä½†æ˜¯å®é™…ä¸Šä¸¤ç§æƒ…å†µä¸‹å¿…é¡»ç”¨CNAMEè®°å½•ï¼š\n1ï¼‰çœŸæ˜¯ä¸»æœºæˆ–åˆ«åä¸»æœºåœ¨ä¸åŒçš„åŸŸä¸­ï¼Œæˆ‘ä»¬ä¸çŸ¥é“å¤–éƒ¨åŸŸä¸­çš„IPåœ°å€ï¼Œæ‰€ä»¥å¿…é¡»è¦ç”¨CNAMEï¼Œä¾‹å¦‚ftp.cobb.comæ˜¯ftp.cobb.netçš„ä¸€ä¸ªåˆ«åï¼Œä½†æ˜¯åœ¨åŸŸcobb.comä¸­æ— æ³•çŸ¥é“ftp.cobb.netçš„IPåœ°å€ï¼Œåªèƒ½ç”¨CNAMEè®°å½•ï¼›\n2ï¼‰ç”¨æˆ·å¸Œæœ›è®¿é—®ä¸€ä¸ªç«™ç‚¹æ—¶ç”¨cobb.comäº§ç”Ÿwww.cobb.comçš„æ•ˆæœï¼Œè¿™æ—¶æˆ‘ä»¬éœ€è¦æœ‰å¦‚ä¸‹çš„CNAMEå®šä¹‰ï¼š\n; å®šä¹‰ä¸€ä¸ªè§£æcobb.comçš„IPåœ°å€ IN A cobb.com ; ä¸ºwww.cobb.comå»ºç«‹åˆ«åcobb.com www IN A cobb.com. å½“ç„¶ï¼Œä¸Šé¢ä»‹ç»çš„åªæ˜¯ä¸€ä¸ªæœ€å°é…ç½®ï¼Œä½†æ˜¯å·²ç»åŒ…å«äº†å¤§éƒ¨åˆ†æƒ…å†µä¸‹æˆ‘ä»¬éœ€è¦é…ç½®çš„é€‰é¡¹ã€‚æ›´å¤šçš„é…ç½®é€‰é¡¹è¯·å‚è§ï¼šhttp://www.zytrax.com/books/dns/ch7/view.html äº” å‚è€ƒæ–‡çŒ® # 1ï¼Œã€ŠPro_DNS_and_BINDã€‹\n2ï¼Œhttp://www.zytrax.com/books/dns/ch7/view.html\n3ï¼Œhttp://www.cnblogs.com/cobbliu/archive/2013/03/19/2970311.html åŸæ–‡åœ°å€ï¼šç›´è¾¾\n"},{"id":99,"href":"/blog/linux/B1OZ8INcIAM/","title":"linux mountå‘½ä»¤è¯¦è§£","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" åŠŸèƒ½ # åŠ è½½æŒ‡å®šçš„æ–‡ä»¶ç³»ç»Ÿã€‚\nè¯­æ³• # mount [-afFhnrvVw] [-L] [-o] [-t] [è®¾å¤‡å] [åŠ è½½ç‚¹]\nç”¨æ³• # è¯´æ˜ï¼šmountå¯å°†æŒ‡å®šè®¾å¤‡ä¸­æŒ‡å®šçš„æ–‡ä»¶ç³»ç»ŸåŠ è½½åˆ°Linuxç›®å½•ä¸‹ï¼ˆä¹Ÿå°±æ˜¯è£…è½½ç‚¹ï¼‰ã€‚å¯å°†ç»å¸¸ä½¿ç”¨çš„è®¾å¤‡å†™å…¥æ–‡ä»¶/etc/fastab,ä»¥ä½¿ç³»ç»Ÿåœ¨æ¯æ¬¡å¯åŠ¨æ—¶è‡ªåŠ¨åŠ è½½ã€‚mountåŠ è½½è®¾å¤‡çš„ä¿¡æ¯è®°å½•åœ¨/etc/mtabæ–‡ä»¶ä¸­ã€‚ä½¿ç”¨umountå‘½ä»¤å¸è½½è®¾å¤‡æ—¶ï¼Œè®°å½•å°†è¢«æ¸…é™¤ã€‚\nå¸¸ç”¨å‚æ•°å’Œé€‰é¡¹ # -a åŠ è½½æ–‡ä»¶/etc/fstabä¸­è®¾ç½®çš„æ‰€æœ‰è®¾å¤‡ã€‚\n-f ä¸å®é™…åŠ è½½è®¾å¤‡ã€‚å¯ä¸-vç­‰å‚æ•°åŒæ—¶ä½¿ç”¨ä»¥æŸ¥çœ‹mountçš„æ‰§è¡Œè¿‡ç¨‹ã€‚\n-F éœ€ä¸-aå‚æ•°åŒæ—¶ä½¿ç”¨ã€‚æ‰€æœ‰åœ¨/etc/fstabä¸­è®¾ç½®çš„è®¾å¤‡ä¼šè¢«åŒæ—¶åŠ è½½ï¼Œå¯åŠ å¿«æ‰§è¡Œé€Ÿåº¦ã€‚\n-h æ˜¾ç¤ºåœ¨çº¿å¸®åŠ©ä¿¡æ¯ã€‚\n-L åŠ è½½æ–‡ä»¶ç³»ç»Ÿæ ‡ç­¾ä¸ºçš„è®¾å¤‡ã€‚\n-n ä¸å°†åŠ è½½ä¿¡æ¯è®°å½•åœ¨/etc/mtabæ–‡ä»¶ä¸­ã€‚\n-o æŒ‡å®šåŠ è½½æ–‡ä»¶ç³»ç»Ÿæ—¶çš„é€‰é¡¹ã€‚æœ‰äº›é€‰é¡¹ä¹Ÿå¯åœ¨/etc/fstabä¸­ä½¿ç”¨ã€‚è¿™äº›é€‰é¡¹åŒ…æ‹¬ï¼š\nasync ä»¥éåŒæ­¥çš„æ–¹å¼æ‰§è¡Œæ–‡ä»¶ç³»ç»Ÿçš„è¾“å…¥è¾“å‡ºåŠ¨ä½œã€‚\natime æ¯æ¬¡å­˜å–éƒ½æ›´æ–°inodeçš„å­˜å–æ—¶é—´ï¼Œé»˜è®¤è®¾ç½®ï¼Œå–æ¶ˆé€‰é¡¹ä¸ºnoatimeã€‚\nauto å¿…é¡»åœ¨/etc/fstabæ–‡ä»¶ä¸­æŒ‡å®šæ­¤é€‰é¡¹ã€‚æ‰§è¡Œ-aå‚æ•°æ—¶ï¼Œä¼šåŠ è½½è®¾ç½®ä¸ºautoçš„è®¾å¤‡ï¼Œå–æ¶ˆé€‰å–ä¸ºnoautoã€‚\ndefaults ä½¿ç”¨é»˜è®¤çš„é€‰é¡¹ã€‚é»˜è®¤é€‰é¡¹ä¸ºrwã€suidã€devã€execã€anto nouserä¸asyncã€‚\ndev å¯è¯»æ–‡ä»¶ç³»ç»Ÿä¸Šçš„å­—ç¬¦æˆ–å—è®¾å¤‡ï¼Œå–æ¶ˆé€‰é¡¹ä¸ºnodevã€‚\nexec å¯æ‰§è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå–æ¶ˆé€‰é¡¹ä¸ºnoexecã€‚\ndata=writeback ä¸è®°å½•ç£ç›˜çš„æ—¥å¿—\ndata=ordered åªè®°å½•ä¸»è¦çš„æ—¥å¿—\ndata=journal è®°å½•æ‰€æœ‰çš„æ—¥å¿—\nnoatime æ¯æ¬¡å­˜å–æ—¶ä¸æ›´æ–°inodeçš„å­˜å–æ—¶é—´ã€‚\nnoauto æ— æ³•ä½¿ç”¨-aå‚æ•°æ¥åŠ è½½ã€‚\nnodev ä¸è¯»æ–‡ä»¶ç³»ç»Ÿä¸Šçš„å­—ç¬¦æˆ–å—è®¾å¤‡ã€‚\nnoexec æ— æ³•æ‰§è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶ã€‚\nnosuid å…³é—­set-user-identifier(è®¾ç½®ç”¨æˆ·ID)ä¸set-group-identifer(è®¾ç½®ç»„ID)è®¾ç½®ä½ã€‚\nnouser ä½¿ä¸€èˆ¬ç”¨æˆ·æ— æ³•æ‰§è¡ŒåŠ è½½æ“ä½œï¼Œé»˜è®¤è®¾ç½®ã€‚\nremount é‡æ–°åŠ è½½è®¾å¤‡ã€‚é€šå¸¸ç”¨äºæ”¹å˜è®¾å¤‡çš„è®¾ç½®çŠ¶æ€ã€‚\nro ä»¥åªè¯»æ¨¡å¼åŠ è½½ã€‚\nrw ä»¥å¯è¯»å†™æ¨¡å¼åŠ è½½ã€‚\nsuid å¯åŠ¨set-user-identifier(è®¾ç½®ç”¨æˆ·ID)ä¸set-group-identifer(è®¾ç½®ç»„ID)è®¾ç½®ä½ï¼Œå–æ¶ˆé€‰é¡¹ä¸ºnosuidã€‚\nsync ä»¥åŒæ­¥æ–¹å¼æ‰§è¡Œæ–‡ä»¶ç³»ç»Ÿçš„è¾“å…¥è¾“å‡ºåŠ¨ä½œã€‚\nuser å¯ä»¥è®©ä¸€èˆ¬ç”¨æˆ·åŠ è½½è®¾å¤‡ã€‚\n-r ä»¥åªè¯»æ–¹å¼åŠ è½½è®¾å¤‡ã€‚\n-t æŒ‡å®šè®¾å¤‡çš„æ–‡ä»¶ç³»ç»Ÿç±»å‹ã€‚å¸¸ç”¨çš„é€‰é¡¹è¯´æ˜æœ‰ï¼š\nminix Linuxæœ€æ—©ä½¿ç”¨çš„æ–‡ä»¶ç³»ç»Ÿã€‚\next2 Linuxç›®å‰çš„å¸¸ç”¨æ–‡ä»¶ç³»ç»Ÿã€‚\nmsdos MS-DOS çš„ FATã€‚\nvfat Win85/98 çš„ VFATã€‚\nnfs ç½‘ç»œæ–‡ä»¶ç³»ç»Ÿã€‚\niso9660 CD-ROMå…‰ç›˜çš„æ ‡å‡†æ–‡ä»¶ç³»ç»Ÿã€‚\nntfs Windows NTçš„æ–‡ä»¶ç³»ç»Ÿã€‚\nhpfs OS/2æ–‡ä»¶ç³»ç»Ÿã€‚Windows NT 3.51ä¹‹å‰ç‰ˆæœ¬çš„æ–‡ä»¶ç³»ç»Ÿã€‚\nauto è‡ªåŠ¨æ£€æµ‹æ–‡ä»¶ç³»ç»Ÿã€‚\n-v æ‰§è¡Œæ—¶æ˜¾ç¤ºè¯¦ç»†çš„ä¿¡æ¯ã€‚\n-V æ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯ã€‚\n-w ä»¥å¯è¯»å†™æ¨¡å¼åŠ è½½è®¾å¤‡ï¼Œé»˜è®¤è®¾ç½®ã€‚\nå¸è½½æ•…éšœ # æ•…éšœåŸå›  éœ€è¦å¸è½½çš„è®¾å¤‡æ­£åœ¨è¢«ä½¿ç”¨ ç°è±¡ï¼šæç¤ºï¼šâ€œâ€¦device is busyâ€\nè§£å†³æ€è·¯ # å°†å·¥ä½œç›®å½•åˆ‡æ¢åˆ°æŒ‚è½½ç‚¹ä»¥å¤–ï¼Œé€€å‡ºæ­£åœ¨ä½¿ç”¨è¯¥è®¾å¤‡çš„ç¨‹åºï¼Œä½¿ç”¨fuserå‘½ä»¤æ‰¾å‡ºç›¸å…³è¿›ç¨‹ï¼Œç»“æŸè¯¥è¿›ç¨‹ã€‚\n"},{"id":100,"href":"/blog/linux/rJJe8UNcU0M/","title":"linux nfsé…ç½®åŠè®¿é—®æ§åˆ¶","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" NFSè½¯ä»¶åŒ… # nfs-utils portmap (rhel6æ¢æˆäº†rpcbind ,æ‰€ä»¥å¯åŠ¨æœåŠ¡æ—¶éœ€è¦æ³¨æ„)\nNFSæ–‡ä»¶ # /etc/exports #NFSä¸»é…ç½®æ–‡ä»¶ /etc/init.d/nfs #NFSå¯åŠ¨è„šæœ¬ /etc/init.d/protmap\n#portmapå¯åŠ¨è„šæœ¬ /var/lib/*tab #NFSæ—¥å¿—æ–‡ä»¶\nä¹¦å†™è§„åˆ™ # ç›®å½•å(ç»å¯¹è·¯å¾„) å®¢æˆ·ç«¯ä¸»æœºåã€IPæˆ–â€œ*â€(é€‰é¡¹) é€‰é¡¹å¯é€‰æ‹©å¦‚ä¸‹ï¼š\nsyncï¼šè®¾ç½®NFSæœåŠ¡å™¨åŒæ­¥å†™ç£ç›˜,è¿™æ ·ä¸ä¼šè½»æ˜“ä¸¢å¤±æ•°æ®,å»ºè®®æ‰€æœ‰çš„NFSå…±äº«ç›®å½•ä½¿ç”¨è¯¥é€‰é¡¹. roï¼šè®¾ç½®è¾“å‡ºçš„å…±äº«ç›®å½•ä¸ºåªè¯»ï¼Œä¸rwä¸èƒ½åŒæ—¶ä½¿ç”¨ã€‚\nrwï¼šè®¾ç½®è¾“å‡ºçš„å…±äº«ç›®å½•ä¸ºå¯è¯»å†™ï¼Œä¸roä¸èƒ½åŒæ—¶ä½¿ç”¨ã€‚ root_squashï¼šrootç”¨æˆ·è®¿é—®å…±äº«ç›®å½•çš„èº«ä»½ä¼šè‡ªåŠ¨å˜æˆnobodyèº«ä»½ã€‚\nno_root_squashï¼šrootç”¨æˆ·ä¼šä»¥è‡ªå·±çš„çœŸå®èº«ä»½è®¿é—®å…±äº«ç›®å½•ï¼Œä¸å®‰å…¨ï¼Œä¸å»ºè®®ä½¿ç”¨ã€‚ æ›´å¤šé€‰é¡¹å¯åœ¨ç½‘ä¸ŠæŸ¥\nshowmount # showmountå‘½ä»¤ç”¨äºæŸ¥è¯¢æ˜¾ç¤ºNFSæœåŠ¡å™¨çš„ç›¸å…³ä¿¡æ¯ æ˜¾ç¤ºNFSæœåŠ¡å™¨çš„è¾“å‡ºç›®å½•åˆ—è¡¨ æ˜¾ç¤ºå½“å‰æœ¬æœºä¸­NFSæœåŠ¡å™¨è¾“å‡ºåˆ—è¡¨\nshowmount -e æ˜¾ç¤ºæŒ‡ç‚¹NFSæœåŠ¡å™¨ä¸­çš„å…±äº«ç›®å½•åˆ—è¡¨\nshowmount -e IP é˜²ç«å¢™é…ç½® # nfsdï¼š2049 rhel5 portmapï¼š111 rhel6 rpcbindï¼š111\nrquotad,mountd,sratdå’Œlockdå¯ä»¥å¼ºåˆ¶ä½¿ç”¨ä¸€ä¸ªå¤§äº1024çš„é™æ€ç«¯å£\nä¿®æ”¹/etc/sysconfig/nfsæ–‡ä»¶ QUOTAD_PORT=40001 #rpc.quotadè¿›ç¨‹ç«¯å£ LOCKD_TCPPORT=40002 #rpc.lockdè¿›ç¨‹ç«¯å£ LOCKD_UDPPORT=40002 MOUNTD_PORT=40003 #rpc.mountdè¿›ç¨‹ç«¯å£ STARTD_PORT=40004 #rpc.sratdè¿›ç¨‹ç«¯å£ exportfs # ä¿®æ”¹äº†/etc/exportsæ–‡ä»¶ä¸éœ€è¦é‡å¯nfsï¼Œåªè¦é‡æ–°åŠ è½½/etc/exportsæ–‡ä»¶å³å¯ã€‚\n-aï¼šå…¨éƒ¨æŒ‚è½½ï¼ˆæˆ–å¸è½½ï¼‰/etc/exportsæ–‡ä»¶å†…çš„è®¾å®šã€‚\n-rï¼šé‡æ–°åŠ è½½/etc/exportsä¸­çš„è®¾ç½®ï¼Œæ­¤å¤–åŒæ­¥æ›´æ–°/etc/exportsåŠ/var/lib/nfs/xtabä¸­çš„å†…å®¹ã€‚\n-uï¼šå¸è½½æŸä¸€ç›®å½•ã€‚\n-vï¼šåœ¨exportæ—¶å°†å…±äº«çš„ç›®å½•æ˜¾ç¤ºåœ¨å±å¹•ä¸Šã€‚\nå¸¸ç”¨ç»„åˆ # exportfs -rv (é‡æ–°åŠ è½½é…ç½®å¹¶è¾“å‡ºå½“å‰å…±äº«çš„ç›®å½•)\nexportfs -auv (åœæ­¢å½“å‰ä¸»æœºä¸­NFSæœåŠ¡å™¨çš„æ‰€æœ‰è¾“å‡ºç›®å½•)\næœåŠ¡é…ç½® # vim /etc/exports /home/share 10.1.1.2(sync,rw) *(sync,ro) linuxä½¿ç”¨ # mount -t nfs ipåœ°å€:/home/share/ /mnt Windwosä½¿ç”¨ # Windows 7æˆ–Windows 2008æ”¯æŒNFSå®¢æˆ·ç«¯,NFSæœåŠ¡ç«¯åªæœ‰Windows Serverç‰ˆæœ¬æ”¯æŒ\nshowmount -e 10.1.1.1 mount \\\\10.1.1.1\\share Z: éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œmount æŒ‚è½½ç‚¹å’ŒLinuxåŠUNIXæœ‰æ‰€ä¸åŒï¼Œä¸æ˜¯ä½¿ç”¨ä¸€ä¸ªç›®å½•ä½œä¸ºæŒ‚è½½ç‚¹ï¼Œè€Œæ˜¯ä½¿ç”¨ä¸€ä¸ªæœªè¢«ä½¿ç”¨çš„ç›˜ç¬¦ã€‚\n"},{"id":101,"href":"/blog/linux/SJ68UEcUCM/","title":"linux openssh å¸¸è§é—®é¢˜æ±‡æ€»","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" è½¯ä»¶åŒ…å\nopenssh-server openssh-clients\næœåŠ¡åï¼šsshd\næœåŠ¡ç«¯é…ç½®æ–‡ä»¶ï¼š/etc/ssh/sshd.config å®¢æˆ·ç«¯â€¦\nè½¯ä»¶åŒ…å # openssh-server openssh-clients\næœåŠ¡åï¼šsshd # æœåŠ¡ç«¯é…ç½®æ–‡ä»¶ï¼š/etc/ssh/sshd.config å®¢æˆ·ç«¯é…ç½®æ–‡ä»¶ï¼š/etc/ssh/ssh.config\nå¯åŠ¨æœåŠ¡ # server sshd start æ–‡ä»¶è¯´æ˜ # ~/.ssh/known_hosts #å­˜æ”¾è®¿é—®è¿‡çš„æœåŠ¡å™¨çš„å…¬é’¥ ~/.ssh/authorized_keys #å­˜æ”¾éœ€è¦éªŒè¯çš„å®¢æˆ·æœºçš„å…¬é’¥ å¸¸è§é—®é¢˜ # 1ã€sshè®¿é—®æ…¢ # åŸå› ï¼šè®¿é—®æœåŠ¡å™¨çš„æ—¶å€™ä¼šæŠŠæœåŠ¡å™¨çš„IPåœ°å€åå‘è§£æä¸ºåŸŸåï¼Œå¦‚æœæ— æ³•è§£æå°±ä¼šå¯¼è‡´ç™»é™†æ—¶å¾ˆæ…¢ã€‚ ä¸‹é¢å‡ ç§æ–¹æ³•éƒ½å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜\n1ã€æ¸…ç©º/etc/resolv.confæ–‡ä»¶ä¸­çš„nameserverè®°å½• 2ã€åœ¨å®¢æˆ·æœºçš„/etc/hostsæ–‡ä»¶ä¸­æ·»åŠ æœåŠ¡å™¨åŸŸåçš„è§£æè®°å½•\n3ã€ä¿®æ”¹å®¢æˆ·ç«¯çš„/etc/ssh/ssh.configæ–‡ä»¶ GSSAPLAuthentication no\n4ã€ä¿®æ”¹æœåŠ¡ç«¯çš„/etc/ssh/sshd.configæ–‡ä»¶ UserDNS no\n2ã€~/.sshæƒé™ # .sshç›®å½•å’Œä¸‹é¢çš„æ–‡ä»¶æƒé™ï¼Œç»„å’Œå…¶ä»–äººä¸èƒ½æœ‰wçš„æƒé™ è§£å†³æ–¹æ³•ï¼šé™ä½ç¬¬æœåŠ¡ç«¯çš„æƒé™æ£€æŸ¥\nvim /etc/ssh/sshd_config StrictModes no 3ã€ç¬¬ä¸€æ¬¡è®¿é—®sshserveræ—¶ä¸ç”¨è¾“å…¥yes # ssh -o StrictHostKeyChecking=no username@sshserver vim /etc/ssh/ssh.config StrictHostKeyChecking=no å…¬é’¥è®¤è¯ # ssh-keygen -t rsa #æŒ‡å®šrsaç®—æ³• åœ¨~/.ssh/ä¸‹ç”Ÿäº§ä¸¤ä¸ªæ–‡ä»¶ id_rsaç”¨æˆ·çš„ç§é’¥ id_rsa.pubç”¨æˆ·çš„å…¬é’¥ssh-\ncopy-id -i ~/.ssh/id_rsa.pub username@sshserver\nscpä½¿ç”¨ # scp ç”¨æˆ·å@æœåŠ¡å™¨åœ°å€:æ–‡ä»¶ æœ¬åœ°è·¯å¾„ scp æœ¬åœ°æ–‡ä»¶ ç”¨æˆ·å@æœåŠ¡å™¨åœ°å€:ç›®æ ‡è·¯å¾„\nsftpä½¿ç”¨ # sftp ç”¨æˆ·å@æœåŠ¡å™¨åœ°å€\ntcp_wrappersè®¿é—®æ§åˆ¶ # æ£€æŸ¥æŸä¸ªæœåŠ¡æ˜¯å¦å—tcp_wrappersç®¡ç†æ”¯æŒ\nldd $(which sshd)|grep libwrap å…ˆæ£€æŸ¥/etc/hosts.allowç„¶åæ£€æŸ¥/etc/hosts.deny å¦‚æœä¸¤ä¸ªæ–‡ä»¶éƒ½æ²¡æœ‰åŒ¹é…çš„è§„åˆ™ï¼Œåˆ™æ”¾è¡Œã€‚\nsshd:all EXCEPT 192.168.0.0/255.255.255.0 å¯ä»¥ä½¿ç”¨allã€?ã€* é˜»æŒ¡æ‰€æœ‰ä½†æ’é™¤192.168.0.0ç½‘æ®µ\n"},{"id":102,"href":"/blog/linux/rkxlI845IAz/","title":"linux sambaé…ç½®åŠä¹±ç çš„è§£å†³æ–¹æ³•","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" ç®€è¦è¯´æ˜ # sambaï¼šè¿™ä¸ªè½¯ä½“ä¸»è¦æä¾›äº†SMBä¼ºæœå™¨æ‰€éœ€çš„å„é¡¹æœåŠ¡ç¨‹å¼(smbdåŠnmbd)ã€çš„æ–‡ä»¶æ¡£ã€ä»¥åŠå…¶ä»–ä¸SAMBAç›¸å…³çš„logrotateè®¾å®šæ¡£åŠå¼€æœºé¢„è®¾é€‰é¡¹æ¡£æ¡ˆç­‰ï¼›\nsamba-clientï¼šè¿™ä¸ªè½¯ä½“åˆ™æä¾›äº†å½“Linuxåšä¸ºSAMBA\nClientç«¯æ—¶ï¼Œæ‰€éœ€è¦çš„å·¥å…·æŒ‡ä»¤ï¼Œä¾‹å¦‚æŒ‚è½½SAMBAæ¡£æ¡ˆæ ¼å¼çš„mount.cifsã€å–å¾—ç±»ä¼¼ç½‘èŠ³ç›¸å…³æ ‘çŠ¶å›¾çš„smbtreeç­‰ç­‰ï¼›\nsamba-commonï¼šè¿™ä¸ªè½¯ä½“æä¾›çš„åˆ™æ˜¯ä¼ºæœå™¨ä¸ç”¨æˆ·ç«¯éƒ½ä¼šä½¿ç”¨åˆ°çš„èµ„æ–™ï¼ŒåŒ…æ‹¬SAMBAçš„ä¸»è¦è®¾å®šæ¡£(smb.conf)ã€è¯­æ³•æ£€éªŒæŒ‡ä»¤(testparm)ç­‰ç­‰ï¼›\n/var/lib/samba/private/{passdb.tdb,secrets.tdb}ï¼šç®¡ç†Sambaçš„ä½¿ç”¨è€…å¸å·/å¯†ç æ—¶ï¼Œä¼šç”¨åˆ°çš„èµ„æ–™åº“æ¡£æ¡ˆï¼›\næœåŠ¡é…ç½® # vim /etc/samba/smb.conf\n[share] path = /share //å…±äº«çš„ç›®å½• writable = yes //æ˜¯å¦å¯å†™ write list = test // testç”¨æˆ·å¯ä»¥è®¿é—®è¯¥å…±äº« è®¿é—®æ§åˆ¶ # max connections = æœ€å¤§è¿æ¥æ•° deadtime = æ–­æ‰è¿æ¥æ—¶é—´ï¼ˆåˆ†é’Ÿï¼‰ã€0ä¸ºä¸é™åˆ¶ã€‘ hosts deny = IP ã€åŸŸåã€except hosts allow = IP ã€åŸŸåã€except ç”¨æˆ·æ§åˆ¶ # public = no #ä¸å…è®¸åŒ¿åç”¨æˆ·è®¿é—® browseable = no #éšè—ç›®å½• ï¼ˆçŸ¥é“ç›®å½•åŒæ ·å¯ä»¥è®¿é—®ï¼‰ valid users = ç”¨æˆ·æˆ–åˆ—è¡¨æˆ–@ç”¨æˆ·ç»„ writable = yes #å¯å†™ï¼ˆç›®å½•æœ¬èº«è¦å¯å†™ï¼‰ weite list = ç”¨æˆ·æˆ–åˆ—è¡¨æˆ–@ç”¨æˆ·ç»„ read only = yes #åªè¯»è®¾ç½® create mask = 0744 #æ§åˆ¶å®¢æˆ·æœºåˆ›å»ºæ–‡ä»¶çš„æƒé™ directory mask = 0744 # æ§åˆ¶å®¢æˆ·æœºåˆ›å»ºç›®å½•çš„æƒé™ å®‰å…¨çº§åˆ« # sambaæœåŠ¡å™¨çš„å®‰å…¨çº§åˆ«åˆ†ä¸º5ç§ï¼Œåˆ†åˆ«æ˜¯userã€shareã€serverã€domainå’Œadsã€‚\nåœ¨è®¾ç½®ä¸åŒçš„çº§åˆ«æ—¶ï¼ŒsambaæœåŠ¡å™¨è¿˜ä¼šä½¿ç”¨å£ä»¤æœåŠ¡å™¨å’ŒåŠ å¯†å£ä»¤ã€‚\n1ã€user â€”â€“å®¢æˆ·ç«¯è®¿é—®æœåŠ¡å™¨æ—¶éœ€è¦è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ï¼Œé€šè¿‡éªŒè¯åï¼Œæ‰èƒ½ä½¿ç”¨æœåŠ¡å™¨çš„å…±äº«èµ„æºã€‚æ­¤çº§åˆ«ä½¿ç”¨åŠ å¯†çš„æ–¹å¼ä¼ é€å¯†ç ã€‚\n2ã€share â€”â€“å®¢æˆ·ç«¯è¿æ¥æœåŠ¡å™¨æ—¶ä¸éœ€è¦è¾“å…¥ç”¨æˆ·åå’Œå¯†ç \n3ã€server â€”â€“å®¢æˆ·ç«¯åœ¨è®¿é—®æ—¶åŒæ ·éœ€è¦è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ï¼Œä½†æ˜¯ï¼Œå¯†ç éªŒè¯éœ€è¦å¯†ç éªŒè¯æœåŠ¡å™¨æ¥è´Ÿè´£ã€‚\n4ã€domain â€”â€“é‡‡ç”¨åŸŸæ§åˆ¶å™¨å¯¹ç”¨æˆ·è¿›è¡Œèº«ä»½éªŒè¯\n5ã€ads â€”â€“è‹¥sambaæœåŠ¡å™¨åŠ å…¥åˆ°Windowsæ´»åŠ¨ç›®å½•ä¸­ï¼Œåˆ™ä½¿ç”¨adså®‰å…¨çº§åˆ«ï¼Œadså®‰å…¨çº§åˆ«ä¹Ÿå¿…é¡»æŒ‡å®šå£ä»¤æœåŠ¡å™¨\nå¯åŠ¨æœåŠ¡ # service smb reload ç®¡ç†å·¥å…· # ä¿®æ”¹å®Œé…ç½®æ–‡ä»¶åï¼Œå¯åŠ¨æœåŠ¡ï¼Œç„¶åæ·»åŠ Sambaç”¨æˆ·ï¼ˆpdbedit -a ç”¨æˆ·åï¼‰\nä½¿ç”¨pdbeditæŒ‡ä»¤åŠŸèƒ½ é€‰é¡¹ä¸å‚æ•°ï¼š\n-L ï¼šåˆ—å‡ºç›®å‰åœ¨èµ„æ–™åº“å½“ä¸­çš„å¸å·ä¸UID ç­‰ç›¸å…³èµ„è®¯ï¼›\n-v ï¼šéœ€è¦æ­é…-L æ¥æ‰§è¡Œï¼Œå¯åˆ—å‡ºæ›´å¤šçš„è®¯æ¯ï¼ŒåŒ…æ‹¬å®¶ç›®å½•ç­‰èµ„æ–™ï¼›\n-w ï¼šéœ€è¦æ­é…-L æ¥æ‰§è¡Œï¼Œä½¿ç”¨æ—§ç‰ˆçš„smbpasswd æ ¼å¼æ¥æ˜¾ç¤ºèµ„æ–™ï¼›\n-a ï¼šæ–°å¢ä¸€ä¸ªå¯ä½¿ç”¨Samba çš„å¸å·ï¼Œåé¢çš„å¸å·éœ€è¦åœ¨/etc/passwd å†…å­˜åœ¨è€…ï¼›\n-r ï¼šä¿®æ”¹ä¸€ä¸ªå¸å·çš„ç›¸å…³èµ„è®¯ï¼Œéœ€æ­é…å¾ˆå¤šç‰¹æ®Šå‚æ•°ï¼Œè¯·man pdbeditï¼›\n-x ï¼šåˆ é™¤ä¸€ä¸ªå¯ä½¿ç”¨Samba çš„å¸å·ï¼Œå¯å…ˆç”¨-L æ‰¾åˆ°å¸å·åå†åˆ é™¤ï¼›\n-m ï¼šåé¢æ¥çš„æ˜¯æœºå™¨çš„ä»£ç (machine account)ï¼Œä¸domain model æœ‰å…³ï¼\nä¹±ç é—®é¢˜ # cat /etc/sysconfig/i18n [global] # å¦‚æœlocaleæ˜¯zh_CN.UTF-8ï¼Œåšå¦‚ä¸‹è®¾ç½®ï¼š display charset = UTF-8 unix charset = UTF-8 dos charset = UTF-8 # å¦‚æœlocaleæ˜¯zh_CN.GBKæˆ–zh_CN.gb2312ï¼Œåšå¦‚ä¸‹è®¾ç½®ï¼š display charset = cp936 unix charset = cp936 dos charset = cp936 linuxè®¿é—® # smbclient //IP/ç›®å½•å -U ç™»å½•ç”¨æˆ·å mount -t cifs -o username=ç”¨æˆ·å,passwd=å¯†ç ,iocharset=gb2312,uid,pid,rw //ip æŒ‚è½½ç‚¹ smbtar -s server -u user -p passwd -x sharename -t output.tar windowsè®¿é—® # windowsè®¿é—®æ–¹å¼å°±ä¸è¯´äº†ã€‚ä¸‹é¢è¯´ä¸‹æ¸…é™¤windowså…±äº«è®¿é—®æ–¹æ³•ï¼š\næ‰“å¼€cmd. c:\\\u0026gt;net use * /del "},{"id":103,"href":"/blog/linux/B1muLLNcIRf/","title":"Linux Screenå‘½ä»¤","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":"Linux screen å‘½ä»¤ç”¨äºå¤šé‡è§†çª—ç®¡ç†ç¨‹åºã€‚\nscreen ä¸ºå¤šé‡è§†çª—ç®¡ç†ç¨‹åºã€‚æ­¤å¤„æ‰€è°“çš„è§†çª—ï¼Œæ˜¯æŒ‡ä¸€ä¸ªå…¨å±å¹•çš„æ–‡å­—æ¨¡å¼ç”»é¢ã€‚é€šå¸¸åªæœ‰åœ¨ä½¿ç”¨ telnet ç™»å…¥ä¸»æœºæˆ–æ˜¯ä½¿ç”¨è€å¼çš„ç»ˆç«¯æœºæ—¶ï¼Œæ‰æœ‰å¯èƒ½ç”¨åˆ° screen ç¨‹åºã€‚\nè¯­æ³• # screen [-AmRvx -ls -wipe][-d \u0026lt;ä½œä¸šåç§°\u0026gt;][-h \u0026lt;è¡Œæ•°\u0026gt;][-r \u0026lt;ä½œä¸šåç§°\u0026gt;][-s \u0026lt;shell\u0026gt;][-S \u0026lt;ä½œä¸šåç§°\u0026gt;] å‚æ•°è¯´æ˜ï¼š\n-A å°†æ‰€æœ‰çš„è§†çª—éƒ½è°ƒæ•´ä¸ºç›®å‰ç»ˆç«¯æœºçš„å¤§å°ã€‚ -d \u0026lt;ä½œä¸šåç§°\u0026gt; å°†æŒ‡å®šçš„ screen ä½œä¸šç¦»çº¿ã€‚ -h \u0026lt;è¡Œæ•°\u0026gt; æŒ‡å®šè§†çª—çš„ç¼“å†²åŒºè¡Œæ•°ã€‚ -m å³ä½¿ç›®å‰å·²åœ¨ä½œä¸šä¸­çš„ screen ä½œä¸šï¼Œä»å¼ºåˆ¶å»ºç«‹æ–°çš„ screen ä½œä¸šã€‚ -r \u0026lt;ä½œä¸šåç§°\u0026gt; æ¢å¤ç¦»çº¿çš„ screen ä½œä¸šã€‚ -R å…ˆè¯•å›¾æ¢å¤ç¦»çº¿çš„ä½œä¸šã€‚è‹¥æ‰¾ä¸åˆ°ç¦»çº¿çš„ä½œä¸šï¼Œå³å»ºç«‹æ–°çš„ screen ä½œä¸šã€‚ -s æŒ‡å®šå»ºç«‹æ–°è§†çª—æ—¶ï¼Œæ‰€è¦æ‰§è¡Œçš„ shellã€‚ -S \u0026lt;ä½œä¸šåç§°\u0026gt; æŒ‡å®š screen ä½œä¸šçš„åç§°ã€‚ -v æ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯ã€‚ -x æ¢å¤ä¹‹å‰ç¦»çº¿çš„ screen ä½œä¸šã€‚ -ls æˆ– \u0026ndash;list æ˜¾ç¤ºç›®å‰æ‰€æœ‰çš„ screen ä½œä¸šã€‚ -wipe æ£€æŸ¥ç›®å‰æ‰€æœ‰çš„ screen ä½œä¸šï¼Œå¹¶åˆ é™¤å·²ç»æ— æ³•ä½¿ç”¨çš„ screen ä½œä¸šã€‚ å®ä¾‹ # åˆ›å»º screen ç»ˆç«¯\nscreen //åˆ›å»º screen ç»ˆç«¯ åˆ›å»º screen ç»ˆç«¯ å¹¶æ‰§è¡Œä»»åŠ¡\nscreen vi ~/main.c //åˆ›å»º screen ç»ˆç«¯ ï¼Œå¹¶æ‰§è¡Œ viå‘½ä»¤ ç¦»å¼€ screen ç»ˆç«¯\nscreen vi ~/main.c //åˆ›å»º screen ç»ˆç«¯ ï¼Œå¹¶æ‰§è¡Œ viå‘½ä»¤ #include main () { } \u0026#34;~/mail.c\u0026#34; 0,0-1 åœ¨ screen ç»ˆç«¯ ä¸‹ æŒ‰ä¸‹ Ctrl+a dé”® é‡æ–°è¿æ¥ç¦»å¼€çš„ screen ç»ˆç«¯\nscreen -ls # æ˜¾ç¤ºå·²åˆ›å»ºçš„screenç»ˆç«¯ There are screens on: 2433.pts-3.linuxÂ (2013å¹´10æœˆ20æ—¥ 16æ—¶48åˆ†59ç§’)Â (Detached) 2428.pts-3.linuxÂ (2013å¹´10æœˆ20æ—¥ 16æ—¶48åˆ†05ç§’)Â (Detached) 2284.pts-3.linuxÂ (2013å¹´10æœˆ20æ—¥ 16æ—¶14åˆ†55ç§’)Â (Detached) 2276.pts-3.linuxÂ (2013å¹´10æœˆ20æ—¥ 16æ—¶13åˆ†18ç§’)Â (Detached) 4 Sockets in /var/run/screen/S-root. screen -r 2276 //è¿æ¥ screen_id ä¸º 2276 çš„ screenç»ˆç«¯ "},{"id":104,"href":"/blog/linux/Hk2bI84c8Rz/","title":"linux VMè™šæ‹Ÿå†…å­˜å’ŒBDPä¼˜åŒ–","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" none\nVMè™šæ‹Ÿå†…å­˜ä¼˜åŒ– # #getconf PAGESIZE\nvm.dirty_background_bytes ç³»ç»Ÿå†…æ‰€åŒ…å«çš„è„æ•°æ®æ€»æ•°\nvm.dirty_background_ratio è„æ•°æ®æ‰€å ç”¨å†…å­˜çš„ç™¾åˆ†æ¯”\nvm.dirty_expire_centisecs è„æ•°æ®åœ¨å†…å­˜ä¸­çš„å­˜æ”¾æ—¶é—´\nvm.dirty_bytes å¦‚æœè¿›ç¨‹çš„è„æ•°æ®è¶…è¿‡è¯¥å€¼æ—¶åˆ™è¦æ±‚å†™åˆ°ç£ç›˜\nBDPä¼˜åŒ– # BDP=Bandwidth*RRT net.core.rmem_max æœ€å¤§ç¼“å†²åŒº(çª—å£)å¤§å°\nnet.core.wmem_default é»˜è®¤ç¼“å†²åŒºå¤§å°\nnet.core.wmem_max æœ€å¤§å‘é€ç¼“å†²åŒºå¤§å°\n"},{"id":105,"href":"/blog/linux/H13UIE5LRM/","title":"linux vncç®€å•é…ç½®","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" none\nVNCç«¯å£ # vncserverç›‘å¬ç«¯å£ RFBåè®®ï¼š5900+æ¡Œé¢å· HTTPåè®®ï¼š5800+æ¡Œé¢å· Xåè®®ï¼š6000+æ¡Œé¢å·\nvncserverä½¿ç”¨çš„æ¡Œé¢ç¼–å·é»˜è®¤æ˜¯ä»1å¼€å§‹ï¼Œä¾æ¬¡ä½¿ç”¨ã€‚\nvncé…ç½® # å®‰è£…vnc å’Œvnc-server\nvncserver :1 #å¯åŠ¨vncserverå¹¶ç”Ÿäº§é…ç½®æ–‡ä»¶\nä¿®æ”¹~/.vnc/xstartupæ–‡ä»¶ é»˜è®¤ä½¿ç”¨twmç¯å¢ƒ ä½¿ç”¨å›¾å½¢ç•Œé¢ï¼š\nä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œå»æ‰ä¸‹åˆ—ä¸¤è¡Œçš„æ³¨é‡Š\nUncomment the following two lines for normal desktop: # unset SESSION_MANAGER # exec /etc/X11/xinit/xinitrc # ä¿®æ”¹/etc/sysconfig/vncserversæ–‡ä»¶ å»æ‰æœ€åä¸¤è¡Œçš„æ³¨é‡Š\nVNCSERVERS=â€œ2:myusernameâ€\nVNCSERVERARGS[2]=â€œ-geometry 800x600 -nolisten tcp -nohttpd -localhostâ€\nä¿®æ”¹é…ç½®æ–‡ä»¶åé‡æ–°VNCæœåŠ¡ vncserver -kill :1 vncserver :1\nä¿®æ”¹/etc/inittabæ–‡ä»¶ å°†é»˜è®¤çš„å¯åŠ¨çº§åˆ«æ”¹æˆ5 æ·»åŠ å¼€æœºå¯åŠ¨ chkconfig vncserver on\n"},{"id":106,"href":"/blog/linux/S19ZLLE9I0G/","title":"linux å¸¸ç”¨ç³»ç»Ÿèµ„æºæŸ¥çœ‹å‘½ä»¤","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" none\nä¸€ã€sarå‘½ä»¤ # # sar 1 10 ç›‘æ§CPUï¼Œæ¯ç§’ç›‘æ§ä¸€æ¬¡ï¼Œå…±ç›‘æ§10æ¬¡ # sar -P ALL 1 5 ç›‘æ§æ‰€æœ‰CPU # sar -S 1 10 ç›‘æ§äº¤æ¢åˆ†åŒº # sar -d 1 10 ç›‘æ§ç£ç›˜IO # sar -b 1 10 ç›‘æ§ç£ç›˜IOå’Œé€Ÿç‡ # sar -r 1 10 ç›‘æ§å†…å­˜ä½¿ç”¨ # sar -n DEV 1 10 ç›‘æ§ç½‘ç»œæ¥å£å¡çš„æ•°æ®ä¼ è¾“ äºŒã€mpstat # # mpstat -P ALL 1 10 ä¸‰ã€iostat # # iostat -c 2 # iostat -d 1 100 # iostat 1 20 # iostat -p /dev/sda2 1 10 å››ã€vmstat # #vmstat -d 1 20 è¾“å‡ºä¿¡æ¯ r è¿è¡Œé˜Ÿåˆ—ä¸­çš„è¿›ç¨‹æ•°ï¼Œä¸è¦é•¿æ—¶é—´è¶…è¿‡CPUæ ¸å¿ƒæ€»æ•° b ç­‰å¾…IOçš„è¿›ç¨‹æ•° si æ¯ç§’ä»äº¤æ¢åˆ†åŒºå†™åˆ°å†…å­˜çš„æ•°æ®å¤§å° so æ¯ç§’å†™å…¥äº¤æ¢åˆ†åŒºçš„æ•°æ®å¤§å° #vmstat -a 1 10 äº”ã€å…¶å®ƒå¸¸ç”¨ç›‘æ§å‘½ä»¤ # (1) top (2) free (3) iptraf\n"},{"id":107,"href":"/blog/linux/H1sZIUN9I0f/","title":"linux é˜²æ‹’ç»æœåŠ¡æ”»å‡»","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" none\nä¸€ã€ä½¿ç”¨è„šæœ¬ # wget http://www.inetbase.com/scripts/ddos/install.sh å®‰è£…è„šæœ¬ wget http://www.inetbase.com/scripts/ddos/uninstall.sh å¸è½½è„šæœ¬ äºŒã€å†…æ ¸ä¼˜åŒ– # net.ipv4.tcp_max_syn_backlog = 1024 #è®¾å®šsyné˜Ÿåˆ—é•¿åº¦ net.ipv4.tcp_syncookies = 1 #è®¾å®šæ˜¯å¦å¯ç”¨cookies net.ipv4.tcp_synack_retries = 3 #è®¾å®šsynacké‡è¯•æ¬¡æ•° net.ipv4.tcp_syn_retries = 2 #è®¾å®šsyné‡è¯•æ¬¡æ•° net.ipv4.icmp_echo_ignore_all = 1 #ä¸å›åº”ping net.ipv4.icmp_echo_ignore_broadcast = 1 #ä¸å›åº”å¹¿æ’­ping ä¸‰ã€é˜²ç«å¢™é…ç½® # 1ã€åŸºäºæ•°æ®åŒ…è¿›è¡Œé™åˆ¶ # #iptables -A INPUT -p tcp --tcp-flags syn,ack,fin syn -m limit --limit 5/s --limit-burst 8 -j ACCEPT #iptables -A INPUT -p tcp -m state --state ESTABLISHED,RELATED -j ACCEPT 2ã€åŸºäºè¿æ¥æ•°è¿›è¡Œé™åˆ¶ # #iptables -A INPUT -s 192.168.0.0/24 -p tcp --dport 23 -m connlimit --connlimit-above 2 -j DROP 3ã€åŸºäºåœ°å€åˆ—è¡¨è¿›è¡Œé™åˆ¶ # #iptables -A INPUT -p tcp --dport 80 --tcp-flags syn,ack,fin syn -m recent --name webpool --rcheck --seconds 120 --hitcount 10 -j LOG --log-prefix=\u0026#34;ddos:\u0026#34; --log-ip-options #iptables -A INPUT -p tcp --dport 80 --syn -m recent --name webpool --rcheck --seconds 120 --hitcount 10 -j DROP #iptables -A INPUT -p tcp --dport 80 --syn -m recent --name webpool --set -j ACCEPT "},{"id":108,"href":"/blog/linux/HyYg884c80f/","title":"linux é˜²å¾¡SYNæ”»å‡»","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" none\nä¸€ã€é»˜è®¤syné…ç½® # sysctl -a | grep _syn net.ipv4.tcp_max_syn_backlog = 1024 net.ipv4.tcp_syncookies = 1 net.ipv4.tcp_synack_retries = 5 net.ipv4.tcp_syn_retries = 5 tcp_max_syn_backlog æ˜¯SYNé˜Ÿåˆ—çš„é•¿åº¦ï¼ŒåŠ å¤§SYNé˜Ÿåˆ—é•¿åº¦å¯ä»¥å®¹çº³æ›´å¤šç­‰å¾…è¿æ¥çš„ç½‘ç»œè¿æ¥æ•°ã€‚\ntcp_syncookiesæ˜¯ä¸€ä¸ªå¼€å…³ï¼Œæ˜¯å¦æ‰“å¼€SYN Cookie åŠŸèƒ½ï¼Œè¯¥åŠŸèƒ½å¯ä»¥é˜²æ­¢éƒ¨åˆ†SYNæ”»å‡»ã€‚\ntcp_synack_retrieså’Œtcp_syn_retrieså®šä¹‰SYN çš„é‡è¯•è¿æ¥æ¬¡æ•°ï¼Œå°†é»˜è®¤çš„å‚æ•°å‡å°æ¥æ§åˆ¶SYNè¿æ¥æ¬¡æ•°çš„å°½é‡å°‘ã€‚\näºŒã€ä¿®æ”¹syné…ç½® # ulimit -HSn 65535 sysctl -w net.ipv4.tcp_max_syn_backlog=2048 sysctl -w net.ipv4.tcp_syncookies=1 sysctl -w net.ipv4.tcp_synack_retries=2 sysctl -w net.ipv4.tcp_syn_retries=2 ä¸‰ã€æ·»åŠ é˜²ç«å¢™è§„åˆ™ # #Syn æ´ªæ°´æ”»å‡»(--limit 1/s é™åˆ¶synå¹¶å‘æ•°æ¯ç§’1æ¬¡) iptables -A INPUT -p tcp --syn -m limit --limit 1/s -j ACCEPT #é˜²ç«¯å£æ‰«æ iptables -A FORWARD -p tcp --tcp-flags SYN,ACK,FIN,RST RST -m limit --limit 1/s -j ACCEPT #é˜²æ´ªæ°´ping iptables -A FORWARD -p icmp --icmp-type echo-request -m limit --limit 1/s -j ACCEPT å››ã€æ·»åŠ å¼€æœºå¯åŠ¨ # æœ€ååˆ«å¿˜è®°å°†äºŒã€ä¸‰ã€é‡Œé¢çš„å‘½ä»¤å†™åˆ°/etc/rc.d/rc.local\n"},{"id":109,"href":"/blog/linux/HkGxI8VcL0f/","title":"linuxï¼ˆå†…æ ¸ï¼‰oom kille vm.overcommit_memoryå‚æ•°è¯¦è§£","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" none\nè¯¦ç»†è¯´æ˜ # å¯é€‰å€¼ï¼š0ã€1ã€2ã€‚\n0ï¼Œ è¡¨ç¤ºå†…æ ¸å°†æ£€æŸ¥æ˜¯å¦æœ‰è¶³å¤Ÿçš„å¯ç”¨å†…å­˜ä¾›åº”ç”¨è¿›ç¨‹ä½¿ç”¨ï¼›å¦‚æœæœ‰è¶³å¤Ÿçš„å¯ç”¨å†…å­˜ï¼Œå†…å­˜ç”³è¯·å…è®¸ï¼›å¦åˆ™ï¼Œå†…å­˜ç”³è¯·å¤±è´¥ï¼Œå¹¶æŠŠé”™è¯¯è¿”å›ç»™åº”ç”¨è¿›ç¨‹ã€‚\n1ï¼Œ è¡¨ç¤ºå†…æ ¸å…è®¸åˆ†é…æ‰€æœ‰çš„ç‰©ç†å†…å­˜ï¼Œè€Œä¸ç®¡å½“å‰çš„å†…å­˜çŠ¶æ€å¦‚ä½•ã€‚\n2ï¼Œ è¡¨ç¤ºå†…æ ¸å…è®¸åˆ†é…è¶…è¿‡æ‰€æœ‰ç‰©ç†å†…å­˜å’Œäº¤æ¢ç©ºé—´æ€»å’Œçš„å†…å­˜\nä¿®æ”¹æ–¹æ³• # sysctl vm.overcommit_memory=2 echo \u0026#34;vm.overcommit_memory=2\u0026#34; \u0026gt;\u0026gt; /etc/sysctl.conf "},{"id":110,"href":"/blog/linux/HJCOI8NqUAG/","title":"linuxä»£ç†åœ°å€å¤±æ•ˆå¯¼è‡´çš„é—®é¢˜è§£æ","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" none\né”™è¯¯æè¿° # ä»»ä½•éœ€è¦ä½¿ç”¨httpæœåŠ¡çš„ç¨‹åºéƒ½ä¼šå­˜åœ¨å‡æ­»æˆ–è¶…æ—¶ï¼ŒåŒ…æ‹¬wgetã€curã€yumç­‰ç­‰ã€‚\nåˆæ­¥å‘ç° # ä½¿ç”¨sudo å¯æ˜¯æ­£å¸¸è®¿é—®ã€‚\nä¾‹å¦‚ï¼š\nsudo yum install wget ç„¶åå‘ç° # [root@jn6 tmp]# wget http://mirrors.163.com/.help/CentOS6-Base-163.repo --2018-03-08 14:13:53-- http://mirrors.163.com/.help/CentOS6-Base-163.repo Connecting to 10.1.205.242:3128... æ ¹æ®ä¸Šé¢çš„æç¤ºå‘ç°äº†\nConnecting to 10.1.205.242:3128... å¾ˆæ˜æ˜¾æ˜¯ä½¿ç”¨äº†ä»£ç†ï¼Œå¹¶ä¸”ä»£ç†å·²ç»å¤±æ•ˆäº†ã€‚\nè§£å†³åŠæ³• # æŸ¥çœ‹â€œ/etc/profileâ€ã€â€œ/.bashrcâ€æˆ–è€…â€œ/.bash_profileâ€å°†å¦‚ä¸‹ç±»ä¼¼çš„è¡Œæ³¨é‡Šæ‰å³å¯ã€‚\n#ftp_proxy=\u0026#34;http://10.1.205.242:3128\u0026#34;;export ftp_proxy #http_proxy=\u0026#34;http://10.1.205.242:3128\u0026#34;;export http_proxy #https_proxy=\u0026#34;http://10.1.205.242:3128\u0026#34;;export https_proxy é—®é¢˜æ€»ç»“ # æ ¹æ®åˆæ­¥å‘ç°çš„ç»“æœå¯ä»¥äº†è§£åˆ°ï¼Œsudoå¹¶æ²¡æœ‰è§£æâ€œ/.bashrcâ€å’Œâ€œ/.bash_profileâ€è¿™ä¸¤ä¸ªæ–‡ä»¶ã€‚\n"},{"id":111,"href":"/blog/linux/S13z8UE5UCf/","title":"linuxå†…å­˜æ¸…ç†é‡Šæ”¾å‘½ä»¤","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" none\nå‘½ä»¤ # sync echo 1 \u0026gt; /proc/sys/vm/drop_caches echo 2 \u0026gt; /proc/sys/vm/drop_caches echo 3 \u0026gt; /proc/sys/vm/drop_caches è§£é‡Š # cacheé‡Šæ”¾ï¼š To free pagecache: echo 1 \u0026gt; /proc/sys/vm/drop_caches To free dentries and inodes: echo 2 \u0026gt; /proc/sys/vm/drop_caches To free pagecache, dentries and inodes: echo 3 \u0026gt; /proc/sys/vm/drop_caches è¯´æ˜ # é‡Šæ”¾å‰æœ€å¥½syncä¸€ä¸‹ï¼Œé˜²æ­¢ä¸¢æ•°æ®ã€‚\n"},{"id":112,"href":"/blog/linux/B1FO88V580M/","title":"Linuxæ¸…é™¤å†…å­˜","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" å¦‚ä½•åœ¨ Linux ä¸­æ¸…é™¤ç¼“å­˜ï¼ˆCacheï¼‰ï¼Ÿ # æ¯ä¸ª Linux ç³»ç»Ÿæœ‰ä¸‰ç§é€‰é¡¹æ¥æ¸…é™¤ç¼“å­˜è€Œä¸éœ€è¦ä¸­æ–­ä»»ä½•è¿›ç¨‹æˆ–æœåŠ¡ã€‚\nï¼ˆLCTT è¯‘æ³¨ï¼šCacheï¼Œè¯‘ä½œâ€œç¼“å­˜â€ï¼ŒæŒ‡ CPU\nå’Œå†…å­˜ä¹‹é—´é«˜é€Ÿç¼“å­˜ã€‚Bufferï¼Œè¯‘ä½œâ€œç¼“å†²åŒºâ€ï¼ŒæŒ‡åœ¨å†™å…¥ç£ç›˜å‰çš„å­˜å‚¨å†å†…å­˜ä¸­çš„å†…å®¹ã€‚åœ¨æœ¬æ–‡ä¸­ï¼ŒBuffer å’Œ Cache æœ‰æ—¶å€™ä¼šé€šæŒ‡ã€‚ï¼‰\nä»…æ¸…é™¤é¡µé¢ç¼“å­˜ï¼ˆPageCacheï¼‰ # sync; echo 1 \u0026gt; /proc/sys/vm/drop_caches æ¸…é™¤ç›®å½•é¡¹å’Œinode # sync; echo 2 \u0026gt; /proc/sys/vm/drop_caches æ¸…é™¤é¡µé¢ç¼“å­˜ï¼Œç›®å½•é¡¹å’Œinode # sync; echo 3 \u0026gt; /proc/sys/vm/drop_caches ä¸Šè¿°å‘½ä»¤çš„è¯´æ˜ï¼š\nsync\nå°†åˆ·æ–°æ–‡ä»¶ç³»ç»Ÿç¼“å†²åŒºï¼ˆbufferï¼‰ï¼Œå‘½ä»¤é€šè¿‡â€œ;â€åˆ†éš”ï¼Œé¡ºåºæ‰§è¡Œï¼Œshellåœ¨æ‰§è¡Œåºåˆ—ä¸­çš„ä¸‹ä¸€ä¸ªå‘½ä»¤ä¹‹å‰ä¼šç­‰å¾…å‘½ä»¤çš„ç»ˆæ­¢ã€‚æ­£å¦‚å†…æ ¸æ–‡æ¡£ä¸­æåˆ°çš„ï¼Œå†™å…¥åˆ°drop_cacheå°†æ¸…ç©ºç¼“å­˜è€Œä¸ä¼šæ€æ­»ä»»ä½•åº”ç”¨ç¨‹åº/æœåŠ¡ï¼Œechoå‘½ä»¤åšå†™å…¥æ–‡ä»¶çš„å·¥ä½œã€‚\nå¦‚æœä½ å¿…é¡»æ¸…é™¤ç£ç›˜é«˜é€Ÿç¼“å­˜ï¼Œç¬¬ä¸€ä¸ªå‘½ä»¤åœ¨ä¼ä¸šå’Œç”Ÿäº§ç¯å¢ƒä¸­æ˜¯æœ€å®‰å…¨ï¼Œâ€â€¦echo 1\u0026gt; â€¦â€œåªä¼šæ¸…é™¤é¡µé¢ç¼“å­˜ã€‚\nåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä¸å»ºè®®ä½¿ç”¨ä¸Šé¢çš„ç¬¬ä¸‰ä¸ªé€‰é¡¹â€â€¦echo 3 \u0026gt; â€¦â€ ï¼Œé™¤éä½ æ˜ç¡®è‡ªå·±åœ¨åšä»€ä¹ˆï¼Œå› ä¸ºå®ƒä¼šæ¸…é™¤ç¼“å­˜é¡µï¼Œç›®å½•é¡¹å’Œinodesã€‚\n"},{"id":113,"href":"/blog/linux/ryedLUN9UAf/","title":"linuxæ— äººå€¼å®ˆå®‰è£…ä¹‹æ‰¾ä¸åˆ°pxelinux.0æ–‡ä»¶çš„è§£å†³åŠæ³•","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" none\nè§£å†³æ€è·¯ # yum search pxelinux é€šè¿‡ä¸Šé¢çš„æ–¹æ³•æˆ‘ä»¬æ‰¾åˆ°äº†syslinuxåŒ…\nç„¶åå®‰è£…syslinux\nyum install syslinux æœ€åæ‰¾åˆ°pxelinux.0æ–‡ä»¶\nls /usr/share/syslinux/pxelinux.0 "},{"id":114,"href":"/blog/macos/HkGt88E9U0f/","title":"Mac terminalæ¸…é™¤å†å²å‘½ä»¤çºªå½•","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" Linuxä¼ ç»Ÿæ¸…é™¤æ–¹å¼å¹¶æ²¡èƒ½è§£å†³\nhistory -c\næˆ‘ç”¨çš„iterm2 + zsh\nå¸¸ç”¨historyå‘½ä»¤ï¼š\næŸ¥çœ‹å†å²å‘½ä»¤çºªå½•:\nhistoryâ€¦\nLinuxä¼ ç»Ÿæ¸…é™¤æ–¹å¼å¹¶æ²¡èƒ½è§£å†³\nhistory -c æˆ‘ç”¨çš„iterm2 + zsh\nå¸¸ç”¨historyå‘½ä»¤ï¼š # æŸ¥çœ‹å†å²å‘½ä»¤çºªå½•:\nhistory\nhistory | less ä½¿ç”¨ !! æ‰§è¡Œä¸Šä¸€æ¡å‘½ä»¤\n!! ä½¿ç”¨ !foo æ‰§è¡Œä»¥ foo å¼€å¤´çš„å‘½ä»¤\n!foo ä½¿ç”¨ !n æ‰§è¡Œç¬¬ n ä¸ªå‘½ä»¤\n!100\nå¯ä»¥å°è¯•ä¸‹è¿™æ ·æ¥è§£å†³ï¼š\nåœ¨terminalä¸­è¾“å…¥histï¼Œç„¶åtabé”®ï¼Œå‡ºæ¥ä»¥ä¸‹è¿™äº›\nHISTCHARS HISTFILE HISTSIZE\näº†è§£å†å²è®°å½•çš„å¤§å°:\necho $HISTSIZE å†å²è®°å½•çš„ä¿å­˜ä½ç½®:\necho $HISTFILE # æŸ¥çœ‹historyæ–‡ä»¶å­˜æ”¾åœ°å€ echo \u0026gt; ~/.zsh_history # æ¸…ç©º å¥½äº†ï¼Œé€€å‡ºterminalï¼Œé‡æ–°ç™»å½•æ£€æŸ¥ä¸€ä¸‹å³å¯ é€€å‡ºåï¼Œå†historyæ£€æŸ¥ä¸€ä¸‹\n"},{"id":115,"href":"/blog/macos/H1JGLLVcL0G/","title":"MacOS 10.12 è§£å†³æ‰¾ä¸åˆ°ä»»ä½•æ¥æºè®¾ç½®","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" å®‰è£…ç¬¬ä¸‰æ–¹è½¯ä»¶å¿…å¤‡æŠ€èƒ½\næ‰“å¼€ç»ˆç«¯ ( ç»ˆç«¯åœ¨ åº”ç”¨ç¨‹åº - å®ç”¨å·¥å…·å†… )\nè¾“å…¥ä»¥ä¸‹å‘½ä»¤å¹¶å›è½¦\nsudo spctl --master-disable ç„¶åæŸ¥çœ‹é—®é¢˜æ˜¯å¦è§£å†³ï¼Œ åå¥½è®¾ç½®-\u0026gt;å®‰å…¨æ€§ä¸éšç§-\u0026gt;é€šç”¨-\u0026gt;ä»»ä½•æ¥æº\n"},{"id":116,"href":"/blog/linux/Sky_LU458CM/","title":"mediainfoè·å–tsæ–‡ä»¶å¤§å°å’Œä¿¡æ¯ä¸å‡†ç¡®ï¼ˆMPEG-TSï¼šæ£€æµ‹æ–‡ä»¶çš„åºåˆ—ï¼‰çš„è§£å†³åŠæ³•","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" è§£å†³mediainfoè·å–tsåª’ä½“ä¿¡æ¯ä¸å‡†ç¡®é—®é¢˜\nåœºæ™¯ # åœ¨/opt/ç›®å½•ä¸‹æ€»å…±æœ‰200å¤šä¸ªæ–‡ä»¶æ–‡ä»¶ååˆ†åˆ«å¦‚ä¸‹ï¼š\n/opt/2017LPLå¤å­£èµ›ç¬¬01é›†.ts\n/opt/2017LPLå¤å­£èµ›ç¬¬02é›†.ts\n/opt/2017LPLå¤å­£èµ›ç¬¬03é›†.ts\nâ€¦\n/opt/2017LPLå¤å­£èµ›ç¬¬227é›†.ts\n/opt/2017LPLå¤å­£èµ›ç¬¬228é›†.ts\né”™è¯¯ç»“æœ # mediainfo /opt/2017LPLå¤å­£èµ›ç¬¬01é›†.ts General ID : 1 (0x1) Complete name : Z:\\vrs\\new_upload\\2018-01-16\\2017LPLå¤å­£èµ›ç¬¬01é›†.ts CompleteName_Last : Z:\\vrs\\new_upload\\2018-01-16\\2017LPLå¤å­£èµ›ç¬¬228é›†.ts Format : MPEG-TS File size : 560 GiB Duration : 53mn 32s Overall bit rate mode : Constant Overall bit rate : 1 496 Mbps Video ID : 100 (0x64) Menu ID : 1 (0x1) Format : AVC Format/Info : Advanced Video Codec Format profile : High@L4.0 Format settings, CABAC : No Format settings, ReFrames : 2 frames Codec ID : 27 Duration : 53mn 32s Bit rate mode : Constant Bit rate : 1 422 Mbps Nominal bit rate : 7 800 Kbps / 7 800 Kbps Width : 1 920 pixels Height : 1 080 pixels Display aspect ratio : 16:9 Frame rate : 25.000 fps Color space : YUV Chroma subsampling : 4:2:0 Bit depth : 8 bits Scan type : Progressive Bits/(Pixel*Frame) : 27.431 Stream size : 532 GiB (95%) Writing library : x264 core 148 r2705 3f5ed56 Encoding settings : cabac=0 / ref=2 / deblock=1:0:0 / analyse=0x3:0x13 / me=hex / subme=7 / psy=1 / psy_rd=1.00:0.00 / mixed_ref=1 / me_range=16 / chroma_me=1 / trellis=1 / 8x8dct=1 / cqm=0 / deadzone=21,11 / fast_pskip=1 / chroma_qp_offset=-2 / threads=34 / lookahead_threads=5 / sliced_threads=0 / nr=0 / decimate=1 / interlaced=0 / bluray_compat=0 / constrained_intra=0 / bframes=3 / b_pyramid=0 / b_adapt=1 / b_bias=0 / direct=1 / weightb=1 / open_gop=0 / weightp=1 / keyint=32 / keyint_min=16 / scenecut=40 / intra_refresh=0 / rc_lookahead=32 / rc=cbr / mbtree=1 / bitrate=7800 / ratetol=1.0 / qcomp=0.60 / qpmin=0 / qpmax=69 / qpstep=4 / vbv_maxrate=7800 / vbv_bufsize=1560 / nal_hrd=cbr / filler=1 / ip_ratio=1.40 / aq=1:1.00 Audio ID : 101 (0x65) Menu ID : 1 (0x1) Format : MPEG Audio Format version : Version 1 Format profile : Layer 2 Codec ID : 3 Duration : 53mn 32s Bit rate mode : Constant Bit rate : 96.0 Kbps Channel(s) : 2 channels Sampling rate : 48.0 KHz Compression mode : Lossy Delay relative to video : -10ms Stream size : 36.8 MiB (0%) Menu ID : 4096 (0x1000) Menu ID : 1 (0x1) Duration : 53mn 32s List : 100 (0x64) (AVC) / 101 (0x65) (MPEG Audio) Service name : RM_SERVICE_01 Service provider : RealMagic Service type : digital television æ­£ç¡®ç»“æœ # mediainfo /opt/2017LPLå¤å­£èµ›ç¬¬01é›†.ts General ID : 1 (0x1) Complete name : /data/stb/product/vrs/new_upload/./2018-01-16/2017LPLå¤å­£èµ›ç¬¬01é›†.ts Format : MPEG-TS File size : 2.58 GiB Duration : 43mn 42s Overall bit rate mode : Constant Overall bit rate : 8 464 Kbps Video ID : 100 (0x64) Menu ID : 1 (0x1) Format : AVC Format/Info : Advanced Video Codec Format profile : High@L4.0 Format settings, CABAC : No Format settings, ReFrames : 2 frames Codec ID : 27 Duration : 43mn 42s Bit rate mode : Constant Bit rate : 7 800 Kbps / 7 800 Kbps Width : 1 920 pixels Height : 1 080 pixels Display aspect ratio : 16:9 Frame rate : 25.000 fps Color space : YUV Chroma subsampling : 4:2:0 Bit depth : 8 bits Scan type : Progressive Bits/(Pixel*Frame) : 0.150 Stream size : 2.43 GiB (94%) Writing library : x264 core 148 r2705 3f5ed56 Encoding settings : cabac=0 / ref=2 / deblock=1:0:0 / analyse=0x3:0x13 / me=hex / subme=7 / psy=1 / psy_rd=1.00:0.00 / mixed_ref=1 / me_range=16 / chroma_me=1 / trellis=1 / 8x8dct=1 / cqm=0 / deadzone=21,11 / fast_pskip=1 / chroma_qp_offset=-2 / threads=34 / lookahead_threads=5 / sliced_threads=0 / nr=0 / decimate=1 / interlaced=0 / bluray_compat=0 / constrained_intra=0 / bframes=3 / b_pyramid=0 / b_adapt=1 / b_bias=0 / direct=1 / weightb=1 / open_gop=0 / weightp=1 / keyint=32 / keyint_min=16 / scenecut=40 / intra_refresh=0 / rc_lookahead=32 / rc=cbr / mbtree=1 / bitrate=7800 / ratetol=1.0 / qcomp=0.60 / qpmin=0 / qpmax=69 / qpstep=4 / vbv_maxrate=7800 / vbv_bufsize=1560 / nal_hrd=cbr / filler=1 / ip_ratio=1.40 / aq=1:1.00 Audio ID : 101 (0x65) Menu ID : 1 (0x1) Format : MPEG Audio Format version : Version 1 Format profile : Layer 2 Codec ID : 3 Duration : 43mn 42s Bit rate mode : Constant Bit rate : 96.0 Kbps Channel(s) : 2 channels Sampling rate : 48.0 KHz Compression mode : Lossy Delay relative to video : -10ms Stream size : 30.0 MiB (1%) Menu ID : 4096 (0x1000) Menu ID : 1 (0x1) Duration : 43mn 42s List : 100 (0x64) (AVC) / 101 (0x65) (MPEG Audio) Service name : RM_SERVICE_01 Service provider : RealMagic Service type : digital television è§£å†³åŠæ³• # æ ¹æ®ä½œè€…çš„githubä¸Šæäº¤çš„ä»£ç æè¿°\nhttps://github.com/MediaArea/MediaInfoLib/commit/78f739893c85d4b1397276ef15badd160907b7aa\nvim \u0026#34;Source/MediaInfo/Multiple/File_MpegTs.cpp\u0026#34; void File_MpegTs::Streams_Accept() { ... if (!IsSub) { ... //TestContinuousFileNames(); ... } } æˆ‘ä»¬åªè¦å°†â€TestContinuousFileNames();â€œè¿™è¡Œæ³¨é‡Šæ‰å³å¯è§£å†³é»˜è®¤è·å–tsæ–‡ä»¶åºåˆ—é—®é¢˜\n"},{"id":117,"href":"/blog/linux/SyqLL45IRz/","title":"nginx ç®€å•é…ç½®åŠä½¿ç”¨æ•™ç¨‹","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" none\nå¸¸ç”¨é…ç½® # #è¿è¡Œç”¨æˆ· user nobody; #å¯åŠ¨è¿›ç¨‹,é€šå¸¸è®¾ç½®æˆå’Œcpuçš„æ•°é‡ç›¸ç­‰ worker_processes 1; #å…¨å±€é”™è¯¯æ—¥å¿—åŠPIDæ–‡ä»¶ #error_log logs/error.log; #error_log logs/error.log notice; #error_log logs/error.log info; #pid logs/nginx.pid; #å·¥ä½œæ¨¡å¼åŠè¿æ¥æ•°ä¸Šé™ events { #epollæ˜¯å¤šè·¯å¤ç”¨IO(I/O Multiplexing)ä¸­çš„ä¸€ç§æ–¹å¼, #ä»…ç”¨äºlinux2.6ä»¥ä¸Šå†…æ ¸,å¯ä»¥å¤§å¤§æé«˜nginxçš„æ€§èƒ½ use epoll; #å•ä¸ªåå°worker processè¿›ç¨‹çš„æœ€å¤§å¹¶å‘é“¾æ¥æ•° worker_connections 1024; # å¹¶å‘æ€»æ•°æ˜¯ worker_processes å’Œ worker_connections çš„ä¹˜ç§¯ # å³ max_clients = worker_processes * worker_connections # åœ¨è®¾ç½®äº†åå‘ä»£ç†çš„æƒ…å†µä¸‹ï¼Œmax_clients = worker_processes * worker_connections / 4 ä¸ºä»€ä¹ˆ # ä¸ºä»€ä¹ˆä¸Šé¢åå‘ä»£ç†è¦é™¤ä»¥4ï¼Œåº”è¯¥è¯´æ˜¯ä¸€ä¸ªç»éªŒå€¼ # æ ¹æ®ä»¥ä¸Šæ¡ä»¶ï¼Œæ­£å¸¸æƒ…å†µä¸‹çš„Nginx Serverå¯ä»¥åº”ä»˜çš„æœ€å¤§è¿æ¥æ•°ä¸ºï¼š4 * 8000 = 32000 # worker_connections å€¼çš„è®¾ç½®è·Ÿç‰©ç†å†…å­˜å¤§å°æœ‰å…³ # å› ä¸ºå¹¶å‘å—IOçº¦æŸï¼Œmax_clientsçš„å€¼é¡»å°äºç³»ç»Ÿå¯ä»¥æ‰“å¼€çš„æœ€å¤§æ–‡ä»¶æ•° # è€Œç³»ç»Ÿå¯ä»¥æ‰“å¼€çš„æœ€å¤§æ–‡ä»¶æ•°å’Œå†…å­˜å¤§å°æˆæ­£æ¯”ï¼Œä¸€èˆ¬1GBå†…å­˜çš„æœºå™¨ä¸Šå¯ä»¥æ‰“å¼€çš„æ–‡ä»¶æ•°å¤§çº¦æ˜¯10ä¸‡å·¦å³ # æˆ‘ä»¬æ¥çœ‹çœ‹360Må†…å­˜çš„VPSå¯ä»¥æ‰“å¼€çš„æ–‡ä»¶å¥æŸ„æ•°æ˜¯å¤šå°‘ï¼š # $ cat /proc/sys/fs/file-max # è¾“å‡º 34336 # 32000 \u0026lt; 34336ï¼Œå³å¹¶å‘è¿æ¥æ€»æ•°å°äºç³»ç»Ÿå¯ä»¥æ‰“å¼€çš„æ–‡ä»¶å¥æŸ„æ€»æ•°ï¼Œè¿™æ ·å°±åœ¨æ“ä½œç³»ç»Ÿå¯ä»¥æ‰¿å—çš„èŒƒå›´ä¹‹å†… # æ‰€ä»¥ï¼Œworker_connections çš„å€¼éœ€æ ¹æ® worker_processes è¿›ç¨‹æ•°ç›®å’Œç³»ç»Ÿå¯ä»¥æ‰“å¼€çš„æœ€å¤§æ–‡ä»¶æ€»æ•°è¿›è¡Œé€‚å½“åœ°è¿›è¡Œè®¾ç½® # ä½¿å¾—å¹¶å‘æ€»æ•°å°äºæ“ä½œç³»ç»Ÿå¯ä»¥æ‰“å¼€çš„æœ€å¤§æ–‡ä»¶æ•°ç›® # å…¶å®è´¨ä¹Ÿå°±æ˜¯æ ¹æ®ä¸»æœºçš„ç‰©ç†CPUå’Œå†…å­˜è¿›è¡Œé…ç½® # å½“ç„¶ï¼Œç†è®ºä¸Šçš„å¹¶å‘æ€»æ•°å¯èƒ½ä¼šå’Œå®é™…æœ‰æ‰€åå·®ï¼Œå› ä¸ºä¸»æœºè¿˜æœ‰å…¶ä»–çš„å·¥ä½œè¿›ç¨‹éœ€è¦æ¶ˆè€—ç³»ç»Ÿèµ„æºã€‚ # ulimit -SHn 65535 } http { #è®¾å®šmimeç±»å‹,ç±»å‹ç”±mime.typeæ–‡ä»¶å®šä¹‰ include mime.types; default_type application/octet-stream; #è®¾å®šæ—¥å¿—æ ¼å¼ log_format main \u0026#39;$remote_addr - $remote_user [$time_local] \u0026#34;$request\u0026#34; \u0026#39; \u0026#39;$status $body_bytes_sent \u0026#34;$http_referer\u0026#34; \u0026#39; \u0026#39;\u0026#34;$http_user_agent\u0026#34; \u0026#34;$http_x_forwarded_for\u0026#34;\u0026#39;; access_log logs/access.log main; #sendfile æŒ‡ä»¤æŒ‡å®š nginx æ˜¯å¦è°ƒç”¨ sendfile å‡½æ•°ï¼ˆzero copy æ–¹å¼ï¼‰æ¥è¾“å‡ºæ–‡ä»¶ï¼Œ #å¯¹äºæ™®é€šåº”ç”¨ï¼Œå¿…é¡»è®¾ä¸º on, #å¦‚æœç”¨æ¥è¿›è¡Œä¸‹è½½ç­‰åº”ç”¨ç£ç›˜IOé‡è´Ÿè½½åº”ç”¨ï¼Œå¯è®¾ç½®ä¸º offï¼Œ #ä»¥å¹³è¡¡ç£ç›˜ä¸ç½‘ç»œI/Oå¤„ç†é€Ÿåº¦ï¼Œé™ä½ç³»ç»Ÿçš„uptime. sendfile on; #tcp_nopush on; #è¿æ¥è¶…æ—¶æ—¶é—´ #keepalive_timeout 0; keepalive_timeout 65; tcp_nodelay on; #å¼€å¯gzipå‹ç¼© gzip on; gzip_disable \u0026#34;MSIE [1-6].\u0026#34;; #è®¾å®šè¯·æ±‚ç¼“å†² client_header_buffer_size 128k; large_client_header_buffers 4 128k; #è®¾å®šè™šæ‹Ÿä¸»æœºé…ç½® server { #ä¾¦å¬80ç«¯å£ listen 80; #å®šä¹‰ä½¿ç”¨ www.nginx.cnè®¿é—® server_name www.nginx.cn; #å®šä¹‰æœåŠ¡å™¨çš„é»˜è®¤ç½‘ç«™æ ¹ç›®å½•ä½ç½® root html; #è®¾å®šæœ¬è™šæ‹Ÿä¸»æœºçš„è®¿é—®æ—¥å¿— access_log logs/nginx.access.log main; #é»˜è®¤è¯·æ±‚ location / { #å®šä¹‰é¦–é¡µç´¢å¼•æ–‡ä»¶çš„åç§° index index.php index.html index.htm; } # å®šä¹‰é”™è¯¯æç¤ºé¡µé¢ error_page 500 502 503 504 /50x.html; location = /50x.html { } #é™æ€æ–‡ä»¶ï¼Œnginxè‡ªå·±å¤„ç† location ~ ^/(images|javascript|js|css|flash|media|static)/ { #è¿‡æœŸ30å¤©ï¼Œé™æ€æ–‡ä»¶ä¸æ€ä¹ˆæ›´æ–°ï¼Œè¿‡æœŸå¯ä»¥è®¾å¤§ä¸€ç‚¹ï¼Œ #å¦‚æœé¢‘ç¹æ›´æ–°ï¼Œåˆ™å¯ä»¥è®¾ç½®å¾—å°ä¸€ç‚¹ã€‚ expires 30d; } #PHP è„šæœ¬è¯·æ±‚å…¨éƒ¨è½¬å‘åˆ° FastCGIå¤„ç†. ä½¿ç”¨FastCGIé»˜è®¤é…ç½®. location ~ .php$ { fastcgi_pass 127.0.0.1:9000; fastcgi_index index.php; fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name; include fastcgi_params; } #ç¦æ­¢è®¿é—® .htxxx æ–‡ä»¶ location ~ /.ht { deny all; } } } å…¶ä»–é…ç½® # #å®šä¹‰Nginxè¿è¡Œçš„ç”¨æˆ·å’Œç”¨æˆ·ç»„ user www www; #nginxè¿›ç¨‹æ•°ï¼Œå»ºè®®è®¾ç½®ä¸ºç­‰äºCPUæ€»æ ¸å¿ƒæ•°ã€‚ worker_processes 8; #å…¨å±€é”™è¯¯æ—¥å¿—å®šä¹‰ç±»å‹ï¼Œ[ debug | info | notice | warn | error | crit ] error_log /var/log/nginx/error.log info; #è¿›ç¨‹æ–‡ä»¶ pid /var/run/nginx.pid; #ä¸€ä¸ªnginxè¿›ç¨‹æ‰“å¼€çš„æœ€å¤šæ–‡ä»¶æè¿°ç¬¦æ•°ç›®ï¼Œç†è®ºå€¼åº”è¯¥æ˜¯æœ€å¤šæ‰“å¼€æ–‡ä»¶æ•°ï¼ˆç³»ç»Ÿçš„å€¼ulimit -nï¼‰ä¸nginxè¿›ç¨‹æ•°ç›¸é™¤ï¼Œä½†æ˜¯nginxåˆ†é…è¯·æ±‚å¹¶ä¸å‡åŒ€ï¼Œæ‰€ä»¥å»ºè®®ä¸ulimit -nçš„å€¼ä¿æŒä¸€è‡´ã€‚ worker_rlimit_nofile 65535; #å·¥ä½œæ¨¡å¼ä¸è¿æ¥æ•°ä¸Šé™ events { #å‚è€ƒäº‹ä»¶æ¨¡å‹ï¼Œuse [ kqueue | rtsig | epoll | /dev/poll | select | poll ]; epollæ¨¡å‹æ˜¯Linux 2.6ä»¥ä¸Šç‰ˆæœ¬å†…æ ¸ä¸­çš„é«˜æ€§èƒ½ç½‘ç»œI/Oæ¨¡å‹ï¼Œå¦‚æœè·‘åœ¨FreeBSDä¸Šé¢ï¼Œå°±ç”¨kqueueæ¨¡å‹ã€‚ use epoll; #å•ä¸ªè¿›ç¨‹æœ€å¤§è¿æ¥æ•°ï¼ˆæœ€å¤§è¿æ¥æ•°=è¿æ¥æ•°*è¿›ç¨‹æ•°ï¼‰ worker_connections 65535; } #è®¾å®šhttpæœåŠ¡å™¨ http { include mime.types; #æ–‡ä»¶æ‰©å±•åä¸æ–‡ä»¶ç±»å‹æ˜ å°„è¡¨ default_type application/octet-stream; #é»˜è®¤æ–‡ä»¶ç±»å‹ #charset utf-8; #é»˜è®¤ç¼–ç  server_names_hash_bucket_size 128; #æœåŠ¡å™¨åå­—çš„hashè¡¨å¤§å° client_header_buffer_size 32k; #ä¸Šä¼ æ–‡ä»¶å¤§å°é™åˆ¶ large_client_header_buffers 4 64k; #è®¾å®šè¯·æ±‚ç¼“ client_max_body_size 8m; #è®¾å®šè¯·æ±‚ç¼“ sendfile on; #å¼€å¯é«˜æ•ˆæ–‡ä»¶ä¼ è¾“æ¨¡å¼ï¼ŒsendfileæŒ‡ä»¤æŒ‡å®šnginxæ˜¯å¦è°ƒç”¨sendfileå‡½æ•°æ¥è¾“å‡ºæ–‡ä»¶ï¼Œå¯¹äºæ™®é€šåº”ç”¨è®¾ä¸º onï¼Œå¦‚æœç”¨æ¥è¿›è¡Œä¸‹è½½ç­‰åº”ç”¨ç£ç›˜IOé‡è´Ÿè½½åº”ç”¨ï¼Œå¯è®¾ç½®ä¸ºoffï¼Œä»¥å¹³è¡¡ç£ç›˜ä¸ç½‘ç»œI/Oå¤„ç†é€Ÿåº¦ï¼Œé™ä½ç³»ç»Ÿçš„è´Ÿè½½ã€‚æ³¨æ„ï¼šå¦‚æœå›¾ç‰‡æ˜¾ç¤ºä¸æ­£å¸¸æŠŠè¿™ä¸ªæ”¹æˆoffã€‚ autoindex on; #å¼€å¯ç›®å½•åˆ—è¡¨è®¿é—®ï¼Œåˆé€‚ä¸‹è½½æœåŠ¡å™¨ï¼Œé»˜è®¤å…³é—­ã€‚ tcp_nopush on; #é˜²æ­¢ç½‘ç»œé˜»å¡ tcp_nodelay on; #é˜²æ­¢ç½‘ç»œé˜»å¡ keepalive_timeout 120; #é•¿è¿æ¥è¶…æ—¶æ—¶é—´ï¼Œå•ä½æ˜¯ç§’ #FastCGIç›¸å…³å‚æ•°æ˜¯ä¸ºäº†æ”¹å–„ç½‘ç«™çš„æ€§èƒ½ï¼šå‡å°‘èµ„æºå ç”¨ï¼Œæé«˜è®¿é—®é€Ÿåº¦ã€‚ä¸‹é¢å‚æ•°çœ‹å­—é¢æ„æ€éƒ½èƒ½ç†è§£ã€‚ fastcgi_connect_timeout 300; fastcgi_send_timeout 300; fastcgi_read_timeout 300; fastcgi_buffer_size 64k; fastcgi_buffers 4 64k; fastcgi_busy_buffers_size 128k; fastcgi_temp_file_write_size 128k; #gzipæ¨¡å—è®¾ç½® gzip on; #å¼€å¯gzipå‹ç¼©è¾“å‡º gzip_min_length 1k; #æœ€å°å‹ç¼©æ–‡ä»¶å¤§å° gzip_buffers 4 16k; #å‹ç¼©ç¼“å†²åŒº gzip_http_version 1.0; #å‹ç¼©ç‰ˆæœ¬ï¼ˆé»˜è®¤1.1ï¼Œå‰ç«¯å¦‚æœæ˜¯squid2.5è¯·ä½¿ç”¨1.0ï¼‰ gzip_comp_level 2; #å‹ç¼©ç­‰çº§ gzip_types text/plain application/x-javascript text/css application/xml; #å‹ç¼©ç±»å‹ï¼Œé»˜è®¤å°±å·²ç»åŒ…å«text/htmlï¼Œæ‰€ä»¥ä¸‹é¢å°±ä¸ç”¨å†å†™äº†ï¼Œå†™ä¸Šå»ä¹Ÿä¸ä¼šæœ‰é—®é¢˜ï¼Œä½†æ˜¯ä¼šæœ‰ä¸€ä¸ªwarnã€‚ gzip_vary on; #limit_zone crawler $binary_remote_addr 10m; #å¼€å¯é™åˆ¶IPè¿æ¥æ•°çš„æ—¶å€™éœ€è¦ä½¿ç”¨ upstream blog.ha97.com { #upstreamçš„è´Ÿè½½å‡è¡¡ï¼Œweightæ˜¯æƒé‡ï¼Œå¯ä»¥æ ¹æ®æœºå™¨é…ç½®å®šä¹‰æƒé‡ã€‚weigthå‚æ•°è¡¨ç¤ºæƒå€¼ï¼Œæƒå€¼è¶Šé«˜è¢«åˆ†é…åˆ°çš„å‡ ç‡è¶Šå¤§ã€‚ server 192.168.80.121:80 weight=3; server 192.168.80.122:80 weight=2; server 192.168.80.123:80 weight=3; } #è™šæ‹Ÿä¸»æœºçš„é…ç½® server { #ç›‘å¬ç«¯å£ listen 80; #åŸŸåå¯ä»¥æœ‰å¤šä¸ªï¼Œç”¨ç©ºæ ¼éš”å¼€ server_name www.ha97.com ha97.com; index index.html index.htm index.php; root /data/www/ha97; location ~ .*\\.(php|php5)?$ { fastcgi_pass 127.0.0.1:9000; fastcgi_index index.php; include fastcgi.conf; } #å›¾ç‰‡ç¼“å­˜æ—¶é—´è®¾ç½® location ~ .*\\.(gif|jpg|jpeg|png|bmp|swf)$ { expires 10d; } #JSå’ŒCSSç¼“å­˜æ—¶é—´è®¾ç½® location ~ .*\\.(js|css)?$ { expires 1h; } #æ—¥å¿—æ ¼å¼è®¾å®š log_format access \u0026#39;$remote_addr - $remote_user [$time_local] \u0026#34;$request\u0026#34; \u0026#39; \u0026#39;$status $body_bytes_sent \u0026#34;$http_referer\u0026#34; \u0026#39; \u0026#39;\u0026#34;$http_user_agent\u0026#34; $http_x_forwarded_for\u0026#39;; #å®šä¹‰æœ¬è™šæ‹Ÿä¸»æœºçš„è®¿é—®æ—¥å¿— access_log /var/log/nginx/ha97access.log access; #å¯¹ \u0026#34;/\u0026#34; å¯ç”¨åå‘ä»£ç† location / { proxy_pass http://127.0.0.1:88; proxy_redirect off; proxy_set_header X-Real-IP $remote_addr; #åç«¯çš„WebæœåŠ¡å™¨å¯ä»¥é€šè¿‡X-Forwarded-Forè·å–ç”¨æˆ·çœŸå®IP proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; #ä»¥ä¸‹æ˜¯ä¸€äº›åå‘ä»£ç†çš„é…ç½®ï¼Œå¯é€‰ã€‚ proxy_set_header Host $host; client_max_body_size 10m; #å…è®¸å®¢æˆ·ç«¯è¯·æ±‚çš„æœ€å¤§å•æ–‡ä»¶å­—èŠ‚æ•° client_body_buffer_size 128k; #ç¼“å†²åŒºä»£ç†ç¼“å†²ç”¨æˆ·ç«¯è¯·æ±‚çš„æœ€å¤§å­—èŠ‚æ•°ï¼Œ proxy_connect_timeout 90; #nginxè·Ÿåç«¯æœåŠ¡å™¨è¿æ¥è¶…æ—¶æ—¶é—´(ä»£ç†è¿æ¥è¶…æ—¶) proxy_send_timeout 90; #åç«¯æœåŠ¡å™¨æ•°æ®å›ä¼ æ—¶é—´(ä»£ç†å‘é€è¶…æ—¶) proxy_read_timeout 90; #è¿æ¥æˆåŠŸåï¼Œåç«¯æœåŠ¡å™¨å“åº”æ—¶é—´(ä»£ç†æ¥æ”¶è¶…æ—¶) proxy_buffer_size 4k; #è®¾ç½®ä»£ç†æœåŠ¡å™¨ï¼ˆnginxï¼‰ä¿å­˜ç”¨æˆ·å¤´ä¿¡æ¯çš„ç¼“å†²åŒºå¤§å° proxy_buffers 4 32k; #proxy_buffersç¼“å†²åŒºï¼Œç½‘é¡µå¹³å‡åœ¨32kä»¥ä¸‹çš„è®¾ç½® proxy_busy_buffers_size 64k; #é«˜è´Ÿè·ä¸‹ç¼“å†²å¤§å°ï¼ˆproxy_buffers*2ï¼‰ proxy_temp_file_write_size 64k; #è®¾å®šç¼“å­˜æ–‡ä»¶å¤¹å¤§å°ï¼Œå¤§äºè¿™ä¸ªå€¼ï¼Œå°†ä»upstreamæœåŠ¡å™¨ä¼  } #è®¾å®šæŸ¥çœ‹NginxçŠ¶æ€çš„åœ°å€ location /NginxStatus { stub_status on; access_log on; auth_basic \u0026#34;NginxStatus\u0026#34;; auth_basic_user_file conf/htpasswd; #htpasswdæ–‡ä»¶çš„å†…å®¹å¯ä»¥ç”¨apacheæä¾›çš„htpasswdå·¥å…·æ¥äº§ç”Ÿã€‚ } #æœ¬åœ°åŠ¨é™åˆ†ç¦»åå‘ä»£ç†é…ç½® #æ‰€æœ‰jspçš„é¡µé¢å‡äº¤ç”±tomcatæˆ–resinå¤„ç† location ~ .(jsp|jspx|do)?$ { proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_pass http://127.0.0.1:8080; } #æ‰€æœ‰é™æ€æ–‡ä»¶ç”±nginxç›´æ¥è¯»å–ä¸ç»è¿‡tomcatæˆ–resin location ~ .*.(htm|html|gif|jpg|jpeg|png|bmp|swf|ioc|rar|zip|txt|flv|mid|doc|ppt|pdf|xls|mp3|wma)$ { expires 15d; } location ~ .*.(js|css)?$ { expires 1h; } } } "},{"id":118,"href":"/blog/linux/ByS8884qI0M/","title":"nginx+php+ThinkPHPç¯å¢ƒå¸¸è§é”™è¯¯æ€»ç»“","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" é”™è¯¯ä¸€\n2017/09/07 16:39:18 [error] 21753#0: *26 FastCGI sent in stderr: â€œPrimary sâ€¦\né”™è¯¯ä¸€ # 2017/09/07 16:39:18 [error] 21753#0: *26 FastCGI sent in stderr: \u0026#34;Primary script unknown\u0026#34; while reading response header from upstream, client: 172.31.26.114, server: localhost, request: \u0026#34;GET /1.php HTTP/1.1\u0026#34;, upstream: \u0026#34;fastcgi://127.0.0.1:9000\u0026#34;, host: \u0026#34;10.200.8.220:8000\u0026#34; è§£å†³ç‰ˆæœ¬ # åœ¨serverèŠ‚ç‚¹ä¸‹æ·»åŠ ä»¥ä¸‹é…ç½®\nroot /var/www/web; index index.php index.html index.htm; location ~ \\.php$ { try_files $uri = 404; fastcgi_pass 127.0.0.1:9000; fastcgi_index index.php; fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name; include fastcgi.conf; } ThinkPHPé…ç½® # å‡å¦‚ç½‘ç«™çš„æ ¹ç›®å½•æ˜¯/var/www/webï¼Œå¦‚æœThinkPHPçš„ç½‘ç«™åœ¨/var/www/web/Testç›®å½•é…ç½®å¦‚ä¸‹\nlocation /Test/ { if (!-e $request_filename){ rewrite ^/Test/(.*)$ /Test/index.php?s=$1 last; } } location ~ \\.php/?.*$ { try_files $uri = 404; fastcgi_pass 127.0.0.1:9000; fastcgi_index index.php; fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name; include fastcgi.conf; #è®¾ç½®PATH_INFOå¹¶æ”¹å†™SCRIPT_FILENAME,SCRIPT_NAMEæœåŠ¡å™¨ç¯å¢ƒå˜é‡ #set $fastcgi_script_name2 $fastcgi_script_name; #if ($fastcgi_script_name ~ \u0026#34;^(.+\\.php)(/.+)$\u0026#34;) { # set $fastcgi_script_name2 $1; # set $path_info $2; #} #fastcgi_param PATH_INFO $path_info; #fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name2; #fastcgi_param SCRIPT_NAME $fastcgi_script_name2; } å¦‚æœæ˜¯æ”¾åœ¨æ ¹ç›®å½•ä¸‹\nlocation / { if (!-e $request_filename){ rewrite ^/(.*)$ /index.php?s=$1 last; } } location ~ \\.php/?.*$ { try_files $uri = 404; fastcgi_pass 127.0.0.1:9000; fastcgi_index index.php; fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name; include fastcgi.conf; #è®¾ç½®PATH_INFOå¹¶æ”¹å†™SCRIPT_FILENAME,SCRIPT_NAMEæœåŠ¡å™¨ç¯å¢ƒå˜é‡ #set $fastcgi_script_name2 $fastcgi_script_name; #if ($fastcgi_script_name ~ \u0026#34;^(.+\\.php)(/.+)$\u0026#34;) { # set $fastcgi_script_name2 $1; # set $path_info $2; #} #fastcgi_param PATH_INFO $path_info; #fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name2; #fastcgi_param SCRIPT_NAME $fastcgi_script_name2; } æœ€åæ¥ä¸ªå®Œæ•´çš„ä¾‹å­\nuser root; worker_processes auto; #error_log logs/error.log; #error_log logs/error.log notice; #error_log logs/error.log info; #pid logs/nginx.pid; events { worker_connections 1024; } http { include mime.types; default_type application/octet-stream; sendfile on; keepalive_timeout 65; server { listen 80; server_name localhost; root /var/www/web; index index.php index.html index.htm; location / { index index.htm index.html index.php; } location /Test/ { if (!-e $request_filename){ rewrite ^/Test/(.*)$ /Test/index.php?s=$1 last; } } error_page 500 502 503 504 /50x.html; location = /50x.html { root html; } location ~ \\.php/?.*$ { try_files $uri = 404; fastcgi_pass 127.0.0.1:9000; fastcgi_index index.php; fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name; include fastcgi.conf; #è®¾ç½®PATH_INFOå¹¶æ”¹å†™SCRIPT_FILENAME,SCRIPT_NAMEæœåŠ¡å™¨ç¯å¢ƒå˜é‡ #set $fastcgi_script_name2 $fastcgi_script_name; #if ($fastcgi_script_name ~ \u0026#34;^(.+\\.php)(/.+)$\u0026#34;) { # set $fastcgi_script_name2 $1; # set $path_info $2; #} #fastcgi_param PATH_INFO $path_info; #fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name2; #fastcgi_param SCRIPT_NAME $fastcgi_script_name2; } } } "},{"id":119,"href":"/blog/linux/H1v8I4cLAf/","title":"Nginxåå‘ä»£ç†ã€é•œåƒç¼“å­˜åŠ é€ŸåŠè´Ÿè½½å‡è¡¡çš„é…ç½®","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" none\nNginxå·²ç»å…·å¤‡Squidæ‰€æ‹¥æœ‰çš„Webç¼“å­˜åŠ é€ŸåŠŸèƒ½ã€æ¸…é™¤æŒ‡å®šURLç¼“å­˜çš„åŠŸèƒ½ã€‚è€Œåœ¨æ€§èƒ½ä¸Šï¼ŒNginxå¯¹å¤šæ ¸CPUçš„åˆ©ç”¨ï¼Œèƒœè¿‡Squidä¸å°‘ã€‚å¦å¤–ï¼Œåœ¨åå‘ä»£ç†ã€è´Ÿè½½å‡è¡¡ã€å¥åº·æ£€æŸ¥ã€åç«¯æœåŠ¡å™¨æ•…éšœè½¬ç§»ã€Rewriteé‡å†™ã€æ˜“ç”¨æ€§ä¸Šï¼ŒNginxä¹Ÿæ¯”Squidå¼ºå¤§å¾—å¤šã€‚\nè¿™ä½¿å¾—ä¸€å°Nginxå¯ä»¥åŒæ—¶ä½œä¸ºâ€œè´Ÿè½½å‡è¡¡æœåŠ¡å™¨â€ä¸â€œWebç¼“å­˜æœåŠ¡å™¨â€æ¥ä½¿ç”¨ã€‚\nå¸¸è§„å®‰è£…nginxçš„è¿‡ç¨‹ï¼Œè¿™é‡Œå°±ä¸è¯¦è¿°äº†ï¼Œè¿™é‡Œåªä»‹ç»nginxçš„é…ç½®æ–‡ä»¶çš„é…ç½®\nä¸€ã€nginxåå‘ä»£ç†çš„åŸºæœ¬æ ¼å¼ï¼Œä¹Ÿå°±æ˜¯æœ€ç®€å•åå‘ä»£ç†é…ç½®æ–‡ä»¶ # server { listen 80; server_name vpsmm.com; location / { proxy_pass http://cache.vpsmm.com/; proxy_redirect off; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; } } äºŒã€å¦‚æœä½ éœ€è¦ä½¿ç”¨CDNé•œåƒåŠ é€Ÿçš„åŠŸèƒ½ # ä¹Ÿå°±æ˜¯å‰ç«¯åŸŸåå’Œåç«¯åŸŸåç›¸åŒï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢ä¸¤ç§æ–¹æ³•ï¼š\nï¼ˆä¸€ï¼‰æºåœ°å€ç›´æ¥å¡«å†™IP # server { listen 80; server_name vpsmm.com; location / { proxy_pass http://192.168.0.110; //å¦‚æœä¸æ˜¯80ç«¯å£ï¼Œå¯ä»¥åŠ ä¸Šç«¯å£http://IP:81 proxy_redirect off; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; } } ï¼ˆäºŒï¼‰é‡‡ç”¨HTTP Upstreamæ¨¡å—serveræŒ‡ä»¤ # upstream cdn { server 192.168.0.110:80 weight=5; server 192.168.0.121:80 weight=5; } server { listen 80; server_name vpsmm.com; location / { proxy_pass http://cdn; proxy_redirect off; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; } } ä¸‰ã€æœ€ç®€å•çš„å‰ç«¯å…¨ç¼“å­˜+åå‘ä»£ç†è„šæœ¬ # mkdir /home/cache/path -p #æ–°å»º2ä¸ªç›®å½•ï¼Œæ”¾ç½®ç¼“å­˜æ–‡ä»¶ mkdir /home/cache/temp -p ä¿®æ”¹ /usr/local/nginx/conf/nginx.conf æ–°å¢ä»¥ä¸‹ä»£ç ï¼Œä¸»è¦æ˜¯ç¼“å­˜ç›¸å…³è®¾ç½®ï¼Œè¯·æ”¾ç½®äº http{ ##è¿™é‡Œ } ä¸­ï¼Œä¸€èˆ¬åŠ åœ¨\nlog_format ä¸Šé¢æˆ–ä¸‹é¢å‡å¯ï¼š\nclient_body_buffer_size 512k; proxy_connect_timeout 5; proxy_read_timeout 60; proxy_send_timeout 5; proxy_buffer_size 16k; proxy_buffers 4 64k; proxy_busy_buffers_size 128k; proxy_temp_file_write_size 128k; proxy_temp_path /home/cache/temp; proxy_cache_path /home/cache/path levels=1:2 keys_zone=cache_one:500m inactive=7d max_size=30g; #500mæ˜¯å†…å­˜å ç”¨ï¼Œ7dæ˜¯7å¤©æ— è®¿é—®åˆ é™¤ï¼Œ30gæ˜¯ç¼“å­˜å å…·ç¡¬ç›˜ç©ºé—´\nä»¥ä¸‹ä¸ºè™šæ‹Ÿä¸»æœºé…ç½®æ–‡ä»¶ï¼Œå¯å¦å­˜æˆ .conf æ”¾ç½®äº vhost ä¸‹é¢ï¼š\nserver { listen 80; server_name vpsmm.com; #ä¸»æœºå location / { proxy_cache cache_one; proxy_cache_valid 200 304 3d; #æ­£å¸¸çŠ¶æ€ç¼“å­˜æ—¶é—´3å¤© proxy_cache_key $host$uri$is_args$args; proxy_pass http://cache.vpsmm.com/; #åä»£çš„ç½‘ç«™ proxy_redirect off; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; expires 10d; #é»˜è®¤10å¤©ç¼“å­˜ access_log /home/wwwlogs/vpsmm.log access; #æ—¥å¿—æ–‡ä»¶ } } ç‚¹å‡»å‡ ä¸‹ç½‘ç«™ï¼Œdf -sh å‘½ä»¤ï¼ŒæŸ¥çœ‹ /home/cache\nç›®å½•å¤§å°ï¼Œå³å¯æµ‹è¯•æ˜¯å¦ç¼“å­˜æˆåŠŸã€‚æ­¤è„šæœ¬ä¸ºå‰ç«¯å…¨ç¼“å­˜ï¼Œåç«¯åŠ¨æ€æ›´æ–°åï¼Œå‰ç«¯ä¸ä¼šè‡ªåŠ¨ä¿®æ”¹ã€‚å¯æ‰‹åŠ¨æ¸…ç†cacheç›®å½•ä¸‹æ–‡ä»¶ã€‚è¿™ä¸ªæ–¹æ³•ï¼Œå¯ä»¥ç”¨çº¯é™æ€çš„å½¢å¼æ¥é˜²CCï¼Œå¦‚æœä½ çš„åŠ¨æ€åšå®¢ï¼Œå—åˆ°CCæ”»å‡»ï¼Œå¯ä»¥å°è¯•ä¸€ä¸‹ã€‚\nä»¥ä¸‹ä¸ºå®Œæ•´çš„nginxè™šæ‹Ÿä¸»æœºçš„é…ç½®æ–‡ä»¶\nlog_format jjhr.net \u0026#39;$remote_addr - $remote_user [$time_local] \u0026#34;$request\u0026#34; \u0026#39; \u0026#39;$status $body_bytes_sent \u0026#34;$http_referer\u0026#34; \u0026#39; \u0026#39;\u0026#34;$http_user_agent\u0026#34; $http_x_forwarded_for\u0026#39;; # åå‘ä»£ç†å‚æ•°ï¼Œå…·ä½“è‡ªè¡Œæœç´¢æŒ‰éœ€é…ç½®å§ proxy_connect_timeout 5; proxy_read_timeout 60; proxy_send_timeout 5; proxy_buffer_size 16k; proxy_buffers 4 64k; proxy_busy_buffers_size 128k; proxy_temp_file_write_size 128k; # é…ç½®ä¸´æ—¶ç›®å½•ã€ç¼“å­˜è·¯å¾„ï¼ˆæ³¨æ„è¦å…ˆå»ºç«‹è¿™2ä¸ªç›®å½•ï¼Œè¦åœ¨åŒä¸€ä¸ªç¡¬ç›˜åˆ†åŒºï¼Œæ³¨æ„æƒé™ï¼‰ proxy_temp_path /var/cache/nginx_proxy_temp 1 2; proxy_cache_path /var/cache/nginx_proxy_cache levels=1:2 keys_zone=jjhr:48m inactive=12d max_size=2g; # keys_zone=jjhr:48m è¡¨ç¤ºè¿™ä¸ª zone åç§°ä¸º jjhrï¼Œåˆ†é…çš„å†…å­˜å¤§å°ä¸º 48MB # levels=1:2 è¡¨ç¤ºç¼“å­˜ç›®å½•çš„ç¬¬ä¸€çº§ç›®å½•æ˜¯ 1 ä¸ªå­—ç¬¦ï¼Œç¬¬äºŒçº§ç›®å½•æ˜¯ 2 ä¸ªå­—ç¬¦ # inactive=12d è¡¨ç¤ºè¿™ä¸ªzoneä¸­çš„ç¼“å­˜æ–‡ä»¶å¦‚æœåœ¨ 12 å¤©å†…éƒ½æ²¡æœ‰è¢«è®¿é—®ï¼Œé‚£ä¹ˆæ–‡ä»¶ä¼šè¢«cache manager è¿›ç¨‹åˆ é™¤ # max_size=2G è¡¨ç¤ºè¿™ä¸ªzoneçš„ç¡¬ç›˜å®¹é‡ä¸º 2G server{ listen 80; server_name jjhr.net *.jjhr.net; index index.html index.php; location / { #------------------------------------- proxy_cache jjhr; proxy_cache_key \u0026#34;$scheme://$host$request_uri\u0026#34;; proxy_cache_valid 200 304 7d; proxy_cache_valid 301 3d; proxy_cache_valid any 10s; expires 1d; #-------------------------------------- proxy_pass http://205.185.115.53; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; } # wordpress åå°ç›®å½•ä¸ç¼“å­˜ location /wp-admin { if ( !-e $request_filename) { proxy_pass http://205.185.115.53; } } access_log /var/log/nginx/jjhr.net.log main; } å››ã€å¤šä¸ªæœåŠ¡å™¨è´Ÿè½½å‡è¡¡çš„é…ç½® # http { â€¦â€¦.. client_max_body_size 300m ; // å…è®¸å®¢æˆ·ç«¯è¯·æ±‚çš„æœ€å¤§å•ä¸ªæ–‡ä»¶å­—èŠ‚æ•° client_body_buffer_size 128k; // ç¼“å†²åŒºä»£ç†ç¼“å†²ç”¨æˆ·ç«¯è¯·æ±‚çš„æœ€å¤§å­—èŠ‚æ•°ï¼Œå¯ä»¥ç†è§£ä¸ºå…ˆä¿å­˜åˆ°æœ¬åœ°å†ä¼ ç»™ç”¨æˆ· proxy_connect_timeout 600; // è·Ÿåç«¯æœåŠ¡å™¨è¿æ¥çš„è¶…æ—¶æ—¶é—´_å‘èµ·æ¡æ‰‹ç­‰å€™å“åº”è¶…æ—¶æ—¶é—´ proxy_read_timeout 600; // è¿æ¥æˆåŠŸå_ç­‰å€™åç«¯æœåŠ¡å™¨å“åº”æ—¶é—´_å…¶å®å·²ç»è¿›å…¥åç«¯æ’é˜Ÿä¹‹ä¸­ç­‰å€™å¤„ç† proxy_send_timeout 600; proxy_buffer_size 16k; // ä¼šä¿å­˜ç”¨æˆ·çš„å¤´ä¿¡æ¯ï¼Œä¾›nginxè¿›è¡Œè§„åˆ™å¤„ç† proxy_buffers 4 32k; // å‘Šè¯‰nginxä¿å­˜å•ä¸ªç”¨çš„å‡ ä¸ªbufferæœ€å¤§ç”¨å¤šå¤§ç©ºé—´ proxy_busy_buffers_size 64k; proxy_max_temp_file_size 64k; // proxyç¼“å­˜ä¸´æ—¶æ–‡ä»¶çš„å¤§å° upstream clubsrv { server 192.168.0.110:80 weight=5; server 192.168.0.121:80 weight=5; } upstream mysrv { server 192.168.0.32:80 weight=2; server 127.0.0.1:8000 weight=8; } server { listen 80; server_name club.xywy.com; charset gbk; root /www; access_log logs/bba.log combined; //ä¸‹é¢æ˜¯ç¬¬ä¸€ä¸ªåŸŸåï¼Œä½¿ç”¨clubsrvçš„ä»£ç† location / { proxy_next_upstream http_502 http_504 error timeout invalid_header; // å¦‚æœåç«¯æœåŠ¡å™¨è¿”å›502ã€504æˆ–æ‰§è¡Œè¶…æ—¶ç­‰é”™è¯¯ï¼Œè‡ªåŠ¨å°†è¯·æ±‚è½¬å‘åˆ°upstreamå¦ä¸€å°æœåŠ¡å™¨ proxy_pass http://clubsrv; // ä¸ä¸Šé¢upstreamè‡ªå·±å‘½åçš„åå­—å¡«å†™ä¸€è‡´ proxy_redirect off; proxy_set_header Host club.xywy.com; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; // nginxåœ¨å‰ç«¯åšä»£ç†ï¼Œåç«¯çš„æ—¥å¿—ä¼šæ˜¾ç¤º127.0.0.1ï¼Œä¸Šé¢é…ç½®å¯ä»¥æ˜¾ç¤ºç”¨æˆ·çœŸå®IPï¼ˆè¿˜éœ€è£…ç¬¬ä¸‰æ–¹è½¯ä»¶ï¼Œè§ä¸‹é¢çš„è¯¦ç»†è¯´æ˜ï¼‰ index index.htm index.html index.php; } //ä¸‹é¢æ˜¯ç¬¬äºŒä¸ªåŸŸåï¼Œä½¿ç”¨mysrvçš„ä»£ç†ï¼Œè®¿é—®www.sum.com/messageç›®å½•ä¸‹çš„ server { listen 80; server_name www.sum.com; location /message { proxy_pass http://mysrv; proxy_set_header Host $host; // è®¿é—®è¿™ä¸ªåŸŸåçš„ï¼Œåªæœ‰mysrv æœ¬æœºå¯ä»¥è®¿é—® } //è®¿é—®é™¤äº†/messageä¹‹å¤–çš„www.sum.com/ åœ°å€ï¼Œ location / { proxy_pass http://mysrv; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; ä¸‹é¢çš„é…ç½®ï¼Œä¸ä¸Šé¢é”™è¯¯è¿”å›çš„æ•ˆæœç›¸åŒï¼Œè¿™é‡Œå¯ä»¥ä¸å†™ã€‚ error_page 500 502 503 504 /50x.html; location = /50x.html { root html; } Nginxè´Ÿè½½å‡è¡¡æŒ‡ä»¤ # Nginxå±äºè½¯ä»¶çš„ä¸ƒå±‚è´Ÿè½½å‡è¡¡ï¼ˆlvsæ˜¯è½¯ä»¶çš„å››å±‚è´Ÿè½½å‡è¡¡çš„ä»£è¡¨ï¼‰ï¼Œä¸ƒå±‚è´Ÿè½½å‡è¡¡è½¯ä»¶è¿˜æœ‰L7SWï¼ˆLayer7\nswitchingï¼‰ã€HAProxyç­‰ã€‚æ”¯æŒè´Ÿè½½å‡è¡¡çš„æ¨¡å—æ˜¯Http Upstreamã€‚ä¸‹é¢ä»‹ç»æ­¤æ¨¡å—åŠä»–ä¸‹é¢çš„å‡ ä¸ªæŒ‡ä»¤\nHTTP Upstreamæ¨¡å— # ï¼ˆ1ï¼‰ip_hashæŒ‡ä»¤ # å½“å¯¹åç«¯çš„å¤šå°åŠ¨æ€åº”ç”¨æœåŠ¡å™¨åšè´Ÿè½½å‡è¡¡æ—¶ï¼Œip_hashæŒ‡ä»¤å°†æŸä¸ªå®¢æˆ·ç«¯IPçš„è¯·æ±‚é€šè¿‡å“ˆå¸Œç®—æ³•å®šä½åˆ°åŒä¸€å°åç«¯æœåŠ¡å™¨ä¸Šã€‚è¿™æ ·ï¼Œå½“æ¥è‡ªæŸipç”¨æˆ·åœ¨Sever\nAä¸Šç™»å½•åï¼Œå†è®¿é—®è¯¥ç«™ç‚¹çš„å…¶ä»–URLæ—¶ï¼Œèƒ½ä¿è¯è®¿é—®ä»åœ¨Server Aä¸Šã€‚\nå¦‚æœä¸åŠ ip_hashï¼ŒåŠ å…¥ç”¨æˆ·åœ¨Server Aä¸Šç™»å½•ï¼Œå†è®¿é—®è¯¥ç«™ç‚¹å…¶ä»–URLï¼Œå°±æœ‰å¯èƒ½è·³è½¬åˆ°åç«¯çš„Sever\nBã€Câ€¦..ï¼Œè€Œsessionè®°å½•åœ¨Aä¸Šï¼ŒBã€Cä¸Šæ²¡æœ‰ï¼Œå°±ä¼šæç¤ºç”¨æˆ·æœªç™»å½•ã€‚\næ³¨æ„ï¼šä½†è¿™ç§è®¿é—®ä¸èƒ½ä¿è¯åç«¯æœåŠ¡å™¨çš„è´Ÿè½½å‡è¡¡ï¼Œå¯èƒ½åç«¯æœ‰äº›serveræ¥å—åˆ°çš„è¯·æ±‚å¤šï¼Œæœ‰äº›serveræ¥å—çš„å°‘ï¼Œè®¾ç½®çš„æƒé‡å€¼ä¸èµ·ä½œç”¨ã€‚\nå»ºè®®å¦‚æœåç«¯çš„åŠ¨æ€åº”ç”¨ç¨‹åºæœåŠ¡å™¨èƒ½åšåˆ°sessionå…±äº«ï¼Œè€Œä¸ç”¨nginxä¸Šé…ç½®ip_hashçš„æ–¹å¼ã€‚\nupstream mysrv { ip_hash; server 192.168.0.110:80 weight=2; server 127.0.0.1:8000 down; server 192.168.0.212:80 weight=8; } ï¼ˆ2ï¼‰serveræŒ‡ä»¤ # è¯¥æŒ‡ä»¤ç”¨è¯­æŒ‡å®šåç«¯æœåŠ¡å™¨çš„åç§°å’Œå‚æ•°ã€‚æœåŠ¡å™¨çš„åç§°å¯ä»¥æ˜¯ä¸€ä¸ªåŸŸåï¼Œä¸€ä¸ªipï¼Œç«¯å£å·æˆ–UNIX Socketã€‚\nå‚æ•°ä»‹ç»ï¼š\nweight=number ï¼š è®¾ç½®æœåŠ¡å™¨æƒé‡ï¼Œæƒé‡å€¼è¶Šé«˜ï¼Œè¢«åˆ†é…åˆ°å®¢æˆ·ç«¯è¯·æ±‚æ•°è¶Šå¤šã€‚é»˜è®¤ä¸º1ï¼›\nmax_fails=numbser ï¼š\nåœ¨fail_timeoutæŒ‡å®šçš„æ—¶é—´å†…å¯¹åç«¯æœåŠ¡å™¨è¯·æ±‚å¤±è´¥çš„æ¬¡æ•°ï¼Œå¦‚æœæ£€æµ‹åˆ°åç«¯æœåŠ¡å™¨æ— æ³•è¿æ¥åŠå‘ç”Ÿé”™è¯¯ï¼ˆ404é™¤å¤–ï¼‰ï¼Œåˆ™æ ‡è®°ä¸ºå¤±è´¥ã€‚å¦‚æœæ²¡æœ‰è®¾ç½®ï¼Œé»˜è®¤ä¸º1ã€‚è®¾ç½®ä¸º0åˆ™å…³é—­è¿™é¡¹æ£€æŸ¥ã€‚\nfail_timeout=time ï¼š åœ¨ç»å†å‚æ•°max_failsè®¾ç½®çš„å¤±è´¥æ¬¡æ•°åï¼Œæš‚åœçš„æ—¶é—´ã€‚ down ï¼š è¡¨ç¤ºæœåŠ¡å™¨ä¸ºæ°¸ä¹…ç¦»çº¿çŠ¶æ€ã€‚ Backup ï¼š ä»…ä»…åœ¨ébackupæœåŠ¡å™¨å…¨éƒ¨downæˆ–ç¹å¿™çš„æ—¶å€™æ‰å¯ç”¨ã€‚ é…ç½®å¦‚ä¸‹ï¼š upstream mysrv { ip_hash; server www.xywy.com weight=2; server 127.0.0.1:8000 down; server 192.168.0.212:80 max_fails=3 fail_timeout=30s; server unix:/tmp/bakend3; } "},{"id":120,"href":"/blog/linux/rykY88V58CG/","title":"nignxä¿®æ”¹æœ€å¤§ä¸Šä¼ æ–‡ä»¶å¤§å°é™åˆ¶","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" none\nlocation / { root html; index index.html index.htm; client_max_body_size 1000m; } â€œclient_max_body_sizeâ€è®¾ç½®ä¸€ä¸‹ä¸Šä¼ çš„æœ€å¤§ä¸Šé™,ç„¶åé‡å¯nginxå³å¯ã€‚\n"},{"id":121,"href":"/blog/linux/HkXeLI4cIAG/","title":"rabbitmq æ¶ˆæ¯é˜Ÿåˆ—å®‰è£…å’Œé…ç½®","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" erlang # é¦–å…ˆå®‰è£…erlangè¯­è¨€ç¯å¢ƒ\nyum install erlang -y rabbitMQ # rabbitMQä¸‹è½½åœ°å€ï¼šç›´è¾¾å®‰è£…æ–¹æ³•:\nrpm -ivh --force --nodeps rabbitmq-server-3.6.0-1.noarch.rpm æˆ–è€… yum localinstall rabbitmq-server-3.6.0-1.noarch.rpm -y å¯åŠ¨æœåŠ¡ # /etc/init.d/rabbitmq-server start rabbitmq-plugins enable rabbitmq_management é…ç½®ä¸»å¤‡ # åŒæ­¥cookie # chmod 777 /var/lib/rabbitmq/.erlang.cookie scp /var/lib/rabbitmq/.erlang.cookie Go02:/var/lib/rabbitmq/.erlang.cookie chmod 400 /var/lib/rabbitmq/.erlang.cookie æ·»åŠ èŠ‚ç‚¹ # rabbitmqctl stop_app rabbitmqctl reset rabbitmqctl join_cluster [--ram] rabbit@Go01 //æ­¤å¤„çš„Go01ä¸ºä¸»èŠ‚ç‚¹çš„hostname,éœ€è¦åœ¨/etc/hostsä¸­æŒ‡å®š rabbitmqctl start_app åˆ é™¤èŠ‚ç‚¹ # rabbitmqctl stop_app rabbitmqctl forget_cluster_node rabbit@rabbit1 ä¿®æ”¹ç±»å‹ # rabbitmqctl stop_app rabbitmqctl change_cluster_node_type ram rabbitmqctl start_app æ·»åŠ ç”¨æˆ· # rabbitmqctl add_user admin admin æ·»åŠ æƒé™: rabbitmqctl set_permissions -p \u0026#34;/\u0026#34; admin \u0026#34;.*\u0026#34; \u0026#34;.*\u0026#34; \u0026#34;.*\u0026#34; åˆ é™¤æµ‹è¯•ç”¨æˆ·: rabbitmqctl delete_user guest èµ‹äºˆå…¶administratorè§’è‰²ï¼š rabbitmqctl set_user_tags admin administrator ä¿®æ”¹é…ç½® # //é˜²æ­¢æœåŠ¡ç«¯å¼‚å¸¸ä¸­æ–­æ¢å¤åé•œåƒé˜Ÿåˆ—ä¸èƒ½æ¢å¤çš„é—®é¢˜ vim /etc/rabbitmq/rabbitmq.conf [ {rabbit,[{tcp_listeners,[5672]}, {cluster_partition_handling, autoheal}]} ]. #ä¸è¦å¿˜è®°æœ€åé¢çš„é‚£ä¸ªç‚¹å·å“¦ï¼ ç¯å¢ƒå˜é‡ # touch /etc/rabbitmq/rabbitmq-env.conf#è¾“å…¥ RABBITMQ_NODENAME=FZTEC-240088 èŠ‚ç‚¹åç§° RABBITMQ_NODE_IP_ADDRESS=127.0.0.1 ç›‘å¬IP RABBITMQ_NODE_PORT=5672 ç›‘å¬ç«¯å£ RABBITMQ_LOG_BASE=/data/rabbitmq/log æ—¥å¿—ç›®å½• RABBITMQ_PLUGINS_DIR=/data/rabbitmq/plugins æ’ä»¶ç›®å½• RABBITMQ_MNESIA_BASE=/data/rabbitmq/mnesia åç«¯å­˜å‚¨ç›®å½• RabbitMQçš„ç”¨æˆ·è§’è‰²åˆ†ç±» # noneã€managementã€policymakerã€monitoringã€administrator\nRabbitMQå„ç±»è§’è‰²æè¿°ï¼š # none # ä¸èƒ½è®¿é—® management plugin\nmanagement # ç”¨æˆ·å¯ä»¥é€šè¿‡AMQPåšçš„ä»»ä½•äº‹å¤–åŠ ï¼š åˆ—å‡ºè‡ªå·±å¯ä»¥é€šè¿‡AMQPç™»å…¥çš„virtual hosts æŸ¥çœ‹è‡ªå·±çš„virtual hostsä¸­çš„queues,\nexchanges å’Œ bindings æŸ¥çœ‹å’Œå…³é—­è‡ªå·±çš„channels å’Œ connections æŸ¥çœ‹æœ‰å…³è‡ªå·±çš„virtual\nhostsçš„â€œå…¨å±€â€çš„ç»Ÿè®¡ä¿¡æ¯ï¼ŒåŒ…å«å…¶ä»–ç”¨æˆ·åœ¨è¿™äº›virtual hostsä¸­çš„æ´»åŠ¨ã€‚\npolicymaker # managementå¯ä»¥åšçš„ä»»ä½•äº‹å¤–åŠ ï¼š æŸ¥çœ‹ã€åˆ›å»ºå’Œåˆ é™¤è‡ªå·±çš„virtual hostsæ‰€å±çš„policieså’Œparameters\nmonitoring # managementå¯ä»¥åšçš„ä»»ä½•äº‹å¤–åŠ ï¼š åˆ—å‡ºæ‰€æœ‰virtual hostsï¼ŒåŒ…æ‹¬ä»–ä»¬ä¸èƒ½ç™»å½•çš„virtual hosts\næŸ¥çœ‹å…¶ä»–ç”¨æˆ·çš„connectionså’Œchannels æŸ¥çœ‹èŠ‚ç‚¹çº§åˆ«çš„æ•°æ®å¦‚clusteringå’Œmemoryä½¿ç”¨æƒ…å†µ æŸ¥çœ‹çœŸæ­£çš„å…³äºæ‰€æœ‰virtual\nhostsçš„å…¨å±€çš„ç»Ÿè®¡ä¿¡æ¯\nadministrator # policymakerå’Œmonitoringå¯ä»¥åšçš„ä»»ä½•äº‹å¤–åŠ : åˆ›å»ºå’Œåˆ é™¤virtual hosts æŸ¥çœ‹ã€åˆ›å»ºå’Œåˆ é™¤users\næŸ¥çœ‹åˆ›å»ºå’Œåˆ é™¤permissions å…³é—­å…¶ä»–ç”¨æˆ·çš„connections\n"},{"id":122,"href":"/blog/linux/HybPILE5U0z/","title":"RabbitMQä¸‰ç§Exchangeæ¨¡å¼(fanout,direct,topic)çš„æ€§èƒ½æ¯”è¾ƒ","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" none\nRabbitMQä¸­ï¼Œæ‰€æœ‰ç”Ÿäº§è€…æäº¤çš„æ¶ˆæ¯éƒ½ç”±Exchangeæ¥æ¥å—ï¼Œç„¶åExchangeæŒ‰ç…§ç‰¹å®šçš„ç­–ç•¥è½¬å‘åˆ°Queueè¿›è¡Œå­˜å‚¨\nRabbitMQæä¾›äº†å››ç§Exchangeï¼šfanout,direct,topic,header\nheaderæ¨¡å¼åœ¨å®é™…ä½¿ç”¨ä¸­è¾ƒå°‘ï¼Œæœ¬æ–‡åªå¯¹å‰ä¸‰ç§æ¨¡å¼è¿›è¡Œæ¯”è¾ƒã€‚\næ€§èƒ½æ’åºï¼šfanout \u0026gt; direct \u0026raquo; topicã€‚æ¯”ä¾‹å¤§çº¦ä¸º11ï¼š10ï¼š6\nä¸€.Direct Exchange # ä»»ä½•å‘é€åˆ°Direct Exchangeçš„æ¶ˆæ¯éƒ½ä¼šè¢«è½¬å‘åˆ°RouteKeyä¸­æŒ‡å®šçš„Queueã€‚\n1.ä¸€èˆ¬æƒ…å†µå¯ä»¥ä½¿ç”¨rabbitMQè‡ªå¸¦çš„Exchangeï¼šâ€â€(è¯¥Exchangeçš„åå­—ä¸ºç©ºå­—ç¬¦ä¸²ï¼Œä¸‹æ–‡ç§°å…¶ä¸ºdefault Exchange)ã€‚\n2.è¿™ç§æ¨¡å¼ä¸‹ä¸éœ€è¦å°†Exchangeè¿›è¡Œä»»ä½•ç»‘å®š(binding)æ“ä½œ\n3.æ¶ˆæ¯ä¼ é€’æ—¶éœ€è¦ä¸€ä¸ªâ€œRouteKeyâ€ï¼Œå¯ä»¥ç®€å•çš„ç†è§£ä¸ºè¦å‘é€åˆ°çš„é˜Ÿåˆ—åå­—ã€‚\n4.å¦‚æœvhostä¸­ä¸å­˜åœ¨RouteKeyä¸­æŒ‡å®šçš„é˜Ÿåˆ—åï¼Œåˆ™è¯¥æ¶ˆæ¯ä¼šè¢«æŠ›å¼ƒã€‚\näºŒ.Fanout Exchange # ä»»ä½•å‘é€åˆ°Fanout Exchangeçš„æ¶ˆæ¯éƒ½ä¼šè¢«è½¬å‘åˆ°ä¸è¯¥Exchangeç»‘å®š(Binding)çš„æ‰€æœ‰Queueä¸Šã€‚\n1.å¯ä»¥ç†è§£ä¸ºè·¯ç”±è¡¨çš„æ¨¡å¼\n2.è¿™ç§æ¨¡å¼ä¸éœ€è¦RouteKey\n3.è¿™ç§æ¨¡å¼éœ€è¦æå‰å°†Exchangeä¸Queueè¿›è¡Œç»‘å®šï¼Œä¸€ä¸ªExchangeå¯ä»¥ç»‘å®šå¤šä¸ªQueueï¼Œä¸€ä¸ªQueueå¯ä»¥åŒå¤šä¸ªExchangeè¿›è¡Œç»‘å®šã€‚\n4.å¦‚æœæ¥å—åˆ°æ¶ˆæ¯çš„Exchangeæ²¡æœ‰ä¸ä»»ä½•Queueç»‘å®šï¼Œåˆ™æ¶ˆæ¯ä¼šè¢«æŠ›å¼ƒã€‚\nä¸‰.Topic Exchange # ä»»ä½•å‘é€åˆ°Topic Exchangeçš„æ¶ˆæ¯éƒ½ä¼šè¢«è½¬å‘åˆ°æ‰€æœ‰å…³å¿ƒRouteKeyä¸­æŒ‡å®šè¯é¢˜çš„Queueä¸Š\n1.è¿™ç§æ¨¡å¼è¾ƒä¸ºå¤æ‚ï¼Œç®€å•æ¥è¯´ï¼Œå°±æ˜¯æ¯ä¸ªé˜Ÿåˆ—éƒ½æœ‰å…¶å…³å¿ƒçš„ä¸»é¢˜ï¼Œæ‰€æœ‰çš„æ¶ˆæ¯éƒ½å¸¦æœ‰ä¸€ä¸ªâ€œæ ‡é¢˜â€(RouteKey)ï¼ŒExchangeä¼šå°†æ¶ˆæ¯è½¬å‘åˆ°æ‰€æœ‰å…³æ³¨ä¸»é¢˜èƒ½ä¸RouteKeyæ¨¡ç³ŠåŒ¹é…çš„é˜Ÿåˆ—ã€‚\n2.è¿™ç§æ¨¡å¼éœ€è¦RouteKeyï¼Œä¹Ÿè®¸è¦æå‰ç»‘å®šExchangeä¸Queueã€‚\n3.åœ¨è¿›è¡Œç»‘å®šæ—¶ï¼Œè¦æä¾›ä¸€ä¸ªè¯¥é˜Ÿåˆ—å…³å¿ƒçš„ä¸»é¢˜ï¼Œå¦‚â€œ#.log.#â€è¡¨ç¤ºè¯¥é˜Ÿåˆ—å…³å¿ƒæ‰€æœ‰æ¶‰åŠlogçš„æ¶ˆæ¯(ä¸€ä¸ªRouteKeyä¸ºâ€MQ.log.errorâ€çš„æ¶ˆæ¯ä¼šè¢«è½¬å‘åˆ°è¯¥é˜Ÿåˆ—)ã€‚\n4.â€œ#â€è¡¨ç¤º0ä¸ªæˆ–è‹¥å¹²ä¸ªå…³é”®å­—ï¼Œâ€œâ€è¡¨ç¤ºä¸€ä¸ªå…³é”®å­—ã€‚å¦‚â€œlog.â€èƒ½ä¸â€œlog.warnâ€åŒ¹é…ï¼Œæ— æ³•ä¸â€œlog.warn.timeoutâ€åŒ¹é…ï¼›ä½†æ˜¯â€œlog.#â€èƒ½ä¸ä¸Šè¿°ä¸¤è€…åŒ¹é…ã€‚\n5.åŒæ ·ï¼Œå¦‚æœExchangeæ²¡æœ‰å‘ç°èƒ½å¤Ÿä¸RouteKeyåŒ¹é…çš„Queueï¼Œåˆ™ä¼šæŠ›å¼ƒæ­¤æ¶ˆæ¯ã€‚\nåŸæ–‡åœ°å€ï¼šhttp://www.gaort.com/index.php/archives/366\n"},{"id":123,"href":"/blog/linux/H1z5LL49I0z/","title":"RabbitMQæ€§èƒ½ä¼˜åŒ–","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" none\nrabbitmq.config # rabbitmq.configæ–‡ä»¶æ—¶rabbitmqçš„é…ç½®æ–‡ä»¶ï¼Œä»–éµå®ˆErlangé…ç½®æ–‡ä»¶å®šä¹‰ã€‚\nrabbitmq.configæ–‡ä»¶ä½ç½®ï¼š\nUnix $RABBITMQ_HOME/etc/rabbitmq Windows %APPDATA%\\RabbitMQ\\ ä¾‹å­å¦‚ä¸‹ï¼š\n[ {mnesia, [{dump_log_write_threshold, 1000}]}, {rabbit, [{tcp_listeners, [5673]}]} ]. Memoryé…ç½®å’Œè®¾ç½® # RabbitMQåœ¨ä½¿ç”¨å½“å‰æœºå™¨çš„40%ä»¥ä¸Šå†…å­˜æ—¶å€™ï¼Œä¼šå‘å‡ºå†…å­˜è­¦å‘Šï¼Œå¹¶ç»„ç»‡RabbitMQæ‰€æœ‰è¿æ¥ï¼ˆproducerè¿æ¥ï¼‰ã€‚ç›´åˆ°RabbitMQå°†å½“å‰æ•°æ®åˆ·å…¥åˆ°ç¡¬ç›˜æˆ–è€…æ¶ˆæ¯è¢«å®¢æˆ·ç«¯æ¶ˆè´¹ã€‚\nå½“Erlangçš„åƒåœ¾å›æ”¶æœºåˆ¶è¿è¡Œèµ·æ¥ï¼ˆè¿™æ˜¯ä¸€ä¸ªéå¸¸è€—è´¹èµ„æºçš„å·¥ä½œï¼‰ï¼Œä¼šæ¶ˆè´¹ä¸¤å€å†…å­˜ã€‚ï¼ˆé»˜è®¤æ˜¯80%çš„å†…å­˜ï¼‰ã€‚å› æ­¤éœ€è¦æ“ä½œç³»ç»Ÿæ”¯æŒOS swapå’Œpage\nfile.\næ³¨æ„ï¼šåœ¨32ä¸ºæ¶æ„ä¸‹ï¼Œæ¯ä¸ªè¿›ç¨‹è¢«é™åˆ¶ä¸º2GBã€‚é€šå¸¸64æ¶æ„ç³»ç»Ÿé™åˆ¶æ¯ä¸ªè¿›ç¨‹ä¸º256TBï¼Œ64ä½windowsé™åˆ¶ä¸º8TBã€‚å°±ç®—åœ¨64ä½æ“ä½œç³»ç»Ÿä¸‹ï¼Œ32ä½çš„è¿›ç¨‹åªèƒ½ç”¨2GBå†…å­˜ã€‚\nå› æ­¤å¼ºçƒˆæ¨èä½¿ç”¨64bit Erlang vmå’Œ64bit osã€‚\nå½“RabbitMQä¸èƒ½è¯†åˆ«ä½ çš„ç³»ç»Ÿçš„æ—¶å€™ï¼Œä½ å¿…é¡»å¯¹vm_memory_high_watermarkè¿›è¡Œä¿®æ”¹ã€‚\nå½“rabbitmqä¸èƒ½è¯†åˆ«ç³»ç»Ÿçš„æ—¶å€™ï¼Œä¼šè®¾ç½®å†…å­˜ä¸º1024MBã€‚æ‰€ä»¥rabbitmqå®é™…ä½¿ç”¨çš„å†…å­˜ä»…ä»…410MBã€‚\nå½“ç³»ç»Ÿä¸º8GBçš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ˜¯vm_memory_high_watermark=3ï¼Œé‚£ä¹ˆæˆ‘ä»¬å®é™…å¯ä»¥ä½¿ç”¨çš„å†…å­˜ä¸º3GBã€‚\né…ç½®Memory Thresholdæ–‡ä»¶\né»˜è®¤é…ç½®RabbitMQçš„vm_memory_high_watermark=0.4\n[{rabbit, [{vm_memory_high_watermark, 0.4}]}]. ä¸¾ä¾‹è¯´æ˜ï¼š # å½“æœºå™¨å†…å­˜ä¸º16GBï¼Œé‚£ä¹ˆ40%ï¼Œä¸º6.4GBã€‚ä¸»è¦å½“32ç³»ç»Ÿæ—¶å€™ï¼Œå®é™…å¯ä»¥ä½¿ç”¨çš„å†…å­˜ä¸º2GBï¼Œé‚£ä¹ˆå®é™…å¯ä»¥ä½¿ç”¨çš„å†…å­˜ä¸º820MBã€‚\nå½“æˆ‘é…ç½®vm_memory_high_watermark=0 æˆ‘ä»¬å¯ä»¥é˜»æ­¢æ‰€æœ‰æ¶ˆæ¯å‘é€ã€‚\næ³¨æ„ï¼šè¿™ä¸ªç™¾åˆ†æ¯”ï¼Œæœ€å¥½ä¸è¦ä¿®æ”¹ã€‚åº”ä¸ºErlang VMå›æ”¶çš„æ—¶å€™ä¼šå æ®ç³»ç»Ÿå†…å­˜çš„80%ã€‚å·²ç»è¾¾åˆ°ç³»ç»Ÿä¸´ç•ŒåŒºã€‚ä¸è¦è®¾ç½®è¶…è¿‡50%çš„ç™¾åˆ†æ¯”ã€‚\né…ç½®Page Thresholdæ–‡ä»¶ # å½“å†…å­˜ä¸­çš„æ•°æ®è¾¾åˆ°ä¸€å®šæ•°é‡åï¼Œä»–éœ€è¦è¢«page outå‡ºæ¥ã€‚ é»˜è®¤é…ç½®\nvm_memory_high_watermark_paging_ratio=0.5ã€‚ä¹Ÿå°±æ˜¯vm_memory_high_watermark0.5ã€‚å‡è®¾æ€»å†…å­˜8GBï¼Œ0.4çš„ä½¿ç”¨å†…å­˜æ˜¯3.2ã€‚é‚£ä¹ˆå½“å†…å­˜å¨å¨3.20.5=1.6GBæ—¶å€™ï¼Œç³»ç»Ÿå°†ä¼šå¤§é‡ç½®æ¢é¡µé¢ã€‚\nå› æ­¤æˆ‘ä»¬å¯ä»¥å°†é¡µé¢ç½®æ¢çš„ç™¾åˆ†æ¯”è°ƒé«˜ã€‚è®¾ç½®ä¸º0.75\n[{rabbit, [{vm_memory_high_watermark_paging_ratio, 0.75}, {vm_memory_high_watermark, 0.4}]}]. æ³¨æ„ï¼šæˆ‘ä»¬å¯ä»¥å°†vm_memory_high_watermark_paging_ratioè®¾ç½®è¶…è¿‡1.0ï¼Œé‚£ä¹ˆä¸ä¼šå‘ç”Ÿå†…å­˜æ¢é¡µçš„æƒ…å†µï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå½“å†…å­˜è¶…è¿‡æ€»å†…å­˜çš„40%ä¹‹åï¼Œå°†ä¼šé˜»æ­¢æ‰€æœ‰produceräº§ç”Ÿæ¶ˆæ¯ã€‚\né…ç½®å‘½ä»¤ # rabbitmqctl set_vm_memory_high_watermark 0.4 è¿™æ˜¯å†…å­˜ä½¿ç”¨å æ€»å†…å­˜æ•°çš„ç™¾åˆ†æ¯”\nrabbitmqctl set_vm_memory_high_watermark_paging_ratio 0.75 è®¾ç½®rabbitmqä½¿ç”¨å†…å­˜è¾¾åˆ°rabbitmqå¯ç”¨å†…å­˜ç™¾åˆ†æ¯”ï¼Œå°±å‡ºå‘é¡µé¢äº¤æ¢åŠŸèƒ½ã€‚\nrabbitmqctl status è·å¾—ç³»ç»Ÿé…ç½®ã€‚\nDiské…ç½®å’Œè®¾ç½® # RabbitMQä¼šåœ¨ç¡¬ç›˜ç©ºé—´ä¸å¤Ÿçš„æ—¶å€™ï¼Œé˜»æ­¢Producerå‘é€æ¶ˆæ¯ã€‚è¿™æ ·å¯ä»¥ä¿è¯RabbitMQå¯ä»¥å†ä»»ä½•æ—¶å€™ï¼Œå°†å†…å­˜ä¸­çš„æ•°æ®ç½®æ¢åˆ°ç£ç›˜ä¸­æ¥ã€‚é€šå¸¸ä¼šå°†ç¡¬ç›˜å‰©ä½™æ•°æ®å¤§å°è®¾ç½®ä¸ºæœºå™¨çš„æ€»å†…å­˜å¤§å°ã€‚\nå…¨å±€æµæ§åˆ¶ä¼šè¢«è§¦å‘ï¼Œå½“å¯ç”¨æ€»ç¡¬ç›˜å®¹é‡å·²ç»ä½äºé…ç½®ä¿¡æ¯ã€‚brokeræ•°æ®åº“å°†ä¼šæœ€å°‘10ç§’æ£€æŸ¥ä¸€ä¸‹è­¦å‘Šæ˜¯å¦å‘å‡ºæˆ–è€…æ¸…é™¤ã€‚\nåœ¨RabbitMQå¯åŠ¨çš„åï¼Œä¼šæ‰“å°disk limité™åˆ¶ï¼Œä½†æ˜¯ä¸èƒ½è¯†åˆ«çš„å¹³å°å°±ä¸èƒ½æ˜¾ç¤ºä¿¡æ¯ã€‚\næ³¨æ„ï¼šå½“RabbitMQæ˜¯é›†ç¾¤æƒ…å†µä¸‹ï¼Œå½“å…¶ä¸­æœ‰ä¸€å°æœºå™¨ç¡¬ç›˜ä¸è¶³çš„æ—¶å€™ï¼Œæ‰€æœ‰èŠ‚ç‚¹çš„produceré“¾æ¥éƒ½ä¼šè¢«é˜»æ­¢ã€‚\nRabbitMQä¼šå®šæœŸä»·æ£€æŸ¥æ€»ç£ç›˜å¯ç”¨ç©ºé—´çš„å¤§å°ã€‚é€šå¸¸æ—¶é—´ä¸º10ç§’æ¯æ¬¡ï¼Œå½“é™åˆ¶å¿«è¢«è¾¾åˆ°æ—¶å€™ï¼ŒRabbitMQæ£€æŸ¥çš„æ—¶å€™ä¼šè¾¾åˆ°10æ¬¡/s.\né…ç½®Disk Free Space Limit # æˆ‘ä»¬å¯ä»¥ç›´æ¥è®¾ç½®ç¡¬ç›˜çš„æœ€å°é™åˆ¶ã€‚ä¹Ÿå¯ä»¥è®¾ç½®ç›¸å¯¹å†…å­˜å¤§å°çš„è®¾ç½®ã€‚\nå…ˆè®¾ç½®ç£ç›˜1GBé™åˆ¶\n[{rabbit, [{disk_free_limit, 1000000000}]}]. åœ¨è¿™æ—¶ç›¸å¯¹äºæœºå™¨æ€»å†…å­˜\n[{rabbit, [{disk_free_limit, {mem_relative, 1.0}}]}]. Erlangçš„Hipeä¼˜åŒ– # å¯ä»¥è®¾ç½®hipe_compilesè®¾ç½®ã€‚å¯ä»¥çœ‹åˆ°æœ‰20-50%çš„æ€§èƒ½ä¼˜åŒ–ã€‚è€Œä½ åªéœ€è¦ä»˜å‡º1åˆ†é’Ÿå·¦å³çš„å»¶è¿Ÿå¯åŠ¨ã€‚\nHiPEéœ€è¦ä½ æ£€æŸ¥æ˜¯å¦ç¼–è¯‘è¿›å…¥ä½ çš„Erlangå®‰è£…ç¯å¢ƒã€‚Ubuntuï¼Œéœ€è¦å®‰è£…erlang-base-hipe.é»˜è®¤æœ‰äº›å¹³å°ä¸æ”¯æŒã€‚å¦‚æœErlang VM\nsegfaults,è¯·å…³é—­è¿™ä¸ªé€‰é¡¹ã€‚\n[{rabbit, [{hipe_compile, true}]}]. å‚è€ƒï¼šhttp://www.rabbitmq.com/configure.html#configuration-file\n"},{"id":124,"href":"/blog/linux/rkCKI84cLAG/","title":"rabbitmqä¹‹æœºå™¨æœºå™¨å…¨éƒ¨æ–­ç”µæ¢å¤è®°å½•","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":"ä»Šå¤©é‡åˆ°ä¸€ä¸ªrabbitmqé›†ç¾¤åŒæ—¶æ–­ç”µï¼Œå½“æœºå™¨å…¨éƒ¨å¯åŠ¨çš„æ—¶å€™å‘ç°rabbitmqæ— æ³•æ­£å¸¸å¯åŠ¨ï¼Œç„¶åå‘ç°å¦‚ä¸‹æ—¥å¿—ã€‚\n=INFO REPORT==== 25-Apr-2018::11:11:07 === Starting RabbitMQ 3.5.3 on Erlang R16B03-1 Copyright (C) 2007-2014 GoPivotal, Inc. Licensed under the MPL. See http://www.rabbitmq.com/ =INFO REPORT==== 25-Apr-2018::11:11:07 === node : rabbit@WIN-ACC2J7AGNM9 home dir : C:\\Users\\Administrator config file(s) : e:/RabbitMQ Data/rabbitmq.config (not found) cookie hash : kR4NuIdBr2n8/4Qt9uIgqQ== log : E:/RabbitMQ Data/log/rabbit@WIN-ACC2J7AGNM9.log sasl log : E:/RabbitMQ Data/log/rabbit@WIN-ACC2J7AGNM9-sasl.log database dir : e:/RabbitMQ Data/db/rabbit@WIN-ACC2J7AGNM9-mnesia =WARNING REPORT==== 25-Apr-2018::11:11:07 === Kernel poll (epoll, kqueue, etc) is disabled. Throughput and CPU utilization may worsen. =INFO REPORT==== 25-Apr-2018::11:11:08 === Memory limit set to 13095MB of 32738MB total. =INFO REPORT==== 25-Apr-2018::11:11:08 === Disk free limit set to 50MB =INFO REPORT==== 25-Apr-2018::11:11:08 === Limiting to approx 8092 file handles (7280 sockets) =INFO REPORT==== 25-Apr-2018::11:11:38 === Timeout contacting cluster nodes: [\u0026#39;rabbit@WIN-2W6NDAIZBIA\u0026#39;]. BACKGROUND ========== This cluster node was shut down while other nodes were still running. To avoid losing data, you should start the other nodes first, then start this one. To force this node to start, first invoke \u0026#34;rabbitmqctl force_boot\u0026#34;. If you do so, any changes made on other cluster nodes after this one was shut down may be lost. DIAGNOSTICS =========== attempted to contact: [\u0026#39;rabbit@WIN-2W6NDAIZBIA\u0026#39;] rabbit@WIN-2W6NDAIZBIA: * connected to epmd (port 4369) on WIN-2W6NDAIZBIA * epmd reports: node \u0026#39;rabbit\u0026#39; not running at all no other nodes on WIN-2W6NDAIZBIA * suggestion: start the node current node details: - node name: \u0026#39;rabbit@WIN-ACC2J7AGNM9\u0026#39; - home dir: C:\\Users\\Administrator - cookie hash: kR4NuIdBr2n8/4Qt9uIgqQ== å…³é”®çš„åœ°æ–¹åœ¨äºä¸­é—´çš„è¿™æ®µè¯´æ˜ï¼š\nThis cluster node was shut down while other nodes were still running. To avoid losing data, you should start the other nodes first, then start this one. To force this node to start, first invoke \u0026#34;rabbitmqctl force_boot\u0026#34;. If you do so, any changes made on other cluster nodes after this one was shut down may be lost. åªè¦æ‰§è¡Œrabbitmqctl force_bootï¼Œå°†æ‰€æœ‰çš„èŠ‚ç‚¹å…¨éƒ¨å¼ºåˆ¶è®¾ç½®æˆæœ€åä¸€ä¸ªå…³é—­çš„å³å¯ã€‚\n"},{"id":125,"href":"/blog/linux/ry3FIUV58AM/","title":"rabbitmqä¹‹ä¿®æ”¹æ•°æ®å’Œlogç›®å½•ä½ç½®ä½ç½®","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" vim /etc/rabbitmq/rabbitmq-env.conf\nI am a complete /etc/rabbitmq/rabbitmq-eâ€¦ # vim /etc/rabbitmq/rabbitmq-env.conf # I am a complete /etc/rabbitmq/rabbitmq-env.conf file. # Comment lines start with a hash character. # This is a /bin/sh script file - use ordinary envt var syntax MNESIA_BASE=/data/rabbitmq/mnesia LOG_BASE=/data/logs/rabbitmq "},{"id":126,"href":"/blog/ffmpeg/S1EdILNqU0M/","title":"Rematrix is needed between 10 channels and 7.1(wide) but there is not enough","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" è§£å†³åŠæ³•\nå°†10ä¸ªå£°é“æ‹†åˆ†æˆ10ä¸ªéŸ³è½¨\nffmpeg -i INPUTFILE -filter_complex â€œ[0:a]pan=mono|c0=c0[â€¦\nè§£å†³åŠæ³• # å°†10ä¸ªå£°é“æ‹†åˆ†æˆ10ä¸ªéŸ³è½¨\nffmpeg -i INPUTFILE -filter_complex \u0026#34;[0:a]pan=mono|c0=c0[a0];[0:a]pan=mono|c0=c1[a1];[0:a]pan=mono|c0=c2[a2];[0:a]pan=mono|c0=c3[a3];[0:a]pan=mono|c0=c4[a4];[0:a]pan=mono|c0=c5[a5];[0:a]pan=mono|c0=c6[a6];[0:a]pan=mono|c0=c7[a7];[0:a]pan=mono|c0=c8[a8];[0:a]pan=mono|c0=c9[a9]\u0026#34; -map \u0026#34;[a0]\u0026#34; -map \u0026#34;[a1]\u0026#34; -map \u0026#34;[a2]\u0026#34; -map \u0026#34;[a3]\u0026#34; -map \u0026#34;[a4]\u0026#34; -map \u0026#34;[a5]\u0026#34; -map \u0026#34;[a6]\u0026#34; -map \u0026#34;[a7]\u0026#34; -map \u0026#34;[a8]\u0026#34; -map \u0026#34;[a9]\u0026#34; -vn -c:a pcm_s24le OUTPUTFILE ffmpeg -i INPUTFILE -vn -c:a pcm_s24le -map 0:1 -filter:a:0 \u0026#34;pan=mono|c0=c0\u0026#34; -map 0:1 -filter:a:1 \u0026#34;pan=mono|c0=c1\u0026#34; -map 0:1 -filter:a:2 \u0026#34;pan=mono|c0=c2\u0026#34; -map 0:1 -filter:a:3 \u0026#34;pan=mono|c0=c3\u0026#34; -map 0:1 -filter:a:4 \u0026#34;pan=mono|c0=c4\u0026#34; -map 0:1 -filter:a:5 \u0026#34;pan=mono|c0=c5\u0026#34; -map 0:1 -filter:a:6 \u0026#34;pan=mono|c0=c6\u0026#34; -map 0:1 -filter:a:7 \u0026#34;pan=mono|c0=c7\u0026#34; -map 0:1 -filter:a:8 \u0026#34;pan=mono|c0=c8\u0026#34; -map 0:1 -filter:a:9 \u0026#34;pan=mono|c0=c9\u0026#34; OUTPUTFILE "},{"id":127,"href":"/blog/linux/B11rILN5UAz/","title":"Ubuntu é˜¿é‡Œäº‘é•œåƒæº","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" å‡†å¤‡å·¥ä½œ # sudo cp /etc/apt/sources.list /etc/apt/sources.list.bak #å¤‡ä»½ ä¿®æ”¹é…ç½® # 14.04 # sudo vim /etc/apt/sources.list #ä¿®æ”¹ deb http://mirrors.aliyun.com/ubuntu/ trusty main restricted universe multiverse deb http://mirrors.aliyun.com/ubuntu/ trusty-security main restricted universe multiverse deb http://mirrors.aliyun.com/ubuntu/ trusty-updates main restricted universe multiverse deb http://mirrors.aliyun.com/ubuntu/ trusty-proposed main restricted universe multiverse deb http://mirrors.aliyun.com/ubuntu/ trusty-backports main restricted universe multiverse deb-src http://mirrors.aliyun.com/ubuntu/ trusty main restricted universe multiverse deb-src http://mirrors.aliyun.com/ubuntu/ trusty-security main restricted universe multiverse deb-src http://mirrors.aliyun.com/ubuntu/ trusty-updates main restricted universe multiverse deb-src http://mirrors.aliyun.com/ubuntu/ trusty-proposed main restricted universe multiverse deb-src http://mirrors.aliyun.com/ubuntu/ trusty-backports main restricted universe multiverse 16.04 # sudo vim /etc/apt/sources.list #ä¿®æ”¹ deb-src http://archive.ubuntu.com/ubuntu xenial main restricted #Added by software-properties deb http://mirrors.aliyun.com/ubuntu/ xenial main restricted deb-src http://mirrors.aliyun.com/ubuntu/ xenial main restricted multiverse universe #Added by software-properties deb http://mirrors.aliyun.com/ubuntu/ xenial-updates main restricted deb-src http://mirrors.aliyun.com/ubuntu/ xenial-updates main restricted multiverse universe #Added by software-properties deb http://mirrors.aliyun.com/ubuntu/ xenial universe deb http://mirrors.aliyun.com/ubuntu/ xenial-updates universe deb http://mirrors.aliyun.com/ubuntu/ xenial multiverse deb http://mirrors.aliyun.com/ubuntu/ xenial-updates multiverse deb http://mirrors.aliyun.com/ubuntu/ xenial-backports main restricted universe multiverse deb-src http://mirrors.aliyun.com/ubuntu/ xenial-backports main restricted universe multiverse #Added by software-properties deb http://archive.canonical.com/ubuntu xenial partner deb-src http://archive.canonical.com/ubuntu xenial partner deb http://mirrors.aliyun.com/ubuntu/ xenial-security main restricted deb-src http://mirrors.aliyun.com/ubuntu/ xenial-security main restricted multiverse universe #Added by software-properties deb http://mirrors.aliyun.com/ubuntu/ xenial-security universe deb http://mirrors.aliyun.com/ubuntu/ xenial-security multiverse æ›´æ–°ç¼“å­˜ # sudo apt-get update #æ›´æ–°åˆ—è¡¨ "},{"id":128,"href":"/blog/linux/HyGHL8E5LRM/","title":"ubuntuç¼–è¯‘å®‰è£…vimåŠé…åˆ¶æ–¹æ³•","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" ä¸€ä¸ªéå¸¸å¥½ç”¨çš„vimé…ç½®æ–‡ä»¶\nvimç®€ä»‹ # Vimæ˜¯ä¸€ä¸ªç±»ä¼¼äºViçš„è‘—åçš„åŠŸèƒ½å¼ºå¤§ã€é«˜åº¦å¯å®šåˆ¶çš„æ–‡æœ¬ç¼–è¾‘å™¨ï¼Œåœ¨Viçš„åŸºç¡€ä¸Šæ”¹è¿›å’Œå¢åŠ äº†å¾ˆå¤šç‰¹æ€§ã€‚VIMæ˜¯è‡ªç”±è½¯ä»¶ã€‚\nVimæ™®éè¢«æ¨å´‡ä¸ºç±»Viç¼–è¾‘å™¨ä¸­æœ€å¥½çš„ä¸€ä¸ªï¼Œäº‹å®ä¸ŠçœŸæ­£çš„åŠ²æ•Œæ¥è‡ªEmacsçš„ä¸åŒå˜ä½“ã€‚1999\nå¹´Emacsè¢«é€‰ä¸ºLinuxworldæ–‡æœ¬ç¼–è¾‘åˆ†ç±»çš„ä¼˜èƒœè€…ï¼ŒVimå±ˆå±…ç¬¬äºŒã€‚ä½†åœ¨2000å¹´2æœˆVimèµ¢å¾—äº†Slashdot\nBeanieçš„æœ€ä½³å¼€æ”¾æºä»£ç æ–‡æœ¬ç¼–è¾‘å™¨å¤§å¥–ï¼Œåˆå°†Emacsæ¨è‡³äºŒçº¿ï¼Œ æ€»çš„æ¥çœ‹ï¼Œ Vimå’ŒEmacsåœ¨æ–‡æœ¬ç¼–è¾‘æ–¹é¢éƒ½æ˜¯éå¸¸ä¼˜ç§€çš„ã€‚\nå‡†å¤‡ç¯å¢ƒ # sudo apt-get install libncurses5-dev libgnome2-dev libgnomeui-dev \\ libgtk2.0-dev libatk1.0-dev libbonoboui2-dev \\ libcairo2-dev libx11-dev libxpm-dev libxt-dev python-dev \\ python3-dev ruby-dev liblua5.1 lua5.1-dev libperl-dev git ç§»é™¤vim # dpkg -l | grep vim sudo apt-get remove vim-common vim-tiny ä¸‹è½½æºç  # git clone https://github.com/vim/vim.git # ç¼–è¯‘vim # cd vim ./configure --with-features=huge \\ --enable-multibyte \\ --enable-rubyinterp=yes \\ --enable-pythoninterp=yes \\ --with-python-config-dir=/usr/lib/python2.7/config \\ --enable-python3interp=yes \\ --with-python3-config-dir=/usr/lib/python3.5/config \\ --enable-perlinterp=yes \\ --enable-luainterp=yes \\ --enable-gui=gtk2 --enable-cscope --prefix=/usr make VIMRUNTIMEDIR=/usr/share/vim/vim80 sudo make install é…åˆ¶vim # sh \u0026lt;(curl https://j.mp/spf13-vim3 -L) "},{"id":129,"href":"/blog/linux/BJ8I8E9U0M/","title":"vim å¿«é€Ÿå…¥é—¨æ‰‹å†Œ","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" vimå¸¸è§æ“ä½œ\nå›¾ç¤º # ![vi-vim-cheat-sheet-sch.png](/static/uploads/BJ8I8E9U0M/img/vi-vim-cheat-\nsheet-sch_SyLsV8yY4.png)\nä¸€ã€ç§»åŠ¨å…‰æ ‡ # 1ã€å·¦ç§»hã€å³ç§»lã€ä¸‹ç§»jã€ä¸Šç§»k\n2ã€å‘ä¸‹ç¿»é¡µctrl + fï¼Œå‘ä¸Šç¿»é¡µctrl + b\n3ã€å‘ä¸‹ç¿»åŠé¡µctrl + dï¼Œå‘ä¸Šç¿»åŠé¡µctrl + u\n4ã€ç§»åŠ¨åˆ°è¡Œå°¾$ï¼Œç§»åŠ¨åˆ°è¡Œé¦–0ï¼ˆæ•°å­—ï¼‰ï¼Œç§»åŠ¨åˆ°è¡Œé¦–ç¬¬ä¸€ä¸ªå­—ç¬¦å¤„^\n5ã€ç§»åŠ¨å…‰æ ‡åˆ°ä¸‹ä¸€ä¸ªå¥å­ ï¼‰ï¼Œç§»åŠ¨å…‰æ ‡åˆ°ä¸Šä¸€ä¸ªå¥å­ï¼ˆ\n6ã€ç§»åŠ¨åˆ°æ®µé¦–{ï¼Œç§»åŠ¨åˆ°æ®µå°¾}\n7ã€ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªè¯wï¼Œç§»åŠ¨åˆ°ä¸Šä¸€ä¸ªè¯b\n8ã€ç§»åŠ¨åˆ°æ–‡æ¡£å¼€å§‹ggï¼Œç§»åŠ¨åˆ°æ–‡æ¡£ç»“æŸG\n9ã€ç§»åŠ¨åˆ°åŒ¹é…çš„{}.().[]å¤„%\n10ã€è·³åˆ°ç¬¬nè¡Œ ngg æˆ– nG æˆ– :n\n11ã€ç§»åŠ¨å…‰æ ‡åˆ°å±å¹•é¡¶ç«¯Hï¼Œç§»åŠ¨åˆ°å±å¹•ä¸­é—´Mï¼Œç§»åŠ¨åˆ°åº•éƒ¨L\n12ã€è¯»å–å½“å‰å­—ç¬¦ï¼Œå¹¶ç§»åŠ¨åˆ°æœ¬å±å¹•å†…ä¸‹ä¸€æ¬¡å‡ºç°çš„åœ°æ–¹ *\n13ã€è¯»å–å½“å‰å­—ç¬¦ï¼Œå¹¶ç§»åŠ¨åˆ°æœ¬å±å¹•å†…ä¸Šä¸€æ¬¡å‡ºç°çš„åœ°æ–¹ #\näºŒã€æŸ¥æ‰¾æ›¿æ¢ # 1ã€å…‰æ ‡å‘åæŸ¥æ‰¾å…³é”®å­— #æˆ–è€…g#\n2ã€å…‰æ ‡å‘å‰æŸ¥æ‰¾å…³é”®å­— æˆ–è€…g\n3ã€å½“å‰è¡ŒæŸ¥æ‰¾å­—ç¬¦ fx, Fx, tx, Tx\n4ã€åŸºæœ¬æ›¿æ¢ :s/s1/s2 ï¼ˆå°†ä¸‹ä¸€ä¸ªs1æ›¿æ¢ä¸ºs2ï¼‰\n5ã€å…¨éƒ¨æ›¿æ¢ :%s/s1/s2 6ã€åªæ›¿æ¢å½“å‰è¡Œ :s/s1/s2/g\n7ã€æ›¿æ¢æŸäº›è¡Œ :n1,n2 s/s1/s2/g\n8ã€æœç´¢æ¨¡å¼ä¸º /stringï¼Œæœç´¢ä¸‹ä¸€å¤„ä¸ºnï¼Œæœç´¢ä¸Šä¸€å¤„ä¸ºN\n9ã€åˆ¶å®šä¹¦ç­¾ mx, ä½†æ˜¯çœ‹ä¸åˆ°ä¹¦ç­¾æ ‡è®°ï¼Œè€Œä¸”åªèƒ½ç”¨å°å†™å­—æ¯\n10ã€ç§»åŠ¨åˆ°æŸæ ‡ç­¾å¤„ `xï¼Œ1æ—è¾¹çš„é”®\n11ã€ç§»åŠ¨åˆ°ä¸Šæ¬¡ç¼–è¾‘æ–‡ä»¶çš„ä½ç½® `. PSï¼š.ä»£è¡¨ä¸€ä¸ªä»»æ„å­—ç¬¦ *ä»£è¡¨ä¸€ä¸ªæˆ–å¤šä¸ªå­—ç¬¦çš„é‡å¤\nä¸‰ã€ç¼–è¾‘æ“ä½œ # 1ã€å…‰æ ‡åæ’å…¥a, è¡Œå°¾æ’å…¥A\n2ã€åæ’ä¸€è¡Œæ’å…¥oï¼Œå‰æ’ä¸€è¡Œæ’å…¥O\n3ã€åˆ é™¤å­—ç¬¦æ’å…¥sï¼Œ åˆ é™¤æ­£è¡Œæ’å…¥S\n4ã€å…‰æ ‡å‰æ’å…¥iï¼Œè¡Œé¦–æ’å…¥I\n5ã€åˆ é™¤ä¸€è¡Œddï¼Œåˆ é™¤åè¿›å…¥æ’å…¥æ¨¡å¼ccæˆ–è€…S\n6ã€åˆ é™¤ä¸€ä¸ªå•è¯dwï¼Œåˆ é™¤ä¸€ä¸ªå•è¯è¿›å…¥æ’å…¥æ¨¡å¼cw\n7ã€åˆ é™¤ä¸€ä¸ªå­—ç¬¦xæˆ–è€…dlï¼Œåˆ é™¤ä¸€ä¸ªå­—ç¬¦è¿›å…¥æ’å…¥æ¨¡å¼sæˆ–è€…cl\n8ã€ç²˜è´´pï¼Œäº¤æ¢ä¸¤ä¸ªå­—ç¬¦xpï¼Œäº¤æ¢ä¸¤è¡Œddp\n9ã€å¤åˆ¶yï¼Œå¤åˆ¶ä¸€è¡Œyy\n10ã€æ’¤é”€uï¼Œé‡åšctrl + rï¼Œé‡å¤.\n11ã€æ™ºèƒ½æç¤º ctrl + n æˆ–è€… ctrl + p\n12ã€åˆ é™¤motionè·¨è¿‡çš„å­—ç¬¦ï¼Œåˆ é™¤å¹¶è¿›å…¥æ’å…¥æ¨¡å¼ c{motion}\n13ã€åˆ é™¤åˆ°ä¸‹ä¸€ä¸ªå­—ç¬¦è·¨è¿‡çš„å­—ç¬¦ï¼Œåˆ é™¤å¹¶è¿›å…¥æ’å…¥æ¨¡å¼ï¼Œä¸åŒ…æ‹¬xå­—ç¬¦ ctx\n14ã€åˆ é™¤å½“å‰å­—ç¬¦åˆ°ä¸‹ä¸€ä¸ªå­—ç¬¦å¤„çš„æ‰€æœ‰å­—ç¬¦ï¼Œå¹¶è¿›å…¥æ’å…¥æ¨¡å¼ï¼ŒåŒ…æ‹¬xå­—ç¬¦ï¼Œcfx\n15ã€åˆ é™¤motionè·¨è¿‡çš„å­—ç¬¦ï¼Œåˆ é™¤ä½†ä¸è¿›å…¥æ’å…¥æ¨¡å¼ d{motion}\n16ã€åˆ é™¤motionè·¨è¿‡çš„å­—ç¬¦ï¼Œåˆ é™¤ä½†ä¸è¿›å…¥æ’å…¥æ¨¡å¼ï¼Œä¸åŒ…æ‹¬xå­—ç¬¦ dtx\n17ã€åˆ é™¤å½“å‰å­—ç¬¦åˆ°ä¸‹ä¸€ä¸ªå­—ç¬¦å¤„çš„æ‰€æœ‰å­—ç¬¦ï¼ŒåŒ…æ‹¬xå­—ç¬¦ dfx\n18ã€å¦‚æœåªæ˜¯å¤åˆ¶çš„æƒ…å†µæ—¶ï¼Œå°†12-17æ¡ä¸­çš„cæˆ–dæ”¹ä¸ºy\n19ã€åˆ é™¤åˆ°è¡Œå°¾å¯ä»¥ä½¿ç”¨Dæˆ–C\n20ã€æ‹·è´å½“å‰è¡Œ yyæˆ–è€…Y\n21ã€åˆ é™¤å½“å‰å­—ç¬¦ x\n22ã€ç²˜è´´ p\n23ã€å¯ä»¥ä½¿ç”¨å¤šé‡å‰ªåˆ‡æ¿ï¼ŒæŸ¥çœ‹çŠ¶æ€ä½¿ç”¨:regï¼Œä½¿ç”¨å‰ªåˆ‡æ¿ä½¿ç”¨â€ï¼Œä¾‹å¦‚å¤åˆ¶åˆ°wå¯„å­˜å™¨ï¼Œâ€wyyï¼Œæˆ–è€…ä½¿ç”¨å¯è§†æ¨¡å¼vâ€wy\n24ã€é‡å¤æ‰§è¡Œä¸Šä¸€ä¸ªä½œç”¨ä½¿ç”¨.\n25ã€ä½¿ç”¨æ•°å­—å¯ä»¥è·¨è¿‡nä¸ªåŒºåŸŸï¼Œå¦‚y3xï¼Œä¼šæ‹·è´å…‰æ ‡åˆ°ç¬¬ä¸‰ä¸ªxä¹‹é—´çš„åŒºåŸŸï¼Œ3jå‘ä¸‹ç§»åŠ¨3è¡Œ\n26ã€åœ¨ç¼–å†™ä»£ç çš„æ—¶å€™å¯ä»¥ä½¿ç”¨]pç²˜è´´ï¼Œè¿™æ ·å¯ä»¥è‡ªåŠ¨è¿›è¡Œä»£ç ç¼©è¿›\n27ã€ \u0026raquo; ç¼©è¿›æ‰€æœ‰é€‰æ‹©çš„ä»£ç \n28ã€ \u0026laquo; åç¼©è¿›æ‰€æœ‰é€‰æ‹©çš„ä»£ç \n29ã€gd ç§»åŠ¨åˆ°å…‰æ ‡æ‰€å¤„çš„å‡½æ•°æˆ–å˜é‡çš„å®šä¹‰å¤„\n30ã€K åœ¨mané‡Œæœç´¢å…‰æ ‡æ‰€åœ¨çš„è¯\n31ã€åˆå¹¶ä¸¤è¡Œ J\n32ã€è‹¥ä¸æƒ³ä¿å­˜æ–‡ä»¶ï¼Œè€Œé‡æ–°æ‰“å¼€ :e!\n33ã€è‹¥æƒ³æ‰“å¼€æ–°æ–‡ä»¶ :e filenameï¼Œç„¶åä½¿ç”¨ctrl + ^è¿›è¡Œæ–‡ä»¶åˆ‡æ¢\nå››ã€çª—å£æ“ä½œ # 1ã€åˆ†éš”ä¸€ä¸ªçª—å£:splitæˆ–è€…:vsplit\n2ã€åˆ›å»ºä¸€ä¸ªçª—å£:newæˆ–è€…:vnew\n3ã€åœ¨æ–°çª—å£æ‰“å¼€æ–‡ä»¶:sf {filename}\n4ã€å…³é—­å½“å‰çª—å£:close\n5ã€ä»…ä¿ç•™å½“å‰çª—å£:only\n6ã€åˆ°å·¦è¾¹çª—å£ ctrl + w, h\n7ã€åˆ°å³è¾¹çª—å£ ctrl + w, l\n8ã€åˆ°ä¸Šè¾¹çª—å£ ctrl + w, k\n9ã€åˆ°ä¸‹è¾¹çª—å£ ctrl + w, j\n10ã€åˆ°é¡¶éƒ¨çª—å£ ctrl + w, t\n11ã€åˆ°åº•éƒ¨çª—å£ ctrl + w, b\näº”ã€å®æ“ä½œ # 1ã€å¼€å§‹è®°å½•å®æ“ä½œq[a-z]ï¼ŒæŒ‰qç»“æŸï¼Œä¿å­˜æ“ä½œåˆ°å¯„å­˜å™¨[a-z]ä¸­\n2ã€@[a-z]æ‰§è¡Œå¯„å­˜å™¨[a-z]ä¸­çš„æ“ä½œ\n3ã€@@æ‰§è¡Œæœ€è¿‘ä¸€æ¬¡è®°å½•çš„å®æ“ä½œ\nå…­ã€å¯è§†æ“ä½œ # 1ã€è¿›å…¥å—å¯è§†æ¨¡å¼ ctrl + v\n2ã€è¿›å…¥å­—ç¬¦å¯è§†æ¨¡å¼ v\n3ã€è¿›å…¥è¡Œå¯è§†æ¨¡å¼ V\n4ã€åˆ é™¤é€‰å®šçš„å— d\n5ã€åˆ é™¤é€‰å®šçš„å—ç„¶åè¿›å…¥æ’å…¥æ¨¡å¼ c\n6ã€åœ¨é€‰ä¸­çš„å—åŒæ˜¯æ’å…¥ç›¸åŒçš„å­—ç¬¦ IESC\nä¸ƒã€è·³åˆ°å£°æ˜ # 1ã€[[ å‘å‰è·³åˆ°é¡¶æ ¼ç¬¬ä¸€ä¸ª{\n2ã€[] å‘å‰è·³åˆ°é¡¶æ ¼ç¬¬ä¸€ä¸ª}\n3ã€]] å‘åè·³åˆ°é¡¶æ ¼çš„ç¬¬ä¸€ä¸ª{\n4ã€]] å‘åè·³åˆ°é¡¶æ ¼çš„ç¬¬ä¸€ä¸ª}\n5ã€[{ è·³åˆ°æœ¬ä»£ç å—çš„å¼€å¤´\n6ã€]} è·³åˆ°æœ¬ä»£ç å—çš„ç»“å°¾\nå…«ã€æŒ‚èµ·æ“ä½œ # 1ã€æŒ‚èµ·Vim ctrl + z æˆ–è€… :suspend\n2ã€æŸ¥çœ‹ä»»åŠ¡ åœ¨shellä¸­è¾“å…¥ jobs\n3ã€æ¢å¤ä»»åŠ¡ fg [job number]ï¼ˆå°†åå°ç¨‹åºæ”¾åˆ°å‰å°ï¼‰æˆ–è€… bg [job number]ï¼ˆå°†å‰å°ç¨‹åºæ”¾åˆ°åå°ï¼‰\n4ã€æ‰§è¡Œshellå‘½ä»¤ :!command\n5ã€å¼€å¯shellå‘½ä»¤ :shellï¼Œé€€å‡ºè¯¥shell exit\n6ã€ä¿å­˜vimçŠ¶æ€ :mksession name.vim\n7ã€æ¢å¤vimçŠ¶æ€ :source name.vim\n8ã€å¯åŠ¨vimæ—¶æ¢å¤çŠ¶æ€ vim -S name.vim\n"},{"id":130,"href":"/blog/linux/BJrx8LE98CG/","title":"vsftpd é…ç½®æ–¹æ³•åŠè®¿é—®æ§åˆ¶","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" vsftpd è¯¦ç»†é…ç½®è¯´æ˜\nvsftpdå¸¸ç”¨é…ç½® # #å…³é—­åŒ¿åç”¨æˆ·è®¿é—®æƒé™ anonymous_enable=NO #å¼€å¯æœ¬åœ°ç”¨æˆ·æƒé™ local_enable=YES #å¼€å¯å†™æƒé™ write_enable=YES #è®¾ç½®ä¾¦å¬ç«¯å£ listen_port=21 #å†™æ–‡ä»¶æ—¶çš„umask local_umask=002 #è¢«åŠ¨æ¨¡å¼åŠå¼€æ”¾ç«¯å£æ®µ #pasv_enable=yes #pasv_min_port=30000 #pasv_max_port=50000 #è¶…æ—¶æ—¶é—´ #idle_session_timeout=6000000 #data_connection_timeout=6000000 dirmessage_enable=YES xferlog_enable=YES connect_from_port_20=YES xferlog_std_format=YES chroot_local_user=YES chroot_list_enable=YES chroot_list_file=/etc/vsftpd/chroot_list listen=YES pam_service_name=vsftpd userlist_enable=YES tcp_wrappers=YES use_localtime=YES reverse_lookup_enable=NO #convert_charset_enable=0 #local_charset=UTF8 #remote_charset=GB2312 #double_377=1 åˆ›å»ºè´¦æˆ·\nuseradd -M -s /sbin/nologin -d /mnt/usernamefile/ username for i in name1 name2 name3;do useradd -M -s /sbin/nologin -d /mnt/$i/ $i;done for i in name1 name2 name3;do echo \u0026#34;$i\u0026#34;123 | passwd --stdin $i ;done åˆ›å»ºç›®å½• # mkdir usernamefile chown username:username usernamefile for i in name1 name2 name3;do mkdir /mnt/$i;done for i in name1 name2 name3;do chown $i:$i /mnt/$i/;done chmod -R 770 * vsftpdè¢«åŠ¨æ¨¡å¼ # 1ã€å¼€å¯è¢«åŠ¨æ¨¡å¼ # vim vsftpd.conf pasv_enable=YES #å¼€å¯è¢«åŠ¨æ¨¡å¼ pasv_min_port=3000 #éšæœºæœ€å°ç«¯å£ pasv_max_port=4000 #éšæœºæœ€å¤§ç«¯å£ 2ã€åŠ è½½å†…æ ¸ # modprobe ip_conntrack_ftp modprobe ip_nat_ftp 3ã€é˜²ç«å¢™ # vim /etc/sysconfig/iptables åœ¨*filterä¸‹åŠ å…¥ä¸‹ -A OUTPUT -p tcp --sport 3000:4000 -j ACCEPT -A INPUT -p tcp --dport 3000:4000 -j ACCEPT iptables-restore \u0026lt; /etc/sysconfig/iptables åŠ è½½iptablesé…ç½® vsftpdè™šæ‹Ÿç”¨æˆ· # 1ã€vsftpdå®‰è£… # yum -y install vsftpd #vsftpdè½¯ä»¶ yum -y install db4-utils #ç”Ÿæˆè™šæ‹Ÿç”¨æˆ·è®¤è¯æ•°æ®æ–‡ä»¶å‘½ä»¤ 2ã€é…ç½®vsftp # vim /etc/vsftpd/vsftpd.conf listen=YES #ç‹¬ç«‹è¿è¡Œvsftpd anonymous_enable=NO #é™åˆ¶åŒ¿åç”¨æˆ·ç™»å½• dirmessage_enable=YES xferlog_enable=YES xferlog_file=/var/log/vsftpd.log xferlog_std_format=YES chroot_list_enable=YES #é™åˆ¶è™šæ‹Ÿç”¨æˆ·åˆ‡æ¢ç›®å½• chroot_list_file=/etc/vsftpd/chroot_list #é™åˆ¶åˆ‡æ¢ç›®å½•çš„ç”¨æˆ·åˆ—è¡¨ chroot_local_user=YES guest_enable=YES #å¼€å¯è™šæ‹Ÿç”¨æˆ·è®¤è¯ guest_username=ftp #æ˜ å°„çš„çœŸå®ç”¨æˆ· user_config_dir=/etc/vsftpd/vsftpd_user_conf #è™šæ‹Ÿç”¨æˆ·é…ç½®ç›®å½• pam_service_name=vsftpd.vu #vsftpdè®¤è¯çš„pamè®¤è¯æ¨¡å— local_enable=YES 3ã€è™šæ‹Ÿç”¨æˆ·db # cd /etc/vsftpd vim user.txt yuangang #ç”¨æˆ·å 123456 #å¯†ç  db_load -T -t hash -f user.txt /etc/vsftpd/vsftpd_login.db chmod 600 /etc/vsftpd/vsftpd_login.db # é…ç½®pamè®¤è¯ vim /etc/pam.d/vsftpd.vu auth required /lib/security/pam_userdb.so db=/etc/vsftpd/vsftpd_login account required /lib/security/pam_userdb.so db=/etc/vsftpd/vsftpd_login vim /etc/vsftpd/chroot_list #é™åˆ¶è™šæ‹Ÿç”¨æˆ·åˆ‡æ¢ç›®å½• ftp yuangang 4ã€é…ç½®è™šæ‹Ÿç”¨æˆ· # cd /etc/vsftpd/vsftpd_user_conf vim yuangang write_enable=YES anon_world_readable_only=NO anon_upload_enable=YES anon_mkdir_write_enable=YES anon_other_write_enable=YES local_root=/data/httpd/yuangang # å»ºç«‹è™šæ‹Ÿç”¨æˆ·ftpç›®å½• mkdir /data/httpd/yuangang chown -R ftp.root /data/httpd chmod o+rw /data/httpd/yuangang vsftpd cmds_allowed # cmds_allowed=ABOR,CWD,LIST,MDTM,MKD,NLST, PASS,PASV,PORT,PWD,QUIT,RETR,RMD,RNFR, RNTO,SITE,SIZE,STOR,TYPE,USER,ACCT, APPE,CDUP,HELP,MODE,NOOP,REIN,STAT,STOU,STRU,SYST æ³¨æ„:ä¸€å®šä¸èƒ½ä½¿ç”¨æ¢è¡Œå’Œç©ºæ ¼ï¼Œä¸ç„¶å°±æ²¡æ•ˆæœ..\nå…¨éƒ¨å‚æ•° # # ABOR - abort a file transfer å–æ¶ˆæ–‡ä»¶ä¼ è¾“ # CWD - change working directory æ›´æ”¹ç›®å½• # DELE - delete a remote file åˆ é™¤æ–‡ä»¶ # LIST - list remote files åˆ—ç›®å½• # MDTM - return the modification time of a file è¿”å›æ–‡ä»¶çš„æ›´æ–°æ—¶é—´ # MKD - make a remote directory æ–°å»ºæ–‡ä»¶å¤¹ # NLST - name list of remote directory # PASS - send password # PASV - enter passive mode # PORT - open a data port æ‰“å¼€ä¸€ä¸ªä¼ è¾“ç«¯å£ # PWD - print working directory æ˜¾ç¤ºå½“å‰å·¥ä½œç›®å½• # QUIT - terminate the connection é€€å‡º # RETR - retrieve a remote file ä¸‹è½½æ–‡ä»¶ # RMD - remove a remote directory # RNFR - rename from # RNTO - rename to # SITE - site-specific commands # SIZE - return the size of a file è¿”å›æ–‡ä»¶å¤§å° # STOR - store a file on the remote host ä¸Šä¼ æ–‡ä»¶ # TYPE - set transfer type # USER - send username # less common commands: # ACCT* - send account information # APPE - append to a remote file # CDUP - CWD to the parent of the current directory # HELP - return help on using the server # MODE - set transfer mode # NOOP - do nothing # REIN* - reinitialize the connection # STAT - return server status # STOU - store a file uniquely # STRU - set file transfer structure # SYST - return system type å¸¸ç”¨å‚æ•° # # CWD - change working directory æ›´æ”¹ç›®å½• # LIST - list remote files åˆ—ç›®å½• # MKD - make a remote directory æ–°å»ºæ–‡ä»¶å¤¹ # NLST - name list of remote directory # PWD - print working directory æ˜¾ç¤ºå½“å‰å·¥ä½œç›®å½• # RETR - retrieve a remote file ä¸‹è½½æ–‡ä»¶ # STOR - store a file on the remote host ä¸Šä¼ æ–‡ä»¶ # DELE - delete a remote file åˆ é™¤æ–‡ä»¶ # RMD - remove a remote directory åˆ é™¤ç›®å½• # RNFR - rename from é‡å‘½å # RNTO - rename to é‡å‘½å ä»¥ä¸Šæ˜¯å¸¸ç”¨çš„ä¸€äº›å‚æ•°ï¼Œå¤§å®¶å¯¹ç…§å­¦ä¹ ä¸€ä¸‹ï¼\nå‡ ä¸ªä¾‹å­ # 1ã€åªèƒ½ä¸Šä¼ ã€‚ä¸èƒ½ä¸‹è½½ã€åˆ é™¤ã€é‡å‘½åã€‚ cmds_allowedï¼FEAT,REST,CWD,LIST,MDTM,MKD,NLST,PASS,PASV,PORT,PWD,QUIT,RMD,SIZE,STOR,TYPE,USER,ACCT, APPE,CDUP,HELP,MODE,NOOP,REIN,STAT,STOU,STRU,SYST 2ã€åªèƒ½ä¸‹è½½ã€‚ä¸èƒ½ä¸Šä¼ ã€åˆ é™¤ã€é‡å‘½åã€‚write_enable=NO 3ã€åªèƒ½ä¸Šä¼ ã€åˆ é™¤ã€é‡å‘½åã€‚ä¸èƒ½ä¸‹è½½ã€‚download_enableï¼NO 4ã€åªèƒ½ä¸‹è½½ã€åˆ é™¤ã€é‡å‘½åã€‚ä¸èƒ½ä¸Šä¼ ã€‚ cmds_allowed=FEAT,REST,CWD,LIST,MDTM,MKD,NLST,PASS,PASV,PORT,PWD,QUIT,RMD,RNFR,RNTO, RETR,DELE,SIZE,TYPE,USER,ACCT,APPE,CDUP,HELP,MODE,NOOP,REIN,STAT,STOU,STRU,SYST æ—¥å¿—æ ¼å¼è§£æ # Sun Feb 23 22:08:26 2014 | 6 | 212.73.193.130 | 1023575 |\n/Lille_IconSP/win_230214_52_11.jpg | b| _| i| r| sipafranch| ftp| 0| *| c\nè®°å½• å«ä¹‰\nSun Feb 23 22:08:26 2014 FTPä¼ è¾“æ—¶é—´\n6 ä¼ è¾“æ–‡ä»¶æ‰€ç”¨æ—¶é—´ã€‚å•ä½/ç§’\n212.73.193.130 ftpå®¢æˆ·ç«¯åç§°/IP\n1023575 ä¼ è¾“æ–‡ä»¶å¤§å°ã€‚å•ä½/Byte\n/Lille_IconSP/win_230214_52_11.jpg ä¼ è¾“æ–‡ä»¶åï¼ŒåŒ…å«è·¯å¾„\nb ä¼ è¾“æ–¹å¼ï¼š aä»¥ASCIIæ–¹å¼ä¼ è¾“; bä»¥äºŒè¿›åˆ¶(binary)æ–¹å¼ä¼ è¾“;\n_ ç‰¹æ®Šå¤„ç†æ ‡å¿—ä½ï¼šâ€_â€œä¸åšä»»ä½•å¤„ç†ï¼›â€Câ€æ–‡ä»¶æ˜¯å‹ç¼©æ ¼å¼ï¼›â€Uâ€æ–‡ä»¶éå‹ç¼©æ ¼å¼ï¼›â€Tâ€æ–‡ä»¶æ˜¯taræ ¼å¼ï¼›\ni ä¼ è¾“æ–¹å‘ï¼šâ€iâ€ä¸Šä¼ ï¼›â€oâ€ä¸‹è½½ï¼›\nr ç”¨æˆ·è®¿é—®æ¨¡å¼ï¼šâ€œaâ€åŒ¿åç”¨æˆ·ï¼›â€gâ€è®¿å®¢æ¨¡å¼ï¼›â€râ€ç³»ç»Ÿä¸­ç”¨æˆ·;\nsipafranch ç™»å½•ç”¨æˆ·å\nftp æœåŠ¡åç§°ï¼Œä¸€èˆ¬éƒ½æ˜¯ftp\n0 è®¤è¯æ–¹å¼ï¼šâ€0â€æ— ï¼›â€1â€RFC931è®¤è¯ï¼›\nè®¤è¯ç”¨æˆ·idï¼Œâ€*â€œè¡¨ç¤ºæ— æ³•è·å–id c å®ŒæˆçŠ¶æ€ï¼šâ€iâ€ä¼ è¾“æœªå®Œæˆï¼›â€câ€ä¼ è¾“å·²å®Œæˆï¼›\n"},{"id":131,"href":"/blog/linux/SJ_88EqU0M/","title":"webè¿ç»´ç›¸å…³æŸ¥è¯¢å‘½ä»¤","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" none\n1. æŸ¥çœ‹TCPè¿æ¥çŠ¶æ€ # netstat -nat |awk \u0026#39;{print $6}\u0026#39;|sort|uniq -c|sort -rn netstat -n | awk \u0026#39;/^tcp/ {++S[$NF]};END {for(a in S) print a, S[a]}\u0026#39; æˆ– netstat -n | awk \u0026#39;/^tcp/ {++state[$NF]}; END {for(key in state) print key,\u0026#34;\\t\u0026#34;,state[key]}\u0026#39; netstat -n | awk \u0026#39;/^tcp/ {++arr[$NF]};END {for(k in arr) print k,\u0026#34;\\t\u0026#34;,arr[k]}\u0026#39; netstat -n |awk \u0026#39;/^tcp/ {print $NF}\u0026#39;|sort|uniq -c|sort -rn netstat -ant | awk \u0026#39;{print $NF}\u0026#39; | grep -v \u0026#39;[a-z]\u0026#39; | sort | uniq -c (ä»¥ä¸Šæ¯ä¸€è¡Œå®ç°çš„æ•ˆæœåŸºæœ¬ç›¸åŒï¼Œåœ¨æ­¤åˆ—å‡ºä¸åŒçš„å†™æ³•ï¼Œæ–¹ä¾¿å¯¹è„šæœ¬å†™æ³•çš„æ›´æ·±ç†è§£ï¼‰\n2. æŸ¥æ‰¾è¯·æ±‚æ•°è¯·20ä¸ªIPï¼ˆå¸¸ç”¨äºæŸ¥æ‰¾æ”»æ¥æºï¼‰ # netstat -anlp|grep 80|grep tcp|awk \u0026#39;{print $5}\u0026#39;|awk -F: \u0026#39;{print $1}\u0026#39;|sort|uniq -c|sort -nr|head -n20 netstat -ant |awk \u0026#39;/:80/{split($5,ip,\u0026#34;:\u0026#34;);++A[ip[1]]}END{for(i in A) print A[i],i}\u0026#39; |sort -rn|head -n20 3. ç”¨tcpdumpå—…æ¢80ç«¯å£çš„è®¿é—®çœ‹çœ‹è°æœ€é«˜ # tcpdump -i eth0 -tnn dst port 80 -c 1000 | awk -F\u0026#34;.\u0026#34; \u0026#39;{print $1\u0026#34;.\u0026#34;$2\u0026#34;.\u0026#34;$3\u0026#34;.\u0026#34;$4}\u0026#39; | sort | uniq -c | sort -nr |head -20 4. æŸ¥æ‰¾è¾ƒå¤štime_waitè¿æ¥ # netstat -n|grep TIME_WAIT|awk \u0026#39;{print $5}\u0026#39;|sort|uniq -c|sort -rn|head -n20 5. æ‰¾æŸ¥è¾ƒå¤šçš„SYNè¿æ¥ # netstat -an | grep SYN | awk \u0026#39;{print $5}\u0026#39; | awk -F: \u0026#39;{print $1}\u0026#39; | sort | uniq -c | sort -nr | more 6. æ ¹æ®ç«¯å£åˆ—è¿›ç¨‹ # netstat -ntlp | grep 80 | awk \u0026#39;{print $7}\u0026#39; | cut -d/ -f1 7. æŸ¥çœ‹æœ‰å¤šå°‘ä¸ªPHP-CGIè¿›ç¨‹æ´»åŠ¨ # netstat -anp | grep php-cgi | grep ^tcp | wc -l 8.æŸ¥çœ‹PHP-CGIå ç”¨å†…å­˜çš„æ€»æ•° # total=0; for i in `ps -C php-cgi -o rss=`; do total=$(($total+$i)); done; echo \u0026#34;PHP-CGI Memory usage: $total kb\u0026#34; "},{"id":132,"href":"/blog/linux/Sykc8UNqICz/","title":"zabbixä¹‹æ— æ³•å¯åŠ¨é—®é¢˜åŠè§£å†³åŠæ³•","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" none\n1ã€\né”™è¯¯æç¤º\nzabbix_agentd [1749]: cannot create PID file [/var/run/zabbix/zabbix_agentd.pid]: [2] No such file or directory è§£å†³æ–¹æ³•\nmkdir /var/run/zabbix/ chown zabbix.zabbix /var/run/zabbix/ chmod g+w /var/run/zabbix/ touch /var/run/zabbix/zabbix_agentd.pid /etc/init.d/zabbix-agent restart ps aux | grep zabbix "},{"id":133,"href":"/blog/linux/SytNL84q8Af/","title":"é˜¿é‡Œäº‘ECS Linuxçš„rc.localï¼ˆå¼€æœºå¯åŠ¨ï¼‰è®¾ç½®ä¸ç”Ÿæ•ˆ","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" none\nä½¿ç”¨åœºæ™¯ # å‰æ®µæ—¶é—´ä½¿ç”¨é˜¿é‡Œäº‘çš„ecsï¼Œå°†ä¸€äº›å¼€æœºå¯åŠ¨çš„å‘½ä»¤å†™åˆ°/etc/rc.localé‡Œé¢ï¼Œå‘ç°ä¸ç”Ÿæ•ˆã€‚ç»è¿‡ä¸€ç•ªæŸ¥è¯¢å’Œæœç´¢ä¹‹åï¼Œæœ€åå‘ç°ä¸€ä¸ªå‘ï¼Œå±…ç„¶è¦ç»™è¿™ä¸ªæ–‡ä»¶è®¾ç½®æ‰§è¡Œæƒé™æ‰ç”Ÿæ•ˆã€‚\nè§£å†³æ–¹æ³• # chmod +x /etc/rc.local "},{"id":134,"href":"/blog/ffmpeg/SyD7UIEcUAM/","title":"ç®€æAndroidé›†æˆFFMPEGæ¨æµ","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" å¦‚ä»Šï¼Œè§†é¢‘ç›´æ’­è¡Œä¸šåœ¨ä¸­å›½ç®—æ˜¯æ¯”è¾ƒçƒ­é—¨ã€‚åœ¨åˆšåˆšè¿‡å»çš„2015å¹´ï¼Œè§†é¢‘ç›´æ’­æˆä¸ºäº’è”ç½‘è¡Œä¸šæœ€æŠ¢çœ¼çš„é¢†åŸŸä¹‹ä¸€ã€‚ä»æ¸¸æˆåˆ°ç§€åœºï¼Œä»ä¼ ç»Ÿçš„ç½‘é¡µç«¯åˆ°ç§»åŠ¨äº’è”ç½‘ï¼Œå„å¤§ç›´æ’­å¹³å°åŒ…æ‹¬â€¦\nå¦‚ä»Šï¼Œè§†é¢‘ç›´æ’­è¡Œä¸šåœ¨ä¸­å›½ç®—æ˜¯æ¯”è¾ƒçƒ­é—¨ã€‚åœ¨åˆšåˆšè¿‡å»çš„2015å¹´ï¼Œè§†é¢‘ç›´æ’­æˆä¸ºäº’è”ç½‘è¡Œä¸šæœ€æŠ¢çœ¼çš„é¢†åŸŸä¹‹ä¸€ã€‚ä»æ¸¸æˆåˆ°ç§€åœºï¼Œä»ä¼ ç»Ÿçš„ç½‘é¡µç«¯åˆ°ç§»åŠ¨äº’è”ç½‘ï¼Œå„å¤§ç›´æ’­å¹³å°åŒ…æ‹¬æ–—é±¼ã€ç†ŠçŒ«tvã€è™ç‰™æˆ˜æ——è¿˜æœ‰çº¯ç§»åŠ¨ç«¯çš„æ˜ å®¢ã€æ˜“ç›´æ’­ç­‰ï¼Œç¾¤é›„å‰²æ®ã€‚è¨€å½’æ­£è½¬ï¼Œä»Šå¤©æˆ‘ä»¬è®²è§£çš„æ˜¯Android\nç«¯ç®€è¦é›†æˆFFMPEGè¿›è¡Œæ¨æµã€‚\næ¨æµåŸºæœ¬æµç¨‹ # ä¸€èˆ¬æƒ…å†µä¸‹æ¨æµçš„åŸºæœ¬æµç¨‹å¦‚ä¸Šã€‚\nFFmpeg # è¯´åˆ°æ¨æµå°±ä¸å¾—ä¸æå¤§åé¼é¼çš„FFMPEGäº†ï¼ŒFFmpegæ˜¯ä¸€ä¸ªå¼€æºå…è´¹è·¨å¹³å°çš„è§†é¢‘å’ŒéŸ³é¢‘æµæ–¹æ¡ˆï¼Œå±äºè‡ªç”±è½¯ä»¶ï¼Œé‡‡ç”¨LGPLæˆ–GPLè®¸å¯è¯ï¼ˆä¾æ®ä½ é€‰æ‹©çš„ç»„ä»¶ï¼‰ã€‚å®ƒæä¾›äº†å½•åˆ¶ã€è½¬æ¢ä»¥åŠæµåŒ–éŸ³è§†é¢‘çš„å®Œæ•´è§£å†³æ–¹æ¡ˆã€‚å®ƒåŒ…å«äº†éå¸¸å…ˆè¿›çš„éŸ³é¢‘/è§†é¢‘ç¼–è§£ç åº“libavcodecï¼Œä¸ºäº†ä¿è¯é«˜å¯ç§»æ¤æ€§å’Œç¼–è§£ç è´¨é‡ï¼Œlibavcodecé‡Œå¾ˆå¤šcodecéƒ½æ˜¯ä»å¤´å¼€å‘çš„ã€‚è¯¸å¦‚å¾®ä¿¡çš„å°è§†é¢‘ï¼Œæ˜ å®¢ã€æ–—é±¼ç­‰å‡æ˜¯åœ¨FFmpegåŸºç¡€ä¸Šå¼€å‘è€Œæ¥ï¼Œå¯è§FFmpegä¹‹å¼ºå¤§ã€‚ä¸€ä¸‹æ˜¯è§£å‹å¾®ä¿¡çš„apkçš„æˆªå›¾ã€‚\nFFmpeg åœ¨Androidä¸­çš„ä½¿ç”¨ # FFmpegè¦æƒ³åœ¨Androidå°±å¿…é¡»è¦ç¼–è¯‘æˆAndroidä¸Šèƒ½ä½¿ç”¨soåŠ¨æ€é“¾æ¥åº“ï¼ˆä¸‹ç§°soåº“ï¼‰ã€‚å…·ä½“ç¼–è¯‘æ–¹æ³•å¯ä»¥å‚è€ƒgithubå®˜æ–¹æä¾›æºç ã€‚ç¼–è¯‘è¿‡ç¨‹å¤§çº¦åœ¨30åˆ†é’Ÿå·¦å³ã€‚ä»¥ä¸‹æ˜¯ç¬”è€…ç¼–è¯‘å¥½çš„soåº“ã€‚\nFFmpegä¸»è¦åˆ†ä¸º8å¤§æ¨¡å—ï¼š # libavcodecï¼šç”¨äºå„ç§ç±»å‹å£°éŸ³/å›¾åƒç¼–è§£ç ï¼› libavdeviceï¼šç”¨äºè§†é¢‘é‡‡é›†è®¿é—®æ‘„åƒå¤´ç­‰ libavfilterï¼šç”¨åšæ»¤é•œå¤„ç† libavformatï¼šç”¨äºå„ç§éŸ³è§†é¢‘å°è£…æ ¼å¼çš„ç”Ÿæˆå’Œè§£æï¼ŒåŒ…æ‹¬è·å–è§£ç æ‰€éœ€ä¿¡æ¯ä»¥ç”Ÿæˆè§£ç ä¸Šä¸‹æ–‡ç»“æ„å’Œè¯»å–éŸ³è§†é¢‘å¸§ç­‰åŠŸèƒ½ï¼› libswresampleï¼šç”¨äºé‡é‡‡æ ·ï¼› libavutilï¼šåŒ…å«ä¸€äº›å…¬å…±çš„å·¥å…·å‡½æ•°ï¼› libswscaleï¼šç”¨äºè§†é¢‘åœºæ™¯æ¯”ä¾‹ç¼©æ”¾ã€è‰²å½©æ˜ å°„è½¬æ¢ï¼› libpostprocï¼šç”¨äºåæœŸæ•ˆæœå¤„ç†ï¼› JNIå¼€å‘è°ƒç”¨FFmpeg # æˆ‘ä»¬å…ˆçœ‹çœ‹æˆ‘ä»¬ä½¿ç”¨åˆ°çš„FFmpegUtilså·¥å…·ç±»ï¼Œä¸»è¦ç”¨äºåŠ è½½nativeæ–¹æ³•ï¼š\npublic class FFmpegUtils { //åŠ è½½soåº“ static{ System.loadLibrary(\u0026#34;avutil-54\u0026#34;); System.loadLibrary(\u0026#34;swresample-1\u0026#34;); System.loadLibrary(\u0026#34;avcodec-56\u0026#34;); System.loadLibrary(\u0026#34;avformat-56\u0026#34;); System.loadLibrary(\u0026#34;swscale-3\u0026#34;); System.loadLibrary(\u0026#34;postproc-53\u0026#34;); System.loadLibrary(\u0026#34;avfilter-5\u0026#34;); System.loadLibrary(\u0026#34;avdevice-56\u0026#34;); System.loadLibrary(\u0026#34;sffstreamer\u0026#34;); } /* * æŠŠæœ¬åœ°çš„éŸ³è§†é¢‘æ•°æ®é€šè¿‡rtmpåè®®å‘é€åˆ°æµåª’ä½“æœåŠ¡å™¨ä¸Š *@param input *@param output */ public native int stream(String input, String output); } æ¥ä¸‹æ¥æˆ‘ä»¬å°±æ˜¯æˆ‘ä»¬çš„é‡å¤´æˆJNIè°ƒç”¨FFmpeg\n#include \u0026#34;libavcodec/avcodec.h\u0026#34; #include \u0026#34;libavformat/avformat.h\u0026#34; #include \u0026#34;libavutil/log.h\u0026#34; #define LOGE(format, ...) __android_log_print(ANDROID_LOG_ERROR, \u0026#34;(\u0026gt;_\u0026lt;)\u0026#34;, format, ##__VA_ARGS__) #define LOGI(format, ...) __android_log_print(ANDROID_LOG_INFO, \u0026#34;(^_^)\u0026#34;, format, ##__VA_ARGS__) JNIEXPORT jint JNICALL Java_org_loofer_ffmpegstreamer_MainActivity_stream (JNIEnv *env, jobject obj, jstring input_jstr, jstring output_jstr) { //java string -\u0026gt; c char* //è§†é¢‘æ–‡ä»¶æ‰€åœ¨è·¯å¾„ const char* input_cstr = (*env)-\u0026gt;GetStringUTFChars(env,input_jstr, NULL)); //æ¨é€çš„æµåª’ä½“åœ°å€ const char* output_cstr = (*env)-\u0026gt;GetStringUTFChars(env,output_jstr, NULL)); //å°è£…æ ¼å¼(è¯»å…¥ï¼Œå†™å‡º)ï¼ˆè§£å°è£…ï¼Œå¾—åˆ°frameï¼‰ AVFormatContext *inFmtCtx = NULL, *outFmtCtx = NULL; AVOutputFormat *ofmt = NULL; AVPacket pkt; //æ³¨å†Œç»„ä»¶ av_register_all(); //åˆå§‹åŒ–ç½‘ç»œ avformat_network_init(); //Input if ((ret = avformat_open_input(\u0026amp;inFmtCtx, input_str, 0, 0)) \u0026lt; 0) { LOGE( \u0026#34;Could not open input file.\u0026#34;); goto end; } //è·å–æ–‡ä»¶ä¿¡æ¯ if ((ret = avformat_find_stream_info(inFmtCtx, 0)) \u0026lt; 0) { LOGE( \u0026#34;Failed to retrieve input stream information\u0026#34;); goto end; } //è·å–è§†é¢‘çš„ç´¢å¼•ä½ç½® int videoindex=-1; for(i=0; i\u0026lt;inFmtCtx-\u0026gt;nb_streams; i++) if(inFmtCtx-\u0026gt;streams[i]-\u0026gt;codec-\u0026gt;codec_type==AVMEDIA_TYPE_VIDEO){ videoindex=i; break; } //è¾“å‡ºå°è£…æ ¼å¼ï¼Œæ¨é€flvå°è£…æ ¼å¼çš„è§†é¢‘æµ avformat_alloc_output_context2(\u0026amp;outFmtCtx, NULL, \u0026#34;flv\u0026#34;,output_cstr); //RTMP //avformat_alloc_output_context2(\u0026amp;outFmtCtx, NULL, \u0026#34;mpegts\u0026#34;, output_cstr);//UDP if (!outFmtCtx) { LOGE( \u0026#34;Could not create output context/n\u0026#34;); ret = AVERROR_UNKNOWN; goto end; } for (i = 0; i \u0026lt; inFmtCtx-\u0026gt;nb_streams; i++) { //è§£ç å™¨ï¼Œè§£ç ä¸Šä¸‹æ–‡ä¿æŒä¸€è‡´ AVStream *in_stream = inFmtCtx-\u0026gt;streams[i]; AVStream *out_stream = avformat_new_stream(outFmtCtx, in_stream-\u0026gt;codec-\u0026gt;codec); if (!out_stream) { LOGE( \u0026#34;Failed allocating output stream/n\u0026#34;); ret = AVERROR_UNKNOWN; goto end; } //å¤åˆ¶è§£ç å™¨ä¸Šä¸‹æ–‡çš„ è®¾ç½® ret = avcodec_copy_context(out_stream-\u0026gt;codec, in_stream-\u0026gt;codec); if (ret \u0026lt; 0) { LOGE( \u0026#34;Failed to copy context from input to output stream codec context/n\u0026#34;); goto end; } //å…¨å±€çš„header out_stream-\u0026gt;codec-\u0026gt;codec_tag = 0; if (outFmtCtx-\u0026gt;oformat-\u0026gt;flags \u0026amp; AVFMT_GLOBALHEADER) out_stream-\u0026gt;codec-\u0026gt;flags |= CODEC_FLAG_GLOBAL_HEADER; } //æ‰“å¼€è¾“å‡ºçš„AVIOContext IOæµä¸Šä¸‹æ–‡ ofmt = outFmtCtx-\u0026gt;oformat; //Open output URL if (!(ofmt-\u0026gt;flags \u0026amp; AVFMT_NOFILE)) { ret = avio_open(\u0026amp;outFmtCtx-\u0026gt;pb, output_cstr, AVIO_FLAG_WRITE); if (ret \u0026lt; 0) { LOGE( \u0026#34;Could not open output URL \u0026#39;%s\u0026#39;\u0026#34;, output_cstr); goto end; } } //å…ˆå†™ä¸€ä¸ªå¤´ ret = avformat_write_header(outFmtCtx, NULL); if (ret \u0026lt; 0) { LOGE( \u0026#34;Error occurred when opening output URL/n\u0026#34;); goto end; } int frame_index=0; int64_t start_time=av_gettime(); while (1) { AVStream *in_stream, *out_stream; //Get an AVPacket ret = av_read_frame(inFmtCtx, \u0026amp;pkt); if (ret \u0026lt; 0) break; //FIXï¼šNo PTS (Example: Raw H.264) //raw stream è£¸æµ //PTS:Presentation Time Stamp è§£ç åè§†é¢‘å¸§è¦åœ¨ä»€ä¹ˆæ—¶å€™å–å‡ºæ¥ //DTS:é€å…¥è§£ç å™¨åä»€ä¹ˆæ—¶å€™æ ‡è¯†è¿›è¡Œè§£ç  if(pkt.pts==AV_NOPTS_VALUE){ //Write PTS AVRational time_base1=inFmtCtx-\u0026gt;streams[videoindex]-\u0026gt;time_base; //Duration between 2 frames (us) int64_t calc_duration=(double)AV_TIME_BASE/av_q2d(inFmtCtx-\u0026gt;streams[videoindex]-\u0026gt;r_frame_rate); //Parameters pkt.pts=(double)(frame_index*calc_duration)/(double)(av_q2d(time_base1)*AV_TIME_BASE); pkt.dts=pkt.pts; pkt.duration=(double)calc_duration/(double)(av_q2d(time_base1)*AV_TIME_BASE); } //è¯»å…¥é€Ÿåº¦æ¯”è¾ƒå¿«ï¼Œå¯ä»¥åœ¨è¿™é‡Œè°ƒæ•´è¯»å–é€Ÿåº¦å‡è½»æœåŠ¡å™¨å‹åŠ› if(pkt.stream_index==videoindex){ AVRational time_base=inFmtCtx-\u0026gt;streams[videoindex]-\u0026gt;time_base; AVRational time_base_q={1,AV_TIME_BASE}; int64_t pts_time = av_rescale_q(pkt.dts, time_base, time_base_q); int64_t now_time = av_gettime() - start_time; if (pts_time \u0026gt; now_time) av_usleep(pts_time - now_time); } in_stream = inFmtCtx-\u0026gt;streams[pkt.stream_index]; out_stream = outFmtCtx-\u0026gt;streams[pkt.stream_index]; /* copy packet */ //Convert PTS/DTS pkt.pts = av_rescale_q_rnd(pkt.pts, in_stream-\u0026gt;time_base, out_stream-\u0026gt;time_base, AV_ROUND_NEAR_INF|AV_ROUND_PASS_MINMAX); pkt.dts = av_rescale_q_rnd(pkt.dts, in_stream-\u0026gt;time_base, out_stream-\u0026gt;time_base, AV_ROUND_NEAR_INF|AV_ROUND_PASS_MINMAX); pkt.duration = av_rescale_q(pkt.duration, in_stream-\u0026gt;time_base, out_stream-\u0026gt;time_base); pkt.pos = -1; //Print to Screen if(pkt.stream_index==videoindex){ LOGE(\u0026#34;Send %8d video frames to output URL/n\u0026#34;,frame_index); frame_index++; } //å†™æ•°æ® //ret = av_write_frame(outFmtCtx, \u0026amp;pkt); ret = av_interleaved_write_frame(outFmtCtx, \u0026amp;pkt); if (ret \u0026lt; 0) { LOGE( \u0026#34;Error muxing packet/n\u0026#34;); break; } av_free_packet(\u0026amp;pkt); } //å†™ç»“å°¾ av_write_trailer(outFmtCtx); end: //é‡Šæ”¾è‡ªæ„¿ avformat_close_input(\u0026amp;inFmtCtx); /* å…³é—­è¾“å‡ºæµ */ if (outFmtCtx \u0026amp;\u0026amp; !(ofmt-\u0026gt;flags \u0026amp; AVFMT_NOFILE)) avio_close(outFmtCtx-\u0026gt;pb); avformat_free_context(outFmtCtx); if (ret \u0026lt; 0 \u0026amp;\u0026amp; ret != AVERROR_EOF) { LOGE( \u0026#34;Error occurred./n\u0026#34;); return -1; } return 0; } å‡½æ•°ç®€å•ä»‹ç» # av_register_all():æ³¨å†Œæ‰€æœ‰ç»„ä»¶ã€‚ avformat_open_input():æ‰“å¼€è¾“å…¥è§†é¢‘æ–‡ä»¶ã€‚ avformat_find_stream_info():è·å–è§†é¢‘æ–‡ä»¶ä¿¡æ¯ã€‚ avcodec_find_decoder():æŸ¥æ‰¾è§£ç å™¨ã€‚ avcodec_open2():æ‰“å¼€è§£ç å™¨ã€‚ av_read_frame():ä»è¾“å…¥æ–‡ä»¶è¯»å–ä¸€å¸§å‹ç¼©æ•°æ®ã€‚ avcodec_decode_video2():è§£ç ä¸€å¸§å‹ç¼©æ•°æ®ã€‚ avcodec_close():å…³é—­è§£ç å™¨ã€‚ avformat_close_input():å…³é—­è¾“å…¥è§†é¢‘æ–‡ä»¶ "},{"id":135,"href":"/blog/linux/HJqtULE5I0z/","title":"æ’æŸ¥linuxæ ¹ç›®å½•ç©ºé—´å ç”¨ä¸å®é™…ç©ºé—´ä¸ç¬¦","section":"ğŸ“š æˆ‘çš„æ–‡ç« ","content":" none\nå‘ç°é—®é¢˜ # é¦–å…ˆä½¿ç”¨â€df -Thâ€æŸ¥çœ‹æ ¹ç›®å½•çš„ç©ºé—´ä½¿ç”¨å’Œâ€du -sh /â€œçš„ç»“æœè¿›è¡Œå¯¹æ¯”ã€‚\næ’æŸ¥é—®é¢˜ # ç¬¬ä¸€ç§æƒ…å†µ # æ–‡ä»¶è¢«åˆ æ‰ï¼Œä½†æ˜¯å†™è¿™ä¸ªæ–‡ä»¶çš„è¿›ç¨‹æ²¡é€€å‡º\nlsof -n|grep delete ä½¿ç”¨ä»¥ä¸Šå‘½ä»¤å¾—åˆ°ç›¸å…³çš„è¿›ç¨‹ï¼Œç„¶åä½¿ç”¨å¾—åˆ°çš„pidæ‰¾åˆ°å¯¹åº”çš„ç¨‹åºï¼Œç„¶åé‡å¯ç¨‹åºæˆ–killæ‰å³å¯é‡Šæ”¾è¢«åˆ é™¤æ–‡ä»¶çš„ç©ºé—´ã€‚\nç¬¬äºŒç§æƒ…å†µ # lsof -n|grep delete æ²¡æœ‰å¾—åˆ°ä»»ä½•è¿”å›ç»“æœã€‚\né‚£ä¹ˆæˆ‘ä»¬é¦–å…ˆæŸ¥çœ‹ä¸‹æ ¹ç›®å½•çš„æ–‡ä»¶ç³»ç»Ÿï¼Œå¦‚æœæ˜¯â€œxfsâ€,é‚£ä¹ˆå¯ä»¥ä½¿ç”¨\nxfs_db -c frag -r /dev/sdxx æŸ¥çœ‹ç¢ç‰‡çš„å æ¯”ï¼Œå¦‚æœè¾ƒé«˜çš„è¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬åº”è¯¥æ•´ç†ä¸‹xfsçš„ç¢ç‰‡äº†ã€‚\nxfs_fsr /dev/sdxx #æ•´ç†ç¢ç‰‡ ç„¶åä½ å†â€œdfâ€çœ‹çœ‹é‡Šæ”¾ç©ºé—´å·²ç»é‡Šæ”¾äº†ã€‚\nå¤‡æ³¨ # xfsè™½ç„¶æ€§èƒ½æ¯”è¾ƒå¥½ï¼Œä½†æ˜¯ç¨³å®šæ€§è¿˜æ˜¯æœ‰æ‰€æ¬ ç¼ºï¼Œä¸æ˜¯å¾ˆå»ºè®®ä½¿ç”¨ã€‚\nå¦‚æœä»¥ä¸Šçš„æ–¹æ³•æ²¡æœ‰è§£å†³ä½ çš„é—®é¢˜æˆ–è€…ä½ è¿˜æœ‰å…¶ä»–æƒ…å†µï¼Œæ¬¢è¿ç•™è¨€ä¸€èµ·æ¢è®¨ã€‚\n"}]