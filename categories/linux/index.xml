<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Linux on 张文兵的笔记</title><link>https://notes.zhangwenbing.com/categories/linux/</link><description>Recent content in Linux on 张文兵的笔记</description><generator>Hugo</generator><language>zh</language><lastBuildDate>Mon, 23 Dec 2024 18:17:28 +0800</lastBuildDate><atom:link href="https://notes.zhangwenbing.com/categories/linux/index.xml" rel="self" type="application/rss+xml"/><item><title>Linux硬盘故障相关的查询命令</title><link>https://notes.zhangwenbing.com/articles/2024/12/23/wvkjyjt7qhumo4jpucheca/</link><pubDate>Mon, 23 Dec 2024 18:17:28 +0800</pubDate><guid>https://notes.zhangwenbing.com/articles/2024/12/23/wvkjyjt7qhumo4jpucheca/</guid><description>&lt;h2 id="查看硬盘及对应的uuid信息">
 查看硬盘及对应的UUID信息
 &lt;a class="anchor" href="#%e6%9f%a5%e7%9c%8b%e7%a1%ac%e7%9b%98%e5%8f%8a%e5%af%b9%e5%ba%94%e7%9a%84uuid%e4%bf%a1%e6%81%af">#&lt;/a>
&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 查看硬盘及对应的UUID信息 或者是所有硬盘的UUID信息&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>blkid &lt;span style="color:#f92672">[&lt;/span>/dev/sda1&lt;span style="color:#f92672">]&lt;/span> &lt;span style="color:#75715e"># lsblk -o NAME,UUID -p&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="查看uuid对应的硬盘路径">
 查看UUID对应的硬盘路径
 &lt;a class="anchor" href="#%e6%9f%a5%e7%9c%8buuid%e5%af%b9%e5%ba%94%e7%9a%84%e7%a1%ac%e7%9b%98%e8%b7%af%e5%be%84">#&lt;/a>
&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>blkid -U 383bc776-fc1a-4040-ad8f-45f4f5d96fcf
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="查看硬盘信息">
 查看硬盘信息
 &lt;a class="anchor" href="#%e6%9f%a5%e7%9c%8b%e7%a1%ac%e7%9b%98%e4%bf%a1%e6%81%af">#&lt;/a>
&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>lshw -class disk
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="检测磁盘是否损坏">
 检测磁盘是否损坏
 &lt;a class="anchor" href="#%e6%a3%80%e6%b5%8b%e7%a3%81%e7%9b%98%e6%98%af%e5%90%a6%e6%8d%9f%e5%9d%8f">#&lt;/a>
&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>badblocks -b &lt;span style="color:#ae81ff">4096&lt;/span> -v /dev/sda &lt;span style="color:#75715e"># 也有坏快的屏蔽方式这个里就不列举了&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="点亮硬盘led">
 点亮硬盘LED
 &lt;a class="anchor" href="#%e7%82%b9%e4%ba%ae%e7%a1%ac%e7%9b%98led">#&lt;/a>
&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>dd &lt;span style="color:#66d9ef">if&lt;/span>&lt;span style="color:#f92672">=&lt;/span>/dev/sda of&lt;span style="color:#f92672">=&lt;/span>/dev/null bs&lt;span style="color:#f92672">=&lt;/span>1M count&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#ae81ff">100&lt;/span> &lt;span style="color:#75715e"># 点亮硬盘LED&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="查看服务器序列号">
 查看服务器序列号
 &lt;a class="anchor" href="#%e6%9f%a5%e7%9c%8b%e6%9c%8d%e5%8a%a1%e5%99%a8%e5%ba%8f%e5%88%97%e5%8f%b7">#&lt;/a>
&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>dmidecode -t &lt;span style="color:#ae81ff">1&lt;/span> &lt;span style="color:#75715e"># 查看对应的&amp;#39;Serial Number&amp;#39;字段&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Mamba替代Conda</title><link>https://notes.zhangwenbing.com/articles/2024/03/27/e4c2nybngzu5eddbnmdjgq/</link><pubDate>Wed, 27 Mar 2024 13:07:03 +0800</pubDate><guid>https://notes.zhangwenbing.com/articles/2024/03/27/e4c2nybngzu5eddbnmdjgq/</guid><description>&lt;p>mamba是一个conda的替代品，可以加速conda的包管理，提升包管理的效率。&lt;/p>
&lt;h2 id="安装">
 安装
 &lt;a class="anchor" href="#%e5%ae%89%e8%a3%85">#&lt;/a>
&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># macos&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>brew install micromamba
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># macos or linux&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#e6db74">${&lt;/span>SHELL&lt;span style="color:#e6db74">}&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span> &amp;lt;&lt;span style="color:#f92672">(&lt;/span>curl -L micro.mamba.pm/install.sh&lt;span style="color:#f92672">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="配置">
 配置
 &lt;a class="anchor" href="#%e9%85%8d%e7%bd%ae">#&lt;/a>
&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 根据命令提示，修改~/.zshrc文件&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>micromamba shell init -s zsh -p ~/.micromamba
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 添加配置文件&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$ cat ~/.mambarc
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>channels:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - conda-forge
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>always_yes: false
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="使用">
 使用
 &lt;a class="anchor" href="#%e4%bd%bf%e7%94%a8">#&lt;/a>
&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>micromamba create -n python310 python&lt;span style="color:#f92672">=&lt;/span>3.10
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 激活环境&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>micromamba activate python310
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 然后可以用 micromamba 或者 pip 装东西&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>micromamba install package_1 package_2&lt;span style="color:#f92672">=&lt;/span>version
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">## 具体请参考 https://mamba.readthedocs.io/en/latest/&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>micromamba --help
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>ssh客户端于服务端保持连接</title><link>https://notes.zhangwenbing.com/blog/linux/fSHb366Mg/</link><pubDate>Fri, 11 Jun 2021 17:26:32 +0800</pubDate><guid>https://notes.zhangwenbing.com/blog/linux/fSHb366Mg/</guid><description>&lt;blockquote>
&lt;p>linux ssh 默认没有开启心跳，所以很容易导致连接断开。&lt;/p>
&lt;/blockquote>
&lt;h2 id="服务端设置">
 服务端设置
 &lt;a class="anchor" href="#%e6%9c%8d%e5%8a%a1%e7%ab%af%e8%ae%be%e7%bd%ae">#&lt;/a>
&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>sudo vim /etc/ssh/sshd_config
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>TCPKeepAlive yes
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ClientAliveInterval &lt;span style="color:#ae81ff">60&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ClientAliveCountMax &lt;span style="color:#ae81ff">3&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="客户端设置">
 客户端设置
 &lt;a class="anchor" href="#%e5%ae%a2%e6%88%b7%e7%ab%af%e8%ae%be%e7%bd%ae">#&lt;/a>
&lt;/h2>
&lt;p>一般还是建议在客户端设置。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>sudo vim /etc/ssh/ssh_config
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>TCPKeepAlive yes
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ServerAliveInterval &lt;span style="color:#ae81ff">60&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ServerAliveCountMax &lt;span style="color:#ae81ff">3&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Centos7系统升级内核版本</title><link>https://notes.zhangwenbing.com/blog/linux/G0DCCusMR/</link><pubDate>Tue, 02 Mar 2021 17:52:33 +0800</pubDate><guid>https://notes.zhangwenbing.com/blog/linux/G0DCCusMR/</guid><description>&lt;blockquote>
&lt;p>使用ELRepo仓库升级系统内核&lt;/p>
&lt;/blockquote>
&lt;h2 id="查看内核版本">
 查看内核版本
 &lt;a class="anchor" href="#%e6%9f%a5%e7%9c%8b%e5%86%85%e6%a0%b8%e7%89%88%e6%9c%ac">#&lt;/a>
&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>uname -r
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>uname -a
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>cat /etc/redhat-release
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="安装elrepo-yum源">
 安装ELRepo yum源
 &lt;a class="anchor" href="#%e5%ae%89%e8%a3%85elrepo-yum%e6%ba%90">#&lt;/a>
&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>rpm --import https://www.elrepo.org/RPM-GPG-KEY-elrepo.org
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>rpm -Uvh http://www.elrepo.org/elrepo-release-7.0-3.el7.elrepo.noarch.rpm
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="查看可用的内核版本">
 查看可用的内核版本
 &lt;a class="anchor" href="#%e6%9f%a5%e7%9c%8b%e5%8f%af%e7%94%a8%e7%9a%84%e5%86%85%e6%a0%b8%e7%89%88%e6%9c%ac">#&lt;/a>
&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>yum --disablerepo&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;*&amp;#34;&lt;/span> --enablerepo&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;elrepo-kernel&amp;#34;&lt;/span> list available
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>...
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>kernel-lt.x86_64 4.4.155-1.el7.elrepo
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>kernel-lt-devel.x86_64 4.4.155-1.el7.elrepo
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>...
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="安装稳定版本内核">
 安装稳定版本内核
 &lt;a class="anchor" href="#%e5%ae%89%e8%a3%85%e7%a8%b3%e5%ae%9a%e7%89%88%e6%9c%ac%e5%86%85%e6%a0%b8">#&lt;/a>
&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>yum --enablerepo&lt;span style="color:#f92672">=&lt;/span>elrepo-kernel install kernel-lt
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="设置引导grub2">
 设置引导（grub2）
 &lt;a class="anchor" href="#%e8%ae%be%e7%bd%ae%e5%bc%95%e5%af%bcgrub2">#&lt;/a>
&lt;/h2>
&lt;h3 id="查看所有内核版本">
 查看所有内核版本
 &lt;a class="anchor" href="#%e6%9f%a5%e7%9c%8b%e6%89%80%e6%9c%89%e5%86%85%e6%a0%b8%e7%89%88%e6%9c%ac">#&lt;/a>
&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>sudo awk -F&lt;span style="color:#ae81ff">\&amp;#39;&lt;/span> &lt;span style="color:#e6db74">&amp;#39;$1==&amp;#34;menuentry &amp;#34; {print i++ &amp;#34; : &amp;#34; $2}&amp;#39;&lt;/span> /etc/grub2.cfg
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">0&lt;/span> : CentOS Linux &lt;span style="color:#f92672">(&lt;/span>4.4.241-1.el7.elrepo.x86_64&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#ae81ff">7&lt;/span> &lt;span style="color:#f92672">(&lt;/span>Core&lt;span style="color:#f92672">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">1&lt;/span> : CentOS Linux &lt;span style="color:#f92672">(&lt;/span>3.10.0-957.el7.x86_64&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#ae81ff">7&lt;/span> &lt;span style="color:#f92672">(&lt;/span>Core&lt;span style="color:#f92672">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">2&lt;/span> : CentOS Linux &lt;span style="color:#f92672">(&lt;/span>0-rescue-651e1b90bb3149809cdeb8cc80e72c43&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#ae81ff">7&lt;/span> &lt;span style="color:#f92672">(&lt;/span>Core&lt;span style="color:#f92672">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="设置新的默认引导的内核版本">
 设置新的默认引导的内核版本
 &lt;a class="anchor" href="#%e8%ae%be%e7%bd%ae%e6%96%b0%e7%9a%84%e9%bb%98%e8%ae%a4%e5%bc%95%e5%af%bc%e7%9a%84%e5%86%85%e6%a0%b8%e7%89%88%e6%9c%ac">#&lt;/a>
&lt;/h3>
&lt;p>方法1&lt;/p></description></item><item><title>dnsmasq安装与配置</title><link>https://notes.zhangwenbing.com/blog/linux/xd2UELYGR/</link><pubDate>Wed, 03 Feb 2021 11:20:44 +0800</pubDate><guid>https://notes.zhangwenbing.com/blog/linux/xd2UELYGR/</guid><description>&lt;blockquote>
&lt;p>dnsmasq是一个小巧且方便地用于配置DNS和DHCP的工具，适用于小型网络，它提供了DNS功能和可选择的DHCP功能。&lt;/p>
&lt;/blockquote>
&lt;h2 id="安装服务">
 安装服务
 &lt;a class="anchor" href="#%e5%ae%89%e8%a3%85%e6%9c%8d%e5%8a%a1">#&lt;/a>
&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>sudo yum install dnsmasq
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="常用配置">
 常用配置
 &lt;a class="anchor" href="#%e5%b8%b8%e7%94%a8%e9%85%8d%e7%bd%ae">#&lt;/a>
&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>cat /etc/dnsmasq.conf
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#######这里表示 严格按照 resolv-file 文件中的顺序从上到下进行 DNS 解析, 直到第一个成功解析成功为止&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#strict-order&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">###同时发送所有的查询到所有的dns服务器，谁快就用谁&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>all-servers
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>listen-address&lt;span style="color:#f92672">=&lt;/span>127.0.0.1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">###不让dnsmasq去读/etc/hosts文件&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>no-hosts
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">## 设置缓存条目&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>cache-size&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#ae81ff">10240&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#允许客户端缓存的时间单位为秒&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>local-ttl&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#ae81ff">10&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>max-cache-ttl&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#ae81ff">15&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">###开启日志&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#log-queries&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">##配置日志文件&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#log-facility=/data/logs/dnsmasq.log&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>cat /etc/resolv.dnsmasq.conf
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>nameserver 223.5.5.5
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>nameserver 114.114.114.114
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>nameserver 222.246.129.80
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="启动服务">
 启动服务
 &lt;a class="anchor" href="#%e5%90%af%e5%8a%a8%e6%9c%8d%e5%8a%a1">#&lt;/a>
&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>systemctl start dnsmasq
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="验证方法">
 验证方法
 &lt;a class="anchor" href="#%e9%aa%8c%e8%af%81%e6%96%b9%e6%b3%95">#&lt;/a>
&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>dig www.zhangwenbing.com
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="其他配置">
 其他配置
 &lt;a class="anchor" href="#%e5%85%b6%e4%bb%96%e9%85%8d%e7%bd%ae">#&lt;/a>
&lt;/h2>
&lt;h3 id="国内指定dns">
 &lt;strong>国内指定DNS&lt;/strong>
 &lt;a class="anchor" href="#%e5%9b%bd%e5%86%85%e6%8c%87%e5%ae%9adns">#&lt;/a>
&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-ini" data-lang="ini">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">server&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">/cn/114.114.114.114&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">server&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">/taobao.com/114.114.114.114&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">server&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">/taobaocdn.com/114.114.114.114&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="国外指定dns">
 &lt;strong>国外指定DNS&lt;/strong>
 &lt;a class="anchor" href="#%e5%9b%bd%e5%a4%96%e6%8c%87%e5%ae%9adns">#&lt;/a>
&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-ini" data-lang="ini">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">server&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">/google.com/8.8.8.8&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="屏蔽网页广告">
 屏蔽网页广告
 &lt;a class="anchor" href="#%e5%b1%8f%e8%94%bd%e7%bd%91%e9%a1%b5%e5%b9%bf%e5%91%8a">#&lt;/a>
&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-ini" data-lang="ini">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">address&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">/ad.youku.com/127.0.0.1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">address&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">/ad.iqiyi.com/127.0.0.1&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="其他功能">
 其他功能
 &lt;a class="anchor" href="#%e5%85%b6%e4%bb%96%e5%8a%9f%e8%83%bd">#&lt;/a>
&lt;/h2>
&lt;p>除了DNS，还支持DHCP和TFTP，由于暂时用不到，这里就不一一例举了。&lt;/p></description></item><item><title>使用ssh配置跳板机</title><link>https://notes.zhangwenbing.com/blog/linux/SNyWJwbGR/</link><pubDate>Tue, 29 Dec 2020 16:11:55 +0800</pubDate><guid>https://notes.zhangwenbing.com/blog/linux/SNyWJwbGR/</guid><description>&lt;blockquote>
&lt;p>简单的修改/etc/ssh/ssh_config文件即可通过跳板机，直达目标服务器。&lt;/p>
&lt;/blockquote>
&lt;h2 id="配置方法">
 配置方法
 &lt;a class="anchor" href="#%e9%85%8d%e7%bd%ae%e6%96%b9%e6%b3%95">#&lt;/a>
&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>cat /etc/ssh/ssh_config
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Host jump-server
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> User xxxx
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Hostname yyy.yyy.yyy.yyy
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Port &lt;span style="color:#ae81ff">22&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Host 10.*
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ProxyCommand ssh -q -W %h:%p jump-server
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Host 支持通配符 &lt;code>*&lt;/code> 和 &lt;code>?&lt;/code>&lt;/p></description></item><item><title>centos6镜像站停止维护的解决办法</title><link>https://notes.zhangwenbing.com/blog/linux/tqj7MybMg/</link><pubDate>Mon, 28 Dec 2020 17:47:27 +0800</pubDate><guid>https://notes.zhangwenbing.com/blog/linux/tqj7MybMg/</guid><description>&lt;blockquote>
&lt;p>2020年11月30日 centos6各大开源镜像站已经停止维护了，但是阿里云还有其他源可以使用。&lt;/p>
&lt;/blockquote>
&lt;h2 id="错误提示">
 错误提示
 &lt;a class="anchor" href="#%e9%94%99%e8%af%af%e6%8f%90%e7%a4%ba">#&lt;/a>
&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span> http://mirrors.aliyun.com/epel/6/x86_64/repodata/repomd.xml: &lt;span style="color:#f92672">[&lt;/span>Errno 14&lt;span style="color:#f92672">]&lt;/span> PYCURL ERROR &lt;span style="color:#ae81ff">22&lt;/span> - &lt;span style="color:#e6db74">&amp;#34;The requested URL returned error: 404 Not Found&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="解决办法">
 解决办法
 &lt;a class="anchor" href="#%e8%a7%a3%e5%86%b3%e5%8a%9e%e6%b3%95">#&lt;/a>
&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>cat /etc/yum.repos.d/CentOS-Base.repo
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># CentOS-Base.repo&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># The mirror system uses the connecting IP address of the client and the&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># update status of each mirror to pick mirrors that are updated to and&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># geographically close to the client. You should use this for CentOS updates&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># unless you are manually picking other mirrors.&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># If the mirrorlist= does not work for you, as a fall back you can try the&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># remarked out baseurl= line instead.&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">[&lt;/span>base&lt;span style="color:#f92672">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>name&lt;span style="color:#f92672">=&lt;/span>CentOS-6.10 - Base - mirrors.aliyun.com
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>failovermethod&lt;span style="color:#f92672">=&lt;/span>priority
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>baseurl&lt;span style="color:#f92672">=&lt;/span>http://mirrors.aliyun.com/centos-vault/6.10/os/$basearch/
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>gpgcheck&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>gpgkey&lt;span style="color:#f92672">=&lt;/span>http://mirrors.aliyun.com/centos-vault/RPM-GPG-KEY-CentOS-6
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#released updates&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">[&lt;/span>updates&lt;span style="color:#f92672">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>name&lt;span style="color:#f92672">=&lt;/span>CentOS-6.10 - Updates - mirrors.aliyun.com
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>failovermethod&lt;span style="color:#f92672">=&lt;/span>priority
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>baseurl&lt;span style="color:#f92672">=&lt;/span>http://mirrors.aliyun.com/centos-vault/6.10/updates/$basearch/
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>gpgcheck&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>gpgkey&lt;span style="color:#f92672">=&lt;/span>http://mirrors.aliyun.com/centos-vault/RPM-GPG-KEY-CentOS-6
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#additional packages that may be useful&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">[&lt;/span>extras&lt;span style="color:#f92672">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>name&lt;span style="color:#f92672">=&lt;/span>CentOS-6.10 - Extras - mirrors.aliyun.com
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>failovermethod&lt;span style="color:#f92672">=&lt;/span>priority
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>baseurl&lt;span style="color:#f92672">=&lt;/span>http://mirrors.aliyun.com/centos-vault/6.10/extras/$basearch/
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>gpgcheck&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>gpgkey&lt;span style="color:#f92672">=&lt;/span>http://mirrors.aliyun.com/centos-vault/RPM-GPG-KEY-CentOS-6
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#additional packages that extend functionality of existing packages&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">[&lt;/span>centosplus&lt;span style="color:#f92672">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>name&lt;span style="color:#f92672">=&lt;/span>CentOS-6.10 - Plus - mirrors.aliyun.com
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>failovermethod&lt;span style="color:#f92672">=&lt;/span>priority
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>baseurl&lt;span style="color:#f92672">=&lt;/span>http://mirrors.aliyun.com/centos-vault/6.10/centosplus/$basearch/
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>gpgcheck&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>enabled&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>gpgkey&lt;span style="color:#f92672">=&lt;/span>http://mirrors.aliyun.com/centos-vault/RPM-GPG-KEY-CentOS-6
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#contrib - packages by Centos Users&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">[&lt;/span>contrib&lt;span style="color:#f92672">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>name&lt;span style="color:#f92672">=&lt;/span>CentOS-6.10 - Contrib - mirrors.aliyun.com
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>failovermethod&lt;span style="color:#f92672">=&lt;/span>priority
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>baseurl&lt;span style="color:#f92672">=&lt;/span>http://mirrors.aliyun.com/centos-vault/6.10/contrib/$basearch/
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>gpgcheck&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>enabled&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>gpgkey&lt;span style="color:#f92672">=&lt;/span>http://mirrors.aliyun.com/centos-vault/RPM-GPG-KEY-CentOS-6
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>yum clean all
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>yum makecache
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>tcpdump之UDP抓包</title><link>https://notes.zhangwenbing.com/blog/linux/-vpymjJGg/</link><pubDate>Fri, 18 Dec 2020 15:01:47 +0800</pubDate><guid>https://notes.zhangwenbing.com/blog/linux/-vpymjJGg/</guid><description>&lt;blockquote>
&lt;p>使用tcpdump抓UDP包，过滤过滤IP和port，并且自动拆分片段。&lt;/p>
&lt;/blockquote>
&lt;h2 id="安装tcpdump">
 安装tcpdump
 &lt;a class="anchor" href="#%e5%ae%89%e8%a3%85tcpdump">#&lt;/a>
&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>yum install -y tcpdump
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="使用方法">
 使用方法
 &lt;a class="anchor" href="#%e4%bd%bf%e7%94%a8%e6%96%b9%e6%b3%95">#&lt;/a>
&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>tcpdump -i bond0 udp port xxxx and host xxx.x.xx.xxx -s0 -G &lt;span style="color:#ae81ff">600&lt;/span> -w %Y_%m%d_%H%M_%S.pcap
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="参数说明">
 参数说明
 &lt;a class="anchor" href="#%e5%8f%82%e6%95%b0%e8%af%b4%e6%98%8e">#&lt;/a>
&lt;/h3>
&lt;p>-i 指定监听的网卡&lt;/p></description></item><item><title>Linux收录UDP视频花屏总结</title><link>https://notes.zhangwenbing.com/blog/linux/h5sGcU1MR/</link><pubDate>Wed, 16 Dec 2020 19:10:08 +0800</pubDate><guid>https://notes.zhangwenbing.com/blog/linux/h5sGcU1MR/</guid><description>&lt;blockquote>
&lt;p>最近在Linux下使用ffmpeg收录UDP流花屏问题，发现机器有双网卡，添加路由指定网卡收录导致无法收录了。另附一些解决花屏的优化方法。&lt;/p>
&lt;/blockquote>
&lt;h2 id="优化内核参数">
 优化内核参数
 &lt;a class="anchor" href="#%e4%bc%98%e5%8c%96%e5%86%85%e6%a0%b8%e5%8f%82%e6%95%b0">#&lt;/a>
&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>cat /etc/sysctl.conf
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>net.ipv4.conf.default.rp_filter &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>net.ipv4.conf.all.rp_filter &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 修改默认网络的缓存大小 这个很重要不然&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>net.core.rmem_max &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">50000000&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>net.core.rmem_default &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">50000000&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sysctl -p
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 添加以上配置后需要重启系统&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>reboot
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 不重启的话一定要执行以下命令&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">for&lt;/span> i in /proc/sys/net/ipv4/conf/*/rp_filter ; &lt;span style="color:#66d9ef">do&lt;/span> echo &lt;span style="color:#ae81ff">0&lt;/span> &amp;gt; &lt;span style="color:#e6db74">&amp;#34;&lt;/span>$i&lt;span style="color:#e6db74">&amp;#34;&lt;/span>; &lt;span style="color:#66d9ef">done&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="吐槽">
 吐槽
 &lt;a class="anchor" href="#%e5%90%90%e6%a7%bd">#&lt;/a>
&lt;/h2>
&lt;p>由于博主只修改了上面的 &lt;code>sysctl.conf&lt;/code> 并且只执行了 &lt;code>sysctl -p&lt;/code> 所以悲剧了，添加路由之后一直无法收录。&lt;/p></description></item><item><title>CentOS添加静态路由之route</title><link>https://notes.zhangwenbing.com/blog/linux/loBZJ41MR/</link><pubDate>Wed, 09 Dec 2020 20:50:36 +0800</pubDate><guid>https://notes.zhangwenbing.com/blog/linux/loBZJ41MR/</guid><description>&lt;blockquote>
&lt;p>route命令参数详细说明及常用命令&lt;/p>
&lt;/blockquote>
&lt;p>原文地址 &lt;a href="https://docs.lvrui.io/2016/10/12/CentOS%E4%B8%8B%E6%B7%BB%E5%8A%A0%E9%9D%99%E6%80%81%E8%B7%AF%E7%94%B1/">docs.lvrui.io&lt;/a>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&amp;gt; route
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Kernel IP routing table
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Destination Gateway Genmask Flags Metric Ref Use Iface
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>default localhost 0.0.0.0 UG &lt;span style="color:#ae81ff">100&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span> eno16780032
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>172.17.0.0 0.0.0.0 255.255.0.0 U &lt;span style="color:#ae81ff">0&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span> docker0
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>192.168.10.0 0.0.0.0 255.255.255.0 U &lt;span style="color:#ae81ff">100&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span> eno16780032
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;em>macOS 中使用 &lt;code>netstat -nr&lt;/code> 命令来查看当前路由表&lt;/em>&lt;/p></description></item><item><title>nginx及php-fpm优化</title><link>https://notes.zhangwenbing.com/blog/linux/bdpp4QAMg/</link><pubDate>Fri, 04 Dec 2020 16:33:34 +0800</pubDate><guid>https://notes.zhangwenbing.com/blog/linux/bdpp4QAMg/</guid><description>&lt;blockquote>
&lt;p>简单的讲讲nginx+php的一些常用优化，以及相关的内核参数优化。&lt;/p>
&lt;/blockquote>
&lt;h2 id="nginx-优化">
 Nginx 优化
 &lt;a class="anchor" href="#nginx-%e4%bc%98%e5%8c%96">#&lt;/a>
&lt;/h2>
&lt;h3 id="1-tcp-与-unix-套接字">
 1. TCP 与 UNIX 套接字
 &lt;a class="anchor" href="#1-tcp-%e4%b8%8e-unix-%e5%a5%97%e6%8e%a5%e5%ad%97">#&lt;/a>
&lt;/h3>
&lt;p>UNIX 域套接字提供的性能略高于 TCP 套接字在回送接口上的性能（较少的数据复制，较少的上下文切换）。如果每个服务器需要支持超过 1000 个连接，请使用 TCP 套接字 - 它们可以更好地扩展。&lt;/p></description></item><item><title>[supervisord]填坑之最大连接数</title><link>https://notes.zhangwenbing.com/blog/linux/HTLMANZea/</link><pubDate>Thu, 27 Aug 2020 04:03:19 +0800</pubDate><guid>https://notes.zhangwenbing.com/blog/linux/HTLMANZea/</guid><description>&lt;blockquote>
&lt;p>修改supervisord配置突破1024最大连接数&lt;/p>
&lt;/blockquote>
&lt;h2 id="问题描述">
 问题描述
 &lt;a class="anchor" href="#%e9%97%ae%e9%a2%98%e6%8f%8f%e8%bf%b0">#&lt;/a>
&lt;/h2>
&lt;p>最近在使用supervisord服务时发现，无论如何修改系统的最大连接数，由supervisord管理的程序都无法突破1024的限制。&lt;/p></description></item><item><title>supervisor 常见坑及解决办法</title><link>https://notes.zhangwenbing.com/blog/linux/QNIBzjz3k/</link><pubDate>Tue, 14 Jul 2020 09:51:26 +0800</pubDate><guid>https://notes.zhangwenbing.com/blog/linux/QNIBzjz3k/</guid><description>&lt;blockquote>
&lt;p>Too many open files、获取不到$HOME等&lt;/p>
&lt;/blockquote>
&lt;h2 id="too-many-open-files">
 Too many open files
 &lt;a class="anchor" href="#too-many-open-files">#&lt;/a>
&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>vim /etc/supervisord.conf
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">[&lt;/span>supervisord&lt;span style="color:#f92672">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>minfds&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#ae81ff">81920&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>minprocs&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#ae81ff">81920&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># systemctl restart supervisord&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="获取不到home">
 获取不到$HOME
 &lt;a class="anchor" href="#%e8%8e%b7%e5%8f%96%e4%b8%8d%e5%88%b0home">#&lt;/a>
&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">[&lt;/span>program:apache2&lt;span style="color:#f92672">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>command&lt;span style="color:#f92672">=&lt;/span>/home/chrism/bin/httpd -c &lt;span style="color:#e6db74">&amp;#34;ErrorLog /dev/stdout&amp;#34;&lt;/span> -DFOREGROUND
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>user&lt;span style="color:#f92672">=&lt;/span>chrism
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>environment&lt;span style="color:#f92672">=&lt;/span>HOME&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;/home/chrism&amp;#34;&lt;/span>,USER&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;chrism&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>supervisorctl update
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>linux nvidia 获取显卡信息</title><link>https://notes.zhangwenbing.com/blog/linux/N2EsU3hZT/</link><pubDate>Thu, 04 Jun 2020 06:40:16 +0800</pubDate><guid>https://notes.zhangwenbing.com/blog/linux/N2EsU3hZT/</guid><description>&lt;blockquote>
&lt;p>使用deviceQuery获取显卡信息&lt;/p>
&lt;/blockquote>
&lt;h2 id="环境">
 环境
 &lt;a class="anchor" href="#%e7%8e%af%e5%a2%83">#&lt;/a>
&lt;/h2>
&lt;p>Linux、nvidia、cuda&lt;/p>
&lt;h2 id="命令">
 命令
 &lt;a class="anchor" href="#%e5%91%bd%e4%bb%a4">#&lt;/a>
&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>/usr/local/cuda/extras/demo_suite/deviceQuery
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> CUDA Device Query &lt;span style="color:#f92672">(&lt;/span>Runtime API&lt;span style="color:#f92672">)&lt;/span> version &lt;span style="color:#f92672">(&lt;/span>CUDART static linking&lt;span style="color:#f92672">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Detected &lt;span style="color:#ae81ff">2&lt;/span> CUDA Capable device&lt;span style="color:#f92672">(&lt;/span>s&lt;span style="color:#f92672">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Device 0: &lt;span style="color:#e6db74">&amp;#34;GeForce RTX 2080 Ti&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> CUDA Driver Version / Runtime Version 10.1 / 10.1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> CUDA Capability Major/Minor version number: 7.5
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Total amount of global memory: &lt;span style="color:#ae81ff">11019&lt;/span> MBytes &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#ae81ff">11554717696&lt;/span> bytes&lt;span style="color:#f92672">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">(&lt;/span>68&lt;span style="color:#f92672">)&lt;/span> Multiprocessors, &lt;span style="color:#f92672">(&lt;/span> 64&lt;span style="color:#f92672">)&lt;/span> CUDA Cores/MP: &lt;span style="color:#ae81ff">4352&lt;/span> CUDA Cores
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> GPU Max Clock rate: &lt;span style="color:#ae81ff">1545&lt;/span> MHz &lt;span style="color:#f92672">(&lt;/span>1.54 GHz&lt;span style="color:#f92672">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Memory Clock rate: &lt;span style="color:#ae81ff">7000&lt;/span> Mhz
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Memory Bus Width: 352-bit
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> L2 Cache Size: &lt;span style="color:#ae81ff">5767168&lt;/span> bytes
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Maximum Texture Dimension Size &lt;span style="color:#f92672">(&lt;/span>x,y,z&lt;span style="color:#f92672">)&lt;/span> 1D&lt;span style="color:#f92672">=(&lt;/span>131072&lt;span style="color:#f92672">)&lt;/span>, 2D&lt;span style="color:#f92672">=(&lt;/span>131072, 65536&lt;span style="color:#f92672">)&lt;/span>, 3D&lt;span style="color:#f92672">=(&lt;/span>16384, 16384, 16384&lt;span style="color:#f92672">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Maximum Layered 1D Texture Size, &lt;span style="color:#f92672">(&lt;/span>num&lt;span style="color:#f92672">)&lt;/span> layers 1D&lt;span style="color:#f92672">=(&lt;/span>32768&lt;span style="color:#f92672">)&lt;/span>, &lt;span style="color:#ae81ff">2048&lt;/span> layers
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Maximum Layered 2D Texture Size, &lt;span style="color:#f92672">(&lt;/span>num&lt;span style="color:#f92672">)&lt;/span> layers 2D&lt;span style="color:#f92672">=(&lt;/span>32768, 32768&lt;span style="color:#f92672">)&lt;/span>, &lt;span style="color:#ae81ff">2048&lt;/span> layers
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Total amount of constant memory: &lt;span style="color:#ae81ff">65536&lt;/span> bytes
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Total amount of shared memory per block: &lt;span style="color:#ae81ff">49152&lt;/span> bytes
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Total number of registers available per block: &lt;span style="color:#ae81ff">65536&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Warp size: &lt;span style="color:#ae81ff">32&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Maximum number of threads per multiprocessor: &lt;span style="color:#ae81ff">1024&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Maximum number of threads per block: &lt;span style="color:#ae81ff">1024&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Max dimension size of a thread block &lt;span style="color:#f92672">(&lt;/span>x,y,z&lt;span style="color:#f92672">)&lt;/span>: &lt;span style="color:#f92672">(&lt;/span>1024, 1024, 64&lt;span style="color:#f92672">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Max dimension size of a grid size &lt;span style="color:#f92672">(&lt;/span>x,y,z&lt;span style="color:#f92672">)&lt;/span>: &lt;span style="color:#f92672">(&lt;/span>2147483647, 65535, 65535&lt;span style="color:#f92672">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Maximum memory pitch: &lt;span style="color:#ae81ff">2147483647&lt;/span> bytes
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Texture alignment: &lt;span style="color:#ae81ff">512&lt;/span> bytes
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Concurrent copy and kernel execution: Yes with &lt;span style="color:#ae81ff">3&lt;/span> copy engine&lt;span style="color:#f92672">(&lt;/span>s&lt;span style="color:#f92672">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Run time limit on kernels: No
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Integrated GPU sharing Host Memory: No
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Support host page-locked memory mapping: Yes
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Alignment requirement &lt;span style="color:#66d9ef">for&lt;/span> Surfaces: Yes
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Device has ECC support: Disabled
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Device supports Unified Addressing &lt;span style="color:#f92672">(&lt;/span>UVA&lt;span style="color:#f92672">)&lt;/span>: Yes
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Device supports Compute Preemption: Yes
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Supports Cooperative Kernel Launch: Yes
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Supports MultiDevice Co-op Kernel Launch: Yes
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Device PCI Domain ID / Bus ID / location ID: &lt;span style="color:#ae81ff">0&lt;/span> / &lt;span style="color:#ae81ff">1&lt;/span> / &lt;span style="color:#ae81ff">0&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Compute Mode:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &amp;lt; Default &lt;span style="color:#f92672">(&lt;/span>multiple host threads can use ::cudaSetDevice&lt;span style="color:#f92672">()&lt;/span> with device simultaneously&lt;span style="color:#f92672">)&lt;/span> &amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Device 1: &lt;span style="color:#e6db74">&amp;#34;GeForce RTX 2080 Ti&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> CUDA Driver Version / Runtime Version 10.1 / 10.1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> CUDA Capability Major/Minor version number: 7.5
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Total amount of global memory: &lt;span style="color:#ae81ff">11019&lt;/span> MBytes &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#ae81ff">11554717696&lt;/span> bytes&lt;span style="color:#f92672">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">(&lt;/span>68&lt;span style="color:#f92672">)&lt;/span> Multiprocessors, &lt;span style="color:#f92672">(&lt;/span> 64&lt;span style="color:#f92672">)&lt;/span> CUDA Cores/MP: &lt;span style="color:#ae81ff">4352&lt;/span> CUDA Cores
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> GPU Max Clock rate: &lt;span style="color:#ae81ff">1545&lt;/span> MHz &lt;span style="color:#f92672">(&lt;/span>1.54 GHz&lt;span style="color:#f92672">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Memory Clock rate: &lt;span style="color:#ae81ff">7000&lt;/span> Mhz
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Memory Bus Width: 352-bit
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> L2 Cache Size: &lt;span style="color:#ae81ff">5767168&lt;/span> bytes
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Maximum Texture Dimension Size &lt;span style="color:#f92672">(&lt;/span>x,y,z&lt;span style="color:#f92672">)&lt;/span> 1D&lt;span style="color:#f92672">=(&lt;/span>131072&lt;span style="color:#f92672">)&lt;/span>, 2D&lt;span style="color:#f92672">=(&lt;/span>131072, 65536&lt;span style="color:#f92672">)&lt;/span>, 3D&lt;span style="color:#f92672">=(&lt;/span>16384, 16384, 16384&lt;span style="color:#f92672">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Maximum Layered 1D Texture Size, &lt;span style="color:#f92672">(&lt;/span>num&lt;span style="color:#f92672">)&lt;/span> layers 1D&lt;span style="color:#f92672">=(&lt;/span>32768&lt;span style="color:#f92672">)&lt;/span>, &lt;span style="color:#ae81ff">2048&lt;/span> layers
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Maximum Layered 2D Texture Size, &lt;span style="color:#f92672">(&lt;/span>num&lt;span style="color:#f92672">)&lt;/span> layers 2D&lt;span style="color:#f92672">=(&lt;/span>32768, 32768&lt;span style="color:#f92672">)&lt;/span>, &lt;span style="color:#ae81ff">2048&lt;/span> layers
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Total amount of constant memory: &lt;span style="color:#ae81ff">65536&lt;/span> bytes
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Total amount of shared memory per block: &lt;span style="color:#ae81ff">49152&lt;/span> bytes
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Total number of registers available per block: &lt;span style="color:#ae81ff">65536&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Warp size: &lt;span style="color:#ae81ff">32&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Maximum number of threads per multiprocessor: &lt;span style="color:#ae81ff">1024&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Maximum number of threads per block: &lt;span style="color:#ae81ff">1024&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Max dimension size of a thread block &lt;span style="color:#f92672">(&lt;/span>x,y,z&lt;span style="color:#f92672">)&lt;/span>: &lt;span style="color:#f92672">(&lt;/span>1024, 1024, 64&lt;span style="color:#f92672">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Max dimension size of a grid size &lt;span style="color:#f92672">(&lt;/span>x,y,z&lt;span style="color:#f92672">)&lt;/span>: &lt;span style="color:#f92672">(&lt;/span>2147483647, 65535, 65535&lt;span style="color:#f92672">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Maximum memory pitch: &lt;span style="color:#ae81ff">2147483647&lt;/span> bytes
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Texture alignment: &lt;span style="color:#ae81ff">512&lt;/span> bytes
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Concurrent copy and kernel execution: Yes with &lt;span style="color:#ae81ff">3&lt;/span> copy engine&lt;span style="color:#f92672">(&lt;/span>s&lt;span style="color:#f92672">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Run time limit on kernels: No
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Integrated GPU sharing Host Memory: No
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Support host page-locked memory mapping: Yes
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Alignment requirement &lt;span style="color:#66d9ef">for&lt;/span> Surfaces: Yes
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Device has ECC support: Disabled
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Device supports Unified Addressing &lt;span style="color:#f92672">(&lt;/span>UVA&lt;span style="color:#f92672">)&lt;/span>: Yes
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Device supports Compute Preemption: Yes
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Supports Cooperative Kernel Launch: Yes
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Supports MultiDevice Co-op Kernel Launch: Yes
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Device PCI Domain ID / Bus ID / location ID: &lt;span style="color:#ae81ff">0&lt;/span> / &lt;span style="color:#ae81ff">2&lt;/span> / &lt;span style="color:#ae81ff">0&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Compute Mode:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &amp;lt; Default &lt;span style="color:#f92672">(&lt;/span>multiple host threads can use ::cudaSetDevice&lt;span style="color:#f92672">()&lt;/span> with device simultaneously&lt;span style="color:#f92672">)&lt;/span> &amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&amp;gt; Peer access from GeForce RTX &lt;span style="color:#ae81ff">2080&lt;/span> Ti &lt;span style="color:#f92672">(&lt;/span>GPU0&lt;span style="color:#f92672">)&lt;/span> -&amp;gt; GeForce RTX &lt;span style="color:#ae81ff">2080&lt;/span> Ti &lt;span style="color:#f92672">(&lt;/span>GPU1&lt;span style="color:#f92672">)&lt;/span> : Yes
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&amp;gt; Peer access from GeForce RTX &lt;span style="color:#ae81ff">2080&lt;/span> Ti &lt;span style="color:#f92672">(&lt;/span>GPU1&lt;span style="color:#f92672">)&lt;/span> -&amp;gt; GeForce RTX &lt;span style="color:#ae81ff">2080&lt;/span> Ti &lt;span style="color:#f92672">(&lt;/span>GPU0&lt;span style="color:#f92672">)&lt;/span> : Yes
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>deviceQuery, CUDA Driver &lt;span style="color:#f92672">=&lt;/span> CUDART, CUDA Driver Version &lt;span style="color:#f92672">=&lt;/span> 10.1, CUDA Runtime Version &lt;span style="color:#f92672">=&lt;/span> 10.1, NumDevs &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="源码">
 源码
 &lt;a class="anchor" href="#%e6%ba%90%e7%a0%81">#&lt;/a>
&lt;/h2>
&lt;p>&lt;a href="https://github.com/NVIDIA/cuda-samples/tree/master/Samples/deviceQuery">https://github.com/NVIDIA/cuda-samples/tree/master/Samples/deviceQuery&lt;/a>&lt;/p></description></item><item><title>mediainfo 静态编译脚本</title><link>https://notes.zhangwenbing.com/blog/linux/roH7hpe6L/</link><pubDate>Tue, 13 Aug 2019 01:38:19 +0800</pubDate><guid>https://notes.zhangwenbing.com/blog/linux/roH7hpe6L/</guid><description>&lt;blockquote>
&lt;p>因为需要mediainfo支持http协议，在老的版本中是不支持的，所以只能自己动手编译了。&lt;/p>
&lt;/blockquote>
&lt;h2 id="说明">
 说明
 &lt;a class="anchor" href="#%e8%af%b4%e6%98%8e">#&lt;/a>
&lt;/h2>
&lt;p>系统：ubuntu 14.04 (其他版本可能会有少许改动)&lt;/p></description></item><item><title>openssl - https SAN自签名证书</title><link>https://notes.zhangwenbing.com/blog/linux/JQIo7dGc1/</link><pubDate>Tue, 02 Jul 2019 12:15:46 +0800</pubDate><guid>https://notes.zhangwenbing.com/blog/linux/JQIo7dGc1/</guid><description>&lt;blockquote>
&lt;p>使用openssl生产自签名证书，用于https测试。&lt;/p>
&lt;/blockquote>
&lt;h2 id="ca根证书制作">
 CA根证书制作
 &lt;a class="anchor" href="#ca%e6%a0%b9%e8%af%81%e4%b9%a6%e5%88%b6%e4%bd%9c">#&lt;/a>
&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#1.生成根证书密钥&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$ openssl genrsa -out ca.key &lt;span style="color:#ae81ff">4096&lt;/span> &lt;span style="color:#75715e">#建议长度为4096,1024长度已经被列为不安全。&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#2.生成自签名根证书&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$ openssl req -new -x509 -days &lt;span style="color:#ae81ff">3650&lt;/span> -key ca.key -out ca.crt &lt;span style="color:#75715e">#这里在输入CommonName的时候输入名称而不是域名或者ip,就是证书上显示的颁发者，虽然是自签名证书，但是尽量让证书看起来标准一些&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="使用根证书来签名其它证书">
 使用根证书来签名其它证书
 &lt;a class="anchor" href="#%e4%bd%bf%e7%94%a8%e6%a0%b9%e8%af%81%e4%b9%a6%e6%9d%a5%e7%ad%be%e5%90%8d%e5%85%b6%e5%ae%83%e8%af%81%e4%b9%a6">#&lt;/a>
&lt;/h2>
&lt;h3 id="1生成证书密钥">
 &lt;strong>1.生成证书密钥&lt;/strong>
 &lt;a class="anchor" href="#1%e7%94%9f%e6%88%90%e8%af%81%e4%b9%a6%e5%af%86%e9%92%a5">#&lt;/a>
&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>$ openssl genrsa -out server.key &lt;span style="color:#ae81ff">4096&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="2-subject-alt-namesan">
 &lt;strong>2. Subject Alt Name(SAN)&lt;/strong>
 &lt;a class="anchor" href="#2-subject-alt-namesan">#&lt;/a>
&lt;/h2>
&lt;p>高版本的Chrome浏览器会要求设置 &lt;code>subjectAltName&lt;/code>,如果没有设置SAN会报证书错误&lt;/p></description></item><item><title>supervisor 安装和使用方法</title><link>https://notes.zhangwenbing.com/blog/linux/B1G3FwCaN/</link><pubDate>Fri, 31 May 2019 09:20:01 +0800</pubDate><guid>https://notes.zhangwenbing.com/blog/linux/B1G3FwCaN/</guid><description>&lt;blockquote>
&lt;p>Supervisor是用Python开发的一套通用的进程管理程序，能将一个普通的命令行进程变为后台daemon，并监控进程状态，异常退出时能自动重启。&lt;/p></description></item><item><title>error while loading shared libraries: libc.so.6: cannot open shared object file: No such file or directory</title><link>https://notes.zhangwenbing.com/blog/linux/HkCTnskvV/</link><pubDate>Fri, 08 Mar 2019 09:24:10 +0800</pubDate><guid>https://notes.zhangwenbing.com/blog/linux/HkCTnskvV/</guid><description>&lt;blockquote>
&lt;p>不小心误删libc.so的恢复方式&lt;/p>
&lt;/blockquote>
&lt;p>安装完成后, 建立软链指向glibc-2.14, 执行如下命令:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>rm -rf /lib64/libc.so.6
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>ln -s /opt/glibc-2.14/lib/libc-2.14.so /lib64/libc.so.6
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>注意：删除libc.so.6之后可能导致系统命令不可用的情况, 可使用如下方法解决:&lt;/p></description></item><item><title>yum错误:problem making ssl connection Trying other mirror</title><link>https://notes.zhangwenbing.com/blog/linux/rk-lmMGL4/</link><pubDate>Tue, 26 Feb 2019 01:20:26 +0800</pubDate><guid>https://notes.zhangwenbing.com/blog/linux/rk-lmMGL4/</guid><description>&lt;blockquote>
&lt;p>yum无法使用带https的源&lt;/p>
&lt;/blockquote>
&lt;h2 id="环境">
 环境
 &lt;a class="anchor" href="#%e7%8e%af%e5%a2%83">#&lt;/a>
&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>yum install epel-release
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>运行以上命令之后，安装其他软件就报错。&lt;/p>
&lt;h2 id="错误提示">
 错误提示
 &lt;a class="anchor" href="#%e9%94%99%e8%af%af%e6%8f%90%e7%a4%ba">#&lt;/a>
&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">[&lt;/span>Errno 14&lt;span style="color:#f92672">]&lt;/span> problem making ssl connection Trying other mirror.
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Trying other mirror
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Error: Cannot retrieve repository metadata &lt;span style="color:#f92672">(&lt;/span>repomd.xml&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#66d9ef">for&lt;/span> repository: xxxx. Please verify its path and try again
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>经过google查询，发现似乎是ssl证书的原因。&lt;/p></description></item><item><title>CentOS7 php5.6 编译安装amqp扩展</title><link>https://notes.zhangwenbing.com/blog/linux/H10_K-VQ4/</link><pubDate>Tue, 22 Jan 2019 03:21:18 +0800</pubDate><guid>https://notes.zhangwenbing.com/blog/linux/H10_K-VQ4/</guid><description>&lt;blockquote>
&lt;p>php 安装最新rabbitmq扩展&lt;/p>
&lt;/blockquote>
&lt;h2 id="1安装编译环境">
 1、安装编译环境
 &lt;a class="anchor" href="#1%e5%ae%89%e8%a3%85%e7%bc%96%e8%af%91%e7%8e%af%e5%a2%83">#&lt;/a>
&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>yum install cmake gcc gcc-c++ make openssl-devel
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="2安装rabbitmq-c">
 2、安装rabbitmq-c
 &lt;a class="anchor" href="#2%e5%ae%89%e8%a3%85rabbitmq-c">#&lt;/a>
&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>wget https://github.com/alanxz/rabbitmq-c/archive/v0.9.0.zip
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>unzip v0.9.0.zip
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>cd rabbitmq-c-0.9.0/
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>cmake -DCMAKE_INSTALL_PREFIX&lt;span style="color:#f92672">=&lt;/span>/usr/local/rabbitmq-c-0.9.0/
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>make &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> make install
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="3安装amqp">
 3、安装amqp
 &lt;a class="anchor" href="#3%e5%ae%89%e8%a3%85amqp">#&lt;/a>
&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>wget http://pecl.php.net/get/amqp-1.9.4.tgz
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>tar zxf amqp-1.9.4.tgz
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>cd amqp-1.9.4
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>/usr/bin/phpize
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>./configure --with-php-config&lt;span style="color:#f92672">=&lt;/span>/usr/bin/php-config --with-amqp --with-librabbitmq-dir&lt;span style="color:#f92672">=&lt;/span>/usr/local/rabbitmq-c-0.9.0
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#由于rabbitmq-c编译出来的lib目录是lib64，所以我们要做一些小的修改&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>vim Makefile
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#将 AMQP_SHARED_LIBADD = -Wl,-rpath,/usr/local/rabbitmq-c-0.9.0/lib -L/usr/local/rabbitmq-c-0.9.0/lib -lrabbitmq&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#修改为 AMQP_SHARED_LIBADD = -Wl,-rpath,/usr/local/rabbitmq-c-0.9.0/lib64 -L/usr/local/rabbitmq-c-0.9.0/lib64 -lrabbitmq&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>make &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> make install
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="4phpini-添加模块">
 4、php.ini 添加模块
 &lt;a class="anchor" href="#4phpini-%e6%b7%bb%e5%8a%a0%e6%a8%a1%e5%9d%97">#&lt;/a>
&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>vi /usr/local/php/etc/php.ini
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#增加&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>extension &lt;span style="color:#f92672">=&lt;/span> /usr/lib64/php/modules/amqp.so
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="5重启服务">
 5、重启服务
 &lt;a class="anchor" href="#5%e9%87%8d%e5%90%af%e6%9c%8d%e5%8a%a1">#&lt;/a>
&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>systemctl restart php-fpm
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>记一次时间同步引起的故障</title><link>https://notes.zhangwenbing.com/blog/linux/B11j0sF-N/</link><pubDate>Wed, 02 Jan 2019 04:24:43 +0800</pubDate><guid>https://notes.zhangwenbing.com/blog/linux/B11j0sF-N/</guid><description>&lt;blockquote>
&lt;p>ntpdate同步时间，时间跳跃，引起服务中断。&lt;/p>
&lt;/blockquote>
&lt;h2 id="计划任务">
 计划任务
 &lt;a class="anchor" href="#%e8%ae%a1%e5%88%92%e4%bb%bb%e5%8a%a1">#&lt;/a>
&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">0&lt;/span> &lt;span style="color:#ae81ff">4&lt;/span> * * * /usr/sbin/ntpdate 10.200.3.71
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="日志">
 日志
 &lt;a class="anchor" href="#%e6%97%a5%e5%bf%97">#&lt;/a>
&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>Dec &lt;span style="color:#ae81ff">30&lt;/span> 04:00:01 localhost systemd: Created slice user-0.slice.
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Dec &lt;span style="color:#ae81ff">30&lt;/span> 04:00:01 localhost systemd: Starting user-0.slice.
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Dec &lt;span style="color:#ae81ff">30&lt;/span> 04:00:01 localhost systemd: Started Session &lt;span style="color:#ae81ff">16&lt;/span> of user root.
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Dec &lt;span style="color:#ae81ff">30&lt;/span> 04:00:01 localhost systemd: Starting Session &lt;span style="color:#ae81ff">16&lt;/span> of user root.
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Dec &lt;span style="color:#ae81ff">29&lt;/span> 20:09:59 localhost systemd: Time has been changed
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Dec &lt;span style="color:#ae81ff">29&lt;/span> 20:09:59 localhost systemd: Removed slice user-0.slice.
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Dec &lt;span style="color:#ae81ff">29&lt;/span> 20:09:59 localhost systemd: Stopping user-0.slice.
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="故障">
 故障
 &lt;a class="anchor" href="#%e6%95%85%e9%9a%9c">#&lt;/a>
&lt;/h2>
&lt;p>因为跳跃的时间太大，导致系统的各种服务中断（网络中断和systemctl管理的服务也有问题）。&lt;/p></description></item><item><title>解决rabbitmq依赖问题</title><link>https://notes.zhangwenbing.com/blog/linux/HJJ4wWwim/</link><pubDate>Fri, 19 Oct 2018 07:30:49 +0800</pubDate><guid>https://notes.zhangwenbing.com/blog/linux/HJJ4wWwim/</guid><description>&lt;h2 id="错误提示">
 错误提示
 &lt;a class="anchor" href="#%e9%94%99%e8%af%af%e6%8f%90%e7%a4%ba">#&lt;/a>
&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>warning: rabbitmq-server-3.6.6-1.el6.noarch.rpm: Header V4 RSA/SHA1 Signature, key ID 6026dfca: NOKEYerror: Failed dependencies:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> erlang &amp;gt;&lt;span style="color:#f92672">=&lt;/span> R16B-03 is needed by rabbitmq-server-3.6.6-1.el6.noarch
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> socat is needed by rabbitmq-server-3.6.6-1.el6.noarch
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="解决方法">
 解决方法
 &lt;a class="anchor" href="#%e8%a7%a3%e5%86%b3%e6%96%b9%e6%b3%95">#&lt;/a>
&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>cd /etc/yum.repos.d/
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>cat erlang.repo
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">[&lt;/span>erlang-solutions&lt;span style="color:#f92672">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>name&lt;span style="color:#f92672">=&lt;/span>Centos $releasever - $basearch - Erlang Solutions
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>baseurl&lt;span style="color:#f92672">=&lt;/span>http://packages.erlang-solutions.com/rpm/centos/$releasever/$basearch
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>gpgcheck&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>gpgkey&lt;span style="color:#f92672">=&lt;/span>http://packages.erlang-solutions.com/debian/erlang_solutions.asc
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>enabled&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>然后再安装rabbitmq&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>yum localinstall rabbitmq-server-3.6.6-1.el6.noarch.rpm
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="其他问题">
 其他问题
 &lt;a class="anchor" href="#%e5%85%b6%e4%bb%96%e9%97%ae%e9%a2%98">#&lt;/a>
&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># /etc/init.d/rabbitmq-server start&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Starting rabbitmq-server: FAILED - check /var/log/rabbitmq/startup_&lt;span style="color:#f92672">{&lt;/span>log, _err&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>rabbitmq-server.
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># vim /var/log/rabbitmq/startup_err&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>init terminating in do_boot &lt;span style="color:#f92672">(&lt;/span>noproc&lt;span style="color:#f92672">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Crash dump is being written to: erl_crash.dump...done
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>如果出现以上问题，说明erlang和rabbitmq的版本不相符。只能重新安装erlang了。&lt;/p></description></item><item><title>Linux bash 提取文件名和目录名</title><link>https://notes.zhangwenbing.com/blog/linux/SJyvgQAOm/</link><pubDate>Tue, 18 Sep 2018 07:01:06 +0800</pubDate><guid>https://notes.zhangwenbing.com/blog/linux/SJyvgQAOm/</guid><description>&lt;blockquote>
&lt;p>在Linux Bash中分别使用basename、dirname、${}，提取文件名和目录名。&lt;/p>
&lt;/blockquote>
&lt;h2 id="通过变量方式">
 通过变量方式
 &lt;a class="anchor" href="#%e9%80%9a%e8%bf%87%e5%8f%98%e9%87%8f%e6%96%b9%e5%bc%8f">#&lt;/a>
&lt;/h2>
&lt;p>${}用于字符串的读取，提取和替换功能，可以使用${} 提取字符串&lt;/p></description></item><item><title>nginx auth_basic登录验证遇到的坑</title><link>https://notes.zhangwenbing.com/blog/linux/ByaB7yPSQ/</link><pubDate>Tue, 07 Aug 2018 09:26:11 +0800</pubDate><guid>https://notes.zhangwenbing.com/blog/linux/ByaB7yPSQ/</guid><description>&lt;blockquote>
&lt;p>htpasswd默认使用crypt()加密，创建的密码只有前8位有效&lt;/p>
&lt;/blockquote>
&lt;h2 id="问题">
 问题
 &lt;a class="anchor" href="#%e9%97%ae%e9%a2%98">#&lt;/a>
&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>htpasswd -c /etc/nginx/.htpasswd test
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>假如，密码为abcd12345&lt;/p>
&lt;p>那么在登录的时候，不管是输入“abcd1234”、”abcd12345“或”abcd123456789sdjkal“ 都能通过验证。&lt;/p></description></item><item><title>Nginx的connect() to xxx failed (13: Permission denied) 和 Nginx 403 forbidden</title><link>https://notes.zhangwenbing.com/blog/linux/HJlvWaG47/</link><pubDate>Mon, 23 Jul 2018 02:53:40 +0800</pubDate><guid>https://notes.zhangwenbing.com/blog/linux/HJlvWaG47/</guid><description>&lt;blockquote>
&lt;p>解决Nginx的connect() to xxx failed (13: Permission denied) 和 Nginx 403 forbidden 错误&lt;/p>
&lt;/blockquote>
&lt;h2 id="查看selinux状态">
 查看SeLinux状态
 &lt;a class="anchor" href="#%e6%9f%a5%e7%9c%8bselinux%e7%8a%b6%e6%80%81">#&lt;/a>
&lt;/h2>
&lt;pre tabindex="0">&lt;code>getenforce
&lt;/code>&lt;/pre>&lt;p>如果是enabled则继续往下看。&lt;/p>
&lt;h2 id="临时关闭不需要重启机器">
 临时关闭（不需要重启机器）
 &lt;a class="anchor" href="#%e4%b8%b4%e6%97%b6%e5%85%b3%e9%97%ad%e4%b8%8d%e9%9c%80%e8%a6%81%e9%87%8d%e5%90%af%e6%9c%ba%e5%99%a8">#&lt;/a>
&lt;/h2>
&lt;pre tabindex="0">&lt;code>setenforce 0
&lt;/code>&lt;/pre>&lt;h2 id="修改配置">
 修改配置
 &lt;a class="anchor" href="#%e4%bf%ae%e6%94%b9%e9%85%8d%e7%bd%ae">#&lt;/a>
&lt;/h2>
&lt;pre tabindex="0">&lt;code>vim /etc/selinux/config #将SELINUX=enforcing改为SELINUX=disabled
&lt;/code>&lt;/pre>&lt;p>如果你执行了临时关闭SeLinux并机器上跑了重要的业务，那可以不需要马上重启机器，等待下次重启配置生效即可。&lt;/p></description></item><item><title>centos7 rdate 时间同步服务</title><link>https://notes.zhangwenbing.com/blog/linux/rJY7U8E9U0z/</link><pubDate>Mon, 14 May 2018 04:45:01 +0800</pubDate><guid>https://notes.zhangwenbing.com/blog/linux/rJY7U8E9U0z/</guid><description>&lt;h2 id="安装软件">
 安装软件
 &lt;a class="anchor" href="#%e5%ae%89%e8%a3%85%e8%bd%af%e4%bb%b6">#&lt;/a>
&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>yum install -y xinetd rdate
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="修改配制">
 修改配制
 &lt;a class="anchor" href="#%e4%bf%ae%e6%94%b9%e9%85%8d%e5%88%b6">#&lt;/a>
&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>vim /etc/xinetd.d/time-stream
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 将disable = yes 改为 disable = no&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="启动服务">
 启动服务
 &lt;a class="anchor" href="#%e5%90%af%e5%8a%a8%e6%9c%8d%e5%8a%a1">#&lt;/a>
&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 启动xinetd&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>systemctl start xinetd
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 添加开启启动&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>systemctl enable xinetd
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="同步时间">
 同步时间
 &lt;a class="anchor" href="#%e5%90%8c%e6%ad%a5%e6%97%b6%e9%97%b4">#&lt;/a>
&lt;/h2>
&lt;h3 id="服务端">
 服务端
 &lt;a class="anchor" href="#%e6%9c%8d%e5%8a%a1%e7%ab%af">#&lt;/a>
&lt;/h3>
&lt;p>首先在服务端执行以下命令（到底哪个是服务端呢？就是你在哪台机器上面执行了以上三个步骤就是服务端），在服务端上同步网络标准时间，然后再同步到内网各台机器上。&lt;/p></description></item><item><title>centos7 修改内核引导顺序</title><link>https://notes.zhangwenbing.com/blog/linux/rytGLI49LCf/</link><pubDate>Mon, 14 May 2018 04:45:01 +0800</pubDate><guid>https://notes.zhangwenbing.com/blog/linux/rytGLI49LCf/</guid><description>&lt;h2 id="查看内核">
 查看内核
 &lt;a class="anchor" href="#%e6%9f%a5%e7%9c%8b%e5%86%85%e6%a0%b8">#&lt;/a>
&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>cat /boot/grub2/grub.cfg |grep menuentry
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>menuentry &lt;span style="color:#e6db74">&amp;#39;CentOS Linux (3.10.0-327.36.3.el7.x86_64) 7 (Core)&amp;#39;&lt;/span> --class centos --class gnu-linux --class gnu --class os --unrestricted $menuentry_id_option &lt;span style="color:#e6db74">&amp;#39;gnulinux-3.10.0-327.el7.x86_64-advanced-80b9b662-0a1d-4e84-b07b-c1bf19e72d97&amp;#39;&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>menuentry &lt;span style="color:#e6db74">&amp;#39;CentOS Linux (3.10.0-327.22.2.el7.x86_64) 7 (Core)&amp;#39;&lt;/span> --class centos --class gnu-linux --class gnu --class os --unrestricted $menuentry_id_option &lt;span style="color:#e6db74">&amp;#39;gnulinux-3.10.0-327.el7.x86_64-advanced-80b9b662-0a1d-4e84-b07b-c1bf19e72d97&amp;#39;&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>menuentry &lt;span style="color:#e6db74">&amp;#39;CentOS Linux (3.10.0-327.el7.x86_64) 7 (Core)&amp;#39;&lt;/span> --class centos --class gnu-linux --class gnu --class os --unrestricted $menuentry_id_option &lt;span style="color:#e6db74">&amp;#39;gnulinux-3.10.0-327.el7.x86_64-advanced-80b9b662-0a1d-4e84-b07b-c1bf19e72d97&amp;#39;&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>menuentry &lt;span style="color:#e6db74">&amp;#39;CentOS Linux (0-rescue-7d26c16f128042a684ea474c9e2c240f) 7 (Core)&amp;#39;&lt;/span> --class centos --class gnu-linux --class gnu --class os --unrestricted $menuentry_id_option &lt;span style="color:#e6db74">&amp;#39;gnulinux-0-rescue-7d26c16f128042a684ea474c9e2c240f-advanced-80b9b662-0a1d-4e84-b07b-c1bf19e72d97&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="修改默认">
 修改默认
 &lt;a class="anchor" href="#%e4%bf%ae%e6%94%b9%e9%bb%98%e8%ae%a4">#&lt;/a>
&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>grub2-set-default &lt;span style="color:#e6db74">&amp;#34;CentOS Linux (3.10.0-327.22.2.el7.x86_64) 7 (Core)&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="查看生效">
 查看生效
 &lt;a class="anchor" href="#%e6%9f%a5%e7%9c%8b%e7%94%9f%e6%95%88">#&lt;/a>
&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>grub2-editenv list
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>saved_entry&lt;span style="color:#f92672">=&lt;/span>CentOS Linux &lt;span style="color:#f92672">(&lt;/span>3.10.0-327.22.2.el7.x86_64&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#ae81ff">7&lt;/span> &lt;span style="color:#f92672">(&lt;/span>Core&lt;span style="color:#f92672">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Centos7搭建vpn</title><link>https://notes.zhangwenbing.com/blog/linux/B1AMUL45ICM/</link><pubDate>Mon, 14 May 2018 04:45:01 +0800</pubDate><guid>https://notes.zhangwenbing.com/blog/linux/B1AMUL45ICM/</guid><description>&lt;h2 id="准备环境">
 准备环境
 &lt;a class="anchor" href="#%e5%87%86%e5%a4%87%e7%8e%af%e5%a2%83">#&lt;/a>
&lt;/h2>
&lt;h3 id="首先查看系统是否支持pptpd服务">
 首先查看系统是否支持pptpd服务：
 &lt;a class="anchor" href="#%e9%a6%96%e5%85%88%e6%9f%a5%e7%9c%8b%e7%b3%bb%e7%bb%9f%e6%98%af%e5%90%a6%e6%94%af%e6%8c%81pptpd%e6%9c%8d%e5%8a%a1">#&lt;/a>
&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>modprobe ppp-compress-18 &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> echo yes
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="安装ppp--pptpdiptables">
 安装ppp , pptpd，iptables
 &lt;a class="anchor" href="#%e5%ae%89%e8%a3%85ppp--pptpdiptables">#&lt;/a>
&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>yum install -y ppp pptpd iptables
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>systemctl mask firewalld
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>systemctl stop firewalld
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="修改配制">
 修改配制
 &lt;a class="anchor" href="#%e4%bf%ae%e6%94%b9%e9%85%8d%e5%88%b6">#&lt;/a>
&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>vi /etc/pptpd.conf &lt;span style="color:#75715e">#找到配制文件中默认的值，去掉注释即可&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>localip 192.168.0.1 &lt;span style="color:#75715e">#本机VPN IP&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>remoteip 192.168.0.234-238,192.168.0.245 客户端可以获取到的ip网段
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#修改DNS&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>vi /etc/ppp/options.pptpd &lt;span style="color:#75715e">#末尾添加dns&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ms-dns 8.8.8.8
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ms-dns 114.114.114.114
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#添加vpn账户&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>vi /etc/ppp/chap-secrets
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># client server secret IP addresses&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> user pptpd passwd *
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#开启路由转发&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>vi /etc/sysctl.conf
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>net.ipv4.ip_forward &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span> &lt;span style="color:#75715e">#添加在配制文件的末尾即可&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sysctl -p &lt;span style="color:#75715e">#运行这个命令会输出上面添加的那一行信息，意思是使内核修改生效&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#在防火墙上开启nat转发&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>iptables -t nat -A POSTROUTING -s 192.168.0.0/24 -o eth0 -j MASQUERADE &lt;span style="color:#75715e">#IP和网口根据实际情况修改即可&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="开启服务">
 开启服务
 &lt;a class="anchor" href="#%e5%bc%80%e5%90%af%e6%9c%8d%e5%8a%a1">#&lt;/a>
&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>service iptables save
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>systemctl restart iptables
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>systemctl restart pptpd
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Centos多网卡绑定(bonding)</title><link>https://notes.zhangwenbing.com/blog/linux/rJFUIE5I0G/</link><pubDate>Mon, 14 May 2018 04:45:01 +0800</pubDate><guid>https://notes.zhangwenbing.com/blog/linux/rJFUIE5I0G/</guid><description>&lt;h2 id="内核模块">
 内核模块
 &lt;a class="anchor" href="#%e5%86%85%e6%a0%b8%e6%a8%a1%e5%9d%97">#&lt;/a>
&lt;/h2>
&lt;p>通过modinfo bonding命令查看Linux是否支持bonding&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>lsmod |grep bonding
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#载入bonding模块&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>modprobe bonding
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="配置bonding">
 配置bonding
 &lt;a class="anchor" href="#%e9%85%8d%e7%bd%aebonding">#&lt;/a>
&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># cat /etc/modprobe.d/bond0.conf&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>alias bond0 bonding
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>cd /etc/sysconfig/network-scripts/
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># grep -v &amp;#34;^#&amp;#34; ifcfg-bond0&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>DEVICE&lt;span style="color:#f92672">=&lt;/span>bond0
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>BOOTPROTO&lt;span style="color:#f92672">=&lt;/span>static
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ONBOOT&lt;span style="color:#f92672">=&lt;/span>yes
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>IPADDR&lt;span style="color:#f92672">=&lt;/span>192.168.5.88
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>NETMASK&lt;span style="color:#f92672">=&lt;/span>255.255.255.0
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>GATEWAY&lt;span style="color:#f92672">=&lt;/span>192.168.5.1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>USERCTL&lt;span style="color:#f92672">=&lt;/span>no
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">====================================================&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>BONDING_OPTS&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;mode=0 miimon=100&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>说明：这里使用了BONDING_OPTS选项，则不需要再使用 /etc/modprobe.d/bond0.conf 配置文件对绑定设备进行配置。参数mode&lt;span style="color:#f92672">=&lt;/span>0，指负载均衡模式，详见下文。miimon是用来进行链路监测的，其原理是检测网上的链路状态，一般将miimon值设为100，表示系统每100ms监测一次链路连接状态，如果有一条线路不通就转入另一条线路。
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">====================================================&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># grep -v &amp;#34;^#&amp;#34; ifcfg-eth1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>DEVICE&lt;span style="color:#f92672">=&lt;/span>eth1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ONBOOT&lt;span style="color:#f92672">=&lt;/span>yes
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>BOOTPROTO&lt;span style="color:#f92672">=&lt;/span>static
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>MASTER&lt;span style="color:#f92672">=&lt;/span>bond0
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>SLAVE&lt;span style="color:#f92672">=&lt;/span>yes
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>USERCTL&lt;span style="color:#f92672">=&lt;/span>no
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># grep -v &amp;#34;^#&amp;#34; ifcfg-eth0&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>DEVICE&lt;span style="color:#f92672">=&lt;/span>eth0
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>BOOTPROTO&lt;span style="color:#f92672">=&lt;/span>static
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ONBOOT&lt;span style="color:#f92672">=&lt;/span>yes
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>MASTER&lt;span style="color:#f92672">=&lt;/span>bond0
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>SLAVE&lt;span style="color:#f92672">=&lt;/span>yes
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>USERCTL&lt;span style="color:#f92672">=&lt;/span>no
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>注意：建议不要指定MAC地址
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># echo 100 &amp;gt; /sys/class/net/bond0/bonding/miimon&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># echo 6 &amp;gt; /sys/class/net/bond0/bonding/mode&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Mode of operation : &lt;span style="color:#ae81ff">0&lt;/span> &lt;span style="color:#66d9ef">for&lt;/span> balance-rr, &lt;span style="color:#ae81ff">1&lt;/span> &lt;span style="color:#66d9ef">for&lt;/span> active-backup, &lt;span style="color:#ae81ff">2&lt;/span> &lt;span style="color:#66d9ef">for&lt;/span> balance-xor；
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">3&lt;/span> &lt;span style="color:#66d9ef">for&lt;/span> broadcast, &lt;span style="color:#ae81ff">4&lt;/span> &lt;span style="color:#66d9ef">for&lt;/span> 802.3ad, &lt;span style="color:#ae81ff">5&lt;/span> &lt;span style="color:#66d9ef">for&lt;/span> balance-tlb, &lt;span style="color:#ae81ff">6&lt;/span> &lt;span style="color:#66d9ef">for&lt;/span> balance-alb &lt;span style="color:#f92672">(&lt;/span>charp&lt;span style="color:#f92672">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>重启网络
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># /etc/init.d/network restart&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>检查下
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ifconfig
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>cat /proc/net/bonding/bond0
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="bonding模式">
 bonding模式
 &lt;a class="anchor" href="#bonding%e6%a8%a1%e5%bc%8f">#&lt;/a>
&lt;/h2>
&lt;p>bonding的模式：0-6，即：7种模式&lt;/p></description></item><item><title>centos升级 排除不想升级的软件包</title><link>https://notes.zhangwenbing.com/blog/linux/r1bIUL458Cz/</link><pubDate>Mon, 14 May 2018 04:45:01 +0800</pubDate><guid>https://notes.zhangwenbing.com/blog/linux/r1bIUL458Cz/</guid><description>&lt;h2 id="方法一">
 方法一
 &lt;a class="anchor" href="#%e6%96%b9%e6%b3%95%e4%b8%80">#&lt;/a>
&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>yum --exclude&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;kernel*&amp;#34;&lt;/span> update
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="方法二">
 方法二
 &lt;a class="anchor" href="#%e6%96%b9%e6%b3%95%e4%ba%8c">#&lt;/a>
&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>cat /etc/yum.conf
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">[&lt;/span>main&lt;span style="color:#f92672">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>......
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>exclude&lt;span style="color:#f92672">=&lt;/span>kernel*
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>修改/etc/yum.conf，在“[main]”的最后加上“exclude=kernel*”即可。&lt;/p>
&lt;h2 id="总结">
 总结
 &lt;a class="anchor" href="#%e6%80%bb%e7%bb%93">#&lt;/a>
&lt;/h2>
&lt;p>方法一为零时的，也就是只在当次有效，而方法二为永久有效。可根据不同情况选择。&lt;/p></description></item><item><title>linux bash截取字符串的几种方法</title><link>https://notes.zhangwenbing.com/blog/linux/HJi_UUE5ICG/</link><pubDate>Mon, 14 May 2018 04:45:01 +0800</pubDate><guid>https://notes.zhangwenbing.com/blog/linux/HJi_UUE5ICG/</guid><description>&lt;h3 id="-号截取删除左边字符保留右边字符">
 # 号截取，删除左边字符，保留右边字符
 &lt;a class="anchor" href="#-%e5%8f%b7%e6%88%aa%e5%8f%96%e5%88%a0%e9%99%a4%e5%b7%a6%e8%be%b9%e5%ad%97%e7%ac%a6%e4%bf%9d%e7%95%99%e5%8f%b3%e8%be%b9%e5%ad%97%e7%ac%a6">#&lt;/a>
&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>var&lt;span style="color:#f92672">=&lt;/span>http://www.aaa.com/123.htm
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>echo &lt;span style="color:#e6db74">${&lt;/span>var#*//&lt;span style="color:#e6db74">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>其中var是变量名，#号是运算符， &lt;em>号是通配符，&lt;/em>//表示从左边开始删除第一个到//处的所有字符即删除http://&lt;/p></description></item><item><title>linux crontab计划任务详解</title><link>https://notes.zhangwenbing.com/blog/linux/rJvbIUV580z/</link><pubDate>Mon, 14 May 2018 04:45:01 +0800</pubDate><guid>https://notes.zhangwenbing.com/blog/linux/rJvbIUV580z/</guid><description>&lt;blockquote>
&lt;p>crontab命令常见于Unix和类Unix的操作系统之中，用于设置周期性被执行的指令&lt;/p>
&lt;/blockquote>
&lt;h2 id="配置文件">
 配置文件
 &lt;a class="anchor" href="#%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6">#&lt;/a>
&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>cat /etc/crontab
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>SHELL&lt;span style="color:#f92672">=&lt;/span>/bin/bash 计划任务的默认脚本bash shell
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>PATH&lt;span style="color:#f92672">=&lt;/span>/sbin:/bin:/usr/sbin:/usr/bin 默认搜索路径
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>MAILTO&lt;span style="color:#f92672">=&lt;/span>root 当计划任务有标准输出或标准错误输出时，会将结果发邮件给root
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>HOME&lt;span style="color:#f92672">=&lt;/span>/
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># run-parts&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">01&lt;/span> * * * * root run-parts /etc/cron.hourly /etc/ 后面一定是个文件夹，每小时执行
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">02&lt;/span> &lt;span style="color:#ae81ff">4&lt;/span> * * * root run-parts /etc/cron.daily
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">22&lt;/span> &lt;span style="color:#ae81ff">4&lt;/span> * * &lt;span style="color:#ae81ff">0&lt;/span> root run-parts /etc/cron.weekly
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">42&lt;/span> &lt;span style="color:#ae81ff">4&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span> * * root run-parts /etc/cron.monthly
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="注意事项">
 注意事项
 &lt;a class="anchor" href="#%e6%b3%a8%e6%84%8f%e4%ba%8b%e9%a1%b9">#&lt;/a>
&lt;/h2>
&lt;p>多个计划任务不宜同时进行防止有非法计划任务周和日，月不可同时并存，容易导致计划任务时间混乱&lt;/p></description></item><item><title>linux nfs配置及访问控制</title><link>https://notes.zhangwenbing.com/blog/linux/rJJe8UNcU0M/</link><pubDate>Mon, 14 May 2018 04:45:01 +0800</pubDate><guid>https://notes.zhangwenbing.com/blog/linux/rJJe8UNcU0M/</guid><description>&lt;h2 id="nfs软件包">
 NFS软件包
 &lt;a class="anchor" href="#nfs%e8%bd%af%e4%bb%b6%e5%8c%85">#&lt;/a>
&lt;/h2>
&lt;p>nfs-utils portmap (rhel6换成了rpcbind ,所以启动服务时需要注意)&lt;/p>
&lt;h2 id="nfs文件">
 NFS文件
 &lt;a class="anchor" href="#nfs%e6%96%87%e4%bb%b6">#&lt;/a>
&lt;/h2>
&lt;p>/etc/exports #NFS主配置文件 /etc/init.d/nfs #NFS启动脚本 /etc/init.d/protmap&lt;/p>
&lt;p>#portmap启动脚本 /var/lib/*tab #NFS日志文件&lt;/p></description></item><item><title>linux openssh 常见问题汇总</title><link>https://notes.zhangwenbing.com/blog/linux/SJ68UEcUCM/</link><pubDate>Mon, 14 May 2018 04:45:01 +0800</pubDate><guid>https://notes.zhangwenbing.com/blog/linux/SJ68UEcUCM/</guid><description>&lt;blockquote>
&lt;p>软件包名&lt;/p>
&lt;/blockquote>
&lt;p>openssh-server openssh-clients&lt;/p>
&lt;p>服务名：sshd&lt;/p>
&lt;p>服务端配置文件：/etc/ssh/sshd.config 客户端…&lt;/p>
&lt;h2 id="软件包名">
 软件包名
 &lt;a class="anchor" href="#%e8%bd%af%e4%bb%b6%e5%8c%85%e5%90%8d">#&lt;/a>
&lt;/h2>
&lt;p>openssh-server openssh-clients&lt;/p>
&lt;h2 id="服务名sshd">
 服务名：sshd
 &lt;a class="anchor" href="#%e6%9c%8d%e5%8a%a1%e5%90%8dsshd">#&lt;/a>
&lt;/h2>
&lt;p>服务端配置文件：/etc/ssh/sshd.config 客户端配置文件：/etc/ssh/ssh.config&lt;/p></description></item><item><title>linux samba配置及乱码的解决方法</title><link>https://notes.zhangwenbing.com/blog/linux/rkxlI845IAz/</link><pubDate>Mon, 14 May 2018 04:45:01 +0800</pubDate><guid>https://notes.zhangwenbing.com/blog/linux/rkxlI845IAz/</guid><description>&lt;h2 id="简要说明">
 简要说明
 &lt;a class="anchor" href="#%e7%ae%80%e8%a6%81%e8%af%b4%e6%98%8e">#&lt;/a>
&lt;/h2>
&lt;p>samba：这个软体主要提供了SMB伺服器所需的各项服务程式(smbd及nmbd)、的文件档、以及其他与SAMBA相关的logrotate设定档及开机预设选项档案等；&lt;/p></description></item><item><title>Linux Screen命令</title><link>https://notes.zhangwenbing.com/blog/linux/B1muLLNcIRf/</link><pubDate>Mon, 14 May 2018 04:45:01 +0800</pubDate><guid>https://notes.zhangwenbing.com/blog/linux/B1muLLNcIRf/</guid><description>&lt;p>Linux screen 命令用于多重视窗管理程序。&lt;/p>
&lt;p>screen 为多重视窗管理程序。此处所谓的视窗，是指一个全屏幕的文字模式画面。通常只有在使用 telnet 登入主机或是使用老式的终端机时，才有可能用到 screen 程序。&lt;/p></description></item><item><title>linux 防御SYN攻击</title><link>https://notes.zhangwenbing.com/blog/linux/HyYg884c80f/</link><pubDate>Mon, 14 May 2018 04:45:01 +0800</pubDate><guid>https://notes.zhangwenbing.com/blog/linux/HyYg884c80f/</guid><description>&lt;h2 id="一默认syn配置">
 一、默认syn配置
 &lt;a class="anchor" href="#%e4%b8%80%e9%bb%98%e8%ae%a4syn%e9%85%8d%e7%bd%ae">#&lt;/a>
&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>sysctl -a | grep _syn
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>net.ipv4.tcp_max_syn_backlog &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">1024&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>net.ipv4.tcp_syncookies &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>net.ipv4.tcp_synack_retries &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">5&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>net.ipv4.tcp_syn_retries &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">5&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>tcp_max_syn_backlog 是SYN队列的长度，加大SYN队列长度可以容纳更多等待连接的网络连接数。&lt;/p>
&lt;p>tcp_syncookies是一个开关，是否打开SYN Cookie 功能，该功能可以防止部分SYN攻击。&lt;/p></description></item><item><title>linux内存清理释放命令</title><link>https://notes.zhangwenbing.com/blog/linux/S13z8UE5UCf/</link><pubDate>Mon, 14 May 2018 04:45:01 +0800</pubDate><guid>https://notes.zhangwenbing.com/blog/linux/S13z8UE5UCf/</guid><description>&lt;h2 id="命令">
 命令
 &lt;a class="anchor" href="#%e5%91%bd%e4%bb%a4">#&lt;/a>
&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>sync
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>echo &lt;span style="color:#ae81ff">1&lt;/span> &amp;gt; /proc/sys/vm/drop_caches
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>echo &lt;span style="color:#ae81ff">2&lt;/span> &amp;gt; /proc/sys/vm/drop_caches
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>echo &lt;span style="color:#ae81ff">3&lt;/span> &amp;gt; /proc/sys/vm/drop_caches
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="解释">
 解释
 &lt;a class="anchor" href="#%e8%a7%a3%e9%87%8a">#&lt;/a>
&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>cache释放：
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>To free pagecache:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>echo &lt;span style="color:#ae81ff">1&lt;/span> &amp;gt; /proc/sys/vm/drop_caches
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>To free dentries and inodes:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>echo &lt;span style="color:#ae81ff">2&lt;/span> &amp;gt; /proc/sys/vm/drop_caches
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>To free pagecache, dentries and inodes:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>echo &lt;span style="color:#ae81ff">3&lt;/span> &amp;gt; /proc/sys/vm/drop_caches
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="说明">
 说明
 &lt;a class="anchor" href="#%e8%af%b4%e6%98%8e">#&lt;/a>
&lt;/h2>
&lt;p>释放前最好sync一下，防止丢数据。&lt;/p></description></item><item><title>Linux清除内存</title><link>https://notes.zhangwenbing.com/blog/linux/B1FO88V580M/</link><pubDate>Mon, 14 May 2018 04:45:01 +0800</pubDate><guid>https://notes.zhangwenbing.com/blog/linux/B1FO88V580M/</guid><description>&lt;h2 id="如何在-linux-中清除缓存cache">
 如何在 Linux 中清除缓存（Cache）？
 &lt;a class="anchor" href="#%e5%a6%82%e4%bd%95%e5%9c%a8-linux-%e4%b8%ad%e6%b8%85%e9%99%a4%e7%bc%93%e5%ad%98cache">#&lt;/a>
&lt;/h2>
&lt;p>每个 Linux 系统有三种选项来清除缓存而不需要中断任何进程或服务。&lt;/p>
&lt;p>（LCTT 译注：Cache，译作“缓存”，指 CPU&lt;/p></description></item><item><title>mediainfo获取ts文件大小和信息不准确（MPEG-TS：检测文件的序列）的解决办法</title><link>https://notes.zhangwenbing.com/blog/linux/Sky_LU458CM/</link><pubDate>Mon, 14 May 2018 04:45:01 +0800</pubDate><guid>https://notes.zhangwenbing.com/blog/linux/Sky_LU458CM/</guid><description>&lt;blockquote>
&lt;p>解决mediainfo获取ts媒体信息不准确问题&lt;/p>
&lt;/blockquote>
&lt;h2 id="场景">
 场景
 &lt;a class="anchor" href="#%e5%9c%ba%e6%99%af">#&lt;/a>
&lt;/h2>
&lt;p>在/opt/目录下总共有200多个文件文件名分别如下：&lt;/p>
&lt;p>/opt/2017LPL夏季赛第01集.ts&lt;/p></description></item><item><title>nginx+php+ThinkPHP环境常见错误总结</title><link>https://notes.zhangwenbing.com/blog/linux/ByS8884qI0M/</link><pubDate>Mon, 14 May 2018 04:45:01 +0800</pubDate><guid>https://notes.zhangwenbing.com/blog/linux/ByS8884qI0M/</guid><description>&lt;blockquote>
&lt;p>错误一&lt;/p>
&lt;/blockquote>
&lt;p>2017/09/07 16:39:18 [error] 21753#0: *26 FastCGI sent in stderr: “Primary s…&lt;/p>
&lt;h2 id="错误一">
 错误一
 &lt;a class="anchor" href="#%e9%94%99%e8%af%af%e4%b8%80">#&lt;/a>
&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>2017/09/07 16:39:18 &lt;span style="color:#f92672">[&lt;/span>error&lt;span style="color:#f92672">]&lt;/span> 21753#0: *26 FastCGI sent in stderr: &lt;span style="color:#e6db74">&amp;#34;Primary script unknown&amp;#34;&lt;/span> &lt;span style="color:#66d9ef">while&lt;/span> reading response header from upstream, client: 172.31.26.114, server: localhost, request: &lt;span style="color:#e6db74">&amp;#34;GET /1.php HTTP/1.1&amp;#34;&lt;/span>, upstream: &lt;span style="color:#e6db74">&amp;#34;fastcgi://127.0.0.1:9000&amp;#34;&lt;/span>, host: &lt;span style="color:#e6db74">&amp;#34;10.200.8.220:8000&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="解决版本">
 解决版本
 &lt;a class="anchor" href="#%e8%a7%a3%e5%86%b3%e7%89%88%e6%9c%ac">#&lt;/a>
&lt;/h3>
&lt;p>在server节点下添加以下配置&lt;/p></description></item><item><title>nignx修改最大上传文件大小限制</title><link>https://notes.zhangwenbing.com/blog/linux/rykY88V58CG/</link><pubDate>Mon, 14 May 2018 04:45:01 +0800</pubDate><guid>https://notes.zhangwenbing.com/blog/linux/rykY88V58CG/</guid><description>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>location / &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> root html;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> index index.html index.htm;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> client_max_body_size 1000m;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>“client_max_body_size”设置一下上传的最大上限,然后重启nginx即可。&lt;/p></description></item><item><title>RabbitMQ 三种 Exchange 模式</title><link>https://notes.zhangwenbing.com/blog/linux/HybPILE5U0z/</link><pubDate>Mon, 14 May 2018 04:45:01 +0800</pubDate><guid>https://notes.zhangwenbing.com/blog/linux/HybPILE5U0z/</guid><description>&lt;p>RabbitMQ 中的 Exchange（交换机）负责接收生产者发送的消息，并根据类型将消息路由到相应的队列。常见的三种 Exchange 类型如下：&lt;/p>
&lt;hr>
&lt;h2 id="1-direct-exchange直连模式">
 1. Direct Exchange（直连模式）
 &lt;a class="anchor" href="#1-direct-exchange%e7%9b%b4%e8%bf%9e%e6%a8%a1%e5%bc%8f">#&lt;/a>
&lt;/h2>
&lt;h3 id="-特点">
 ✅ 特点：
 &lt;a class="anchor" href="#-%e7%89%b9%e7%82%b9">#&lt;/a>
&lt;/h3>
&lt;ul>
&lt;li>根据消息的 &lt;strong>routing key&lt;/strong> 精确匹配，将消息路由到绑定了 &lt;strong>相同 routing key&lt;/strong> 的队列。&lt;/li>
&lt;/ul>
&lt;h3 id="-适用场景">
 🎯 适用场景：
 &lt;a class="anchor" href="#-%e9%80%82%e7%94%a8%e5%9c%ba%e6%99%af">#&lt;/a>
&lt;/h3>
&lt;ul>
&lt;li>一对一消息传递。&lt;/li>
&lt;li>多个队列分别订阅不同的消息类型。&lt;/li>
&lt;/ul>
&lt;h3 id="-示例">
 📌 示例：
 &lt;a class="anchor" href="#-%e7%a4%ba%e4%be%8b">#&lt;/a>
&lt;/h3>
&lt;p>绑定情况：&lt;/p></description></item><item><title>rabbitmq 消息队列安装和配置</title><link>https://notes.zhangwenbing.com/blog/linux/HkXeLI4cIAG/</link><pubDate>Mon, 14 May 2018 04:45:01 +0800</pubDate><guid>https://notes.zhangwenbing.com/blog/linux/HkXeLI4cIAG/</guid><description>&lt;h2 id="erlang">
 erlang
 &lt;a class="anchor" href="#erlang">#&lt;/a>
&lt;/h2>
&lt;p>首先安装erlang语言环境&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>yum install erlang -y
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="rabbitmq">
 rabbitMQ
 &lt;a class="anchor" href="#rabbitmq">#&lt;/a>
&lt;/h2>
&lt;p>rabbitMQ下载地址：直达安装方法:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>rpm -ivh --force --nodeps rabbitmq-server-3.6.0-1.noarch.rpm
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>或者
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>yum localinstall rabbitmq-server-3.6.0-1.noarch.rpm -y
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="启动服务">
 启动服务
 &lt;a class="anchor" href="#%e5%90%af%e5%8a%a8%e6%9c%8d%e5%8a%a1">#&lt;/a>
&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>/etc/init.d/rabbitmq-server start
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>rabbitmq-plugins enable rabbitmq_management
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="配置主备">
 配置主备
 &lt;a class="anchor" href="#%e9%85%8d%e7%bd%ae%e4%b8%bb%e5%a4%87">#&lt;/a>
&lt;/h2>
&lt;h3 id="同步cookie">
 同步cookie
 &lt;a class="anchor" href="#%e5%90%8c%e6%ad%a5cookie">#&lt;/a>
&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>chmod &lt;span style="color:#ae81ff">777&lt;/span> /var/lib/rabbitmq/.erlang.cookie
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>scp /var/lib/rabbitmq/.erlang.cookie Go02:/var/lib/rabbitmq/.erlang.cookie
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>chmod &lt;span style="color:#ae81ff">400&lt;/span> /var/lib/rabbitmq/.erlang.cookie
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="添加节点">
 添加节点
 &lt;a class="anchor" href="#%e6%b7%bb%e5%8a%a0%e8%8a%82%e7%82%b9">#&lt;/a>
&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>rabbitmqctl stop_app
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>rabbitmqctl reset
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>rabbitmqctl join_cluster &lt;span style="color:#f92672">[&lt;/span>--ram&lt;span style="color:#f92672">]&lt;/span> rabbit@Go01 //此处的Go01为主节点的hostname,需要在/etc/hosts中指定
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>rabbitmqctl start_app
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="删除节点">
 删除节点
 &lt;a class="anchor" href="#%e5%88%a0%e9%99%a4%e8%8a%82%e7%82%b9">#&lt;/a>
&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>rabbitmqctl stop_app
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>rabbitmqctl forget_cluster_node rabbit@rabbit1
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="修改类型">
 修改类型
 &lt;a class="anchor" href="#%e4%bf%ae%e6%94%b9%e7%b1%bb%e5%9e%8b">#&lt;/a>
&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>rabbitmqctl stop_app
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>rabbitmqctl change_cluster_node_type ram
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>rabbitmqctl start_app
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="添加用户">
 添加用户
 &lt;a class="anchor" href="#%e6%b7%bb%e5%8a%a0%e7%94%a8%e6%88%b7">#&lt;/a>
&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>rabbitmqctl add_user admin admin
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 添加权限:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>rabbitmqctl set_permissions -p &lt;span style="color:#e6db74">&amp;#34;/&amp;#34;&lt;/span> admin &lt;span style="color:#e6db74">&amp;#34;.*&amp;#34;&lt;/span> &lt;span style="color:#e6db74">&amp;#34;.*&amp;#34;&lt;/span> &lt;span style="color:#e6db74">&amp;#34;.*&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 删除测试用户:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>rabbitmqctl delete_user guest
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 赋予其administrator角色：&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>rabbitmqctl set_user_tags admin administrator
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 修改密码：&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>rabbitmqctl change_password admin &lt;span style="color:#e6db74">&amp;#39;12341234&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="修改配置">
 修改配置
 &lt;a class="anchor" href="#%e4%bf%ae%e6%94%b9%e9%85%8d%e7%bd%ae">#&lt;/a>
&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>//防止服务端异常中断恢复后镜像队列不能恢复的问题
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>vim /etc/rabbitmq/rabbitmq.conf
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">[&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">{&lt;/span>rabbit,&lt;span style="color:#f92672">[{&lt;/span>tcp_listeners,&lt;span style="color:#f92672">[&lt;/span>5672&lt;span style="color:#f92672">]}&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">{&lt;/span>cluster_partition_handling, autoheal&lt;span style="color:#f92672">}]}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">]&lt;/span>.
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#不要忘记最后面的那个点号哦！&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="环境变量">
 环境变量
 &lt;a class="anchor" href="#%e7%8e%af%e5%a2%83%e5%8f%98%e9%87%8f">#&lt;/a>
&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>touch /etc/rabbitmq/rabbitmq-env.conf#输入
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> RABBITMQ_NODENAME&lt;span style="color:#f92672">=&lt;/span>FZTEC-240088 节点名称 RABBITMQ_NODE_IP_ADDRESS&lt;span style="color:#f92672">=&lt;/span>127.0.0.1 监听IP
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> RABBITMQ_NODE_PORT&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#ae81ff">5672&lt;/span> 监听端口 RABBITMQ_LOG_BASE&lt;span style="color:#f92672">=&lt;/span>/data/rabbitmq/log 日志目录
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> RABBITMQ_PLUGINS_DIR&lt;span style="color:#f92672">=&lt;/span>/data/rabbitmq/plugins 插件目录
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> RABBITMQ_MNESIA_BASE&lt;span style="color:#f92672">=&lt;/span>/data/rabbitmq/mnesia 后端存储目录
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="rabbitmq的用户角色分类">
 RabbitMQ的用户角色分类
 &lt;a class="anchor" href="#rabbitmq%e7%9a%84%e7%94%a8%e6%88%b7%e8%a7%92%e8%89%b2%e5%88%86%e7%b1%bb">#&lt;/a>
&lt;/h3>
&lt;p>none、management、policymaker、monitoring、administrator&lt;/p></description></item><item><title>RabbitMQ性能优化</title><link>https://notes.zhangwenbing.com/blog/linux/H1z5LL49I0z/</link><pubDate>Mon, 14 May 2018 04:45:01 +0800</pubDate><guid>https://notes.zhangwenbing.com/blog/linux/H1z5LL49I0z/</guid><description>&lt;h2 id="rabbitmqconfig">
 rabbitmq.config
 &lt;a class="anchor" href="#rabbitmqconfig">#&lt;/a>
&lt;/h2>
&lt;p>rabbitmq.config文件时rabbitmq的配置文件，他遵守Erlang配置文件定义。&lt;/p>
&lt;p>rabbitmq.config文件位置：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>Unix $RABBITMQ_HOME/etc/rabbitmq
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Windows %APPDATA%&lt;span style="color:#ae81ff">\R&lt;/span>abbitMQ&lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>例子如下：&lt;/p></description></item><item><title>rabbitmq之机器机器全部断电恢复记录</title><link>https://notes.zhangwenbing.com/blog/linux/rkCKI84cLAG/</link><pubDate>Mon, 14 May 2018 04:45:01 +0800</pubDate><guid>https://notes.zhangwenbing.com/blog/linux/rkCKI84cLAG/</guid><description>&lt;p>今天遇到一个rabbitmq集群同时断电，当机器全部启动的时候发现rabbitmq无法正常启动，然后发现如下日志。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">=&lt;/span>INFO REPORT&lt;span style="color:#f92672">====&lt;/span> 25-Apr-2018::11:11:07 &lt;span style="color:#f92672">===&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Starting RabbitMQ 3.5.3 on Erlang R16B03-1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Copyright &lt;span style="color:#f92672">(&lt;/span>C&lt;span style="color:#f92672">)&lt;/span> 2007-2014 GoPivotal, Inc.
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Licensed under the MPL. See http://www.rabbitmq.com/
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">=&lt;/span>INFO REPORT&lt;span style="color:#f92672">====&lt;/span> 25-Apr-2018::11:11:07 &lt;span style="color:#f92672">===&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>node : rabbit@WIN-ACC2J7AGNM9
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>home dir : C:&lt;span style="color:#ae81ff">\U&lt;/span>sers&lt;span style="color:#ae81ff">\A&lt;/span>dministrator
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>config file&lt;span style="color:#f92672">(&lt;/span>s&lt;span style="color:#f92672">)&lt;/span> : e:/RabbitMQ Data/rabbitmq.config &lt;span style="color:#f92672">(&lt;/span>not found&lt;span style="color:#f92672">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>cookie hash : kR4NuIdBr2n8/4Qt9uIgqQ&lt;span style="color:#f92672">==&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>log : E:/RabbitMQ Data/log/rabbit@WIN-ACC2J7AGNM9.log
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sasl log : E:/RabbitMQ Data/log/rabbit@WIN-ACC2J7AGNM9-sasl.log
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>database dir : e:/RabbitMQ Data/db/rabbit@WIN-ACC2J7AGNM9-mnesia
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">=&lt;/span>WARNING REPORT&lt;span style="color:#f92672">====&lt;/span> 25-Apr-2018::11:11:07 &lt;span style="color:#f92672">===&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Kernel poll &lt;span style="color:#f92672">(&lt;/span>epoll, kqueue, etc&lt;span style="color:#f92672">)&lt;/span> is disabled. Throughput and CPU utilization may worsen.
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">=&lt;/span>INFO REPORT&lt;span style="color:#f92672">====&lt;/span> 25-Apr-2018::11:11:08 &lt;span style="color:#f92672">===&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Memory limit set to 13095MB of 32738MB total.
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">=&lt;/span>INFO REPORT&lt;span style="color:#f92672">====&lt;/span> 25-Apr-2018::11:11:08 &lt;span style="color:#f92672">===&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Disk free limit set to 50MB
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">=&lt;/span>INFO REPORT&lt;span style="color:#f92672">====&lt;/span> 25-Apr-2018::11:11:08 &lt;span style="color:#f92672">===&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Limiting to approx &lt;span style="color:#ae81ff">8092&lt;/span> file handles &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#ae81ff">7280&lt;/span> sockets&lt;span style="color:#f92672">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">=&lt;/span>INFO REPORT&lt;span style="color:#f92672">====&lt;/span> 25-Apr-2018::11:11:38 &lt;span style="color:#f92672">===&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Timeout contacting cluster nodes: &lt;span style="color:#f92672">[&lt;/span>&lt;span style="color:#e6db74">&amp;#39;rabbit@WIN-2W6NDAIZBIA&amp;#39;&lt;/span>&lt;span style="color:#f92672">]&lt;/span>.
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>BACKGROUND
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">==========&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>This cluster node was shut down &lt;span style="color:#66d9ef">while&lt;/span> other nodes were still running.
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>To avoid losing data, you should start the other nodes first, &lt;span style="color:#66d9ef">then&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>start this one. To force this node to start, first invoke
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&amp;#34;rabbitmqctl force_boot&amp;#34;&lt;/span>. If you &lt;span style="color:#66d9ef">do&lt;/span> so, any changes made on other
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>cluster nodes after this one was shut down may be lost.
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>DIAGNOSTICS
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">===========&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>attempted to contact: &lt;span style="color:#f92672">[&lt;/span>&lt;span style="color:#e6db74">&amp;#39;rabbit@WIN-2W6NDAIZBIA&amp;#39;&lt;/span>&lt;span style="color:#f92672">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>rabbit@WIN-2W6NDAIZBIA:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> * connected to epmd &lt;span style="color:#f92672">(&lt;/span>port 4369&lt;span style="color:#f92672">)&lt;/span> on WIN-2W6NDAIZBIA
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> * epmd reports: node &lt;span style="color:#e6db74">&amp;#39;rabbit&amp;#39;&lt;/span> not running at all
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> no other nodes on WIN-2W6NDAIZBIA
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> * suggestion: start the node
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>current node details:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>- node name: &lt;span style="color:#e6db74">&amp;#39;rabbit@WIN-ACC2J7AGNM9&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>- home dir: C:&lt;span style="color:#ae81ff">\U&lt;/span>sers&lt;span style="color:#ae81ff">\A&lt;/span>dministrator
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>- cookie hash: kR4NuIdBr2n8/4Qt9uIgqQ&lt;span style="color:#f92672">==&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>关键的地方在于中间的这段说明：&lt;/p></description></item><item><title>rabbitmq之修改数据和log目录位置位置</title><link>https://notes.zhangwenbing.com/blog/linux/ry3FIUV58AM/</link><pubDate>Mon, 14 May 2018 04:45:01 +0800</pubDate><guid>https://notes.zhangwenbing.com/blog/linux/ry3FIUV58AM/</guid><description>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span> vim /etc/rabbitmq/rabbitmq-env.conf
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># I am a complete /etc/rabbitmq/rabbitmq-env.conf file.&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># Comment lines start with a hash character.&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># This is a /bin/sh script file - use ordinary envt var syntax&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>MNESIA_BASE&lt;span style="color:#f92672">=&lt;/span>/data/rabbitmq/mnesia
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>LOG_BASE&lt;span style="color:#f92672">=&lt;/span>/data/logs/rabbitmq
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>vsftpd 配置方法及访问控制</title><link>https://notes.zhangwenbing.com/blog/linux/BJrx8LE98CG/</link><pubDate>Mon, 14 May 2018 04:45:01 +0800</pubDate><guid>https://notes.zhangwenbing.com/blog/linux/BJrx8LE98CG/</guid><description>&lt;blockquote>
&lt;p>vsftpd 详细配置说明&lt;/p>
&lt;/blockquote>
&lt;h2 id="vsftpd常用配置">
 vsftpd常用配置
 &lt;a class="anchor" href="#vsftpd%e5%b8%b8%e7%94%a8%e9%85%8d%e7%bd%ae">#&lt;/a>
&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#关闭匿名用户访问权限&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>anonymous_enable&lt;span style="color:#f92672">=&lt;/span>NO
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#开启本地用户权限&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>local_enable&lt;span style="color:#f92672">=&lt;/span>YES
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#开启写权限&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>write_enable&lt;span style="color:#f92672">=&lt;/span>YES
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#设置侦听端口&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>listen_port&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#ae81ff">21&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#写文件时的umask&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>local_umask&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#ae81ff">002&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#被动模式及开放端口段&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#pasv_enable=yes&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#pasv_min_port=30000&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#pasv_max_port=50000&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#超时时间&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#idle_session_timeout=6000000&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#data_connection_timeout=6000000&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>dirmessage_enable&lt;span style="color:#f92672">=&lt;/span>YES
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>xferlog_enable&lt;span style="color:#f92672">=&lt;/span>YES
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>connect_from_port_20&lt;span style="color:#f92672">=&lt;/span>YES
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>xferlog_std_format&lt;span style="color:#f92672">=&lt;/span>YES
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>chroot_local_user&lt;span style="color:#f92672">=&lt;/span>YES
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>chroot_list_enable&lt;span style="color:#f92672">=&lt;/span>YES
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>chroot_list_file&lt;span style="color:#f92672">=&lt;/span>/etc/vsftpd/chroot_list
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>listen&lt;span style="color:#f92672">=&lt;/span>YES
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>pam_service_name&lt;span style="color:#f92672">=&lt;/span>vsftpd
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>userlist_enable&lt;span style="color:#f92672">=&lt;/span>YES
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>tcp_wrappers&lt;span style="color:#f92672">=&lt;/span>YES
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>use_localtime&lt;span style="color:#f92672">=&lt;/span>YES
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>reverse_lookup_enable&lt;span style="color:#f92672">=&lt;/span>NO
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#convert_charset_enable=0&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#local_charset=UTF8&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#remote_charset=GB2312&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#double_377=1&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>创建账户&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>useradd -M -s /sbin/nologin -d /mnt/usernamefile/ username
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">for&lt;/span> i in name1 name2 name3;&lt;span style="color:#66d9ef">do&lt;/span> useradd -M -s /sbin/nologin -d /mnt/$i/ $i;&lt;span style="color:#66d9ef">done&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">for&lt;/span> i in name1 name2 name3;&lt;span style="color:#66d9ef">do&lt;/span> echo &lt;span style="color:#e6db74">&amp;#34;&lt;/span>$i&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#ae81ff">123&lt;/span> | passwd --stdin $i ;&lt;span style="color:#66d9ef">done&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="创建目录">
 创建目录
 &lt;a class="anchor" href="#%e5%88%9b%e5%bb%ba%e7%9b%ae%e5%bd%95">#&lt;/a>
&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>mkdir usernamefile
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>chown username:username usernamefile
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">for&lt;/span> i in name1 name2 name3;&lt;span style="color:#66d9ef">do&lt;/span> mkdir /mnt/$i;&lt;span style="color:#66d9ef">done&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">for&lt;/span> i in name1 name2 name3;&lt;span style="color:#66d9ef">do&lt;/span> chown $i:$i /mnt/$i/;&lt;span style="color:#66d9ef">done&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>chmod -R &lt;span style="color:#ae81ff">770&lt;/span> *
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="vsftpd被动模式">
 vsftpd被动模式
 &lt;a class="anchor" href="#vsftpd%e8%a2%ab%e5%8a%a8%e6%a8%a1%e5%bc%8f">#&lt;/a>
&lt;/h2>
&lt;h3 id="1开启被动模式">
 1、开启被动模式
 &lt;a class="anchor" href="#1%e5%bc%80%e5%90%af%e8%a2%ab%e5%8a%a8%e6%a8%a1%e5%bc%8f">#&lt;/a>
&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>vim vsftpd.conf
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>pasv_enable&lt;span style="color:#f92672">=&lt;/span>YES &lt;span style="color:#75715e">#开启被动模式&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>pasv_min_port&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#ae81ff">3000&lt;/span> &lt;span style="color:#75715e">#随机最小端口&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>pasv_max_port&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#ae81ff">4000&lt;/span> &lt;span style="color:#75715e">#随机最大端口&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="2加载内核">
 2、加载内核
 &lt;a class="anchor" href="#2%e5%8a%a0%e8%bd%bd%e5%86%85%e6%a0%b8">#&lt;/a>
&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>modprobe ip_conntrack_ftp
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>modprobe ip_nat_ftp
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="3防火墙">
 3、防火墙
 &lt;a class="anchor" href="#3%e9%98%b2%e7%81%ab%e5%a2%99">#&lt;/a>
&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>vim /etc/sysconfig/iptables 在*filter下加入下
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> -A OUTPUT -p tcp --sport 3000:4000 -j ACCEPT
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> -A INPUT -p tcp --dport 3000:4000 -j ACCEPT
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>iptables-restore &amp;lt; /etc/sysconfig/iptables 加载iptables配置
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="vsftpd虚拟用户">
 vsftpd虚拟用户
 &lt;a class="anchor" href="#vsftpd%e8%99%9a%e6%8b%9f%e7%94%a8%e6%88%b7">#&lt;/a>
&lt;/h2>
&lt;h3 id="1vsftpd安装">
 1、vsftpd安装
 &lt;a class="anchor" href="#1vsftpd%e5%ae%89%e8%a3%85">#&lt;/a>
&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>yum -y install vsftpd &lt;span style="color:#75715e">#vsftpd软件&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>yum -y install db4-utils &lt;span style="color:#75715e">#生成虚拟用户认证数据文件命令&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="2配置vsftp">
 2、配置vsftp
 &lt;a class="anchor" href="#2%e9%85%8d%e7%bd%aevsftp">#&lt;/a>
&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>vim /etc/vsftpd/vsftpd.conf
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> listen&lt;span style="color:#f92672">=&lt;/span>YES &lt;span style="color:#75715e">#独立运行vsftpd&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> anonymous_enable&lt;span style="color:#f92672">=&lt;/span>NO &lt;span style="color:#75715e">#限制匿名用户登录&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> dirmessage_enable&lt;span style="color:#f92672">=&lt;/span>YES
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> xferlog_enable&lt;span style="color:#f92672">=&lt;/span>YES
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> xferlog_file&lt;span style="color:#f92672">=&lt;/span>/var/log/vsftpd.log
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> xferlog_std_format&lt;span style="color:#f92672">=&lt;/span>YES
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> chroot_list_enable&lt;span style="color:#f92672">=&lt;/span>YES &lt;span style="color:#75715e">#限制虚拟用户切换目录&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> chroot_list_file&lt;span style="color:#f92672">=&lt;/span>/etc/vsftpd/chroot_list &lt;span style="color:#75715e">#限制切换目录的用户列表&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> chroot_local_user&lt;span style="color:#f92672">=&lt;/span>YES
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> guest_enable&lt;span style="color:#f92672">=&lt;/span>YES &lt;span style="color:#75715e">#开启虚拟用户认证&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> guest_username&lt;span style="color:#f92672">=&lt;/span>ftp &lt;span style="color:#75715e">#映射的真实用户&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> user_config_dir&lt;span style="color:#f92672">=&lt;/span>/etc/vsftpd/vsftpd_user_conf &lt;span style="color:#75715e">#虚拟用户配置目录&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> pam_service_name&lt;span style="color:#f92672">=&lt;/span>vsftpd.vu &lt;span style="color:#75715e">#vsftpd认证的pam认证模块&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> local_enable&lt;span style="color:#f92672">=&lt;/span>YES
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="3虚拟用户db">
 3、虚拟用户db
 &lt;a class="anchor" href="#3%e8%99%9a%e6%8b%9f%e7%94%a8%e6%88%b7db">#&lt;/a>
&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>cd /etc/vsftpd
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>vim user.txt
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> yuangang &lt;span style="color:#75715e">#用户名&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">123456&lt;/span> &lt;span style="color:#75715e">#密码&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>db_load -T -t hash -f user.txt /etc/vsftpd/vsftpd_login.db
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>chmod &lt;span style="color:#ae81ff">600&lt;/span> /etc/vsftpd/vsftpd_login.db
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 配置pam认证&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>vim /etc/pam.d/vsftpd.vu
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> auth required /lib/security/pam_userdb.so db&lt;span style="color:#f92672">=&lt;/span>/etc/vsftpd/vsftpd_login
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> account required /lib/security/pam_userdb.so db&lt;span style="color:#f92672">=&lt;/span>/etc/vsftpd/vsftpd_login
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>vim /etc/vsftpd/chroot_list &lt;span style="color:#75715e">#限制虚拟用户切换目录&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ftp
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> yuangang
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="4配置虚拟用户">
 4、配置虚拟用户
 &lt;a class="anchor" href="#4%e9%85%8d%e7%bd%ae%e8%99%9a%e6%8b%9f%e7%94%a8%e6%88%b7">#&lt;/a>
&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>cd /etc/vsftpd/vsftpd_user_conf
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>vim yuangang
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> write_enable&lt;span style="color:#f92672">=&lt;/span>YES
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> anon_world_readable_only&lt;span style="color:#f92672">=&lt;/span>NO
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> anon_upload_enable&lt;span style="color:#f92672">=&lt;/span>YES
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> anon_mkdir_write_enable&lt;span style="color:#f92672">=&lt;/span>YES
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> anon_other_write_enable&lt;span style="color:#f92672">=&lt;/span>YES
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> local_root&lt;span style="color:#f92672">=&lt;/span>/data/httpd/yuangang
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 建立虚拟用户ftp目录&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>mkdir /data/httpd/yuangang
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>chown -R ftp.root /data/httpd
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>chmod o+rw /data/httpd/yuangang
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="vsftpd-cmds_allowed">
 vsftpd cmds_allowed
 &lt;a class="anchor" href="#vsftpd-cmds_allowed">#&lt;/a>
&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>cmds_allowed&lt;span style="color:#f92672">=&lt;/span>ABOR,CWD,LIST,MDTM,MKD,NLST,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>PASS,PASV,PORT,PWD,QUIT,RETR,RMD,RNFR,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>RNTO,SITE,SIZE,STOR,TYPE,USER,ACCT,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>APPE,CDUP,HELP,MODE,NOOP,REIN,STAT,STOU,STRU,SYST
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>注意:一定不能使用换行和空格，不然就没效果..&lt;/p></description></item><item><title>web运维相关查询命令</title><link>https://notes.zhangwenbing.com/blog/linux/SJ_88EqU0M/</link><pubDate>Mon, 14 May 2018 04:45:01 +0800</pubDate><guid>https://notes.zhangwenbing.com/blog/linux/SJ_88EqU0M/</guid><description>&lt;h2 id="1-查看tcp连接状态">
 1. 查看TCP连接状态
 &lt;a class="anchor" href="#1-%e6%9f%a5%e7%9c%8btcp%e8%bf%9e%e6%8e%a5%e7%8a%b6%e6%80%81">#&lt;/a>
&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>netstat -nat |awk &lt;span style="color:#e6db74">&amp;#39;{print $6}&amp;#39;&lt;/span>|sort|uniq -c|sort -rn
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>netstat -n | awk &lt;span style="color:#e6db74">&amp;#39;/^tcp/ {++S[$NF]};END {for(a in S) print a, S[a]}&amp;#39;&lt;/span> 或
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>netstat -n | awk &lt;span style="color:#e6db74">&amp;#39;/^tcp/ {++state[$NF]}; END {for(key in state) print key,&amp;#34;\t&amp;#34;,state[key]}&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>netstat -n | awk &lt;span style="color:#e6db74">&amp;#39;/^tcp/ {++arr[$NF]};END {for(k in arr) print k,&amp;#34;\t&amp;#34;,arr[k]}&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>netstat -n |awk &lt;span style="color:#e6db74">&amp;#39;/^tcp/ {print $NF}&amp;#39;&lt;/span>|sort|uniq -c|sort -rn
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>netstat -ant | awk &lt;span style="color:#e6db74">&amp;#39;{print $NF}&amp;#39;&lt;/span> | grep -v &lt;span style="color:#e6db74">&amp;#39;[a-z]&amp;#39;&lt;/span> | sort | uniq -c
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>以上每一行实现的效果基本相同，在此列出不同的写法，方便对脚本写法的更深理解&lt;/p></description></item><item><title>阿里云ECS Linux的rc.local（开机启动）设置不生效</title><link>https://notes.zhangwenbing.com/blog/linux/SytNL84q8Af/</link><pubDate>Mon, 14 May 2018 04:45:01 +0800</pubDate><guid>https://notes.zhangwenbing.com/blog/linux/SytNL84q8Af/</guid><description>&lt;blockquote>
&lt;p>none&lt;/p>
&lt;/blockquote>
&lt;h2 id="使用场景">
 使用场景
 &lt;a class="anchor" href="#%e4%bd%bf%e7%94%a8%e5%9c%ba%e6%99%af">#&lt;/a>
&lt;/h2>
&lt;p>前段时间使用阿里云的ecs，将一些开机启动的命令写到/etc/rc.local里面，发现不生效。经过一番查询和搜索之后，最后发现一个坑，居然要给这个文件设置执行权限才生效。&lt;/p></description></item><item><title>排查linux根目录空间占用与实际空间不符</title><link>https://notes.zhangwenbing.com/blog/linux/HJqtULE5I0z/</link><pubDate>Mon, 14 May 2018 04:45:01 +0800</pubDate><guid>https://notes.zhangwenbing.com/blog/linux/HJqtULE5I0z/</guid><description>&lt;h2 id="发现问题">
 发现问题
 &lt;a class="anchor" href="#%e5%8f%91%e7%8e%b0%e9%97%ae%e9%a2%98">#&lt;/a>
&lt;/h2>
&lt;p>首先使用”df -Th”查看根目录的空间使用和”du -sh /“的结果进行对比。&lt;/p>
&lt;h2 id="排查问题">
 排查问题
 &lt;a class="anchor" href="#%e6%8e%92%e6%9f%a5%e9%97%ae%e9%a2%98">#&lt;/a>
&lt;/h2>
&lt;h3 id="第一种情况">
 第一种情况
 &lt;a class="anchor" href="#%e7%ac%ac%e4%b8%80%e7%a7%8d%e6%83%85%e5%86%b5">#&lt;/a>
&lt;/h3>
&lt;p>文件被删掉，但是写这个文件的进程没退出&lt;/p></description></item></channel></rss>